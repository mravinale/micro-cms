(function(){function Sanitize(){var e,t,n;n=arguments[0]||{};this.jQuery=arguments[1]||{};this.config={};this.config.elements=n.elements?n.elements:[];this.config.attributes=n.attributes?n.attributes:{};this.config.attributes[Sanitize.ALL]=this.config.attributes[Sanitize.ALL]?this.config.attributes[Sanitize.ALL]:[];this.config.allow_comments=n.allow_comments?n.allow_comments:false;this.allowed_elements={};this.config.protocols=n.protocols?n.protocols:{};this.config.add_attributes=n.add_attributes?n.add_attributes:{};this.dom=n.dom?n.dom:document;for(e=0;e<this.config.elements.length;e++){this.allowed_elements[this.config.elements[e]]=true}this.config.remove_element_contents={};this.config.remove_all_contents=false;if(n.remove_contents){if(n.remove_contents instanceof Array){for(e=0;e<n.remove_contents.length;e++){this.config.remove_element_contents[n.remove_contents[e]]=true}}else{this.config.remove_all_contents=true}}this.transformers=n.transformers?n.transformers:[];this.filters=n.filters?n.filters:[]}var JSON;if(!JSON){JSON={}}(function(){function f(e){return e<10?"0"+e:e}function quote(e){escapable.lastIndex=0;return escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t==="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];if(a&&typeof a==="object"&&typeof a.toJSON==="function"){a=a.toJSON(e)}if(typeof rep==="function"){a=rep.call(t,e,a)}switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a){return"null"}gap+=indent;u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1){u[n]=str(n,a)||"null"}i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]";gap=o;return i}if(rep&&typeof rep==="object"){s=rep.length;for(n=0;n<s;n+=1){if(typeof rep[n]==="string"){r=rep[n];i=str(r,a);if(i){u.push(quote(r)+(gap?": ":":")+i)}}}}else{for(r in a){if(Object.prototype.hasOwnProperty.call(a,r)){i=str(r,a);if(i){u.push(quote(r)+(gap?": ":":")+i)}}}}i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}";gap=o;return i}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;if(typeof JSON.stringify!=="function"){JSON.stringify=function(e,t,n){var r;gap="";indent="";if(typeof n==="number"){for(r=0;r<n;r+=1){indent+=" "}}else if(typeof n==="string"){indent=n}rep=t;if(t&&typeof t!=="function"&&(typeof t!=="object"||typeof t.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":e})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i==="object"){for(n in i){if(Object.prototype.hasOwnProperty.call(i,n)){r=walk(i,n);if(r!==undefined){i[n]=r}else{delete i[n]}}}}return reviver.call(e,t,i)}var j;text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})();define("util/json2",[],function(){return JSON});(function(){var e=function(){function u(n,r){var i=typeof n[r];return i==t||!!(i==e&&n[r])||i=="unknown"}function a(t,n){return!!(typeof t[n]==e&&t[n])}function f(e,t){return typeof e[t]!=n}function l(e){return function(t,n){var r=n.length;while(r--){if(!e(t,n[r])){return false}}return true}}function d(e){return e&&c(e,o)&&p(e,s)}function m(e){window.alert("Rangy not supported in your browser. Reason: "+e);v.initialized=true;v.supported=false}function g(e){var t="Rangy warning: "+e;if(v.config.alertOnWarn){window.alert(t)}else if(typeof window.console!=n&&typeof window.console.log!=n){window.console.log(t)}}function w(){if(v.initialized){return}var e;var t=false,n=false;if(u(document,"createRange")){e=document.createRange();if(c(e,i)&&p(e,r)){t=true}e.detach()}var s=a(document,"body")?document.body:document.getElementsByTagName("body")[0];if(s&&u(s,"createTextRange")){e=s.createTextRange();if(d(e)){n=true}}if(!t&&!n){m("Neither Range nor TextRange are implemented")}v.initialized=true;v.features={implementsDomRange:t,implementsTextRange:n};var o=b.concat(y);for(var f=0,l=o.length;f<l;++f){try{o[f](v)}catch(h){if(a(window,"console")&&u(window.console,"log")){window.console.log("Init listener threw an exception. Continuing.",h)}}}}function S(e){e=e||window;w();for(var t=0,n=E.length;t<n;++t){E[t](e)}}function x(e){this.name=e;this.initialized=false;this.supported=false}var e="object",t="function",n="undefined";var r=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"];var i=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];var s=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];var o=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"];var c=l(u);var h=l(a);var p=l(f);var v={version:"1.2.1",initialized:false,supported:true,util:{isHostMethod:u,isHostObject:a,isHostProperty:f,areHostMethods:c,areHostObjects:h,areHostProperties:p,isTextRange:d},features:{},modules:{},config:{alertOnWarn:false,preferTextRange:true}};v.fail=m;v.warn=g;if({}.hasOwnProperty){v.util.extend=function(e,t){for(var n in t){if(t.hasOwnProperty(n)){e[n]=t[n]}}}}else{m("hasOwnProperty not supported")}var y=[];var b=[];v.init=w;v.addInitListener=function(e){if(v.initialized){e(v)}else{y.push(e)}};var E=[];v.addCreateMissingNativeApiListener=function(e){E.push(e)};v.createMissingNativeApi=S;x.prototype.fail=function(e){this.initialized=true;this.supported=false;throw new Error("Module '"+this.name+"' failed to load: "+e)};x.prototype.warn=function(e){v.warn("Module "+this.name+": "+e)};x.prototype.createError=function(e){return new Error("Error in Rangy "+this.name+" module: "+e)};v.createModule=function(e,t){var n=new x(e);v.modules[e]=n;b.push(function(e){t(e,n);n.initialized=true;n.supported=true})};v.requireModules=function(e){for(var t=0,n=e.length,r,i;t<n;++t){i=e[t];r=v.modules[i];if(!r||!(r instanceof x)){throw new Error("Module '"+i+"' not found")}if(!r.supported){throw new Error("Module '"+i+"' not supported")}}};var T=false;var N=function(e){if(!T){T=true;if(!v.initialized){w()}}};if(typeof window==n){m("No window found");return}if(typeof document==n){m("No document found");return}if(u(document,"addEventListener")){document.addEventListener("DOMContentLoaded",N,false)}if(u(window,"addEventListener")){window.addEventListener("load",N,false)}else if(u(window,"attachEvent")){window.attachEvent("onload",N)}else{m("Window does not have required addEventListener or attachEvent method")}return v}();e.createModule("DomUtil",function(e,t){function u(e){var t;return typeof e.namespaceURI==n||(t=e.namespaceURI)===null||t=="http://www.w3.org/1999/xhtml"}function a(e){var t=e.parentNode;return t.nodeType==1?t:null}function f(e){var t=0;while(e=e.previousSibling){t++}return t}function l(e){var t;return d(e)?e.length:(t=e.childNodes)?t.length:0}function c(e,t){var n=[],r;for(r=e;r;r=r.parentNode){n.push(r)}for(r=t;r;r=r.parentNode){if(o(n,r)){return r}}return null}function h(e,t,n){var r=n?t:t.parentNode;while(r){if(r===e){return true}else{r=r.parentNode}}return false}function p(e,t,n){var r,i=n?e:e.parentNode;while(i){r=i.parentNode;if(r===t){return i}i=r}return null}function d(e){var t=e.nodeType;return t==3||t==4||t==8}function v(e,t){var n=t.nextSibling,r=t.parentNode;if(n){r.insertBefore(e,n)}else{r.appendChild(e)}return e}function m(e,t){var n=e.cloneNode(false);n.deleteData(0,t);e.deleteData(t,e.length-t);v(n,e);return n}function g(e){if(e.nodeType==9){return e}else if(typeof e.ownerDocument!=n){return e.ownerDocument}else if(typeof e.document!=n){return e.document}else if(e.parentNode){return g(e.parentNode)}else{throw new Error("getDocument: no document found for node")}}function y(e){var t=g(e);if(typeof t.defaultView!=n){return t.defaultView}else if(typeof t.parentWindow!=n){return t.parentWindow}else{throw new Error("Cannot get a window object for node")}}function b(e){if(typeof e.contentDocument!=n){return e.contentDocument}else if(typeof e.contentWindow!=n){return e.contentWindow.document}else{throw new Error("getIframeWindow: No Document object found for iframe element")}}function w(e){if(typeof e.contentWindow!=n){return e.contentWindow}else if(typeof e.contentDocument!=n){return e.contentDocument.defaultView}else{throw new Error("getIframeWindow: No Window object found for iframe element")}}function E(e){return r.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}function S(e){var t;while(t=e.parentNode){e=t}return e}function x(e){if(!e){return}if(e.previousSibling){return e.previousSibling.nextSibling}else if(e.nextSibling){return e.nextSibling.previousSibling}else if(e.parentNode){return e.parentNode.firstChild}else{return e}}function T(e,t,n,r){e=x(e);n=x(n);var i,s,o,u,a;if(e==n){return t===r?0:t<r?-1:1}else if(i=p(n,e,true)){return t<=f(i)?-1:1}else if(i=p(e,n,true)){return f(i)<r?-1:1}else{s=c(e,n);o=e===s?s:p(e,s,true);u=n===s?s:p(n,s,true);if(o===u){throw new Error("comparePoints got to case 4 and childA and childB are the same!")}else{a=s.firstChild;while(a){if(a===o){return-1}else if(a===u){return 1}a=a.nextSibling}throw new Error("Should not be here!")}}}function N(e){var t=g(e).createDocumentFragment(),n;while(n=e.firstChild){t.appendChild(n)}return t}function C(e){if(!e){return"[No node]"}if(d(e)){return'"'+e.data+'"'}else if(e.nodeType==1){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+e.childNodes.length+"]"}else{return e.nodeName}}function k(e){this.root=e;this._next=e}function L(e){return new k(e)}function A(e,t){this.node=e;this.offset=t}function O(e){this.code=this[e];this.codeName=e;this.message="DOMException: "+this.codeName}var n="undefined";var r=e.util;if(!r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])){t.fail("document missing a Node creation method")}if(!r.isHostMethod(document,"getElementsByTagName")){t.fail("document missing getElementsByTagName method")}var i=document.createElement("div");if(!r.areHostMethods(i,["insertBefore","appendChild","cloneNode"]||!r.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"]))){t.fail("Incomplete Element implementation")}if(!r.isHostProperty(i,"innerHTML")){t.fail("Element is missing innerHTML property")}var s=document.createTextNode("test");if(!r.areHostMethods(s,["splitText","deleteData","insertData","appendData","cloneNode"]||!r.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"])||!r.areHostProperties(s,["data"]))){t.fail("Incomplete Text Node implementation")}var o=function(e,t){var n=e.length;while(n--){if(e[n]===t){return true}}return false};k.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;var t,n;if(this._current){t=e.firstChild;if(t){this._next=t}else{n=null;while(e!==this.root&&!(n=e.nextSibling)){e=e.parentNode}this._next=n}}return this._current},detach:function(){this._current=this._next=this.root=null}};A.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+C(this.node)+":"+this.offset+")]"}};O.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};O.prototype.toString=function(){return this.message};e.dom={arrayContains:o,isHtmlNamespace:u,parentElement:a,getNodeIndex:f,getNodeLength:l,getCommonAncestor:c,isAncestorOf:h,getClosestAncestorIn:p,isCharacterDataNode:d,insertAfter:v,splitDataNode:m,getDocument:g,getWindow:y,getIframeWindow:w,getIframeDocument:b,getBody:E,getRootContainer:S,comparePoints:T,inspectNode:C,fragmentFromNodeChildren:N,createIterator:L,DomPosition:A};e.DOMException=O});e.createModule("DomRange",function(e,t){function s(e,t){return e.nodeType!=3&&(n.isAncestorOf(e,t.startContainer,true)||n.isAncestorOf(e,t.endContainer,true))}function o(e){return n.getDocument(e.startContainer)}function u(e,t,n){var r=e._listeners[t];if(r){for(var i=0,s=r.length;i<s;++i){r[i].call(e,{target:e,args:n})}}}function a(e){return new r(e.parentNode,n.getNodeIndex(e))}function f(e){return new r(e.parentNode,n.getNodeIndex(e)+1)}function l(e,t,r){var i=e.nodeType==11?e.firstChild:e;if(n.isCharacterDataNode(t)){if(r==t.length){n.insertAfter(e,t)}else{t.parentNode.insertBefore(e,r==0?t:n.splitDataNode(t,r))}}else if(r>=t.childNodes.length){t.appendChild(e)}else{t.insertBefore(e,t.childNodes[r])}return i}function c(e){var t;for(var n,r=o(e.range).createDocumentFragment(),s;n=e.next();){t=e.isPartiallySelectedSubtree();n=n.cloneNode(!t);if(t){s=e.getSubtreeIterator();n.appendChild(c(s));s.detach(true)}if(n.nodeType==10){throw new i("HIERARCHY_REQUEST_ERR")}r.appendChild(n)}return r}function h(e,t,r){var i,s;r=r||{stop:false};for(var o,u;o=e.next();){if(e.isPartiallySelectedSubtree()){if(t(o)===false){r.stop=true;return}else{u=e.getSubtreeIterator();h(u,t,r);u.detach(true);if(r.stop){return}}}else{i=n.createIterator(o);while(s=i.next()){if(t(s)===false){r.stop=true;return}}}}}function p(e){var t;while(e.next()){if(e.isPartiallySelectedSubtree()){t=e.getSubtreeIterator();p(t);t.detach(true)}else{e.remove()}}}function d(e){for(var t,n=o(e.range).createDocumentFragment(),r;t=e.next();){if(e.isPartiallySelectedSubtree()){t=t.cloneNode(false);r=e.getSubtreeIterator();t.appendChild(d(r));r.detach(true)}else{e.remove()}if(t.nodeType==10){throw new i("HIERARCHY_REQUEST_ERR")}n.appendChild(t)}return n}function v(e,t,n){var r=!!(t&&t.length),i;var s=!!n;if(r){i=new RegExp("^("+t.join("|")+")$")}var o=[];h(new g(e,false),function(e){if((!r||i.test(e.nodeType))&&(!s||n(e))){o.push(e)}});return o}function m(e){var t=typeof e.getName=="undefined"?"Range":e.getName();return"["+t+"("+n.inspectNode(e.startContainer)+":"+e.startOffset+", "+n.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function g(e,t){this.range=e;this.clonePartiallySelectedTextNodes=t;if(!e.collapsed){this.sc=e.startContainer;this.so=e.startOffset;this.ec=e.endContainer;this.eo=e.endOffset;var r=e.commonAncestorContainer;if(this.sc===this.ec&&n.isCharacterDataNode(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc}else{this._first=this._next=this.sc===r&&!n.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:n.getClosestAncestorIn(this.sc,r,true);this._last=this.ec===r&&!n.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:n.getClosestAncestorIn(this.ec,r,true)}}}function y(e){this.code=this[e];this.codeName=e;this.message="RangeException: "+this.codeName}function b(e,t,n){this.nodes=v(e,t,n);this._next=this.nodes[0];this._position=0}function N(e){return function(t,r){var i,s=r?t:t.parentNode;while(s){i=s.nodeType;if(n.arrayContains(e,i)){return s}s=s.parentNode}return null}}function O(e,t){if(A(e,t)){throw new y("INVALID_NODE_TYPE_ERR")}}function M(e){if(!e.startContainer){throw new i("INVALID_STATE_ERR")}}function _(e,t){if(!n.arrayContains(t,e.nodeType)){throw new y("INVALID_NODE_TYPE_ERR")}}function D(e,t){if(t<0||t>(n.isCharacterDataNode(e)?e.length:e.childNodes.length)){throw new i("INDEX_SIZE_ERR")}}function P(e,t){if(k(e,true)!==k(t,true)){throw new i("WRONG_DOCUMENT_ERR")}}function H(e){if(L(e,true)){throw new i("NO_MODIFICATION_ALLOWED_ERR")}}function B(e,t){if(!e){throw new i(t)}}function j(e){return!n.arrayContains(E,e.nodeType)&&!k(e,true)}function F(e,t){return t<=(n.isCharacterDataNode(e)?e.length:e.childNodes.length)}function I(e){M(e);if(j(e.startContainer)||j(e.endContainer)||!F(e.startContainer,e.startOffset)||!F(e.endContainer,e.endOffset)){throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}}function Z(){}function et(e){e.START_TO_START=X;e.START_TO_END=V;e.END_TO_END=$;e.END_TO_START=J;e.NODE_BEFORE=K;e.NODE_AFTER=Q;e.NODE_BEFORE_AND_AFTER=G;e.NODE_INSIDE=Y}function tt(e){et(e);et(e.prototype)}function nt(e,t){return function(){I(this);var r=this.startContainer,i=this.startOffset,s=this.commonAncestorContainer;var o=new g(this,true);var u,a;if(r!==s){u=n.getClosestAncestorIn(r,s,true);a=f(u);r=a.node;i=a.offset}h(o,H);o.reset();var l=e(o);o.detach();t(this,r,i,r,i);return l}}function rt(t,r,i){function o(e,t){return function(n){M(this);_(n,w);_(C(n),E);var r=(e?a:f)(n);(t?u:l)(this,r.node,r.offset)}}function u(e,t,i){var s=e.endContainer,o=e.endOffset;if(t!==e.startContainer||i!==this.startOffset){if(C(t)!=C(s)||n.comparePoints(t,i,s,o)==1){s=t;o=i}r(e,t,i,s,o)}}function l(e,t,i){var s=e.startContainer,o=e.startOffset;if(t!==e.endContainer||i!==this.endOffset){if(C(t)!=C(s)||n.comparePoints(t,i,s,o)==-1){s=t;o=i}r(e,s,o,t,i)}}function c(e,t,n){if(t!==e.startContainer||n!==this.startOffset||t!==e.endContainer||n!==this.endOffset){r(e,t,n,t,n)}}t.prototype=new Z;e.util.extend(t.prototype,{setStart:function(e,t){M(this);O(e,true);D(e,t);u(this,e,t)},setEnd:function(e,t){M(this);O(e,true);D(e,t);l(this,e,t)},setStartBefore:o(true,true),setStartAfter:o(false,true),setEndBefore:o(true,false),setEndAfter:o(false,false),collapse:function(e){I(this);if(e){r(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset)}else{r(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)}},selectNodeContents:function(e){M(this);O(e,true);r(this,e,0,e,n.getNodeLength(e))},selectNode:function(e){M(this);O(e,false);_(e,w);var t=a(e),n=f(e);r(this,t.node,t.offset,n.node,n.offset)},extractContents:nt(d,r),deleteContents:nt(p,r),canSurroundContents:function(){I(this);H(this.startContainer);H(this.endContainer);var e=new g(this,true);var t=e._first&&s(e._first,this)||e._last&&s(e._last,this);e.detach();return!t},detach:function(){i(this)},splitBoundaries:function(){I(this);var e=this.startContainer,t=this.startOffset,i=this.endContainer,s=this.endOffset;var o=e===i;if(n.isCharacterDataNode(i)&&s>0&&s<i.length){n.splitDataNode(i,s)}if(n.isCharacterDataNode(e)&&t>0&&t<e.length){e=n.splitDataNode(e,t);if(o){s-=t;i=e}else if(i==e.parentNode&&s>=n.getNodeIndex(e)){s++}t=0}r(this,e,t,i,s)},normalizeBoundaries:function(){I(this);var e=this.startContainer,t=this.startOffset,i=this.endContainer,s=this.endOffset;var o=function(e){var t=e.nextSibling;if(t&&t.nodeType==e.nodeType){i=e;s=e.length;e.appendData(t.data);t.parentNode.removeChild(t)}};var u=function(r){var o=r.previousSibling;if(o&&o.nodeType==r.nodeType){e=r;var u=r.length;t=o.length;r.insertData(0,o.data);o.parentNode.removeChild(o);if(e==i){s+=t;i=e}else if(i==r.parentNode){var a=n.getNodeIndex(r);if(s==a){i=r;s=u}else if(s>a){s--}}}};var a=true;if(n.isCharacterDataNode(i)){if(i.length==s){o(i)}}else{if(s>0){var f=i.childNodes[s-1];if(f&&n.isCharacterDataNode(f)){o(f)}}a=!this.collapsed}if(a){if(n.isCharacterDataNode(e)){if(t==0){u(e)}}else{if(t<e.childNodes.length){var l=e.childNodes[t];if(l&&n.isCharacterDataNode(l)){u(l)}}}}else{e=i;t=s}r(this,e,t,i,s)},collapseToPoint:function(e,t){M(this);O(e,true);D(e,t);c(this,e,t)}});tt(t)}function it(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset;e.commonAncestorContainer=e.collapsed?e.startContainer:n.getCommonAncestor(e.startContainer,e.endContainer)}function st(e,t,n,r,i){var s=e.startContainer!==t||e.startOffset!==n;var o=e.endContainer!==r||e.endOffset!==i;e.startContainer=t;e.startOffset=n;e.endContainer=r;e.endOffset=i;it(e);u(e,"boundarychange",{startMoved:s,endMoved:o})}function ot(e){M(e);e.startContainer=e.startOffset=e.endContainer=e.endOffset=null;e.collapsed=e.commonAncestorContainer=null;u(e,"detach",null);e._listeners=null}function ut(e){this.startContainer=e;this.startOffset=0;this.endContainer=e;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};it(this)}e.requireModules(["DomUtil"]);var n=e.dom;var r=n.DomPosition;var i=e.DOMException;g.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;if(e){this._next=e!==this._last?e.nextSibling:null;if(n.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes){if(e===this.ec){(e=e.cloneNode(true)).deleteData(this.eo,e.length-this.eo)}if(this._current===this.sc){(e=e.cloneNode(true)).deleteData(0,this.so)}}}return e},remove:function(){var e=this._current,t,r;if(n.isCharacterDataNode(e)&&(e===this.sc||e===this.ec)){t=e===this.sc?this.so:0;r=e===this.ec?this.eo:e.length;if(t!=r){e.deleteData(t,r-t)}}else{if(e.parentNode){e.parentNode.removeChild(e)}else{}}},isPartiallySelectedSubtree:function(){var e=this._current;return s(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode){e=this.range.cloneRange();e.collapse()}else{e=new ut(o(this.range));var t=this._current;var r=t,i=0,s=t,u=n.getNodeLength(t);if(n.isAncestorOf(t,this.sc,true)){r=this.sc;i=this.so}if(n.isAncestorOf(t,this.ec,true)){s=this.ec;u=this.eo}st(e,r,i,s,u)}return new g(e,this.clonePartiallySelectedTextNodes)},detach:function(e){if(e){this.range.detach()}this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};y.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};y.prototype.toString=function(){return this.message};b.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var w=[1,3,4,5,7,8,10];var E=[2,9,11];var S=[5,6,10,12];var x=[1,3,4,5,7,8,10,11];var T=[1,3,4,5,7,8];var C=n.getRootContainer;var k=N([9,11]);var L=N(S);var A=N([6,10,12]);var q=document.createElement("style");var R=false;try{q.innerHTML="<b>x</b>";R=q.firstChild.nodeType==3}catch(U){}e.features.htmlParsingConforms=R;var z=R?function(e){var t=this.startContainer;var r=n.getDocument(t);if(!t){throw new i("INVALID_STATE_ERR")}var s=null;if(t.nodeType==1){s=t}else if(n.isCharacterDataNode(t)){s=n.parentElement(t)}if(s===null||s.nodeName=="HTML"&&n.isHtmlNamespace(n.getDocument(s).documentElement)&&n.isHtmlNamespace(s)){s=r.createElement("body")}else{s=s.cloneNode(false)}s.innerHTML=e;return n.fragmentFromNodeChildren(s)}:function(e){M(this);var t=o(this);var r=t.createElement("body");r.innerHTML=e;return n.fragmentFromNodeChildren(r)};var W=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var X=0,V=1,$=2,J=3;var K=0,Q=1,G=2,Y=3;Z.prototype={attachListener:function(e,t){this._listeners[e].push(t)},compareBoundaryPoints:function(e,t){I(this);P(this.startContainer,t.startContainer);var r,i,s,o;var u=e==J||e==X?"start":"end";var a=e==V||e==X?"start":"end";r=this[u+"Container"];i=this[u+"Offset"];s=t[a+"Container"];o=t[a+"Offset"];return n.comparePoints(r,i,s,o)},insertNode:function(e){I(this);_(e,x);H(this.startContainer);if(n.isAncestorOf(e,this.startContainer,true)){throw new i("HIERARCHY_REQUEST_ERR")}var t=l(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){I(this);var e,t;if(this.collapsed){return o(this).createDocumentFragment()}else{if(this.startContainer===this.endContainer&&n.isCharacterDataNode(this.startContainer)){e=this.startContainer.cloneNode(true);e.data=e.data.slice(this.startOffset,this.endOffset);t=o(this).createDocumentFragment();t.appendChild(e);return t}else{var r=new g(this,true);e=c(r);r.detach()}return e}},canSurroundContents:function(){I(this);H(this.startContainer);H(this.endContainer);var e=new g(this,true);var t=e._first&&s(e._first,this)||e._last&&s(e._last,this);e.detach();return!t},surroundContents:function(e){_(e,T);if(!this.canSurroundContents()){throw new y("BAD_BOUNDARYPOINTS_ERR")}var t=this.extractContents();if(e.hasChildNodes()){while(e.lastChild){e.removeChild(e.lastChild)}}l(e,this.startContainer,this.startOffset);e.appendChild(t);this.selectNode(e)},cloneRange:function(){I(this);var e=new ut(o(this));var t=W.length,n;while(t--){n=W[t];e[n]=this[n]}return e},toString:function(){I(this);var e=this.startContainer;if(e===this.endContainer&&n.isCharacterDataNode(e)){return e.nodeType==3||e.nodeType==4?e.data.slice(this.startOffset,this.endOffset):""}else{var t=[],r=new g(this,true);h(r,function(e){if(e.nodeType==3||e.nodeType==4){t.push(e.data)}});r.detach();return t.join("")}},compareNode:function(e){I(this);var t=e.parentNode;var r=n.getNodeIndex(e);if(!t){throw new i("NOT_FOUND_ERR")}var s=this.comparePoint(t,r),o=this.comparePoint(t,r+1);if(s<0){return o>0?G:K}else{return o>0?Q:Y}},comparePoint:function(e,t){I(this);B(e,"HIERARCHY_REQUEST_ERR");P(e,this.startContainer);if(n.comparePoints(e,t,this.startContainer,this.startOffset)<0){return-1}else if(n.comparePoints(e,t,this.endContainer,this.endOffset)>0){return 1}return 0},createContextualFragment:z,toHtml:function(){I(this);var e=o(this).createElement("div");e.appendChild(this.cloneContents());return e.innerHTML},intersectsNode:function(e,t){I(this);B(e,"NOT_FOUND_ERR");if(n.getDocument(e)!==o(this)){return false}var r=e.parentNode,i=n.getNodeIndex(e);B(r,"NOT_FOUND_ERR");var s=n.comparePoints(r,i,this.endContainer,this.endOffset),u=n.comparePoints(r,i+1,this.startContainer,this.startOffset);return t?s<=0&&u>=0:s<0&&u>0},isPointInRange:function(e,t){I(this);B(e,"HIERARCHY_REQUEST_ERR");P(e,this.startContainer);return n.comparePoints(e,t,this.startContainer,this.startOffset)>=0&&n.comparePoints(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e,t){I(this);if(o(e)!=o(this)){throw new i("WRONG_DOCUMENT_ERR")}var r=n.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset),s=n.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset);return t?r<=0&&s>=0:r<0&&s>0},intersection:function(e){if(this.intersectsRange(e)){var t=n.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),r=n.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset);var i=this.cloneRange();if(t==-1){i.setStart(e.startContainer,e.startOffset)}if(r==1){i.setEnd(e.endContainer,e.endOffset)}return i}return null},union:function(e){if(this.intersectsRange(e,true)){var t=this.cloneRange();if(n.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1){t.setStart(e.startContainer,e.startOffset)}if(n.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)==1){t.setEnd(e.endContainer,e.endOffset)}return t}else{throw new y("Ranges do not intersect")}},containsNode:function(e,t){if(t){return this.intersectsNode(e,false)}else{return this.compareNode(e)==Y}},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,n.getNodeLength(e))<=0},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();t.setEnd(r,r.length);var i=this.containsRange(t);t.detach();return i}else{return this.containsNodeContents(e)}},createNodeIterator:function(e,t){I(this);return new b(this,e,t)},getNodes:function(e,t){I(this);return v(this,e,t)},getDocument:function(){return o(this)},collapseBefore:function(e){M(this);this.setEndBefore(e);this.collapse(false)},collapseAfter:function(e){M(this);this.setStartAfter(e);this.collapse(true)},getName:function(){return"DomRange"},equals:function(e){return ut.rangesEqual(this,e)},inspect:function(){return m(this)}};rt(ut,st,ot);e.rangePrototype=Z.prototype;ut.rangeProperties=W;ut.RangeIterator=g;ut.copyComparisonConstants=tt;ut.createPrototypeRange=rt;ut.inspect=m;ut.getRangeDocument=o;ut.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset};e.DomRange=ut;e.RangeException=y});e.createModule("WrappedRange",function(e,t){function o(e){var t=e.parentElement();var n=e.duplicate();n.collapse(true);var i=n.parentElement();n=e.duplicate();n.collapse(false);var s=n.parentElement();var o=i==s?i:r.getCommonAncestor(i,s);return o==t?o:r.getCommonAncestor(t,o)}function u(e){return e.compareEndPoints("StartToEnd",e)==0}function a(e,t,n,s){var o=e.duplicate();o.collapse(n);var u=o.parentElement();if(!r.isAncestorOf(t,u,true)){u=t}if(!u.canHaveHTML){return new i(u.parentNode,r.getNodeIndex(u))}var a=r.getDocument(u).createElement("span");if(a.parentNode){a.parentNode.removeChild(a)}var f,l=n?"StartToStart":"StartToEnd";var c,h,p,d;do{u.insertBefore(a,a.previousSibling);o.moveToElementText(a)}while((f=o.compareEndPoints(l,e))>0&&a.previousSibling);d=a.nextSibling;if(f==-1&&d&&r.isCharacterDataNode(d)){o.setEndPoint(n?"EndToStart":"EndToEnd",e);var v;if(/[\r\n]/.test(d.data)){var m=o.duplicate();var g=m.text.replace(/\r\n/g,"\r").length;v=m.moveStart("character",g);while((f=m.compareEndPoints("StartToEnd",m))==-1){v++;m.moveStart("character",1)}}else{var y=o.text.replace(/\u00a0/g," ");var b=d.data.replace(/\u00a0/g," ");if(b.indexOf(y)!==0){while(y.length>0&&b.indexOf(y)!==0){y=y.substr(1)}v=y.length}else{v=o.text.length}}p=new i(d,v)}else{c=(s||!n)&&a.previousSibling;h=(s||n)&&a.nextSibling;if(h&&r.isCharacterDataNode(h)){p=new i(h,0)}else if(c&&r.isCharacterDataNode(c)){p=new i(c,c.length)}else{p=new i(u,r.getNodeIndex(a))}}a.parentNode.removeChild(a);return p}function f(e,t){var n,i,s=e.offset;var o=r.getDocument(e.node);var u,a,f=o.body.createTextRange();var l=r.isCharacterDataNode(e.node);if(l){n=e.node;i=n.parentNode}else{a=e.node.childNodes;n=s<a.length?a[s]:null;i=e.node}u=o.createElement("span");u.innerHTML="&#feff;";if(n){i.insertBefore(u,n)}else{i.appendChild(u)}try{f.moveToElementText(u);f.collapse(!t)}catch(c){}i.removeChild(u);if(l){f[t?"moveStart":"moveEnd"]("character",s)}return f}e.requireModules(["DomUtil","DomRange"]);var n;var r=e.dom;var i=r.DomPosition;var s=e.DomRange;if(e.features.implementsDomRange&&(!e.features.implementsTextRange||!e.config.preferTextRange)){(function(){function u(e){var t=i.length,n;while(t--){n=i[t];e[n]=e.nativeRange[n]}}function a(e,t,n,r,i){var s=e.startContainer!==t||e.startOffset!=n;var o=e.endContainer!==r||e.endOffset!=i;if(s||o){e.setEnd(r,i);e.setStart(t,n)}}function f(e){e.nativeRange.detach();e.detached=true;var t=i.length,n;while(t--){n=i[t];e[n]=null}}var t;var i=s.rangeProperties;var o;var l;n=function(e){if(!e){throw new Error("Range must be specified")}this.nativeRange=e;u(this)};s.createPrototypeRange(n,a,f);t=n.prototype;t.selectNode=function(e){this.nativeRange.selectNode(e);u(this)};t.deleteContents=function(){this.nativeRange.deleteContents();u(this)};t.extractContents=function(){var e=this.nativeRange.extractContents();u(this);return e};t.cloneContents=function(){return this.nativeRange.cloneContents()};t.surroundContents=function(e){this.nativeRange.surroundContents(e);u(this)};t.collapse=function(e){this.nativeRange.collapse(e);u(this)};t.cloneRange=function(){return new n(this.nativeRange.cloneRange())};t.refresh=function(){u(this)};t.toString=function(){return this.nativeRange.toString()};var c=document.createTextNode("test");r.getBody(document).appendChild(c);var h=document.createRange();h.setStart(c,0);h.setEnd(c,0);try{h.setStart(c,1);o=true;t.setStart=function(e,t){this.nativeRange.setStart(e,t);u(this)};t.setEnd=function(e,t){this.nativeRange.setEnd(e,t);u(this)};l=function(e){return function(t){this.nativeRange[e](t);u(this)}}}catch(p){o=false;t.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t);this.nativeRange.setStart(e,t)}u(this)};t.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t);this.nativeRange.setEnd(e,t)}u(this)};l=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[t](n);this.nativeRange[e](n)}u(this)}}}t.setStartBefore=l("setStartBefore","setEndBefore");t.setStartAfter=l("setStartAfter","setEndAfter");t.setEndBefore=l("setEndBefore","setStartBefore");t.setEndAfter=l("setEndAfter","setStartAfter");h.selectNodeContents(c);if(h.startContainer==c&&h.endContainer==c&&h.startOffset==0&&h.endOffset==c.length){t.selectNodeContents=function(e){this.nativeRange.selectNodeContents(e);u(this)}}else{t.selectNodeContents=function(e){this.setStart(e,0);this.setEnd(e,s.getEndOffset(e))}}h.selectNodeContents(c);h.setEnd(c,3);var d=document.createRange();d.selectNodeContents(c);d.setEnd(c,4);d.setStart(c,2);if(h.compareBoundaryPoints(h.START_TO_END,d)==-1&h.compareBoundaryPoints(h.END_TO_START,d)==1){t.compareBoundaryPoints=function(e,t){t=t.nativeRange||t;if(e==t.START_TO_END){e=t.END_TO_START}else if(e==t.END_TO_START){e=t.START_TO_END}return this.nativeRange.compareBoundaryPoints(e,t)}}else{t.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)}}if(e.util.isHostMethod(h,"createContextualFragment")){t.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}}r.getBody(document).removeChild(c);h.detach();d.detach()})();e.createNativeRange=function(e){e=e||document;return e.createRange()}}else if(e.features.implementsTextRange){n=function(e){this.textRange=e;this.refresh()};n.prototype=new s(document);n.prototype.refresh=function(){var e,t;var n=o(this.textRange);if(u(this.textRange)){t=e=a(this.textRange,n,true,true)}else{e=a(this.textRange,n,true,false);t=a(this.textRange,n,false,false)}this.setStart(e.node,e.offset);this.setEnd(t.node,t.offset)};s.copyComparisonConstants(n);var l=function(){return this}();if(typeof l.Range=="undefined"){l.Range=n}e.createNativeRange=function(e){e=e||document;return e.body.createTextRange()}}if(e.features.implementsTextRange){n.rangeToTextRange=function(e){if(e.collapsed){var t=f(new i(e.startContainer,e.startOffset),true);return t}else{var n=f(new i(e.startContainer,e.startOffset),true);var s=f(new i(e.endContainer,e.endOffset),false);var o=r.getDocument(e.startContainer).body.createTextRange();o.setEndPoint("StartToStart",n);o.setEndPoint("EndToEnd",s);return o}}}n.prototype.getName=function(){return"WrappedRange"};e.WrappedRange=n;e.createRange=function(t){t=t||document;return new n(e.createNativeRange(t))};e.createRangyRange=function(e){e=e||document;return new s(e)};e.createIframeRange=function(t){return e.createRange(r.getIframeDocument(t))};e.createIframeRangyRange=function(t){return e.createRangyRange(r.getIframeDocument(t))};e.addCreateMissingNativeApiListener(function(t){var n=t.document;if(typeof n.createRange=="undefined"){n.createRange=function(){return e.createRange(this)}}n=t=null})});e.createModule("WrappedSelection",function(e,t){function p(e){return(e||window).getSelection()}function d(e){return(e||window).document.selection}function L(e,t,n){var r=n?"end":"start",i=n?"start":"end";e.anchorNode=t[r+"Container"];e.anchorOffset=t[r+"Offset"];e.focusNode=t[i+"Container"];e.focusOffset=t[i+"Offset"]}function A(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode;e.anchorOffset=t.anchorOffset;e.focusNode=t.focusNode;e.focusOffset=t.focusOffset}function O(e){e.anchorNode=e.focusNode=null;e.anchorOffset=e.focusOffset=0;e.rangeCount=0;e.isCollapsed=true;e._ranges.length=0}function M(t){var n;if(t instanceof o){n=t._selectionNativeRange;if(!n){n=e.createNativeRange(i.getDocument(t.startContainer));n.setEnd(t.endContainer,t.endOffset);n.setStart(t.startContainer,t.startOffset);t._selectionNativeRange=n;t.attachListener("detach",function(){this._selectionNativeRange=null})}}else if(t instanceof u){n=t.nativeRange}else if(e.features.implementsDomRange&&t instanceof i.getWindow(t.startContainer).Range){n=t}return n}function _(e){if(!e.length||e[0].nodeType!=1){return false}for(var t=1,n=e.length;t<n;++t){if(!i.isAncestorOf(e[0],e[t])){return false}}return true}function D(e){var t=e.getNodes();if(!_(t)){throw new Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element")}return t[0]}function P(e){return!!e&&typeof e.text!="undefined"}function H(e,t){var n=new u(t);e._ranges=[n];L(e,n,false);e.rangeCount=1;e.isCollapsed=n.collapsed}function B(t){t._ranges.length=0;if(t.docSelection.type=="None"){O(t)}else{var n=t.docSelection.createRange();if(P(n)){H(t,n)}else{t.rangeCount=n.length;var r,s=i.getDocument(n.item(0));for(var o=0;o<t.rangeCount;++o){r=e.createRange(s);r.selectNode(n.item(o));t._ranges.push(r)}t.isCollapsed=t.rangeCount==1&&t._ranges[0].collapsed;L(t,t._ranges[t.rangeCount-1],false)}}}function j(e,t){var n=e.docSelection.createRange();var r=D(t);var s=i.getDocument(n.item(0));var o=i.getBody(s).createControlRange();for(var u=0,a=n.length;u<a;++u){o.add(n.item(u))}try{o.add(r)}catch(f){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}o.select();B(e)}function I(e,t,n){this.nativeSelection=e;this.docSelection=t;this._ranges=[];this.win=n;this.refresh()}function R(e,t){var n=i.getDocument(t[0].startContainer);var r=i.getBody(n).createControlRange();for(var s=0,o;s<rangeCount;++s){o=D(t[s]);try{r.add(o)}catch(u){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}r.select();B(e)}function V(e,t){if(e.anchorNode&&i.getDocument(e.anchorNode)!==i.getDocument(t)){throw new a("WRONG_DOCUMENT_ERR")}}function $(e){var t=[];var n=new f(e.anchorNode,e.anchorOffset);var r=new f(e.focusNode,e.focusOffset);var i=typeof e.getName=="function"?e.getName():"Selection";if(typeof e.rangeCount!="undefined"){for(var s=0,u=e.rangeCount;s<u;++s){t[s]=o.inspect(e.getRangeAt(s))}}return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]);e.config.checkSelectionRanges=true;var n="boolean",r="_rangySelection",i=e.dom,s=e.util,o=e.DomRange,u=e.WrappedRange,a=e.DOMException,f=i.DomPosition,l,c,h="Control";var v=e.util.isHostMethod(window,"getSelection"),m=e.util.isHostObject(document,"selection");var g=m&&(!v||e.config.preferTextRange);if(g){l=d;e.isSelectionValid=function(e){var t=(e||window).document,n=t.selection;return n.type!="None"||i.getDocument(n.createRange().parentElement())==t}}else if(v){l=p;e.isSelectionValid=function(){return true}}else{t.fail("Neither document.selection or window.getSelection() detected.")}e.getNativeSelection=l;var y=l();var b=e.createNativeRange(document);var w=i.getBody(document);var E=s.areHostObjects(y,["anchorNode","focusNode"]&&s.areHostProperties(y,["anchorOffset","focusOffset"]));e.features.selectionHasAnchorAndFocus=E;var S=s.isHostMethod(y,"extend");e.features.selectionHasExtend=S;var x=typeof y.rangeCount=="number";e.features.selectionHasRangeCount=x;var T=false;var N=true;if(s.areHostMethods(y,["addRange","getRangeAt","removeAllRanges"])&&typeof y.rangeCount=="number"&&e.features.implementsDomRange){(function(){var e=document.createElement("iframe");w.appendChild(e);var t=i.getIframeDocument(e);t.open();t.write("<html><head></head><body>12</body></html>");t.close();var n=i.getIframeWindow(e).getSelection();var r=t.documentElement;var s=r.lastChild,o=s.firstChild;var u=t.createRange();u.setStart(o,1);u.collapse(true);n.addRange(u);N=n.rangeCount==1;n.removeAllRanges();var a=u.cloneRange();u.setStart(o,0);a.setEnd(o,2);n.addRange(u);n.addRange(a);T=n.rangeCount==2;u.detach();a.detach();w.removeChild(e)})()}e.features.selectionSupportsMultipleRanges=T;e.features.collapsedNonEditableSelectionsSupported=N;var C=false,k;if(w&&s.isHostMethod(w,"createControlRange")){k=w.createControlRange();if(s.areHostProperties(k,["item","add"])){C=true}}e.features.implementsControlRange=C;if(E){c=function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}}else{c=function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:false}}var F;if(s.isHostMethod(y,"getRangeAt")){F=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}}else if(E){F=function(t){var n=i.getDocument(t.anchorNode);var r=e.createRange(n);r.setStart(t.anchorNode,t.anchorOffset);r.setEnd(t.focusNode,t.focusOffset);if(r.collapsed!==this.isCollapsed){r.setStart(t.focusNode,t.focusOffset);r.setEnd(t.anchorNode,t.anchorOffset)}return r}}e.getSelection=function(e){e=e||window;var t=e[r];var n=l(e),i=m?d(e):null;if(t){t.nativeSelection=n;t.docSelection=i;t.refresh(e)}else{t=new I(n,i,e);e[r]=t}return t};e.getIframeSelection=function(t){return e.getSelection(i.getIframeWindow(t))};var q=I.prototype;if(!g&&E&&s.areHostMethods(y,["removeAllRanges","addRange"])){q.removeAllRanges=function(){this.nativeSelection.removeAllRanges();O(this)};var U=function(t,n){var r=o.getRangeDocument(n);var i=e.createRange(r);i.collapseToPoint(n.endContainer,n.endOffset);t.nativeSelection.addRange(M(i));t.nativeSelection.extend(n.startContainer,n.startOffset);t.refresh()};if(x){q.addRange=function(t,n){if(C&&m&&this.docSelection.type==h){j(this,t)}else{if(n&&S){U(this,t)}else{var r;if(T){r=this.rangeCount}else{this.removeAllRanges();r=0}this.nativeSelection.addRange(M(t));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==r+1){if(e.config.checkSelectionRanges){var i=F(this.nativeSelection,this.rangeCount-1);if(i&&!o.rangesEqual(i,t)){t=new u(i)}}this._ranges[this.rangeCount-1]=t;L(this,t,X(this.nativeSelection));this.isCollapsed=c(this)}else{this.refresh()}}}}}else{q.addRange=function(e,t){if(t&&S){U(this,e)}else{this.nativeSelection.addRange(M(e));this.refresh()}}}q.setRanges=function(e){if(C&&e.length>1){R(this,e)}else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t){this.addRange(e[t])}}}}else if(s.isHostMethod(y,"empty")&&s.isHostMethod(b,"select")&&C&&g){q.removeAllRanges=function(){try{var e=jQuery.browser.msie&&jQuery.browser.version<8&&typeof document.documentMode==="undefined";if(!e){this.docSelection.empty()}if(this.docSelection.type!="None"){if(e){this.docSelection.empty()}}}catch(t){}O(this)};q.addRange=function(e){if(this.docSelection.type==h){j(this,e)}else{try{u.rangeToTextRange(e).select();this._ranges[0]=e;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;L(this,e,false)}catch(t){}}};q.setRanges=function(e){this.removeAllRanges();var t=e.length;if(t>1){R(this,e)}else if(t){this.addRange(e[0])}}}else{t.fail("No means of selecting a Range or TextRange was found");return false}q.getRangeAt=function(e){if(e<0||e>=this.rangeCount){throw new a("INDEX_SIZE_ERR")}else{return this._ranges[e]}};var z;if(g){z=function(t){var n;if(e.isSelectionValid(t.win)){n=t.docSelection.createRange()}else{n=i.getBody(t.win.document).createTextRange();n.collapse(true)}if(t.docSelection.type==h){B(t)}else if(P(n)){H(t,n)}else{O(t)}}}else if(s.isHostMethod(y,"getRangeAt")&&typeof y.rangeCount=="number"){z=function(t){if(C&&m&&t.docSelection.type==h){B(t)}else{t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount;if(t.rangeCount){for(var n=0,r=t.rangeCount;n<r;++n){t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n))}L(t,t._ranges[t.rangeCount-1],X(t.nativeSelection));t.isCollapsed=c(t)}else{O(t)}}}}else if(E&&typeof y.isCollapsed==n&&typeof b.collapsed==n&&e.features.implementsDomRange){z=function(e){var t,n=e.nativeSelection;if(n.anchorNode){t=F(n,0);e._ranges=[t];e.rangeCount=1;A(e);e.isCollapsed=c(e)}else{O(e)}}}else{t.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}q.refresh=function(e){var t=e?this._ranges.slice(0):null;z(this);if(e){var n=t.length;if(n!=this._ranges.length){return false}while(n--){if(!o.rangesEqual(t[n],this._ranges[n])){return false}}return true}};var W=function(e,t){var n=e.getAllRanges(),r=false;e.removeAllRanges();for(var i=0,s=n.length;i<s;++i){if(r||t!==n[i]){e.addRange(n[i])}else{r=true}}if(!e.rangeCount){O(e)}};if(C){q.removeRange=function(e){if(this.docSelection.type==h){var t=this.docSelection.createRange();var n=D(e);var r=i.getDocument(t.item(0));var s=i.getBody(r).createControlRange();var o,u=false;for(var a=0,f=t.length;a<f;++a){o=t.item(a);if(o!==n||u){s.add(t.item(a))}else{u=true}}s.select();B(this)}else{W(this,e)}}}else{q.removeRange=function(e){W(this,e)}}var X;if(!g&&E&&e.features.implementsDomRange){X=function(e){var t=false;if(e.anchorNode){t=i.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)==1}return t};q.isBackwards=function(){return X(this)}}else{X=q.isBackwards=function(){return false}}q.toString=function(){var e=[];for(var t=0,n=this.rangeCount;t<n;++t){e[t]=""+this._ranges[t]}return e.join("")};q.collapse=function(t,n){V(this,t);var r=e.createRange(i.getDocument(t));r.collapseToPoint(t,n);this.removeAllRanges();this.addRange(r);this.isCollapsed=true};q.collapseToStart=function(){if(this.rangeCount){var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)}else{throw new a("INVALID_STATE_ERR")}};q.collapseToEnd=function(){if(this.rangeCount){var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)}else{throw new a("INVALID_STATE_ERR")}};q.selectAllChildren=function(t){V(this,t);var n=e.createRange(i.getDocument(t));n.selectNodeContents(t);this.removeAllRanges();this.addRange(n)};q.deleteFromDocument=function(){if(C&&m&&this.docSelection.type==h){var e=this.docSelection.createRange();var t;while(e.length){t=e.item(0);e.remove(t);t.parentNode.removeChild(t)}this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();this.removeAllRanges();for(var r=0,i=n.length;r<i;++r){n[r].deleteContents()}this.addRange(n[i-1])}};q.getAllRanges=function(){return this._ranges.slice(0)};q.setSingleRange=function(e){this.setRanges([e])};q.containsNode=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n){if(this._ranges[n].containsNode(e,t)){return true}}return false};q.toHtml=function(){var e="";if(this.rangeCount){var t=o.getRangeDocument(this._ranges[0]).createElement("div");for(var n=0,r=this._ranges.length;n<r;++n){t.appendChild(this._ranges[n].cloneContents())}e=t.innerHTML}return e};q.getName=function(){return"WrappedSelection"};q.inspect=function(){return $(this)};q.detach=function(){this.win[r]=null;this.win=this.anchorNode=this.focusNode=null};I.inspect=$;e.Selection=I;e.selectionPrototype=q;e.addCreateMissingNativeApiListener(function(t){if(typeof t.getSelection=="undefined"){t.getSelection=function(){return e.getSelection(this)}}t=null})});window.rangy=e})();define("vendor/rangy-core",function(){});define("aloha/rangy-core",["jquery","vendor/rangy-core"],function(e){return window.rangy});define("util/class",[],function(){var e=false,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(){function u(){if(!e&&this._constructor)this._constructor.apply(this,arguments)}var n=this.prototype;e=true;var r=new this;e=false;for(var i=0;i<arguments.length;i++){var s=arguments[i];for(var o in s){r[o]=typeof s[o]=="function"&&typeof n[o]=="function"&&t.test(s[o])?function(e,t){return function(){var r=this._super;this._super=n[e];var i=t.apply(this,arguments);this._super=r;return i}}(o,s[o]):s[o]}}u.prototype=r;u.constructor=u;u.extend=arguments.callee;return u};return this.Class});window.GENTICS=window.GENTICS||{};window.GENTICS.Utils=window.GENTICS.Utils||{};define("util/lang",[],function(){});(function(e){var t=e.alohaQuery||e.jQuery,n=t,r=e.GENTICS,i=e.Class,s=e.console;r.Utils.applyProperties=function(e,t){var n;for(n in t){if(t.hasOwnProperty(n)){e[n]=t[n]}}};r.Utils.uniqeString4=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};r.Utils.guid=function(){var e=r.Utils.uniqeString4;return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}})(window);define("aloha/ecma5shims",[],function(){function r(e){var t=null;if(e){do{t=e}while(null!=(e=e.parentNode))}return t}function i(e,t){return(e.contains(t)&&16)+(t.contains(e)&&8)+(e.sourceIndex>=0&&t.sourceIndex>=0?(e.sourceIndex<t.sourceIndex&&4)+(e.sourceIndex>t.sourceIndex&&2):1)}function s(e){if(null!=e.sourceIndex){return e}return e.parentNode.insertBefore(document.createComment(""),e)}var e;var t={bind:function(e){var t=this.obj||this;var n=Function.prototype.bind;var r=Array.prototype.slice.call(arguments,1);if(n){return n.apply(t,arguments)}return function(){return t.apply(e,arguments.length===0?r:r.concat(Array.prototype.slice.call(arguments)))}},trim:function(){var e=this.obj||this;var t=String.prototype.trim;if(t){return t.call(e)}return e.replace(/^\s+/,"").replace(/\s+$/,"")},indexOf:function(e,t){var n=this.obj||this;var r=Array.prototype.indexOf;if(r){return r.call(n,e,t)}if(t===undefined){t=0}if(t<0){t+=n.length}if(t<0){t=0}var i;for(i=n.length;t<i;t++){if(undefined!==n[t]&&n[t]===e){return t}}return-1},forEach:function(e,t){var n=this.obj||this;var r=Array.prototype.forEach;if(r){return r.call(n,e,t)}var i,s;for(i=0,s=n.length;i<s;i++){if(undefined!==n[i]){e.call(t,n[i],i,n)}}},map:function(t,n,r){var i=this.obj||this;var s=Array.prototype.map;var o=typeof arguments[arguments.length-1]=="boolean"?Array.prototype.pop.call(arguments):false;var u=[];if(s){u=s.call(i,t,n)}else{var a=[];var f,l;for(f=0,l=i.length;f<l;f++){if(undefined!==i[f]){a[f]=t.call(n,i[f],f,i)}}u=a}return o?e(u):u},filter:function(t,n,r){var i=this.obj||this;var s=Array.prototype.filter;var o=typeof arguments[arguments.length-1]=="boolean"?Array.prototype.pop.call(arguments):false;var u=[];if(s){u=s.call(i,t,n)}else{var a=[],f,l,c;for(l=0,c=i.length;l<c;l++){if(undefined!==i[l]&&t.call(n,f=i[l],l,i)){a.push(f)}}u=a}return o?e(u):u},every:function(e,t){var n=this.obj||this;var r=Array.prototype.every;if(r){return r.call(n,e,t)}var i,s;for(i=0,s=n.length;i<s;i++){if(undefined!==n[i]&&!e.call(t,n[i],i,n)){return false}}return true},some:function(e,t){var n=this.obj||this;var r=Array.prototype.some;if(r){return r.call(n,e,t)}var i,s;for(i=0,s=n.length;i<s;i++){if(undefined!==n[i]&&e.call(t,n[i],i,n)){return true}}return false},hasAttribute:function(e){var t=this.obj||this;var n=t.hasAttribute;if(n){return t.hasAttribute(e)}return!!t.getAttribute(e)}};e=function(e){var n=function(){};n.prototype=t;var r=new n;r.obj=e;return r};var n;for(n in t){if(t.hasOwnProperty(n)){e[n]=t[n]}}if(typeof window.Node!="undefined"){e.Node=window.Node}else{e.Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,DOCUMENT_POSITION_DISCONNECTED:1,DOCUMENT_POSITION_PRECEDING:2,DOCUMENT_POSITION_FOLLOWING:4,DOCUMENT_POSITION_CONTAINS:8,DOCUMENT_POSITION_CONTAINED_BY:16,DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC:32}}e.compareDocumentPosition=function(e,t){if(document.documentElement.compareDocumentPosition){return e.compareDocumentPosition(t)}if(!document.documentElement.contains){throw"neither compareDocumentPosition nor contains is supported by this browser."}if(e==t){return 0}if(r(e)!=r(t)){return 1}if(null!=e.sourceIndex&&null!=t.sourceIndex){return i(e,t)}if(e==document){return 20}if(t==document){return 10}var n=s(e),o=s(t);var u=i(n,o);if(e!=n){n.parentNode.removeChild(n)}if(t!=o){o.parentNode.removeChild(o)}return u};e.getComputedStyle=function(e,t){if(window.getComputedStyle){return window.getComputedStyle(e,t)}if(e.currentStyle){return e.currentStyle}return null};return e});window.GENTICS=window.GENTICS||{};window.GENTICS.Utils=window.GENTICS.Utils||{};define("util/dom",["jquery","util/class","aloha/ecma5shims"],function(e,t,n){function o(e){var t=0;var n=e.firstChild;while(n){t+=1;n=n.nextSibling}return t}function u(e){if(1===e.nodeType){return o(e)}if(3===e.nodeType){return e.length}return 0}function a(e){return e.className==="aloha-editing-p"&&u(e)===1&&e.children[0].nodeName==="BR"&&e.children[0].className==="aloha-end-br"}function f(e,t){if(!e){return null}if(t(e)){return e}var n=e.firstChild||e.nextSibling||e.parentNode&&!r.Utils.Dom.isEditingHost(e.parentNode)&&e.parentNode.nextSibling;return n?f(n,t):null}function l(e){if(!e){return true}if("BR"===e.nodeName){return false}if(e.nodeType===i.TEXT_NODE){if(e.data.search(/\S/)===-1){return true}if(1===e.data.length&&e.data.charCodeAt(0)>=8192){return true}return false}var t=u(e);if(0===t){return true}var n=e.childNodes;var r;for(r=0;r<t;r++){if(!l(n[r])){return false}}return true}function c(e){return!l(e)}function h(e){return l(e)||a(e)}function p(t,n){if(t.nodeType!==i.TEXT_NODE&&h(t)){e(t).replaceWith(n)}else{e(t).after(n)}}var r=window.GENTICS,i={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,DOCUMENT_POSITION_DISCONNECTED:1,DOCUMENT_POSITION_PRECEDING:2,DOCUMENT_POSITION_FOLLOWING:4,DOCUMENT_POSITION_CONTAINS:8,DOCUMENT_POSITION_CONTAINED_BY:16,DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC:32},s={P:true,H1:true,H2:true,H3:true,H4:true,H5:true,H6:true,LI:true};var d=t.extend({wordRegex:/[\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0525\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0621-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971\u0972\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3D\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC\u0EDD\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8B\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10D0-\u10FA\u10FC\u1100-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u2094\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2D00-\u2D25\u2D30-\u2D65\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31B7\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCB\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA65F\uA662-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B\uA78C\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA2D\uFA30-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,nonWordRegex:/[^\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0525\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0621-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971\u0972\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3D\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC\u0EDD\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8B\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10D0-\u10FA\u10FC\u1100-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u2094\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2D00-\u2D25\u2D30-\u2D65\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31B7\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCB\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA65F\uA662-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B\uA78C\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA2D\uFA30-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,mergeableTags:["b","code","del","em","i","ins","strong","sub","sup","#text"],nonWordBoundaryTags:["a","b","code","del","em","i","ins","span","strong","sub","sup","#text"],nonEmptyTags:["br"],tags:{flow:["a","abbr","address","area","article","aside","audio","b","bdi","bdo","blockquote","br","button","canvas","cite","code","command","datalist","del","details","dfn","div","dl","em","embed","fieldset","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","i","iframe","img","input","ins","kbd","keygen","label","map","mark","math","menu","meter","nav","noscript","object","ol","output","p","pre","progress","q","ruby","s","samp","script","section","select","small","span","strong","style","sub","sup","svg","table","textarea","time","u","ul","var","video","wbr","#text"],phrasing:["a","abbr","area","audio","b","bdi","bdo","br","button","canvas","cite","code","command","datalist","del","dfn","em","embed","i","iframe","img","input","ins","kbd","keygen","label","map","mark","math","meter","noscript","object","output","progress","q","ruby","samp","script","select","small","span","strong","sub","sup","svg","textarea","time","u","var","video","wbr","#text"]},children:{a:"phrasing",abbr:"phrasing",address:"flow",area:"empty",article:"flow",aside:"flow",audio:"source",b:"phrasing",base:"empty",bdo:"phrasing",blockquote:"phrasing",body:"flow",br:"empty",button:"phrasing",canvas:"phrasing",caption:"flow",cite:"phrasing",code:"phrasing",col:"empty",colgroup:"col",command:"empty",datalist:["phrasing","option"],dd:"flow",del:"phrasing",div:"flow",details:["summary","flow"],dfn:"flow",dl:["dt","dd"],dt:"phrasing",em:"phrasing",embed:"empty",fieldset:["legend","flow"],figcaption:"flow",figure:["figcaption","flow"],footer:"flow",form:"flow",h1:"phrasing",h2:"phrasing",h3:"phrasing",h4:"phrasing",h5:"phrasing",h6:"phrasing",header:"flow",hgroup:["h1","h2","h3","h4","h5","h6"],hr:"empty",i:"phrasing",iframe:"#text",img:"empty",input:"empty",ins:"phrasing",kbd:"phrasing",keygen:"empty",label:"phrasing",legend:"phrasing",li:"flow",link:"empty",map:"area",mark:"phrasing",menu:["li","flow"],meta:"empty",meter:"phrasing",nav:"flow",noscript:"phrasing",object:"param",ol:"li",optgroup:"option",option:"#text",output:"phrasing",p:"phrasing",param:"empty",pre:"phrasing",progress:"phrasing",q:"phrasing",rp:"phrasing",rt:"phrasing",ruby:["phrasing","rt","rp"],s:"phrasing",samp:"pharsing",script:"#script",section:"flow",select:["option","optgroup"],small:"phrasing",source:"empty",span:"phrasing",strong:"phrasing",style:"phrasing",sub:"phrasing",summary:"phrasing",sup:"phrasing",table:["caption","colgroup","thead","tbody","tfoot","tr"],tbody:"tr",td:"flow",textarea:"#text",tfoot:"tr",th:"phrasing",thead:"tr",time:"phrasing",title:"#text",tr:["th","td"],track:"empty",u:"phrasing",ul:"li","var":"phrasing",video:"source",wbr:"empty"},blockLevelElements:["p","h1","h2","h3","h4","h5","h6","blockquote","div","pre"],listElements:["li","ol","ul"],split:function(t,n,r){var i=e(t.startContainer),s=t.startOffset,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;if(r){i=e(t.endContainer);s=t.endOffset}if(n.length<1){n=e(document.body)}o=!t.isCollapsed()&&!r;a=i.parents().get();a.unshift(i.get(0));e.each(a,function(e,t){var r=n.filter(function(){return this==t}).length;if(r){if(e>0){u=a.slice(0,e)}return false}});if(!u){return true}u=u.reverse();for(h=0,p=u.length;h<p;++h){d=u[h];if(h===p-1){if(d.nodeType===3){c=document.createTextNode(d.data.substring(s,d.data.length));d.data=d.data.substring(0,s);if(this.isEmpty(c)&&e("br",f).length===0){c=e("<br/>").addClass("aloha-end-br")}}else{v=e(d);m=v.contents();g=v.clone(false).empty();c=g.append(m.slice(s,m.length)).get(0);e(c).addClass("aloha-editing-p");if(c.childNodes.length===1&&c.childNodes.item(0).nodeName.toLowerCase()==="br"){e(c.childNodes.item(0)).addClass("aloha-end-br")}}if(o&&t.endContainer===d){t.endContainer=c;t.endOffset-=s;t.clearCaches()}if(l){l.prepend(c)}else{e(d).after(c)}}else{g=e(d).clone(false).empty();if(!f){f=g}else{l.prepend(g)}l=g;while(true){y=u[h+1].nextSibling;if(!y){break}l.append(y)}if(o&&t.endContainer===d){t.endContainer=g.get(0);b=u[h+1];w=0;while(true){b=b.previousSibling;if(!b){break}w++}t.endOffset-=w;t.clearCaches()}}}e(u[0]).after(f);return e([u[0],f?f.get(0):c])},allowsNesting:function(t,n){if(!t||!t.nodeName||!n||!n.nodeName){return false}var r=t.nodeName.toLowerCase(),i=n.nodeName.toLowerCase();if(!this.children[r]){return false}if(this.children[r]==i){return true}if(e.isArray(this.children[r])&&e.inArray(i,this.children[r])>=0){return true}if(e.isArray(this.tags[this.children[r]])&&e.inArray(i,this.tags[this.children[r]])>=0){return true}return false},addMarkup:function(t,n,r){if(t.startContainer.nodeType===3&&t.startOffset>0&&t.startOffset<t.startContainer.data.length){this.split(t,e(t.startContainer).parent(),false)}if(t.endContainer.nodeType===3&&t.endOffset>0&&t.endOffset<t.endContainer.data.length){this.split(t,e(t.endContainer).parent(),true)}var i=t.getRangeTree();this.recursiveAddMarkup(i,n,t,r);this.doCleanup({merge:true,removeempty:true},t)},recursiveAddMarkup:function(t,n,i,s){var o,u,a;for(o=0,a=t.length;o<a;++o){if(t[o].type=="full"&&this.allowsNesting(n.get(0),t[o].domobj)){if((s||t[o].domobj.nodeName!=n.get(0).nodeName)&&(t[o].domobj.nodeType!==3||e.trim(t[o].domobj.data).length!==0)){e(t[o].domobj).wrap(n);if(!s&&t[o].domobj.nodeType!==3){u=new r.Utils.RangeObject;u.startContainer=u.endContainer=t[o].domobj.parentNode;u.startOffset=0;u.endOffset=u.endContainer.childNodes.length;this.removeMarkup(u,n,e(t[o].domobj.parentNode))}}}else{if((s||t[o].domobj&&t[o].domobj.nodeName!==n.get(0).nodeName)&&t[o].children&&t[o].children.length>0){this.recursiveAddMarkup(t[o].children,n)}}}},findHighestElement:function(e,t,n){t=t.toLowerCase();var r,i=e,s=n?function(){return n.filter(function(){return i==this}).length}:function(){return false};while(!s()&&i){if(i.nodeName.toLowerCase()===t){r=i}i=i.parentNode}return r},removeMarkup:function(t,n,r){var i=n.get(0).nodeName,s=this.findHighestElement(t.startContainer,i,r),o=this.findHighestElement(t.endContainer,i,r),u=false,a,f,l;if(s&&t.startOffset>0){this.split(t,e(s).parent(),false);u=true}if(o){if(t.endContainer.nodeType===3&&t.endOffset<t.endContainer.data.length){this.split(t,e(o).parent(),true);u=true}if(t.endContainer.nodeType===1&&t.endOffset<t.endContainer.childNodes.length){this.split(t,e(o).parent(),true);u=true}}if(u){t.correctRange()}a=this.findHighestElement(t.getCommonAncestorContainer(),i,r);f=a?a.parentNode:t.getCommonAncestorContainer();if(f){l=t.getRangeTree(f);this.recursiveRemoveMarkup(l,n);this.doCleanup({merge:true,removeempty:true},t,f)}},recursiveRemoveMarkup:function(t,n){var r,i,s;for(r=0,i=t.length;r<i;++r){if(t[r].type=="full"&&t[r].domobj.nodeName==n.get(0).nodeName){s=e(t[r].domobj).contents();if(s.length>0){s.first().unwrap()}else{e(t[r].domobj).remove()}}if(t[r].children){this.recursiveRemoveMarkup(t[r].children,n)}}},doCleanup:function(t,n,i){var s=this,o,u,a,f,l;if(typeof t==="undefined"){t={}}if(typeof t.merge==="undefined"){t.merge=false}if(typeof t.removeempty==="undefined"){t.removeempty=false}if(typeof i==="undefined"&&n){i=n.getCommonAncestorContainer()}o=false;u=false;a=e(i);f=n.startOffset;l=n.endOffset;a.contents().each(function(){var i;var c;try{c=this.nodeType;i=s.getIndexInParent(this)}catch(h){return}switch(c){case 1:if(o&&o.nodeName==this.nodeName){if(n.startContainer===a&&f>i){n.startOffset-=1;u=true}if(n.endContainer===a&&l>i){n.endOffset-=1;u=true}e(o).append(e(this).contents());u|=s.doCleanup(t,n,o);e(this).remove()}else{u|=s.doCleanup(t,n,this);var p=false;if(t.removeempty){if(r.Utils.Dom.isBlockLevelElement(this)&&this.childNodes.length===0){p=true}if(e.inArray(this.nodeName.toLowerCase(),s.mergeableTags)>=0&&e(this).text().length===0&&this.childNodes.length===0){p=true}}if(!p){if(t.mergeable?t.mergeable(this):e.inArray(this.nodeName.toLowerCase(),s.mergeableTags)>=0){o=this}else{o=false}}else{if(n.startContainer===this.parentNode&&f>i){n.startOffset=n.startOffset-1;u=true}if(n.endContainer===this.parentNode&&l>i){n.endOffset=n.endOffset-1;u=true}e(this).remove()}}break;case 3:if(o&&o.nodeType===3&&t.merge){if(n.startContainer===this){n.startContainer=o;n.startOffset+=o.nodeValue.length;u=true}else if(n.startContainer===o.parentNode&&n.startOffset===s.getIndexInParent(o)+1){n.startContainer=o;n.startOffset=o.nodeValue.length;u=true}if(n.endContainer===this){n.endContainer=o;n.endOffset+=o.nodeValue.length;u=true}else if(n.endContainer===o.parentNode&&n.endOffset===s.getIndexInParent(o)+1){n.endContainer=o;n.endOffset=o.nodeValue.length;u=true}o.data+=this.data}else if(!(this.nodeValue===""&&t.removeempty)){o=this;break}if(n.startContainer===this.parentNode&&n.startOffset>i){n.startOffset=n.startOffset-1;u=true}if(n.endContainer===this.parentNode&&n.endOffset>i){n.endOffset=n.endOffset-1;u=true}e(this).remove();if(o&&(!o.nextSibling||o.nextSibling.nodeType!==3)){var d;for(d=o.data.length-1;d>=0&&o.data.length>1;d--){if(o.data.charAt(d)===""){o.deleteData(d,1);if(n.startContainer===o&&n.startOffset>d){n.startOffset--;u=true}if(n.endContainer===o&&n.endOffset>d){n.endOffset--;u=true}}}}break}});if(u){n.clearCaches()}return u},getIndexInParent:function(e){if(!e){return false}var t=0,n=e.previousSibling;while(n){t++;n=n.previousSibling}return t},isBlockLevelElement:function(t){if(!t){return false}if(t.nodeType===1&&e.inArray(t.nodeName.toLowerCase(),this.blockLevelElements)>=0){return true}return false},isLineBreakElement:function(e){if(!e){return false}return e.nodeType===1&&e.nodeName.toLowerCase()=="br"},isListElement:function(t){if(!t){return false}return t.nodeType===1&&e.inArray(t.nodeName.toLowerCase(),this.listElements)>=0},isSplitObject:function(e){return e.nodeType===1&&s.hasOwnProperty(e.nodeName)},searchAdjacentTextNode:function(t,n,r,i){if(!t||t.nodeType!==1||n<0||n>t.childNodes.length){return false}if(typeof i==="undefined"){i={blocklevel:true,list:true,linebreak:true}}if(typeof i.blocklevel==="undefined"){i.blocklevel=true}if(typeof i.list==="undefined"){i.list=true}if(typeof i.linebreak==="undefined"){i.linebreak=true}if(typeof r==="undefined"){r=true}var s,o=t;if(r&&n>0){s=t.childNodes[n-1]}if(!r&&n<t.childNodes.length){s=t.childNodes[n]}while(o){if(!s){if(i.blocklevel&&this.isBlockLevelElement(o)){return false}if(i.list&&this.isListElement(o)){return false}s=r?o.previousSibling:o.nextSibling;o=o.parentNode;continue}else if(s.nodeType===3&&e.trim(s.data).length>0){return s}if(i.blocklevel&&this.isBlockLevelElement(s)){return false}if(i.linebreak&&this.isLineBreakElement(s)){return false}if(i.list&&this.isListElement(s)){return false}if(s.nodeType===3){s=r?s.previousSibling:s.nextSibling}else{o=s;s=r?s.lastChild:s.firstChild}}},insertIntoDOM:function(t,n,r,i,s){var o=n.getContainerParents(r,i),u=this,a,l,d,v,m;if(!r){r=e(document.body)}if(o.length===0){a=r.get(0)}else{e.each(o,function(e,n){if(u.allowsNesting(n,t.get(0))){a=n;return false}})}if(typeof a==="undefined"&&r.length>0){a=r.get(0)}if(!this.allowsNesting(a,t.get(0))&&!s){return false}if(typeof a!=="undefined"){v=this.split(n,e(a),i);if(v===true){l=n.startContainer;d=n.startOffset;if(i){l=n.endContainer;d=n.endOffset}if(d===0){m=e(l).contents();if(m.length>0){m.eq(0).before(t)}else{e(l).append(t)}return true}e(l).contents().eq(d-1).after(t);return true}if(v){var g=v[0];var y=v[1];p(g,t);if(h(y)){var b=y.nextSibling||y.parentNode&&y.parentNode.nextSibling;if(f(b,c)){e(y).remove()}}return true}return false}return false},removeFromDOM:function(t,n,r){if(r){var i=this.getIndexInParent(t),s=e(t).contents().length,o=t.parentNode;if(n.startContainer==o&&n.startOffset>i){n.startOffset+=s-1}else if(n.startContainer==t){n.startContainer=o;n.startOffset=i+n.startOffset}if(n.endContainer==o&&n.endOffset>i){n.endOffset+=s-1}else if(n.endContainer==t){n.endContainer=o;n.endOffset=i+n.endOffset}e(t).contents().unwrap();this.doCleanup({merge:true},n,o)}},removeRange:function(t){if(!t){return false}if(t.isCollapsed()){return false}if(t.startContainer.nodeType==3&&t.startOffset>0&&t.startOffset<t.startContainer.data.length){this.split(t,e(t.startContainer).parent(),false)}if(t.endContainer.nodeType==3&&t.endOffset>0&&t.endOffset<t.endContainer.data.length){this.split(t,e(t.endContainer).parent(),true)}var n=t.getRangeTree();t.endContainer=t.startContainer;t.endOffset=t.startOffset;this.recursiveRemoveRange(n,t);this.doCleanup({merge:true},t);t.clearCaches()},recursiveRemoveRange:function(t,n){var r;for(r=0;r<t.length;++r){if(t[r].type=="full"){if(e(n.startContainer).parents().andSelf().filter(t[r].domobj).length>0){n.startContainer=n.endContainer=t[r].domobj.parentNode;n.startOffset=n.endOffset=this.getIndexInParent(t[r].domobj)}e(t[r].domobj).remove()}else if(t[r].type=="partial"&&t[r].children){this.recursiveRemoveRange(t[r].children,n)}}},extendToWord:function(e,t){var n=this.searchWordBoundary(e.startContainer,e.startOffset,true),r=this.searchWordBoundary(e.endContainer,e.endOffset,false);if(!t){if(e.startContainer==n.container&&e.startOffset==n.offset){return}if(e.endContainer==r.container&&e.endOffset==r.offset){return}}e.startContainer=n.container;e.startOffset=n.offset;e.endContainer=r.container;e.endOffset=r.offset;e.correctRange();e.clearCaches()},isWordBoundaryElement:function(t){if(!t||!t.nodeName){return false}return e.inArray(t.nodeName.toLowerCase(),this.nonWordBoundaryTags)==-1},searchWordBoundary:function(e,t,n){if(typeof n==="undefined"){n=true}var r=false,i,s,o;while(!r){if(e.nodeType===3){if(!n){i=e.data.substring(t).search(this.nonWordRegex);if(i!=-1){t=t+i;r=true}else{t=this.getIndexInParent(e)+1;e=e.parentNode}}else{i=e.data.substring(0,t).search(this.nonWordRegex);s=i;while(s!=-1){i=s;s=e.data.substring(i+1,t).search(this.nonWordRegex);if(s!=-1){s=s+i+1}}if(i!=-1){t=i+1;r=true}else{t=this.getIndexInParent(e);e=e.parentNode}}}else if(e.nodeType===1){if(!n){if(t<e.childNodes.length){if(this.isWordBoundaryElement(e.childNodes[t])){r=true}else{e=e.childNodes[t];t=0}}else{if(this.isWordBoundaryElement(e)){r=true}else{t=this.getIndexInParent(e)+1;e=e.parentNode}}}else{if(t>0){if(this.isWordBoundaryElement(e.childNodes[t-1])){r=true}else{e=e.childNodes[t-1];t=e.nodeType===3?e.data.length:e.childNodes.length}}else{if(this.isWordBoundaryElement(e)){r=true}else{t=this.getIndexInParent(e);e=e.parentNode}}}}}if(e.nodeType!==3){o=this.searchAdjacentTextNode(e,t,!n);if(o){e=o;t=n?0:e.data.length}}return{container:e,offset:t}},isEmpty:function(t){if(!t){return true}if(e.inArray(t.nodeName.toLowerCase(),this.nonEmptyTags)!=-1){return false}if(t.nodeType===3){if(t.data.search(/\S/)==-1){return true}else if(t.data.length===1&&t.data.charCodeAt(0)>=8192){return true}return false}var n,r;for(n=0,r=t.childNodes.length;n<r;++n){if(!this.isEmpty(t.childNodes[n])){return false}}return true},setCursorAfter:function(e){var t=new r.Utils.RangeObject,n=this.getIndexInParent(e),i,s;if(e.nodeType==3){i=e;s=i.nodeValue.length}else if(e.nextSibling&&e.nextSibling.nodeType==3){i=e.nextSibling;s=0}else{i=e.parentNode;s=this.getIndexInParent(e)+1}t.startContainer=t.endContainer=i;t.startOffset=t.endOffset=s;t.select();return t},selectDomNode:function(e){var t=new r.Utils.RangeObject;t.startContainer=t.endContainer=e.parentNode;t.startOffset=this.getIndexInParent(e);t.endOffset=t.startOffset+1;t.select()},setCursorInto:function(e){var t=new r.Utils.RangeObject;t.startContainer=t.endContainer=e;t.startOffset=t.endOffset=0;t.select()},isEditingHost:function(e){return e&&e.nodeType==1&&(e.contentEditable=="true"||e.parentNode&&e.parentNode.nodeType==9&&e.parentNode.designMode=="on")},isEditable:function(e){return e&&!this.isEditingHost(e)&&(e.nodeType!=1||e.contentEditable!="false")&&(this.isEditingHost(e.parentNode)||this.isEditable(e.parentNode))},getEditingHostOf:function(e){if(this.isEditingHost(e)){return e}if(this.isEditable(e)){var t=e.parentNode;while(!this.isEditingHost(t)){t=t.parentNode}return t}return null},inSameEditingHost:function(e,t){return this.getEditingHostOf(e)&&this.getEditingHostOf(e)==this.getEditingHostOf(t)},isBlockNode:function(e){return e&&(e.nodeType==n.Node.ELEMENT_NODE&&n(["inline","inline-block","inline-table","none"]).indexOf(n.getComputedStyle(e).display)==-1||e.nodeType==n.Node.DOCUMENT_NODE||e.nodeType==n.Node.DOCUMENT_FRAGMENT_NODE)},getFirstVisibleChild:function(t,r){if(!t){return null}if(t.nodeType==n.Node.TEXT_NODE&&this.isEmpty(t)||t.nodeType==n.Node.ELEMENT_NODE&&t.offsetHeight==0&&e.inArray(t.nodeName.toLowerCase(),this.nonEmptyTags)===-1){return null}if(t.nodeType==n.Node.TEXT_NODE||t.nodeType==n.Node.ELEMENT_NODE&&t.childNodes.length==0||!e(t).contentEditable()){return r?t:null}var i;for(i=0;i<t.childNodes.length;++i){var s=this.getFirstVisibleChild(t.childNodes[i],true);if(s!=null){return s}}return null},getLastVisibleChild:function(t,r){if(!t){return null}if(t.nodeType==n.Node.TEXT_NODE&&this.isEmpty(t)||t.nodeType==n.Node.ELEMENT_NODE&&t.offsetHeight==0&&e.inArray(t.nodeName.toLowerCase(),this.nonEmptyTags)===-1){return null}if(t.nodeType==n.Node.TEXT_NODE||t.nodeType==n.Node.ELEMENT_NODE&&t.childNodes.length==0||!e(t).contentEditable()){return r?t:null}var i;for(i=t.childNodes.length-1;i>=0;--i){var s=this.getLastVisibleChild(t.childNodes[i],true);if(s!=null){return s}}return null}});r.Utils.Dom=new d;return r.Utils.Dom});define("aloha/pluginmanager",["jquery","util/class"],function(e,t){function r(e,t){var n;for(n in t){if(t.hasOwnProperty(n)&&e[n]){e[n].settings=t[n]||{}}}}function i(e,t){var n=[];var r;var i;for(i=0;i<t.length;i++){r=e[t[i]];if(r){n.push(r)}}return n}function s(e,t){if(0===e.length){if(t){t()}return}var n=e.length;var r=function(){if(0===--n&&t){t()}};var i;var s;var o;for(i=0;i<e.length;i++){o=e[i];o.settings=o.settings||{};if(typeof o.settings.enabled==="undefined"){o.settings.enabled=true}if(o.settings.enabled&&o.checkDependencies()){s=o.init();if(s&&typeof s.done==="function"){s.done(r)}else{r()}}else{r()}}}var n=window.Aloha;return new(t.extend({plugins:{},init:function(e,t){var o=this;var u=o.plugins;r(u,n&&n.settings&&n.settings.plugins);var a;if(u&&0===t.length){t=[];for(a in u){if(u.hasOwnProperty(a)){t.push(a)}}}s(i(u,t),e)},register:function(e){if(!e.name){throw new Error("Plugin does not have an name.")}if(this.plugins[e.name]){throw new Error('Already registered the plugin "'+e.name+'"!')}this.plugins[e.name]=e},makeClean:function(e){var t,r;for(r in this.plugins){if(this.plugins.hasOwnProperty(r)){if(n.Log.isDebugEnabled()){n.Log.debug(this,"Passing contents of HTML Element with id { "+e.attr("id")+" } for cleaning to plugin { "+r+" }")}this.plugins[r].makeClean(e)}}},toString:function(){return"pluginmanager"}}))});define("aloha/core",["jquery","aloha/pluginmanager"],function(e,t){function r(){var t=e.browser;var n=t.version;return!(t.webkit&&parseFloat(n)<532.5||t.mozilla&&parseFloat(n)<1.9||t.msie&&n<7||t.opera&&n<11)}function i(t){var n=e(t.target);return n.is(".aloha-dialog")||n.closest(".aloha").length}function s(){e("html").mousedown(function(e){if(n.activeEditable&&!n.eventHandled&&!i(e)){n.deactivateEditable()}}).mouseup(function(){n.eventHandled=false})}function o(t,i){if(!r()){var o=window.console;if(o){var u=o.error?"error":o.log?"log":null;if(u){o[u]("This browser is not supported")}}return}if(e.browser.webkit){e("html").addClass("aloha-webkit")}else if(e.browser.opera){e("html").addClass("aloha-opera")}else if(e.browser.msie){e("html").addClass("aloha-ie"+parseInt(e.browser.version,10))}else if(e.browser.mozilla){e("html").addClass("aloha-mozilla")}if(navigator.appVersion.indexOf("Win")!==-1){n.OSName="Win"}else if(navigator.appVersion.indexOf("Mac")!==-1){n.OSName="Mac"}else if(navigator.appVersion.indexOf("X11")!==-1){n.OSName="Unix"}else if(navigator.appVersion.indexOf("Linux")!==-1){n.OSName="Linux"}s();n.settings.base=n.getAlohaUrl();n.Log.init();if(n.settings.errorhandling){window.onerror=function(e,t,r){n.Log.error(n,"Error message: "+e+"\nURL: "+t+"\nLine Number: "+r);return true}}t();i()}function u(e,t){n.RepositoryManager.init();e();t()}function a(e,r){if(0===n.loadedPlugins.length){var i=t.plugins;var s;for(s in i){if(i.hasOwnProperty(s)){n.loadedPlugins.push(s)}}}var o=false;t.init(function(){if(!o){e();o=true}r()},n.loadedPlugins);if(!o){e();o=true}}function f(e,t){var r;for(r=0;r<n.editables.length;r++){if(!n.editables[r].ready){n.editables[r].init()}}e();t()}var n=window.Aloha;var l=[{fn:null,event:null,deferred:null},{fn:o,event:null,deferred:null},{fn:u,event:null,deferred:null},{fn:a,event:"aloha-plugins-loaded",deferred:null},{fn:f,event:null,deferred:null},{fn:null,event:"aloha-ready",deferred:null}];e.extend(true,n,{version:"0.23.12",editables:[],activeEditable:null,settings:{},defaults:{},ui:{},OSName:"Unknown",loadedPlugins:[],_pluginBaseUrlByName:{},init:function(){n.initialize(l)},getLoadedPlugins:function(){return this.loadedPlugins},isPluginLoaded:function(t){var n=false;e.each(this.loadedPlugins,function(e,r){if(t===r.toString()){n=true;return false}});return n},activateEditable:function(e){var t=n.editables;var r;for(r=0;r<t.length;r++){if(t[r]!==e&&t[r].isActive){t[r].blur()}}n.activeEditable=e},getActiveEditable:function(){return n.activeEditable},deactivateEditable:function(){if(n.activeEditable){n.activeEditable.blur();n.activeEditable=null}},getEditableById:function(t){var r=e("#"+t);if(r.length&&"textarea"===r[0].nodeName.toLowerCase()){t=t+"-aloha"}var i;for(i=0;i<n.editables.length;i++){if(n.editables[i].getId()===t){return n.editables[i]}}return null},isEditable:function(e){var t,r;for(t=0,r=n.editables.length;t<r;t++){if(n.editables[t].originalObj.get(0)===e){return true}}return false},getEditableHost:function(){var e=function(e){var t;for(t=0;t<n.editables.length;t++){if(n.editables[t].originalObj[0]===e){return n.editables[t]}}return null};return function(t){if(!t||0===t.length){return null}var n=e(t[0]);if(!n){t.parents().each(function(t,r){n=e(r);if(n){return false}})}return n}}(),log:function(e,t,r){if(typeof n.Log!=="undefined"){n.Log.log(e,t,r)}},registerEditable:function(e){n.editables.push(e)},unregisterEditable:function(t){var r=e.inArray(t,n.editables);if(r!==-1){n.editables.splice(r,1)}},isModified:function(){var e;for(e=0;e<n.editables.length;e++){if(n.editables[e].isModified&&n.editables[e].isModified()){return true}}return false},getAlohaUrl:function(e){return n.settings.baseUrl||""},getPluginUrl:function(e){if(!e){return null}var t=n.settings._pluginBaseUrlByName[e];if(t){if(!t.match("^(/|http[s]?:).*")){t=n.getAlohaUrl()+"/"+t}}return t},disableObjectResizing:function(){try{var e;try{e=document.queryCommandSupported("enableObjectResizing")}catch(t){e=false;n.Log.log("enableObjectResizing is not supported.")}if(e){document.execCommand("enableObjectResizing",false,false);n.Log.log("enableObjectResizing disabled.")}}catch(r){n.Log.error(r,"Could not disable enableObjectResizing")}},toString:function(){return"Aloha"}});return n});define("aloha/console",["aloha/core","util/class","jquery"],function(e,t,n){var r=t.extend({init:function(){if(typeof e.settings.logLevels==="undefined"||!e.settings.logLevels){e.settings.logLevels={error:true,warn:true}}if(typeof e.settings.logHistory==="undefined"||!e.settings.logHistory){e.settings.logHistory={}}if(!e.settings.logHistory.maxEntries){e.settings.logHistory.maxEntries=100}if(!e.settings.logHistory.highWaterMark){e.settings.logHistory.highWaterMark=90}if(!e.settings.logHistory.levels){e.settings.logHistory.levels={error:true,warn:true}}this.flushLogHistory();e.trigger("aloha-logger-ready")},logHistory:[],highWaterMarkReached:false,log:function(t,n,r){if(typeof n==="undefined"){r=t}if(typeof n!=="string"&&n&&n.toString){n=n.toString()}if(typeof r==="undefined"){r=n;n=undefined}if(typeof t==="undefined"||!t){t="log"}t=t.toLowerCase();if(typeof e.settings.logLevels==="undefined"){return}if(!e.settings.logLevels[t]){return}n=n||"Unkown Aloha Component";this.addToLogHistory({level:t,component:n,message:r,date:new Date});var i=window.console;switch(t){case"error":if(window.console&&i.error){if(!n&&!r){i.error("Error occured without message and component")}else{i.error(n+": "+r)}}break;case"warn":if(window.console&&i.warn){i.warn(n+": "+r)}break;case"info":if(window.console&&i.info){i.info(n+": "+r)}break;case"debug":if(window.console&&i.log){i.log(n+" ["+t+"]: "+r)}break;default:if(window.console&&i.log){i.log(n+" ["+t+"]: "+r)}break}},error:function(e,t){this.log("error",e,t)},warn:function(e,t){this.log("warn",e,t)},info:function(e,t){this.log("info",e,t)},debug:function(e,t){this.log("debug",e,t)},deprecated:function(t,n){this.log("warn",t,n);if(e.settings.logLevels.deprecated){throw new Error(n)}},isLogLevelEnabled:function(t){return e.settings&&e.settings.logLevels&&e.settings.logLevels[t]},isErrorEnabled:function(){return this.isLogLevelEnabled("error")},isWarnEnabled:function(){return this.isLogLevelEnabled("warn")},isInfoEnabled:function(){return this.isLogLevelEnabled("info")},isDebugEnabled:function(){return this.isLogLevelEnabled("debug")},addToLogHistory:function(t){if(!e.settings.logHistory){this.init()}if(e.settings.logHistory.maxEntries<=0||!e.settings.logHistory.levels[t.level]){return}this.logHistory.push(t);if(!this.highWaterMarkReached){if(this.logHistory.length>=e.settings.logHistory.maxEntries*e.settings.logHistory.highWaterMark/100){e.trigger("aloha-log-full");this.highWaterMarkReached=true}}while(this.logHistory.length>e.settings.logHistory.maxEntries){this.logHistory.shift()}},getLogHistory:function(){return this.logHistory},flushLogHistory:function(){this.logHistory=[];this.highWaterMarkReached=false}});r=new r;e.Log=e.Console=r;return r});window.GENTICS=window.GENTICS||{};window.GENTICS.Utils=window.GENTICS.Utils||{};define("util/range",["jquery","util/dom","util/class","aloha/console","aloha/rangy-core"],function(e,t,n,r,i){function u(e,t){var n=[],r;if(1===e.nodeType){r=e}else{r=e.parentNode}for(;;){if(!r||r===t||9===r.nodeType){break}if(1===r.nodeType){n.push(r)}r=r.parentNode}return n}var s=window.GENTICS;var o=window.Aloha;s.Utils.RangeObject=n.extend({_constructor:function(e){if(typeof e==="object"){if(typeof e.startContainer!=="undefined"){this.startContainer=e.startContainer}if(typeof e.startOffset!=="undefined"){this.startOffset=e.startOffset}if(typeof e.endContainer!=="undefined"){this.endContainer=e.endContainer}if(typeof e.endOffset!=="undefined"){this.endOffset=e.endOffset}}else if(e===true){this.initializeFromUserSelection()}},startContainer:undefined,startOffset:undefined,endContainer:undefined,endOffset:undefined,deleteContents:function(){t.removeRange(this)},log:function(e){r.deprecated("Utils.RangeObject","log() is deprecated. use "+'console.log() from module "aloha/console" instead: '+e)},isCollapsed:function(){return!this.endContainer||this.startContainer===this.endContainer&&this.startOffset===this.endOffset},getCommonAncestorContainer:function(){if(this.commonAncestorContainer){return this.commonAncestorContainer}this.updateCommonAncestorContainer();return this.commonAncestorContainer},getContainerParents:function(t,n){var r=n?this.endContainer:this.startContainer;if(!r){return false}return e(u(r,t?t[0]:null))},getStartContainerParents:function(e){return this.getContainerParents(e,false)},getEndContainerParents:function(e){return this.getContainerParents(e,true)},updateCommonAncestorContainer:function(e){if(!e){var t=this.getStartContainerParents(),n=this.getEndContainerParents(),i;if(!(t.length>0&&n.length>0)){r.warn("aloha/range","could not find commonAncestorContainer");return false}for(i=0;i<t.length;i++){if(n.index(t[i])!=-1){this.commonAncestorContainer=t[i];break}}}else{this.commonAncestorContainer=e}r.debug(e?"commonAncestorContainer was set successfully":"commonAncestorContainer was calculated successfully");return true},getCollapsedIERange:function(e,t){var n=document.body.createTextRange(),r,i,s,o;o=this.searchElementToLeft(e,t);if(o.element){r=document.body.createTextRange();r.moveToElementText(o.element);n.setEndPoint("StartToEnd",r);if(o.characters!==0){n.moveStart("character",o.characters)}else{n.moveStart("character",1);n.moveStart("character",-1)}}else{i=this.searchElementToRight(e,t);s=e.nodeType==3?e.parentNode:e;r=document.body.createTextRange();r.moveToElementText(s);n.setEndPoint("StartToStart",r);if(o.characters!==0){n.moveStart("character",o.characters)}}n.collapse();return n},select:function(){var e,t,n,s,o;if(typeof this.startContainer==="undefined"||typeof this.endContainer==="undefined"){r.warn("can not select an empty range");return false}s=i.createRange();s.setStart(this.startContainer,this.startOffset);s.setEnd(this.endContainer,this.endOffset);o=i.getSelection();o.setSingleRange(s)},searchElementToLeft:function(e,t){var n,r=0;if(e.nodeType===3){r=t;n=e.previousSibling}else{if(t>0){n=e.childNodes[t-1]}}while(n&&n.nodeType===3){r+=n.data.length;n=n.previousSibling}return{element:n,characters:r}},searchElementToRight:function(e,t){var n,r=0;if(e.nodeType===3){r=e.data.length-t;n=e.nextSibling}else{if(t<e.childNodes.length){n=e.childNodes[t]}}while(n&&n.nodeType===3){r+=n.data.length;n=n.nextSibling}return{element:n,characters:r}},update:function(e){r.debug("now updating rangeObject");this.initializeFromUserSelection(e);this.updateCommonAncestorContainer()},initializeFromUserSelection:function(e){var t=i.getSelection(),n;if(!t){return false}if(!t.rangeCount){return false}n=t.getRangeAt(0);if(!n){return false}this.startContainer=n.startContainer;this.endContainer=n.endContainer;this.startOffset=n.startOffset;this.endOffset=n.endOffset;this.correctRange();return},correctRange:function(){var t,n,r,i,u;this.clearCaches();if(this.isCollapsed()){if(this.startContainer.nodeType===1){if(this.startOffset>0&&this.startContainer.childNodes[this.startOffset-1].nodeType===3){this.startContainer=this.startContainer.childNodes[this.startOffset-1];this.startOffset=this.startContainer.data.length;this.endContainer=this.startContainer;this.endOffset=this.startOffset;return}if(this.startOffset>0&&this.startContainer.childNodes[this.startOffset-1].nodeType===1){t=s.Utils.Dom.searchAdjacentTextNode(this.startContainer,this.startOffset,true);if(t){this.startContainer=this.endContainer=t;this.startOffset=this.endOffset=t.data.length;return}t=s.Utils.Dom.searchAdjacentTextNode(this.startContainer,this.startOffset,false);if(t){this.startContainer=this.endContainer=t;this.startOffset=this.endOffset=0;return}}if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType===3){this.startContainer=this.startContainer.childNodes[this.startOffset];this.startOffset=0;this.endContainer=this.startContainer;this.endOffset=0;return}}if(this.startContainer.nodeType===3&&this.startOffset===0){t=s.Utils.Dom.searchAdjacentTextNode(this.startContainer.parentNode,s.Utils.Dom.getIndexInParent(this.startContainer),true);if(t&&e(t).closest(o.activeEditable.obj).length>0){this.startContainer=this.endContainer=t;this.startOffset=this.endOffset=t.data.length}}}else{if(this.startContainer.nodeType===1){if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType===3){this.startContainer=this.startContainer.childNodes[this.startOffset];this.startOffset=0}else if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType===1){n=false;r=this.startContainer.childNodes[this.startOffset];while(n===false&&r.childNodes&&r.childNodes.length>0){r=r.childNodes[0];if(r.nodeType===3){n=r}}if(n!==false){this.startContainer=n;this.startOffset=0}}}if(this.startContainer.nodeType===3&&this.startOffset===this.startContainer.data.length){t=s.Utils.Dom.searchAdjacentTextNode(this.startContainer.parentNode,s.Utils.Dom.getIndexInParent(this.startContainer)+1,false);if(t){this.startContainer=t;this.startOffset=0}}if(this.endContainer.nodeType===3&&this.endOffset===0){if(this.endContainer.previousSibling&&this.endContainer.previousSibling.nodeType===3){this.endContainer=this.endContainer.previousSibling;this.endOffset=this.endContainer.data.length}else if(this.endContainer.previousSibling&&this.endContainer.previousSibling.nodeType===1&&this.endContainer.parentNode){i=this.endContainer.parentNode;for(u=0;u<i.childNodes.length;++u){if(i.childNodes[u]==this.endContainer){this.endOffset=u;break}}this.endContainer=i}}if(this.endContainer.nodeType==1&&this.endOffset===0){if(this.endContainer.previousSibling){if(this.endContainer.previousSibling.nodeType===3){this.endContainer=this.endContainer.previousSibling;this.endOffset=this.endContainer.data.length}else if(this.endContainer.previousSibling.nodeType===1&&this.endContainer.previousSibling.childNodes&&this.endContainer.previousSibling.childNodes.length>0){this.endContainer=this.endContainer.previousSibling;this.endOffset=this.endContainer.childNodes.length}}}if(this.endContainer.nodeType==1){if(this.endOffset>0&&this.endContainer.childNodes[this.endOffset-1].nodeType===3){this.endContainer=this.endContainer.childNodes[this.endOffset-1];this.endOffset=this.endContainer.data.length}else if(this.endOffset>0&&this.endContainer.childNodes[this.endOffset-1].nodeType===1){n=false;r=this.endContainer.childNodes[this.endOffset-1];while(n===false&&r.childNodes&&r.childNodes.length>0){r=r.childNodes[r.childNodes.length-1];if(r.nodeType===3){n=r}}if(n!==false){this.endContainer=n;this.endOffset=this.endContainer.data.length}}}}},clearCaches:function(){this.commonAncestorContainer=undefined},getRangeTree:function(e){if(typeof e==="undefined"){e=this.getCommonAncestorContainer()}this.inselection=false;return this.recursiveGetRangeTree(e)},recursiveGetRangeTree:function(t){var n=e(t),r=0,i=this,o=[];n.contents().each(function(e){var n="none",u=false,a=false,f=false,l=false,c=false,h=false,p;if(i.isCollapsed()&&t===i.startContainer&&i.startOffset===e){o[r]=new s.Utils.RangeTree;o[r].type="collapsed";o[r].domobj=undefined;i.inselection=false;f=true;r++}if(!i.inselection&&!f){switch(this.nodeType){case 3:if(this===i.startContainer){i.inselection=true;n=i.startOffset>0?"partial":"full";u=i.startOffset;a=this.length}break;case 1:if(this===i.startContainer&&i.startOffset===0){i.inselection=true;n="full"}if(t===i.startContainer&&i.startOffset===e){i.inselection=true;n="full"}break}}if(i.inselection&&!f){if(n=="none"){n="full"}switch(this.nodeType){case 3:if(this===i.endContainer){i.inselection=false;if(i.endOffset<this.length){n="partial"}if(u===false){u=0}a=i.endOffset}break;case 1:if(this===i.endContainer&&i.endOffset===0){i.inselection=false}break}if(t===i.endContainer&&i.endOffset<=e){i.inselection=false;n="none"}}o[r]=new s.Utils.RangeTree;o[r].domobj=this;o[r].type=n;if(n=="partial"){o[r].startOffset=u;o[r].endOffset=a}o[r].children=i.recursiveGetRangeTree(this);if(o[r].children.length>0){for(p=0;p<o[r].children.length;++p){switch(o[r].children[p].type){case"none":l=true;break;case"full":h=true;break;case"partial":c=true;break}}if(c||h&&l){o[r].type="partial"}else if(h&&!c&&!l){o[r].type="full"}}r++});if(this.isCollapsed()&&t===this.startContainer&&this.startOffset==t.childNodes.length){o[r]=new s.Utils.RangeTree;o[r].type="collapsed";o[r].domobj=undefined}return o},findMarkup:function(e,t,n){var r=n?this.endContainer:this.startContainer,i,s,o;t=t?t[0]:null;if(!r){return}i=u(r,t);for(s=0,o=i.length;s<o;s++){if(e.apply(i[s])){return i[s]}}return false},getText:function(){if(this.isCollapsed()){return""}return this.recursiveGetText(this.getRangeTree())},recursiveGetText:function(t){if(!t){return""}var n=this,r="";e.each(t,function(){if(this.type=="full"){r+=e(this.domobj).text()}else if(this.type=="partial"&&this.domobj.nodeType===3){r+=e(this.domobj).text().substring(this.startOffset,this.endOffset)}else if(this.type=="partial"&&this.domobj.nodeType===1&&this.children){r+=n.recursiveGetText(this.children)}});return r}});s.Utils.RangeTree=n.extend({domobj:{},type:null,children:[]});return s.Utils.RangeObject});define("util/functions",[],function(){function e(e){return e}function t(){}function n(){return true}function r(){return false}function i(e){return function(){return!e.apply(this,arguments)}}return{identity:e,noop:t,returnTrue:n,returnFalse:r,complement:i}});define("util/arrays",["util/functions"],function(e){function t(e,t){var n;if(t){e.sort(t);for(n=1;n<e.length;n++){if(0===t(e[n],e[n-1])){e.splice(n--,1)}}}else{e.sort();for(n=1;n<e.length;n++){if(e[n]==e[n-1]){e.splice(n--,1)}}}return e}function n(e,t,n){var r,i=e.length;if(i!==t.length){return false}if(n){for(r=0;r<i;r++){if(!n(e[r],t[r])){return false}}}else{for(r=0;r<i;r++){if(e[r]!==t[r]){return false}}}return true}function r(e,t){var n,r,i=[];for(n=0,r=e.length;n<r;n++){i.push(t(e[n]))}return i}function i(e,t){return e.map(t)}function s(e,t){var n,r,i,s=[];for(n=0,r=e.length;n<r;n++){i=e[n];if(t(i)){s.push(i)}}return s}function o(e,t){var n,r;for(n=0,r=e.length;n<r;n++){if(t===e[n]){return n}}return-1}function u(e,t,n){var r,i;for(r=0,i=e.length;r<i;r++){t=n(t,e[r])}return t}function a(e,t){return-1!==o(e,t)}function f(e,t){return e==null?null:t(e)}function l(e,t){var n,r;for(n=0,r=e.length;n<r;n++){t(e[n],n,e)}}function c(e,t){var n,r;for(n=0,r=e.length;n<r;n++){if(t(e[n])){return true}}return false}function h(t,n){return!c(t,e.complement(n))}function p(e,t){return s(e,function(e){return a(t,e)})}function d(e){return e.length?e[e.length-1]:null}function v(e){return e[1]}return{filter:s,indexOf:o,reduce:u,forEach:l,some:c,every:h,map:Array.prototype.map?i:r,contains:a,equal:n,applyNotNull:f,sortUnique:t,intersect:p,second:v,last:d}});define("util/strings",["jquery"],function(e){function n(e){var n=e.split(t);if(n.length&&n[0]===""){n.shift()}if(n.length&&n[n.length-1]===""){n.pop()}return n}function r(e){return e.replace(/[\-]([a-z])/gi,function(e,t){return t.toUpperCase()})}function i(e){return e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()})}function s(e,t){var n=[];var r=0;var i;while(null!=(i=t.exec(e))){if(r<i.index){n.push(e.substring(r,i.index));r=i.index}r+=i[0].length;n.push(i[0])}if(r<e.length){n.push(e.substring(r,e.length))}return n}function o(e){return""===e||null==e}var t=/\s+/;return{words:n,dashesToCamelCase:r,camelCaseToDashes:i,splitIncl:s,empty:o}});define("PubSub",[],function(){function r(n){return t[n]&&e[t[n].channel]}function i(n,r){if(!e[n]){return 0}if(!r){r={}}else if(typeof r!=="object"){r={data:r}}r.channel=n;var i=e[n].slice();var s;for(s=0;s<i.length;++s){t[i[s]].callback(r)}return s}var e={};var t={};var n=0;var s={sub:function(r,i){if(typeof i!=="function"){return-1}var s=e[r];if(!s){s=e[r]=[]}s.push(++n);t[n]={channel:r,callback:i};return n},unsub:function(e){if(-1===e||!t[e]){return false}var n=r(e);delete t[e];var i=n.length;while(i){if(n[--i]===e){n.splice(i,1);return true}}return false},pub:function(e,t){var n=e.split(".");var r;var s=n.length;var o="";var u=0;for(r=0;r<s;++r){o+=(0===r?"":".")+n[r];u+=i(o,t)}return u}};return s});define("util/maps",[],function(){function e(e){var t;for(t in e){if(e.hasOwnProperty(t)){return false}}return true}function t(e,t,n){var r=t.length;while(r--){e[t[r]]=n}return e}function n(e,t){var n=t.length,r;while(n--){r=t[n];e[r[0]]=r[1]}return e}function r(e){var t=[],n;for(n in e){if(e.hasOwnProperty(n)){t.push(n)}}return t}function i(e,t){var n;for(n in e){if(e.hasOwnProperty(n)){t(e[n],n,e)}}}return{isEmpty:e,fillTuples:n,fillKeys:t,keys:r,forEach:i}});define("util/html",["jquery","util/dom","util/maps","util/arrays"],function(e,t,n,r){function v(e){return f.test(e)||h.test(e)}function m(e){return 3===e.nodeType&&v(e.data)}function y(e){return g[e.nodeName]}function b(e){return 3===e.nodeType&&!e.length}function w(e){return i[e.nodeName]}function E(e){if(!g[e.nodeName]){return false}var t=false;var n=e.children;var r=n.length;var i;for(i=0;i<r;i++){if(!t&&"br"===n[i].nodeName.toLowerCase()){t=true}else if(!b(n[i])){return false}}return t}function S(e){return 1===e.nodeType&&"true"===e.contentEditable}function x(e,t){while(e&&!t(e)){e=e.previousSibling}return e}function T(e,t){while(e&&!t(e)){e=e.nextSibling}return e}function N(n){if(n.obj[0]&&t.allowsNesting(n.obj[0],e("<p>")[0])){return true}return false}function C(e){return e.replace(l,"").replace(c,"").replace(p,"").replace(d,"")}function k(e){if(3===e.nodeType&&0===e.data.length){return true}if(e===e.parentNode.lastChild&&y(e.parentNode)&&"BR"===e.nodeName){return true}return m(e)}var i={A:true,B:true,EM:true,FONT:true,I:true,S:true,SPAN:true,STRIKE:true,STRONG:true,SUB:true,SUP:true,U:true};var s=["address","article","aside","audio","blockquote","canvas","dd","div","dl","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","noscript","ol","output","p","pre","section","table","tfoot","ul","video"];var o=["\\u200B","\\u200C","\\u200D","\\uFEFF"];var u=["\\u0009","\\u000A","\\u000B","\\u000C","\\u000D","\\u0020","\\u0085","\\u00A0","\\u1680","\\u180E","\\u2000","\\u2001","\\u2002","\\u2003","\\u2004","\\u2005","\\u2006","\\u2007","\\u2008","\\u2009","\\u200A","\\u2028","\\u2029","\\u202F","\\u205F","\\u3000"];var a=u.join("");var f=new RegExp("["+a+"]+");var l=new RegExp("^["+a+"]+");var c=new RegExp("["+a+"]+$");var h=new RegExp("["+o.join("")+"]+");var p=new RegExp("^["+o.join("")+"]+");var d=new RegExp("["+o.join("")+"]+$");var g={};n.fillKeys(g,s,true);n.fillKeys(g,r.map(s,function(e){return e.toUpperCase()}),true);return{BLOCKLEVEL_ELEMENTS:s,isBlock:y,isIgnorableWhitespace:b,isInlineFormattable:w,isProppedBlock:E,isEditingHost:S,findNodeLeft:T,findNodeRight:x,allowNestedParagraph:N,trimWhitespaceCharacters:C,isWSPorZWSPNode:m,isWSPorZWSPText:v,isUnrenderedNode:k}});define("aloha/engine",["aloha/core","aloha/ecma5shims","util/maps","util/html","jquery"],function(e,t,n,r,i){function s(e,t){var n=e.hasAttribute;if(n){return e.hasAttribute(t)}return typeof e.attributes[t]!="undefined"}function l(e){return e===null||!e||e===o}function c(e,n){if(typeof n=="string"){n=[n]}if(typeof n=="object"){n=t(n).map(function(e){return e.toUpperCase()})}return e&&e.nodeType==1&&l(e.namespaceURI)&&(typeof n=="undefined"||t(n).indexOf(e.tagName)!=-1)}function h(e){return e&&e.nodeType==1&&l(e.namespaceURI)}function p(e,t){return e&&e.nodeType==1&&l(e.namespaceURI)&&t.toUpperCase()===e.nodeName}function d(e,t){var n,r;t=t.toUpperCase();for(n=0,r=e.length;n<r;n++){if(e[n].toUpperCase()===t){return true}}return false}function v(e,t){return e&&e.nodeType==1&&l(e.namespaceURI)&&d(t,e.nodeName)}function m(e,t){return e&&e.nodeType==1&&l(e.namespaceURI)&&t[e.nodeName]}function g(e){var t;var n=0;if(!e){return 0}if(!e.style){return 0}if(typeof e.style.length!=="undefined"){return e.style.length}for(t in e.style){if(e.style[t]&&e.style[t]!==0&&e.style[t]!=="false"){n++}}return n}function y(e){if(!e){return null}var t=[],n,r=e.length;n=r>>>0;while(n--){t[n]=e[n]}return t}function b(e){while(e&&!e.nextSibling){e=e.parentNode}if(!e){return null}return e.nextSibling}function w(e){if(e.hasChildNodes()){return e.firstChild}return b(e)}function E(e){if(e.previousSibling){e=e.previousSibling;while(e.hasChildNodes()){e=e.lastChild}return e}if(e.parentNode&&e.parentNode.nodeType==t.Node.ELEMENT_NODE){return e.parentNode}return null}function S(e,n){return e&&n&&Boolean(t.compareDocumentPosition(e,n)&t.Node.DOCUMENT_POSITION_CONTAINED_BY)}function x(e,t){return(e||t)&&(e==t||S(e,t))}function T(e,n){return n&&e&&Boolean(t.compareDocumentPosition(n,e)&t.Node.DOCUMENT_POSITION_CONTAINED_BY)}function N(e,n){return Boolean(t.compareDocumentPosition(e,n)&t.Node.DOCUMENT_POSITION_FOLLOWING)}function C(e,n){return Boolean(t.compareDocumentPosition(e,n)&t.Node.DOCUMENT_POSITION_PRECEDING)}function k(e){var t=[];while(e.parentNode){t.unshift(e.parentNode);e=e.parentNode}return t}function L(e){var t=[];var n=b(e);while(null!=(e=w(e))&&e!=n){t.push(e)}return t}function A(e){var t={fontFamily:"font-family",fontSize:"font-size",fontStyle:"font-style",fontWeight:"font-weight",textDecoration:"text-decoration"};if(typeof t[e]!="undefined"){return t[e]}return e}function O(e){return{"xx-small":1,small:2,medium:3,large:4,"x-large":5,"xx-large":6,"xxx-large":7}[e]}function M(e){return{1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[e]}function _(e){if(e.dir=="ltr"){return"ltr"}if(e.dir=="rtl"){return"rtl"}if(!h(e.parentNode)){return"ltr"}return _(e.parentNode)}function D(e){var t=0;while(e.previousSibling){t++;e=e.previousSibling}return t}function P(e){switch(e.nodeType){case t.Node.PROCESSING_INSTRUCTION_NODE:case t.Node.DOCUMENT_TYPE_NODE:return 0;case t.Node.TEXT_NODE:case t.Node.COMMENT_NODE:return e.length;default:return e.childNodes.length}}function H(e,n,r,i){if(e==r){if(n==i){return"equal"}if(n<i){return"before"}if(n>i){return"after"}}var s=t.compareDocumentPosition(r,e);if(s&t.Node.DOCUMENT_POSITION_FOLLOWING){var o=H(r,i,e,n);if(o=="before"){return"after"}if(o=="after"){return"before"}}if(s&t.Node.DOCUMENT_POSITION_CONTAINS){var u=r;while(u.parentNode!=e){u=u.parentNode}if(D(u)<n){return"after"}}return"before"}function B(e){var t=e;while(t.parentNode!=null){t=t.parentNode}return t}function j(e,t){var n=H(e,0,t.startContainer,t.startOffset);if(n!=="after"){return false}var r=H(e,P(e),t.endContainer,t.endOffset);if(r!=="before"){return false}return B(e)==B(t.startContainer)}function F(e,t){if(typeof t=="undefined"){t=function(){return true}}var n=e.startContainer;if(n.hasChildNodes()&&e.startOffset<n.childNodes.length){n=n.childNodes[e.startOffset]}else if(e.startOffset==P(n)){n=b(n)}else{n=w(n)}var r=e.endContainer;if(r.hasChildNodes()&&e.endOffset<r.childNodes.length){r=r.childNodes[e.endOffset]}else{r=b(r)}var i=[];while(N(n,r)){if(j(n,e)&&t(n)){i.push(n);n=b(n);continue}n=w(n)}return i}function I(e,t){if(typeof t=="undefined"){t=function(){return true}}var n=e.startContainer;if(n.hasChildNodes()&&e.startOffset<n.childNodes.length){n=n.childNodes[e.startOffset]}else if(e.startOffset==P(n)){n=b(n)}else{n=w(n)}var r=e.endContainer;if(r.hasChildNodes()&&e.endOffset<r.childNodes.length){r=r.childNodes[e.endOffset]}else{r=b(r)}var i=[];while(N(n,r)){if(j(n,e)&&t(n)){i.push(n)}n=w(n)}return i}function q(e){if(e.toLowerCase()=="currentcolor"){return null}var n=document.createElement("span");document.body.appendChild(n);n.style.color="black";var r=document.createElement("span");n.appendChild(r);r.style.color=e;e=t.getComputedStyle(r).color;if(e=="rgb(0, 0, 0)"){n.color="white";e=t.getComputedStyle(r).color;if(e!="rgb(0, 0, 0)"){return null}}document.body.removeChild(n);if(/^rgba\([0-9]+, [0-9]+, [0-9]+, 1\)$/.test(e)){return e.replace("rgba","rgb").replace(", 1)",")")}if(e=="transparent"){return"rgba(0, 0, 0, 0)"}return e}function R(e){e=e.toLowerCase();if(t(["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"]).indexOf(e)!=-1){return e}e=q(e);var n=/^rgb\(([0-9]+), ([0-9]+), ([0-9]+)\)$/.exec(e);if(n){return"#"+parseInt(n[1],10).toString(16).replace(/^.$/,"0$&")+parseInt(n[2],10).toString(16).replace(/^.$/,"0$&")+parseInt(n[3],10).toString(16).replace(/^.$/,"0$&")}else if(/^#[abcdef0123456789]+$/i.exec(e)){return e}return null}function Q(e){e=t(e).trim();if(/^[\-+]?[0-9]+(\.[0-9]+)?([eE][\-+]?[0-9]+)?$/.test(e)){var n;if(e[0]=="+"){e=e.slice(1);n="relative-plus"}else if(e[0]=="-"){e=e.slice(1);n="relative-minus"}else{n="absolute"}var r=parseInt(e,10);if(n=="relative-plus"){r+=3}if(n=="relative-minus"){r=3-r}if(r<1){r=1}if(r>7){r=7}e={1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[r]}return e}function G(e){e=Q(e);if(i.inArray(e,["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large"])==-1&&!/^[0-9]+(\.[0-9]+)?(cm|mm|in|pt|pc|px)$/.test(e)){return null}var n=document.createElement("font");document.body.appendChild(n);if(e=="xxx-large"){n.size=7}else{n.style.fontSize=e}var r=parseInt(t.getComputedStyle(n).fontSize,10);document.body.removeChild(n);var s=1;while(s<7){n=document.createElement("font");n.size=s;document.body.appendChild(n);var o=parseInt(t.getComputedStyle(n).fontSize,10);n.size=1+s;var u=parseInt(t.getComputedStyle(n).fontSize,10);document.body.removeChild(n);var a=(u+o)/2;if(r<a){return String(s)}s++}return"7"}function Y(e,t,n,r){var i;if(K==0&&typeof n!="undefined"){a=n}else if(K==0){a=null;a=n}K++;try{i=r()}catch(s){K--;throw s}K--;return i}function Z(e,t){e=e.toLowerCase();return Y(e,"action",t,function(e){return function(){return i.inArray(e,["copy","cut","paste","selectall","stylewithcss","usecss"])!=-1||t!==null}}(e))}function et(e){var t=new window.GENTICS.Utils.RangeObject;t.startContainer=e.startContainer;t.startOffset=e.startOffset;t.endContainer=e.endContainer;t.endOffset=e.endOffset;t.select()}function tt(e,t,n,r){var i=e.toLowerCase();var s=t;var o=n;if(arguments.length==1||arguments.length>=4&&typeof s=="undefined"){s=false}if(arguments.length<=2||arguments.length>=4&&typeof o=="undefined"){o=""}return Y(i,"action",r,function(e,t,n){return function(){if(!Z(e)){return false}f[e].action(n,r);et(r);return true}}(i,s,o))}function nt(e,t){e=e.toLowerCase();return Y(e,"indeterm",t,function(e){return function(){if(!Z(e,t)){return false}return f[e].indeterm(t)}}(e))}function rt(e,t){e=e.toLowerCase();return Y(e,"state",t,function(e){return function(){if(!Z(e,t)){return false}if(typeof U(e,t)!="undefined"){return U(e,t)}return f[e].state(t)}}(e))}function it(e){e=e.toLowerCase();return f.hasOwnProperty(e)}function st(e,t){e=e.toLowerCase();return Y(e,"value",t,function(){if(!f.hasOwnProperty(e)||!f[e].hasOwnProperty("value")){return""}if(e=="fontsize"&&V("fontsize",t)!==undefined){return G(V("fontsize",t))}if(typeof V(e,t)!="undefined"){return V(e,t)}return f[e].value(t)})}function ut(e){return m(e,ot)}function ft(e){return e&&(e.nodeType==t.Node.ELEMENT_NODE&&!at[t.getComputedStyle(e).display]||e.nodeType==t.Node.DOCUMENT_NODE||e.nodeType==t.Node.DOCUMENT_FRAGMENT_NODE)}function lt(e){return e&&!ft(e)}function ct(e){return e&&e.nodeType==t.Node.ELEMENT_NODE&&(e.contentEditable=="true"||e.parentNode&&e.parentNode.nodeType==t.Node.DOCUMENT_NODE&&e.parentNode.designMode=="on")}function ht(e){return e&&!ct(e)&&(e.nodeType!=t.Node.ELEMENT_NODE||e.contentEditable!="false"||i(e).hasClass("aloha-table-wrapper"))&&(ct(e.parentNode)||ht(e.parentNode))}function pt(e){var t;for(t=0;t<e.childNodes.length;t++){if(ht(e.childNodes[t])||pt(e.childNodes[t])){return true}}return false}function dt(e){if(ct(e)){return e}if(ht(e)){var t=e.parentNode;while(!ct(t)){t=t.parentNode}return t}return null}function vt(e,t){return dt(e)&&dt(e)==dt(t)}function mt(e){if(!p(e,"br")){return false}var n=e.parentNode;while(t.getComputedStyle(n).display=="inline"){n=n.parentNode}var r={height:n.style.height,maxHeight:n.style.maxHeight,minHeight:n.style.minHeight};n.style.height="auto";n.style.maxHeight="none";if(!(i.browser.msie&&i.browser.version<8)){n.style.minHeight="0"}var s=document.createTextNode("");var o=n.offsetHeight;if(o==0){throw"isCollapsedLineBreak: original height is zero, bug?"}e.parentNode.insertBefore(s,e.nextSibling);var u=n.offsetHeight;s.parentNode.removeChild(s);n.style.height=r.height;n.style.maxHeight=r.maxHeight;if(!(i.browser.msie&&i.browser.version<8)){n.style.minHeight=r.minHeight}return o<u-5}function gt(e){if(!p(e,"br")){return false}if(p(e.parentNode,"li")&&e.parentNode.childNodes.length==1){return false}var n=e.parentNode;while(t.getComputedStyle(n).display=="inline"){n=n.parentNode}var r={height:n.style.height,maxHeight:n.style.maxHeight,minHeight:n.style.minHeight,contentEditable:n.contentEditable};n.style.height="auto";n.style.maxHeight="none";n.style.minHeight="0";if(i.browser.msie&&i.browser.version<=7){n.contentEditable="false"}var s=n.offsetHeight;if(s==0){throw"isExtraneousLineBreak: original height is zero, bug?"}var o=e.style.display;e.style.display="none";var u=n.offsetHeight;n.style.height=r.height;n.style.maxHeight=r.maxHeight;n.style.minHeight=r.minHeight;if(i.browser.msie&&i.browser.version<=7){n.contentEditable=r.contentEditable}e.style.display=o;return s==u}function yt(e){return e&&e.nodeType==t.Node.TEXT_NODE&&(e.data==""||/^[\t\n\r ]+$/.test(e.data)&&e.parentNode&&e.parentNode.nodeType==t.Node.ELEMENT_NODE&&i.inArray(t.getComputedStyle(e.parentNode).whiteSpace,["normal","nowrap"])!=-1||/^[\t\r ]+$/.test(e.data)&&e.parentNode&&e.parentNode.nodeType==t.Node.ELEMENT_NODE&&t.getComputedStyle(e.parentNode).whiteSpace=="pre-line"||/^[\t\n\r ]+$/.test(e.data)&&e.parentNode&&e.parentNode.nodeType==t.Node.DOCUMENT_FRAGMENT_NODE)}function bt(e,n){if(!ht(e)&&!ct(e)){return}if(!e||e.nodeType!==t.Node.TEXT_NODE){return}if(i.inArray(t.getComputedStyle(e.parentNode).whiteSpace,["pre","pre-wrap"])!=-1){return}if(!/[\t\n\r ]{2,}/.test(e.data)){return}var r="";var s=n.startContainer==e;var o=n.endContainer==e;var u=false;var a;for(a=0;a<e.data.length;++a){if(/[\t\n\r ]/.test(e.data.substr(a,1))){if(!u){r+=" ";u=true}else{if(s&&r.length<n.startOffset){n.startOffset--}if(o&&r.length<n.endOffset){n.endOffset--}}}else{r+=e.data.substr(a,1);u=false}}e.data=r}function wt(e){if(!yt(e)){return false}if(e.data==""){return true}var n=e.parentNode;if(!n){return true}if(t(k(e)).some(function(e){return e.nodeType==t.Node.ELEMENT_NODE&&t.getComputedStyle(e).display=="none"})){return true}while(!ft(n)&&n.parentNode){n=n.parentNode}var r=e;while(r!=n){r=E(r);if(ft(r)||p(r,"br")){return true}if(r.nodeType==t.Node.TEXT_NODE&&!yt(r)||p(r,"img")){break}}r=e;var i=b(n);while(r!=i){r=w(r);if(ft(r)||p(r,"br")){return true}if(r&&r.nodeType==t.Node.TEXT_NODE&&!yt(r)||p(r,"img")){break}}return false}function Et(e){var n;if(!e){return false}if(t(k(e).concat(e)).filter(function(e){return e.nodeType==t.Node.ELEMENT_NODE},true).some(function(e){return t.getComputedStyle(e).display=="none"})){return false}if(ft(e)||e.nodeType==t.Node.TEXT_NODE&&!wt(e)||p(e,"img")||p(e,"br")&&!gt(e)){return true}for(n=0;n<e.childNodes.length;n++){if(Et(e.childNodes[n])){return true}}return false}function St(e){return e&&!Et(e)}function xt(e){var n;if(mt(e)&&!gt(e)){return true}if(!lt(e)||e.nodeType!=t.Node.ELEMENT_NODE){return false}var r=false;for(n=0;n<e.childNodes.length;n++){if(!St(e.childNodes[n])&&!xt(e.childNodes[n])){return false}if(xt(e.childNodes[n])){r=true}}return r}function Tt(e){if(e&&e.nodeType!==t.Node.TEXT_NODE){return false}var n=0;var r=e.data;var i=r.length;while(n<i&&r.charAt(n)===""){n++}return n===i}function Nt(e){return!Tt(e)}function Ct(e){if(!r.isBlock(e)){return false}var t=r.findNodeRight(e.lastChild,Et);return t&&"br"===t.nodeName.toLowerCase()&&!r.findNodeRight(t.previousSibling,Et)}function kt(e){return!e.hasChildNodes()||Ct(e)||!r.findNodeRight(e.lastChild,Nt)}function Lt(e){return e&&kt(e)&&ct(e.parentNode)&&!e.previousSibling&&!e.nextSibling}function At(e){var t=e.parentNode;var n=D(e);t.removeChild(e);return{node:t,offset:n}}function Ot(){var n;if(a){n=a}else if(e.getSelection().rangeCount){n=e.getSelection().getRangeAt(0)}else{return null}if(i.inArray(n.startContainer.nodeType,[t.Node.TEXT_NODE,t.Node.ELEMENT_NODE])==-1||i.inArray(n.endContainer.nodeType,[t.Node.TEXT_NODE,t.Node.ELEMENT_NODE])==-1||!n.startContainer.ownerDocument||!n.endContainer.ownerDocument||!T(n.startContainer,n.startContainer.ownerDocument)||!T(n.endContainer,n.endContainer.ownerDocument)){throw"Invalid active range; test bug?"}return n}function Mt(n,r,i,s){if(i==-1){i=r.childNodes.length}var o=n.parentNode;var u=D(n);var a;var f=[s];for(a=0;a<e.getSelection().rangeCount;a++){f.push(e.getSelection().getRangeAt(a))}var l=[];t(f).forEach(function(e){l.push([e.startContainer,e.startOffset]);l.push([e.endContainer,e.endOffset])});t(l).forEach(function(e){if(e[0]==r&&e[1]>i){e[1]++}if(e[0]==o&&(e[1]==u||e[1]==u+1)){e[0]=r;e[1]+=i-u}if(e[0]==o&&e[1]>u+1){e[1]--}});if(r.childNodes.length==i){r.appendChild(n)}else{r.insertBefore(n,r.childNodes[i])}var c=null;if(l[0][1]>l[0][0].childNodes.length&&l[1][1]>l[1][0].childNodes.length){s.setStart(n,0);s.setEnd(n,0)}else{s.setStart(l[0][0],l[0][1]);s.setEnd(l[1][0],l[1][1]);e.getSelection().removeAllRanges();for(a=1;a<f.length;a++){c=e.createRange();c.setStart(l[2*a][0],l[2*a][1]);c.setEnd(l[2*a+1][0],l[2*a+1][1]);e.getSelection().addRange(c)}if(c){s=c}}}function _t(e,t){if(i.browser.msie&&i.browser.version>=7&&typeof e.attributes[i.expando]!=="undefined"){i(e).removeAttr(i.expando)}var n=e.attributes;var r;for(r=0;r<n.length;r++){var s=n[r];if(typeof s.specified==="undefined"||s.specified){if(typeof t.setAttributeNS==="function"){t.setAttributeNS(s.namespaceURI,s.name,s.value)}else{t.setAttribute(s.name,s.value)}}}}function Dt(e,t,n){if(p(e,t)){return e}if(!e.parentNode){return e}var r=e.ownerDocument.createElement(t);e.parentNode.insertBefore(r,e);_t(e,r);while(e.childNodes.length){Mt(e.firstChild,r,r.childNodes.length,n)}e.parentNode.removeChild(e);if(n.startContainer===e){n.startContainer=r}if(n.endContainer===e){n.endContainer=r}return r}function Pt(e){var t=e.previousSibling;if(!t){return}while(t.hasChildNodes()){t=t.lastChild}while(St(t)&&!gt(t)&&t!=e.parentNode){t=E(t)}if(ht(t)&&gt(t)){t.parentNode.removeChild(t)}}function Ht(e){var t=e;while(t.hasChildNodes()){t=t.lastChild}while(St(t)&&!gt(t)&&t!=e){t=E(t)}if(ht(t)&&gt(t)){t.parentNode.removeChild(t)}}function Bt(e){Pt(e);Ht(e)}function jt(e,t,n,r){var i;if(typeof t=="undefined"){t=function(){return false}}if(typeof n=="undefined"){n=function(){return null}}if(!e.length||!ht(e[0])){return null}if(lt(e[e.length-1])&&!p(e[e.length-1],"br")&&p(e[e.length-1].nextSibling,"br")){e.push(e[e.length-1].nextSibling)}var s;if(ht(e[0].previousSibling)&&t(e[0].previousSibling)){s=e[0].previousSibling}else if(ht(e[e.length-1].nextSibling)&&t(e[e.length-1].nextSibling)){s=e[e.length-1].nextSibling}else{s=n()}if(!s){return null}if(!s.parentNode){e[0].parentNode.insertBefore(s,e[0]);var o=r.startContainer,u=r.startOffset,f=r.endContainer,l=r.endOffset;if(o==s.parentNode&&u>=D(s)){r.setStart(o,u+1)}if(f==s.parentNode&&l>=D(s)){r.setEnd(f,l+1)}if(a&&a!==r){o=a.startContainer;u=a.startOffset;f=a.endContainer;l=a.endOffset;if(o==s.parentNode&&u>=D(s)){a.setStart(o,u+1)}if(f==s.parentNode&&l>=D(s)){a.setEnd(f,l+1)}}}var c=e[0].parentNode;if(N(s,e[0])){if(!lt(s)&&lt(s.lastChild)&&lt(e[0])&&!p(s.lastChild,"BR")){s.appendChild(s.ownerDocument.createElement("br"))}for(i=0;i<e.length;i++){Mt(e[i],s,-1,r)}}else{if(!lt(s)&&lt(s.firstChild)&&lt(e[e.length-1])&&!p(e[e.length-1],"BR")){s.insertBefore(s.ownerDocument.createElement("br"),s.firstChild)}for(i=e.length-1;i>=0;i--){Mt(e[i],s,0,r)}}if(ht(c)&&!c.hasChildNodes()){c.parentNode.removeChild(c)}if(ht(s.nextSibling)&&t(s.nextSibling)){if(!lt(s)&&lt(s.lastChild)&&lt(s.nextSibling.firstChild)&&!p(s.lastChild,"BR")){s.appendChild(s.ownerDocument.createElement("br"))}while(s.nextSibling.hasChildNodes()){Mt(s.nextSibling.firstChild,s,-1,r)}s.parentNode.removeChild(s.nextSibling)}Bt(s);return s}function Xt(e){return m(e,Ft)}function Vt(e,n){if((It[n]||v(n,["colgroup","table","tbody","tfoot","thead","tr"]))&&typeof e=="object"&&e.nodeType==t.Node.TEXT_NODE&&!/^[ \t\n\f\r]*$/.test(e.data)){return false}if((qt[n]||v(n,["script","style","plaintext","xmp"]))&&(typeof e!="object"||e.nodeType!=t.Node.TEXT_NODE)){return false}if(typeof e=="object"&&(e.nodeType==t.Node.DOCUMENT_NODE||e.nodeType==t.Node.DOCUMENT_FRAGMENT_NODE||e.nodeType==t.Node.DOCUMENT_TYPE_NODE)){return false}if(h(e)){e=e.tagName.toLowerCase()}if(typeof e!="string"){return true}if(h(n)){var r=n;while(r){if(e=="a"&&p(r,"a")){return false}if(ot[e.toUpperCase()]&&Xt(r)){return false}if(/^h[1-6]$/.test(e)&&h(r)&&/^H[1-6]$/.test(r.tagName)){return false}r=r.parentNode}n=n.tagName.toLowerCase()}if(typeof n=="object"&&(n.nodeType==t.Node.ELEMENT_NODE||n.nodeType==t.Node.DOCUMENT_FRAGMENT_NODE)){return true}if(typeof n!="string"){return false}switch(n){case"colgroup":return e=="col";case"table":return i.inArray(e,["caption","col","colgroup","tbody","td","tfoot","th","thead","tr"])!=-1;case"tbody":case"thead":case"tfoot":return i.inArray(e,["td","th","tr"])!=-1;case"tr":return i.inArray(e,["td","th"])!=-1;case"dl":return i.inArray(e,["dt","dd"])!=-1;case"dir":case"ol":case"ul":return i.inArray(e,["dir","li","ol","ul"])!=-1;case"hgroup":return/^h[1-6]$/.test(e)}if(i.inArray(e,["body","caption","col","colgroup","frame","frameset","head","html","tbody","td","tfoot","th","thead","tr"])!=-1){return false}if(i.inArray(e,["dd","dt"])!=-1&&n!="dl"){return false}if(e=="li"&&n!="ol"&&n!="ul"){return false}var s=Wt[n.toUpperCase()];if(s){var o=s[e.toUpperCase()];if(o){return false}}return true}function $t(e,n){if(n.collapsed){return false}if(j(e,n)){return true}if(e==n.startContainer&&e.nodeType==t.Node.TEXT_NODE&&P(e)!=n.startOffset){return true}if(e==n.endContainer&&e.nodeType==t.Node.TEXT_NODE&&n.endOffset!=0){return true}if(e.hasChildNodes()&&t(e.childNodes).every(function(e){return $t(e,n)})&&(!T(n.startContainer,e)||n.startContainer.nodeType!=t.Node.TEXT_NODE||n.startOffset==0)&&(!T(n.endContainer,e)||n.endContainer.nodeType!=t.Node.TEXT_NODE||n.endOffset==P(n.endContainer))){return true}return false}function Jt(e,t){if(typeof t=="undefined"){t=function(){return true}}var n=e.startContainer;while($t(n.parentNode,e)){n=n.parentNode}var r=b(e.endContainer);var i=[];while(N(n,r)){if($t(n,e)&&t(n)){i.push(n);n=b(n);continue}n=w(n)}return i}function Kt(e,t){if(typeof t=="undefined"){t=function(){return true}}var n=e.startContainer;while($t(n.parentNode,e)){n=n.parentNode}var r=b(e.endContainer);var i=[];while(N(n,r)){if($t(n,e)&&t(n)){i.push(n)}n=w(n)}return i}function Qt(e){if(!h(e)){return false}if(i.inArray(e.tagName,["B","EM","I","S","SPAN","STRIKE","STRONG","SUB","SUP","U"])!=-1){if(e.attributes.length==0){return true}if(e.attributes.length==1&&s(e,"style")){return true}}if(e.tagName=="FONT"||e.tagName=="A"){var t=e.attributes.length;if(s(e,"style")){t--}if(e.tagName=="FONT"){if(s(e,"color")){t--}if(s(e,"face")){t--}if(s(e,"size")){t--}}if(e.tagName=="A"&&s(e,"href")){t--}if(t==0){return true}}return false}function Gt(e){if(!h(e)){return false}if(i.inArray(e.tagName,["A","B","EM","FONT","I","S","SPAN","STRIKE","STRONG","SUB","SUP","U"])==-1){return false}if(e.attributes.length==0){return true}if(e.attributes.length>1){return false}if(s(e,"style")&&g(e)==0){return true}if(e.tagName=="A"&&s(e,"href")){return true}if(e.tagName=="FONT"&&(s(e,"color")||s(e,"face")||s(e,"size"))){return true}if((e.tagName=="B"||e.tagName=="STRONG")&&s(e,"style")&&g(e)==1&&e.style.fontWeight!=""){return true}if((e.tagName=="I"||e.tagName=="EM")&&s(e,"style")&&g(e)==1&&e.style.fontStyle!=""){return true}if((e.tagName=="A"||e.tagName=="FONT"||e.tagName=="SPAN")&&s(e,"style")&&g(e)==1&&e.style.textDecoration==""){return true}if(i.inArray(e.tagName,["A","FONT","S","SPAN","STRIKE","U"])!=-1&&s(e,"style")&&g(e)==1&&(e.style.textDecoration=="line-through"||e.style.textDecoration=="underline"||e.style.textDecoration=="overline"||e.style.textDecoration=="none")){return true}return false}function Yt(e,t,n){if(t===null&&n===null){return true}if(typeof t=="string"&&typeof n=="string"&&t==n&&!f[e].hasOwnProperty("equivalentValues")){return true}if(typeof t=="string"&&typeof n=="string"&&f[e].hasOwnProperty("equivalentValues")&&f[e].equivalentValues(t,n)){return true}return false}function Zt(e,n,r){if(Yt(e,n,r)){return true}if(e!="fontsize"||typeof n!="string"||typeof r!="string"){return false}var i=Zt;if(i.sizeMap===undefined){i.sizeMap={};var s=document.createElement("font");document.body.appendChild(s);t(["xx-small","small","medium","large","x-large","xx-large","xxx-large"]).forEach(function(e){s.size=O(e);i.sizeMap[e]=t.getComputedStyle(s).fontSize});document.body.removeChild(s)}return n===i.sizeMap[r]||r===i.sizeMap[n]}function en(e,n){if(e.nodeType!=t.Node.ELEMENT_NODE&&(!e.parentNode||e.parentNode.nodeType!=t.Node.ELEMENT_NODE)){return null}if(e.nodeType!=t.Node.ELEMENT_NODE){return en(e.parentNode,n)}if(n=="createlink"||n=="unlink"){while(e&&(!h(e)||e.tagName!="A"||!s(e,"href"))){e=e.parentNode}if(!e){return null}return e.getAttribute("href")}if(n=="backcolor"||n=="hilitecolor"){while((t.getComputedStyle(e).backgroundColor=="rgba(0, 0, 0, 0)"||t.getComputedStyle(e).backgroundColor===""||t.getComputedStyle(e).backgroundColor=="transparent")&&e.parentNode&&e.parentNode.nodeType==t.Node.ELEMENT_NODE){e=e.parentNode}if(t.getComputedStyle(e).backgroundColor=="rgba(0, 0, 0, 0)"||t.getComputedStyle(e).backgroundColor===""||t.getComputedStyle(e).backgroundColor=="transparent"){return"rgb(255, 255, 255)"}return t.getComputedStyle(e).backgroundColor}if(n=="subscript"||n=="superscript"){var r=false;var i=false;while(lt(e)){var o=t.getComputedStyle(e).verticalAlign;if(p(e,"sub")){r=true}else if(p(e,"sup")){i=true}e=e.parentNode}if(r&&i){return"mixed"}if(r){return"subscript"}if(i){return"superscript"}return null}if(n=="strikethrough"){do{if(t.getComputedStyle(e).textDecoration.indexOf("line-through")!=-1){return"line-through"}e=e.parentNode}while(e&&e.nodeType==t.Node.ELEMENT_NODE);return null}if(n=="underline"){do{if(t.getComputedStyle(e).textDecoration.indexOf("underline")!=-1){return"underline"}e=e.parentNode}while(e&&e.nodeType==t.Node.ELEMENT_NODE);return null}if(!f[n].hasOwnProperty("relevantCssProperty")){throw"Bug: no relevantCssProperty for "+n+" in getEffectiveCommandValue"}return t.getComputedStyle(e)[f[n].relevantCssProperty].toString()}function tn(e,n){if((n=="backcolor"||n=="hilitecolor")&&t.getComputedStyle(e).display!="inline"){return null}if(n=="createlink"||n=="unlink"){if(h(e)&&e.tagName=="A"&&s(e,"href")){return e.getAttribute("href")}return null}if(n=="subscript"||n=="superscript"){if(p(e,"sup")){return"superscript"}if(p(e,"sub")){return"subscript"}return null}if(n=="strikethrough"&&e.style.textDecoration!=""){if(e.style.textDecoration.indexOf("line-through")!=-1){return"line-through"}return null}if(n=="strikethrough"&&v(e,["S","STRIKE"])){return"line-through"}if(n=="underline"&&e.style.textDecoration!=""){if(e.style.textDecoration.indexOf("underline")!=-1){return"underline"}return null}if(n=="underline"&&p(e,"U")){return"underline"}var r=f[n].relevantCssProperty;if(r===null){return null}if(e.style[r]!=""){return e.style[r]}if(l(e.namespaceURI)&&e.tagName=="FONT"){if(r=="color"&&s(e,"color")){return e.color}if(r=="fontFamily"&&s(e,"face")){return e.face}if(r=="fontSize"&&s(e,"size")){var i=parseInt(e.size,10);if(i<1){i=1}if(i>7){i=7}return{1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[i]}}if(r=="fontWeight"&&(e.tagName=="B"||e.tagName=="STRONG")){return"bold"}if(r=="fontStyle"&&(e.tagName=="I"||e.tagName=="EM")){return"italic"}return null}function nn(e,t,n,r){var i=e;while(Qt(i)&&i.childNodes.length==1&&Qt(i.firstChild)&&(!Gt(i)||!Yt(t,tn(i,t),n))){i=i.firstChild}if(i==e||!Gt(i)||!Yt(t,tn(i,t),n)||!Zt(t,en(i,t),n)){return}while(i.hasChildNodes()){Mt(i.firstChild,i.parentNode,D(i),r)}e.parentNode.insertBefore(i,e.nextSibling);Mt(e,i,-1,r)}function sn(e){var t=[];var n=i.makeArray(e);var r,s;var o;var u;var a;var f;for(r=0;r<n.length;r++){o=n[r];for(s=0;s<rn.length;s++){u=rn[s];a=o;if(a.nodeType!=1){a=a.parentNode}f=null;while(a&&a.nodeType==1&&(f=tn(a,u))===null){a=a.parentNode}t.push([o,u,f])}}return t}function on(e,t,n){if(!ht(e)){return[]}if(tn(e,t)===null){return[]}if(Gt(e)){var r=Array.prototype.slice.call(y(e.childNodes));var i;for(i=0;i<r.length;i++){Mt(r[i],e.parentNode,D(e),n)}e.parentNode.removeChild(e);return r}if(t=="strikethrough"&&e.style.textDecoration.indexOf("line-through")!=-1){if(e.style.textDecoration=="line-through"){e.style.textDecoration=""}else{e.style.textDecoration=e.style.textDecoration.replace("line-through","")}if(e.getAttribute("style")==""){e.removeAttribute("style")}}if(t=="underline"&&e.style.textDecoration.indexOf("underline")!=-1){if(e.style.textDecoration=="underline"){e.style.textDecoration=""}else{e.style.textDecoration=e.style.textDecoration.replace("underline","")}if(e.getAttribute("style")==""){e.removeAttribute("style")}}if(f[t].relevantCssProperty!==null){e.style[f[t].relevantCssProperty]="";if(e.getAttribute("style")==""){e.removeAttribute("style")}}if(l(e.namespaceURI)&&e.tagName=="FONT"){if(t=="forecolor"){e.removeAttribute("color")}if(t=="fontname"){e.removeAttribute("face")}if(t=="fontsize"){e.removeAttribute("size")}}if(p(e,"A")&&(t=="createlink"||t=="unlink")){e.removeAttribute("href")}if(tn(e,t)===null){return[]}return[Dt(e,"span",n)]}function un(e,n,r,s){var o=[];var a;var l;if(!e.parentNode){return}if(r===null){return}if(Vt(e,"span")){nn(e.previousSibling,n,r,s);nn(e.nextSibling,n,r,s);jt([e],function(e){return Gt(e)&&Yt(n,tn(e,n),r)&&Zt(n,en(e,n),r)},function(){return null},s)}if(Zt(n,en(e,n),r)){return}if(!Vt(e,"span")){for(a=0;a<e.childNodes.length;a++){if(e.childNodes[a].nodeType==t.Node.ELEMENT_NODE){l=tn(e.childNodes[a],n);if(l!==null&&!Yt(n,r,l)){continue}}o.push(e.childNodes[a])}for(a=0;a<o.length;a++){un(o[a],n,r,s)}return}if(Zt(n,en(e,n),r)){return}var c=null;if(!u){if(n=="bold"&&(r=="bold"||r=="700")){c=e.ownerDocument.createElement("b")}if(n=="italic"&&r=="italic"){c=e.ownerDocument.createElement("i")}if(n=="strikethrough"&&r=="line-through"){c=e.ownerDocument.createElement("s")}if(n=="underline"&&r=="underline"){c=e.ownerDocument.createElement("u")}if(n=="forecolor"&&R(r)){c=e.ownerDocument.createElement("span");i(c).css("color",R(r))}if(n=="fontname"){c=e.ownerDocument.createElement("font");c.face=r}}if(n=="createlink"||n=="unlink"){c=e.ownerDocument.createElement("a");c.setAttribute("href",r);var h=e.parentNode;while(h){if(p(h,"A")){h=Dt(h,"span",s)}h=h.parentNode}}if(n=="fontsize"&&i.inArray(r,["xx-small","small","medium","large","x-large","xx-large","xxx-large"])!=-1&&(!u||r=="xxx-large")){c=e.ownerDocument.createElement("font");c.size=O(r)}if((n=="subscript"||n=="superscript")&&r=="subscript"){c=e.ownerDocument.createElement("sub")}if((n=="subscript"||n=="superscript")&&r=="superscript"){c=e.ownerDocument.createElement("sup")}if(!c){c=e.ownerDocument.createElement("span")}e.parentNode.insertBefore(c,e);var d=f[n].relevantCssProperty;if(d!==null&&!Zt(n,en(c,n),r)){c.style[d]=r}if(n=="strikethrough"&&r=="line-through"&&en(c,"strikethrough")!="line-through"){c.style.textDecoration="line-through"}if(n=="underline"&&r=="underline"&&en(c,"underline")!="underline"){c.style.textDecoration="underline"}Mt(e,c,c.childNodes.length,s);if(e.nodeType==t.Node.ELEMENT_NODE&&!Yt(n,en(e,n),r)){Mt(e,c.parentNode,D(c),s);c.parentNode.removeChild(c);o=[];for(a=0;a<e.childNodes.length;a++){if(e.childNodes[a].nodeType==t.Node.ELEMENT_NODE){l=tn(e.childNodes[a],n);if(l!==null&&!Yt(n,r,l)){continue}}o.push(e.childNodes[a])}for(a=0;a<o.length;a++){un(o[a],n,r,s)}}}function an(e,n,r,i){if(!e.parentNode||e.parentNode.nodeType!=t.Node.ELEMENT_NODE){return}if(Zt(n,en(e,n),r)){return}var s=e.parentNode;var o=[];while(ht(s)&&s.nodeType==t.Node.ELEMENT_NODE&&!Zt(n,en(s,n),r)){o.push(s);s=s.parentNode}if(!o.length){return}var u=tn(o[o.length-1],n);if(u===null&&u!=r){return}if(r!==null&&!Zt(n,en(o[o.length-1].parentNode,n),r)){return}while(o.length){s=o.pop();if(tn(s,n)!==null){u=tn(s,n)}var a=Array.prototype.slice.call(y(s.childNodes));if(tn(s,n)!==null){on(s,n,i)}var f;for(f=0;f<a.length;f++){var l=a[f];if(l==e){continue}if(l.nodeType==t.Node.ELEMENT_NODE&&tn(l,n)!==null&&!Yt(n,u,tn(l,n))){continue}if(l==o[o.length-1]){continue}un(l,n,u,i)}}}function fn(e,n){t(e).forEach(function(e){var r=e[0];var i=e[1];var s=e[2];var o=r;if(!o||o.nodeType!=t.Node.ELEMENT_NODE){o=o.parentNode}while(o&&o.nodeType==t.Node.ELEMENT_NODE&&tn(o,i)===null){o=o.parentNode}if(s===null&&o&&o.nodeType==t.Node.ELEMENT_NODE){an(r,i,null,n)}else if(o&&o.nodeType==t.Node.ELEMENT_NODE&&!Yt(i,tn(o,i),s)||(!o||o.nodeType!=t.Node.ELEMENT_NODE)&&s!==null){un(r,i,s,n)}})}function ln(n,r,i){i=i||Ot();if(!t(Kt(i)).filter(function(e){return e.nodeType==t.Node.TEXT_NODE},true).some(ht)){if(f[n].hasOwnProperty("inlineCommandActivatedValues")){z(n,t(f[n].inlineCommandActivatedValues).indexOf(r)!=-1,i)}if(n=="subscript"){X("superscript",i)}if(n=="superscript"){X("subscript",i)}if(r===null){J(n,i)}else if(f[n].hasOwnProperty("value")){$(n,r,i)}return}if(ht(i.startContainer)&&i.startContainer.nodeType==t.Node.TEXT_NODE&&i.startOffset!=0&&i.startOffset!=P(i.startContainer)){var s=i.startContainer.splitText(i.startOffset);var o=e.createRange();if(i.startContainer==i.endContainer){var u=i.endOffset-i.startOffset;o.setEnd(s,u);i.setEnd(s,u)}o.setStart(s,0);e.getSelection().removeAllRanges();e.getSelection().addRange(o);i.setStart(s,0)}if(ht(i.endContainer)&&i.endContainer.nodeType==t.Node.TEXT_NODE&&i.endOffset!=0&&i.endOffset!=P(i.endContainer)){var a=i;var l=[a.startContainer,a.startOffset];var c=[a.endContainer,a.endOffset];a.endContainer.splitText(a.endOffset);a.setStart(l[0],l[1]);a.setEnd(c[0],c[1]);e.getSelection().removeAllRanges();e.getSelection().addRange(a)}t(Kt(Ot(),function(e){return ht(e)&&e.nodeType==t.Node.ELEMENT_NODE})).forEach(function(e){on(e,n,i)});t(Kt(i,ht)).forEach(function(e){an(e,n,r,i);un(e,n,r,i)})}function cn(e,n){var r;if(e.nodeType===t.Node.TEXT_NODE&&n<e.length){for(r=n;r<e.length;r++){if(e.data.charAt(r)!=="	"&&e.data.charAt(r)!=="\r"&&e.data.charAt(r)!=="\n"||e.data.charCodeAt(r)===160){return false}}}if(e.nextSibling&&e.nextSibling.className&&e.nextSibling.className.indexOf("aloha-table-wrapper")>=0){return e.nextSibling}if(e.parentNode&&e.parentNode.nextSibling&&e.parentNode.nextSibling.className&&e.parentNode.nextSibling.className.indexOf("aloha-table-wrapper")>=0){return e.parentNode.nextSibling}if(e.parentNode&&e.parentNode.nextSibling&&yt(e.parentNode.nextSibling)&&e.parentNode.nextSibling.nextSibling&&e.parentNode.nextSibling.nextSibling.className&&e.parentNode.nextSibling.nextSibling.className.indexOf("aloha-table-wrapper")>=0){return e.parentNode.nextSibling.nextSibling}}function hn(e,n){var r;if(e.nodeType===t.Node.TEXT_NODE&&n>0){for(r=n-1;r>=0;r--){if(e.data.charAt(r)!=="	"&&e.data.charAt(r)!=="\r"&&e.data.charAt(r)!=="\n"||e.data.charCodeAt(r)===160){return false}}}if(e.previousSibling&&e.previousSibling.className&&e.previousSibling.className.indexOf("aloha-table-wrapper")>=0){return e.previousSibling}if(e.parentNode&&e.parentNode.previousSibling&&e.parentNode.previousSibling.className&&e.parentNode.previousSibling.className.indexOf("aloha-table-wrapper")>=0){return e.parentNode.previousSibling}if(e.parentNode&&e.parentNode.previousSibling&&yt(e.parentNode.previousSibling)&&e.parentNode.previousSibling.previousSibling&&e.parentNode.previousSibling.previousSibling.className&&e.parentNode.previousSibling.previousSibling.className.indexOf("aloha-table-wrapper")>=0){return e.parentNode.previousSibling.previousSibling}return false}function pn(e,t){return!e.parentNode&&t==0||0<=t-1&&t-1<e.childNodes.length&&Et(e.childNodes[t-1])&&(ft(e.childNodes[t-1])||p(e.childNodes[t-1],"br"))}function dn(e,t){return!e.parentNode&&t==P(e)||t<e.childNodes.length&&Et(e.childNodes[t])&&ft(e.childNodes[t])}function vn(e,t){return pn(e,t)||dn(e,t)}function mn(e){var t=0;while(!vn(e,t)){if(0<=t-1&&t-1<e.childNodes.length&&Et(e.childNodes[t-1])){return false}if(t==0||!e.hasChildNodes()){t=D(e);e=e.parentNode}else{e=e.childNodes[t-1];t=P(e)}}return true}function gn(e){var t=P(e);while(!vn(e,t)){if(t<e.childNodes.length&&Et(e.childNodes[t])){return false}if(t==P(e)||!e.hasChildNodes()){t=1+D(e);e=e.parentNode}else{e=e.childNodes[t];t=0}}return true}function yn(e,t){var n;var r=e[0].parentNode;if(!ht(r)||!r.parentNode){return}if(i.inArray(r.firstChild,e)!=-1){Pt(r)}var s=i.inArray(r.firstChild,e)!=-1;var o=i.inArray(r.lastChild,e)!=-1;var u=s&&mn(r);var a=o&&gn(r);if(!s&&o){for(n=e.length-1;n>=0;n--){Mt(e[n],r.parentNode,1+D(r),t)}if(a&&!gn(e[e.length-1])){e[e.length-1].parentNode.insertBefore(document.createElement("br"),e[e.length-1].nextSibling)}Ht(r);return}if(!s){var f=r.cloneNode(false);r.removeAttribute("id");r.parentNode.insertBefore(f,r);while(e[0].previousSibling){Mt(r.firstChild,f,f.childNodes.length,t)}}for(n=0;n<e.length;n++){Mt(e[n],r.parentNode,D(r),t)}if(u&&!mn(e[0])){e[0].parentNode.insertBefore(document.createElement("br"),e[0])}if(lt(e[e.length-1])&&!p(e[e.length-1],"br")&&p(r.firstChild,"br")&&!lt(r)){r.removeChild(r.firstChild)}if(!r.hasChildNodes()){if(r.parentNode===t.startContainer&&r.parentNode===t.endContainer&&t.startContainer===t.endContainer&&t.startOffset===t.endOffset&&r.parentNode.childNodes.length===t.startOffset){t.startOffset=r.parentNode.childNodes.length-1;t.endOffset=t.startOffset}r.parentNode.removeChild(r);if(a&&!gn(e[e.length-1])){e[e.length-1].parentNode.insertBefore(document.createElement("br"),e[e.length-1].nextSibling)}}else{Pt(r)}if(!e[e.length-1].nextSibling&&e[e.length-1].parentNode){Ht(e[e.length-1].parentNode)}}function bn(e){if(!h(e)){return false}if(e.tagName=="BLOCKQUOTE"){return true}if(e.tagName!="DIV"){return false}if(typeof e.style.length!=="undefined"){var t;for(t=0;t<e.style.length;t++){if(/^(-[a-z]+-)?margin/.test(e.style[t])){return true}}}else{var n;for(n in e.style){if(/^(-[a-z]+-)?margin/.test(n)&&e.style[n]&&e.style[n]!==0){return true}}}return false}function wn(e){if(!bn(e)){return false}if(e.tagName!="BLOCKQUOTE"&&e.tagName!="DIV"){return false}var t;for(t=0;t<e.attributes.length;t++){if(!l(e.attributes[t].namespaceURI)||i.inArray(e.attributes[t].name,["style","class","dir"])==-1){return false}}if(typeof e.style.length!=="undefined"){for(t=0;t<e.style.length;t++){if(!/^(-[a-z]+-)?(margin|border|padding)/.test(e.style[t])){return false}}}else{var n;for(n in e.style){if(!/^(-[a-z]+-)?(margin|border|padding)/.test(n)&&e.style[n]&&e.style[n]!==0&&e.style[n]!=="false"){return false}}}return true}function En(e){return v(e,["address","div","h1","h2","h3","h4","h5","h6","listing","p","pre","xmp"])}function Sn(e){return En(e)||v(e,["li","dt","dd"])}function Tn(e){return p(e,"br")&&e.parentNode.lastChild===e}function Nn(){return document.createElement("br")}function Cn(e){if(!e){return}if(ct(e)){return}if(p(e.lastChild,"br")){return}if(t(e.childNodes).some(Et)){return}if(!i.browser.msie){e.appendChild(Nn())}else if(i.browser.msie&&i.browser.version<=7&&v(e,["p","h1","h2","h3","h4","h5","h6","pre","blockquote"])){if(!e.firstChild){e.appendChild(document.createTextNode(""))}}}function kn(e,n){var r;if(!ht(e)){return}if(t(k(e)).every(function(t){return!vt(e,t)||!Vt(e,t)})&&!c(e,xn)){if(v(e,["dd","dt"])){jt([e],function(e){return p(e,"dl")&&!e.attributes.length},function(){return document.createElement("dl")},n);return}if(!ut(e)){return}e=Dt(e,xn,n);Cn(e);kn(e,n);var s=L(e);for(r=0;r<s.length;r++){kn(s[r],n)}return}var o=sn([e]);var u,a;while(!Vt(e,e.parentNode)){for(r=e.parentNode.childNodes.length-1;r>=0;--r){if(e.parentNode.childNodes[r].nodeType==3&&e.parentNode.childNodes[r].data.length==0){e.parentNode.removeChild(e.parentNode.childNodes[r]);if(n.startContainer==e.parentNode&&n.startOffset>r){n.startOffset--}if(n.endContainer==e.parentNode&&n.endOffset>r){n.endOffset--}}}if(e.parentNode.childNodes.length==1){u=n.startOffset;a=n.endOffset;if(n.startContainer===e.parentNode&&n.startOffset>D(e)){u=n.startOffset+(i(e).contents().length-1)}if(n.endContainer===e.parentNode&&n.endOffset>D(e)){a=n.endOffset+(i(e).contents().length-1)}i(e).contents().unwrap();n.startOffset=u;n.endOffset=a;break}else{var f=e.parentNode;yn([e],n);if(f===e.parentNode){u=n.startOffset;a=n.endOffset;if(n.startContainer===e.parentNode&&n.startOffset>D(e)){u=n.startOffset+(i(e).contents().length-1)}if(n.endContainer===e.parentNode&&n.endOffset>D(e)){a=n.endOffset+(i(e).contents().length-1)}i(e).contents().unwrap();n.startOffset=u;n.endOffset=a;break}}}fn(o,n)}function Ln(e,n){function i(e){return v(e,["OL","UL"])}if(!p(e,"LI")||!ht(e)||!ht(e.parentNode)){return}var r=null;while(t(e.childNodes).some(i)){var s=e.lastChild;if(v(s,["OL","UL"])||!r&&s.nodeType==t.Node.TEXT_NODE&&/^[ \t\n\f\r]*$/.test(s.data)){r=null;Mt(s,e.parentNode,1+D(e),n)}else{if(!r){r=e.ownerDocument.createElement("li");e.parentNode.insertBefore(r,e.nextSibling)}Mt(s,r,0,n)}}}function An(e,t){if(!v(e,["OL","UL"])||!ht(e)){return}var n=i(e);n.children("ol,ul").each(function(e,n){if(p(n.previousSibling,"LI")){Mt(n,n.previousSibling,n.previousSibling.childNodes.length,t)}})}function On(n){var r=n.startContainer;var i=n.startOffset;var s=n.endContainer;var o=n.endOffset;var u=t(k(r).concat(r)).filter(function(e){return p(e,"li")}).slice(-1);if(u.length){i=D(u[0]);r=u[0].parentNode}if(!pn(r,i)){do{if(i==0){i=D(r);r=r.parentNode}else{i--}}while(!vn(r,i))}while(i==0&&r.parentNode){i=D(r);r=r.parentNode}u=t(k(s).concat(s)).filter(function(e){return p(e,"li")}).slice(-1);if(u.length){o=1+D(u[0]);s=u[0].parentNode}if(!dn(s,o)){do{if(o==P(s)){o=1+D(s);s=s.parentNode}else{o++}}while(!vn(s,o))}while(o==P(s)&&s.parentNode){o=1+D(s);s=s.parentNode}var a=e.createRange();a.setStart(r,i);a.setEnd(s,o);return a}function Mn(){var e=On(Ot());var n=F(e,function(e){return ht(e)&&!bn(e)&&(v(e,["ol","ul"])||v(e.parentNode,["ol","ul"])||Vt(e,"li"))});if(!n.length){return"none"}if(t(n).every(function(e){return p(e,"ol")||p(e.parentNode,"ol")||p(e.parentNode,"li")&&p(e.parentNode.parentNode,"ol")})&&!t(n).some(function(e){return p(e,"ul")||e.querySelector&&e.querySelector("ul")})){return"ol"}if(t(n).every(function(e){return p(e,"ul")||p(e.parentNode,"ul")||p(e.parentNode,"li")&&p(e.parentNode.parentNode,"ul")})&&!t(n).some(function(e){return p(e,"ol")||e.querySelector&&e.querySelector("ol")})){return"ul"}var r=t(n).some(function(e){return p(e,"ol")||p(e.parentNode,"ol")||e.querySelector&&e.querySelector("ol")||p(e.parentNode,"li")&&p(e.parentNode.parentNode,"ol")});var i=t(n).some(function(e){return p(e,"ul")||p(e.parentNode,"ul")||e.querySelector&&e.querySelector("ul")||p(e.parentNode,"li")&&p(e.parentNode.parentNode,"ul")});if(r&&i){return"mixed"}if(r){return"mixed ol"}if(i){return"mixed ul"}return"none"}function _n(e){while(e&&e.nodeType!=t.Node.ELEMENT_NODE||e.nodeType==t.Node.ELEMENT_NODE&&i.inArray(t.getComputedStyle(e).display,["inline","none"])!=-1){e=e.parentNode}if(!e||e.nodeType!=t.Node.ELEMENT_NODE){return"left"}var n=t.getComputedStyle(e).textAlign.replace(/^-(moz|webkit)-/,"").replace(/^auto$/,"start");if(n=="start"){return _(e)=="ltr"?"left":"right"}if(n=="end"){return _(e)=="ltr"?"right":"left"}if(i.inArray(n,["center","justify","left","right"])!=-1){return n}return"left"}function Dn(e){var n=[];if(V("createlink",e)!==undefined){n.push(["createlink",V("createlink",e)])}t(["bold","italic","strikethrough","subscript","superscript","underline"]).forEach(function(t){if(U(t,e)!==undefined){n.push([t,U(t,e)])}});t(["fontname","fontsize","forecolor","hilitecolor"]).forEach(function(t){if(V(t,e)!==undefined){n.push([t,V(t,e)])}});return n}function Pn(e){var n=[];var r=t(Kt(e)).filter(function(e){return ht(e)&&e.nodeType==t.Node.TEXT_NODE})[0];if(!r){return n}n.push(["createlink",f.createlink.value(e)]);t(["bold","italic","strikethrough","subscript","superscript","underline"]).forEach(function(e){if(t(f[e].inlineCommandActivatedValues).indexOf(en(r,e))!=-1){n.push([e,true])}else{n.push([e,false])}});t(["fontname","fontsize","forecolor","hilitecolor"]).forEach(function(t){n.push([t,f[t].value(e)])});n.push(["fontsize",en(r,"fontsize")]);return n}function Hn(e,n){function u(e){return ht(e)&&e.nodeType==t.Node.TEXT_NODE}var r;var i;var s;var o=t(Kt(n)).filter(function(e){return ht(e)&&e.nodeType==t.Node.TEXT_NODE})[0];if(o){for(r=0;r<e.length;r++){i=e[r][0];s=e[r][1];if(typeof s=="boolean"&&rt(i,n)!=s){tt(i,false,s,n)}else if(typeof s=="string"&&i!="fontsize"&&!Yt(i,st(i,n),s)){tt(i,false,s,n)}else if(typeof s=="string"&&i=="fontsize"&&(V("fontsize",n)!==undefined&&V("fontsize",n)!==s||V("fontsize",n)===undefined&&!Zt(i,en(o,"fontsize"),s))){tt("fontsize",false,s,n)}else{continue}o=t(Kt(n)).filter(u)[0]||o}}else{for(r=0;r<e.length;r++){i=e[r][0];s=e[r][1];if(typeof s=="boolean"){z(i,s,n)}if(typeof s=="string"){$(i,s,n)}}}}function Bn(e,t,n){if(e==0){return""}if(e==1&&!t&&!n){return" "}if(e==1){return""}var r="";var i;if(t){i=" "}else{i=" "}while(e>3){r+=i;e-=2}if(e==3){r+=!t&&!n?"  ":t&&!n?" ":!t&&n?" ":t&&n?" ":"impossible"}else{r+=!t&&!n?" ":t&&!n?" ":!t&&n?" ":t&&n?"":"impossible"}return r}function jn(e,n){if(!ht(e)&&!ct(e)){return}var r=e;var s=n;while(true){if(0<=s-1&&vt(r,r.childNodes[s-1])){r=r.childNodes[s-1];s=P(r)}else if(s==0&&!mn(r)&&vt(r,r.parentNode)){s=D(r);r=r.parentNode}else if(r.nodeType==t.Node.TEXT_NODE&&i.inArray(t.getComputedStyle(r.parentNode).whiteSpace,["pre","pre-wrap"])==-1&&s!=0&&/[ \xa0]/.test(r.data[s-1])){s--}else{break}}var o=r;var u=s;var a=0;var f=false;while(true){if(u<o.childNodes.length&&vt(o,o.childNodes[u])){o=o.childNodes[u];u=0}else if(u==P(o)&&!gn(o)&&vt(o,o.parentNode)){u=1+D(o);o=o.parentNode}else if(o.nodeType==t.Node.TEXT_NODE&&i.inArray(t.getComputedStyle(o.parentNode).whiteSpace,["pre","pre-wrap"])==-1&&u!=P(o)&&/[ \xa0]/.test(o.data[u])){if(f&&" "==o.data[u]){o.deleteData(u,1);continue}f=" "==o.data[u];u++;a++}else{break}}var l=Bn(a,s==0&&mn(r),u==P(o)&&gn(o));while(H(r,s,o,u)=="before"){if(s<r.childNodes.length){r=r.childNodes[s];s=0}else if(r.nodeType!=t.Node.TEXT_NODE||s==P(r)){s=1+D(r);r=r.parentNode}else{var c=l[0];l=l.slice(1);if(c!=r.data[s]){r.insertData(s,c);r.deleteData(s+1,1)}s++}}}function Fn(n,r,i,s,o){var u;var a={};var f;if(arguments.length<3){u=n}else{u=e.createRange();u.setStart(n,r);u.setEnd(i,s)}if(arguments.length==2){a=r}if(arguments.length==5){a=o}var l=null!=a.blockMerging?!!a.blockMerging:true;var c=null!=a.stripWrappers?!!a.stripWrappers:true;if(!u){return}var h=u.startContainer;var d=u.startOffset;var m=u.endContainer;var g=u.endOffset;var b;while(h.hasChildNodes()){if(d==P(h)&&vt(h,h.parentNode)&&lt(h)){d=1+D(h);h=h.parentNode;continue}if(d==P(h)){break}b=h.childNodes[d];if(ft(b)||b.nodeType==t.Node.ELEMENT_NODE&&!b.hasChildNodes()||b.nodeType!=t.Node.ELEMENT_NODE&&b.nodeType!=t.Node.TEXT_NODE){break}h=b;d=0}while(m.hasChildNodes()){if(g==0&&vt(m,m.parentNode)&&lt(m)){g=D(m);m=m.parentNode;continue}if(g==0){break}b=m.childNodes[g-1];if(ft(b)||b.nodeType==t.Node.ELEMENT_NODE&&!b.hasChildNodes()||b.nodeType!=t.Node.ELEMENT_NODE&&b.nodeType!=t.Node.TEXT_NODE){break}m=b;g=P(b)}if(H(m,g,h,d)!=="after"){u.setEnd(u.startContainer,u.startOffset);return u}if(m.nodeType==t.Node.TEXT_NODE&&g==P(m)&&h!=m){g=1+D(m);m=m.parentNode}u.setStart(h,d);u.setEnd(m,g);var w=u.startContainer;while(vt(w,w.parentNode)&&lt(w)){w=w.parentNode}if(!ft(w)&&!ct(w)||!Vt("span",w)||v(w,["td","th"])){w=null}var E=u.endContainer;while(vt(E,E.parentNode)&&lt(E)){E=E.parentNode}if(!ft(E)&&!ct(E)||!Vt("span",E)||v(E,["td","th"])){E=null}var x=Pn(u);var N;if(h==m&&ht(h)&&h.nodeType==t.Node.TEXT_NODE){N=h.parentNode;h.deleteData(d,g-d);if(d>0&&h.data.substr(d-1,1)===" "&&d<h.data.length&&h.data.substr(d,1)===" "){h.replaceData(d-1,1,"")}jn(h,d);u.setStart(u.startContainer,u.startOffset);u.setEnd(u.startContainer,u.startOffset);Hn(x,u);if((ht(N)||ct(N))&&!lt(N)){Cn(N)}return u}if(ht(h)&&h.nodeType==t.Node.TEXT_NODE){h.deleteData(d,P(h)-d)}var C=F(u,function(e){return ht(e)&&!v(e,["thead","tbody","tfoot","tr","th","td"])});for(f=0;f<C.length;f++){var k=C[f];N=k.parentNode;N.removeChild(k);if(c||!S(N,h)&&N!=h){while(ht(N)&&lt(N)&&P(N)==0){var L=N.parentNode;L.removeChild(N);N=L}}if((ht(N)||ct(N))&&!lt(N)){Cn(N)}}if(ht(m)&&m.nodeType==t.Node.TEXT_NODE){m.deleteData(0,g)}jn(u.startContainer,u.startOffset);jn(u.endContainer,u.endOffset);var A;if(!l||!w||!E||!vt(w,E)||w==E){u.setEnd(u.startContainer,u.startOffset);var O=w||E;if(Lt(O)){A=At(O);u.setStart(A.node,A.offset);u.setEnd(A.node,A.offset)}Hn(x,u);return u}if(w.children.length==1&&xt(w.firstChild)){w.removeChild(w.firstChild)}if(E.children.length==1&&xt(E.firstChild)){E.removeChild(E.firstChild)}var M;if(S(w,E)){b=E;while(b.parentNode!=w){b=b.parentNode}u.setStart(w,D(b));u.setEnd(w,D(b));if(!E.hasChildNodes()){while(ht(E)&&E.parentNode.childNodes.length==1&&E.parentNode!=w){N=E;N.removeChild(E);E=N}if(ht(E)&&!lt(E)&&lt(E.previousSibling)&&lt(E.nextSibling)){E.parentNode.insertBefore(document.createElement("br"),E.nextSibling)}if(ht(E)){E.parentNode.removeChild(E)}Hn(x,u);return u}if(!lt(E.firstChild)){Hn(x,u);return u}var _=[];_.push(E.firstChild);while(!p(_[_.length-1],"br")&&lt(_[_.length-1].nextSibling)){_.push(_[_.length-1].nextSibling)}M=sn(_);while(_[0].parentNode!=w){yn(_,u)}if(ht(_[0].previousSibling)&&p(_[0].previousSibling,"br")){_[0].parentNode.removeChild(_[0].previousSibling)}}else if(T(w,E)){u.setStart(w,P(w));u.setEnd(w,P(w));b=w;while(b.parentNode!=E){b=b.parentNode}if(lt(b.nextSibling)&&p(w.lastChild,"br")){w.removeChild(w.lastChild)}var B=[];if(b.nextSibling&&!p(b.nextSibling,"br")&&!ft(b.nextSibling)){B.push(b.nextSibling)}if(B.length&&B[B.length-1].nextSibling&&!p(B[B.length-1].nextSibling,"br")&&!ft(B[B.length-1].nextSibling)){B.push(B[B.length-1].nextSibling)}M=sn(B);t(B).forEach(function(e){Mt(e,w,-1,u)});if(p(b.nextSibling,"br")){b.parentNode.removeChild(b.nextSibling)}}else{u.setStart(w,P(w));u.setEnd(w,P(w));if(lt(E.firstChild)&&p(w.lastChild,"br")){w.removeChild(w.lastChild)}M=sn([].slice.call(y(E.childNodes)));while(E.hasChildNodes()){Mt(E.firstChild,w,-1,u)}while(!E.hasChildNodes()){N=E.parentNode;N.removeChild(E);E=N}}fn(M,u);if(Lt(w)){A=At(w);u.setStart(A.node,A.offset);u.setEnd(A.node,A.offset);w=A.node}Cn(w);Hn(x,u);return u}function In(e,t){if(e.hasChildNodes()){yn([].slice.call(y(e.childNodes)),t)}else{e.parentNode.removeChild(e)}}function qn(e,t){if(e){i(e).find("ul,ol,li").each(function(){i(this).contents().each(function(){if(yt(this)){var e=D(this);if(t.startContainer===this.parentNode&&t.startOffset>e){t.startOffset--}else if(t.startContainer===this){t.startContainer=this.parentNode;t.startOffset=e}if(t.endContainer===this.parentNode&&t.endOffset>e){t.endOffset--}else if(t.endContainer===this){t.endContainer=this.parentNode;t.endOffset=e}i(this).remove()}})})}}function Rn(e,t){if(!e.length){return}var n=e[0];if(v(n.parentNode,["OL","UL"])){var r=n.parentNode.tagName;jt(e,function(e){return c(e,r)},function(){return n.ownerDocument.createElement(r)},t);return}var i=jt(e,function(e){return wn(e)},function(){return n.ownerDocument.createElement("blockquote")},t);kn(i,t)}function Un(e,n){if(!ht(e)){return}if(wn(e)){In(e,n);return}if(bn(e)){e.removeAttribute("class");e.removeAttribute("dir");e.style.margin="";e.style.padding="";e.style.border="";if(e.getAttribute("style")==""){e.removeAttribute("style")}Dt(e,"div",n);return}var r=e.parentNode;var i=[];while(ht(r)&&r.nodeType==t.Node.ELEMENT_NODE&&!wn(r)&&!v(r,["ol","ul"])){i.push(r);r=r.parentNode}if(!ht(r)||!wn(r)){r=e.parentNode;i=[];while(ht(r)&&r.nodeType==t.Node.ELEMENT_NODE&&!bn(r)&&!v(r,["ol","ul"])){i.push(r);r=r.parentNode}}if(v(e,["OL","UL"])&&(!ht(r)||!bn(r))){e.removeAttribute("reversed");e.removeAttribute("start");e.removeAttribute("type");var s=[].slice.call(y(e.childNodes));if(e.attributes.length&&!v(e.parentNode,["OL","UL"])){Dt(e,"div",n)}else{var o=sn([].slice.call(y(e.childNodes)));In(e,n);fn(o,n)}var u;for(u=0;u<s.length;u++){kn(s[u],n)}return}if(!ht(r)||!bn(r)){return}i.push(r);var a=r;while(i.length){r=i.pop();var f=e.parentNode==r?e:i[i.length-1];if(lt(f)&&!p(f,"BR")&&p(f.nextSibling,"BR")){f.parentNode.removeChild(f.nextSibling)}var l=[].slice.call(y(r.childNodes),0,D(f));var c=[].slice.call(y(r.childNodes),1+D(f));Rn(l,n);Rn(c,n)}Un(a,n)}function zn(e,n){function l(){return document.createElement("li")}function h(e){return v(e,["ol","ul"])}function d(e){return function(t){return c(t,e)}}function m(e){return function(){return document.createElement(e)}}function g(e,t,n){return function(){if(!ht(t[0].parentNode)||!wn(t[0].parentNode)||!ht(t[0].parentNode.previousSibling)||!c(t[0].parentNode.previousSibling,e)){return document.createElement(e)}var r=t[0].parentNode.previousSibling;Ln(r.lastChild,n);if(!ht(r.lastChild)||!c(r.lastChild,e)){r.appendChild(document.createElement(e))}return r.lastChild}}var r=Mn()==e?"disable":"enable";e=e.toUpperCase();var i=e=="OL"?"UL":"OL";var s=[];(function(){var e;for(e=n.endContainer;e!=n.commonAncestorContainer;e=e.parentNode){if(p(e,"li")){s.unshift(e)}}for(e=n.startContainer;e;e=e.parentNode){if(p(e,"li")){s.unshift(e)}}})();t(s).forEach(function(e){Ln(e,n)});var o=On(n);if(r=="enable"){t(I(o,function(e){return ht(e)&&c(e,i)})).forEach(function(t){if(ht(t.previousSibling)&&c(t.previousSibling,e)||ht(t.nextSibling)&&c(t.nextSibling,e)){var r=[].slice.call(y(t.childNodes));var i=sn(r);yn(r,n);jt(r,function(t){return c(t,e)},function(){return null},n);fn(i,n)}else{Dt(t,e,n)}})}var u=F(o,function(e){return ht(e)&&!bn(e)&&(v(e,["OL","UL"])||v(e.parentNode,["OL","UL"])||Vt(e,"li"))});if(r=="enable"){u=t(u).filter(function(e){return!v(e,["ol","ul"])||v(e.parentNode,["ol","ul"])})}var a,f;if(r=="disable"){while(u.length){a=[];a.push(u.shift());if(c(a[0],e)){Un(a[0],n);continue}while(u.length&&u[0]==a[a.length-1].nextSibling&&!c(u[0],e)){a.push(u.shift())}f=sn(a);yn(a,n);var b;for(b=0;b<a.length;b++){kn(a[b],n)}fn(f,n)}}else{while(u.length){a=[];while(!a.length||u.length&&u[0]==a[a.length-1].nextSibling){if(v(u[0],["p","div"])){a.push(Dt(u[0],"li",n));u.shift()}else if(v(u[0],["li","ol","ul"])){a.push(u.shift())}else{var w=[];while(!w.length||u.length&&u[0]==w[w.length-1].nextSibling&&lt(u[0])&&lt(w[w.length-1])&&!p(w[w.length-1],"br")){w.push(u.shift())}a.push(jt(w,undefined,l,n))}}if(c(a[0].parentNode,e)||t(a).every(h)){continue}if(c(a[0].parentNode,i)){f=sn(a);yn(a,n);jt(a,d(e),m(e),n);fn(f,n);continue}kn(jt(a,d(e),g(e,a,n),n),n)}}}function Wn(e,n){function l(e){return function(n){return p(n,"div")&&t(n.attributes).every(function(t){return t.name=="align"&&t.value.toLowerCase()==e||t.name=="style"&&g(n)==1&&n.style.textAlign==e})}}function c(e){return function(){var t=document.createElement("div");t.setAttribute("style","text-align: "+e);return t}}var r=On(n);var i=I(r,function(e){return e.nodeType==t.Node.ELEMENT_NODE&&ht(e)&&(s(e,"align")||e.style.textAlign!=""||p(e,"center"))});var o;for(o=0;o<i.length;o++){var u=i[o];u.removeAttribute("align");u.style.textAlign="";if(u.getAttribute("style")==""){u.removeAttribute("style")}if(v(u,["div","span","center"])&&!u.attributes.length){In(u,n)}if(p(u,"center")&&u.attributes.length){Dt(u,"div",n)}}r=On(a);var f=[];f=F(r,function(t){return ht(t)&&Vt(t,"div")&&_n(t)!=e});while(f.length){var h=[];h.push(f.shift());while(f.length&&f[0]==h[h.length-1].nextSibling){h.push(f.shift())}jt(h,l(e),c(e),n)}}function Xn(e,n){var r;if(!e.collapsed){return}r=e.startOffset;if(n){if(e.startContainer&&e.startContainer.nodeType===t.Node.TEXT_NODE){while(r<e.startContainer.data.length&&e.startContainer.data.charAt(r)===""){r++}}}else{if(e.startContainer&&e.startContainer.nodeType===t.Node.TEXT_NODE){while(r>0&&e.startContainer.data.charAt(r-1)===""){r--}}}if(r!==e.startOffset){e.setStart(e.startContainer,r);e.setEnd(e.startContainer,r)}}var o="http://www.w3.org/1999/xhtml";var u=false;var a=null;var f={};var U,z,W,X,V,$,J;var K=0;var ot={ADDRESS:true,ARTICLE:true,ASIDE:true,BLOCKQUOTE:true,CAPTION:true,CENTER:true,COL:true,COLGROUP:true,DD:true,DETAILS:true,DIR:true,DIV:true,DL:true,DT:true,FIELDSET:true,FIGCAPTION:true,FIGURE:true,FOOTER:true,FORM:true,H1:true,H2:true,H3:true,H4:true,H5:true,H6:true,HEADER:true,HGROUP:true,HR:true,LI:true,LISTING:true,MENU:true,NAV:true,OL:true,P:true,PLAINTEXT:true,PRE:true,SECTION:true,SUMMARY:true,TABLE:true,TBODY:true,TD:true,TFOOT:true,TH:true,THEAD:true,TR:true,UL:true,XMP:true};var at={inline:true,"inline-block":true,"inline-table":true,none:true};(function(){var e={};var t={};var r=null;W=function(i){if(!r||r.startContainer!=i.startContainer||r.endContainer!=i.endContainer||r.startOffset!=i.startOffset||r.endOffset!=i.endOffset){r={startContainer:i.startContainer,endContainer:i.endContainer,startOffset:i.startOffset,endOffset:i.endOffset};if(!n.isEmpty(e)||!n.isEmpty(t)){e={};t={};return true}}return false};U=function(t,n){W(n);return e[t]};z=function(t,n,r){W(r);e[t]=n};X=function(t,n){W(n);delete e[t]};V=function(e,n){W(n);return t[e]};$=function(e,n,r){W(r);t[e]=n;if(e=="backcolor"){t.hilitecolor=n}else if(e=="hilitecolor"){t.backcolor=n}};J=function(e,n){W(n);delete t[e];if(e=="backcolor"){delete t.hilitecolor}else if(e=="hilitecolor"){delete t.backcolor}}})();var Ft={A:true,ABBR:true,B:true,BDI:true,BDO:true,CITE:true,CODE:true,DFN:true,EM:true,H1:true,H2:true,H3:true,H4:true,H5:true,H6:true,I:true,KBD:true,MARK:true,P:true,PRE:true,Q:true,RP:true,RT:true,RUBY:true,S:true,SAMP:true,SMALL:true,SPAN:true,STRONG:true,SUB:true,SUP:true,U:true,VAR:true,ACRONYM:true,LISTING:true,STRIKE:true,XMP:true,BIG:true,BLINK:true,FONT:true,MARQUEE:true,NOBR:true,TT:true};var It={colgroup:true,table:true,tbody:true,tfoot:true,thead:true,tr:true};var qt={script:true,style:true,plaintext:true,xmp:true};var Rt=i.extend({H1:true,H2:true,H3:true,H4:true,H5:true,H6:true},ot);var Ut={CAPTION:true,COL:true,COLGROUP:true,TBODY:true,TD:true,TFOOT:true,TH:true,THEAD:true,TR:true};var zt={DD:true,DT:true};var Wt={A:i.extend({A:true},ot),DD:zt,DT:zt,LI:{LI:true},NOBR:i.extend({NOBR:true},ot),H1:Rt,H2:Rt,H3:Rt,H4:Rt,H5:Rt,H6:Rt,TD:Ut,TH:Ut,ABBR:ot,B:ot,BDI:ot,BDO:ot,CITE:ot,CODE:ot,DFN:ot,EM:ot,I:ot,KBD:ot,MARK:ot,P:ot,PRE:ot,Q:ot,RP:ot,RT:ot,RUBY:ot,S:ot,SAMP:ot,SMALL:ot,SPAN:ot,STRONG:ot,SUB:ot,SUP:ot,U:ot,VAR:ot,ACRONYM:ot,LISTING:ot,STRIKE:ot,XMP:ot,BIG:ot,BLINK:ot,FONT:ot,MARQUEE:ot,TT:ot};var rn=["subscript","bold","fontname","fontsize","forecolor","hilitecolor","italic","strikethrough","underline"];f.backcolor={action:function(e,t){if(/^([0-9a-fA-F]{3}){1,2}$/.test(e)){e="#"+e}if(!/^(rgba?|hsla?)\(.*\)$/.test(e)&&!R(e)&&e.toLowerCase()!="transparent"){return}ln("backcolor",e,t)},standardInlineValueCommand:true,relevantCssProperty:"backgroundColor",equivalentValues:function(e,t){return q(e)===q(t)}};f.bold={action:function(e,t){if(rt("bold",t)){ln("bold","normal",t)}else{ln("bold","bold",t)}},inlineCommandActivatedValues:["bold","600","700","800","900"],relevantCssProperty:"fontWeight",equivalentValues:function(e,t){return e==t||e=="bold"&&t=="700"||e=="700"&&t=="bold"||e=="normal"&&t=="400"||e=="400"&&t=="normal"}};f.createlink={action:function(e,n){if(e===""){return}t(Kt(Ot())).forEach(function(n){t(k(n)).forEach(function(t){if(ht(t)&&p(t,"a")&&s(t,"href")){t.setAttribute("href",e)}})});ln("createlink",e,n)},standardInlineValueCommand:true};f.fontname={action:function(e,t){ln("fontname",e,t)},standardInlineValueCommand:true,relevantCssProperty:"fontFamily"};f.fontsize={action:function(e,t){if(e===""){return}e=Q(e);if(i.inArray(e,["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large"])==-1&&!/^[0-9]+(\.[0-9]+)?(cm|mm|in|pt|pc)$/.test(e)){return}ln("fontsize",e,t)},indeterm:function(){return t(Kt(Ot(),function(e){return ht(e)&&e.nodeType==t.Node.TEXT_NODE})).map(function(e){return en(e,"fontsize")},true).filter(function(e,n,r){return t(r.slice(0,n)).indexOf(e)==-1}).length>=2},value:function(e){var n=Kt(e,function(e){return ht(e)&&e.nodeType==t.Node.TEXT_NODE})[0];if(n===undefined){n=e.startContainer}var r=en(n,"fontsize");return G(r)},relevantCssProperty:"fontSize"};f.forecolor={action:function(e,t){if(/^([0-9a-fA-F]{3}){1,2}$/.test(e)){e="#"+e}if(!/^(rgba?|hsla?)\(.*\)$/.test(e)&&!R(e)&&e.toLowerCase()!="transparent"){return}ln("forecolor",e,t)},standardInlineValueCommand:true,relevantCssProperty:"color",equivalentValues:function(e,t){return q(e)===q(t)}};f.hilitecolor={action:function(e,t){if(/^([0-9a-fA-F]{3}){1,2}$/.test(e)){e="#"+e}if(!/^(rgba?|hsla?)\(.*\)$/.test(e)&&!R(e)&&e.toLowerCase()!="transparent"){return}ln("hilitecolor",e,t)},indeterm:function(){return t(Kt(Ot(),function(e){return ht(e)&&e.nodeType==t.Node.TEXT_NODE})).map(function(e){return en(e,"hilitecolor")},true).filter(function(e,n,r){return t(r.slice(0,n)).indexOf(e)==-1}).length>=2},standardInlineValueCommand:true,relevantCssProperty:"backgroundColor",equivalentValues:function(e,t){return q(e)===q(t)}};f.italic={action:function(e,t){if(rt("italic",t)){ln("italic","normal",t)}else{ln("italic","italic",t)}},inlineCommandActivatedValues:["italic","oblique"],relevantCssProperty:"fontStyle"};f.removeformat={action:function(e,n){function o(e){return ht(e)&&v(e,["abbr","acronym","b","bdi","bdo","big","blink","cite","code","dfn","em","font","i","ins","kbd","mark","nobr","q","s","samp","small","span","strike","strong","sub","sup","tt","u","var"])}var r,i,s;var u=Kt(Ot(),o);t(u).forEach(function(e){while(e.hasChildNodes()){Mt(e.firstChild,e.parentNode,D(e),Ot())}e.parentNode.removeChild(e)});if(ht(Ot().startContainer)&&Ot().startContainer.nodeType==t.Node.TEXT_NODE&&Ot().startOffset!=0&&Ot().startOffset!=P(Ot().startContainer)){if(Ot().startContainer==Ot().endContainer){r=Ot().endOffset-Ot().startOffset;s=Ot().startContainer.splitText(Ot().startOffset);Ot().setStart(s,0);Ot().setEnd(s,r)}else{Ot().setStart(Ot().startContainer.splitText(Ot().startOffset),0)}}if(ht(Ot().endContainer)&&Ot().endContainer.nodeType==t.Node.TEXT_NODE&&Ot().endOffset!=0&&Ot().endOffset!=P(Ot().endContainer)){i=[Ot().startContainer,Ot().startOffset];r=[Ot().endContainer,Ot().endOffset];Ot().setEnd(document.documentElement,0);r[0].splitText(r[1]);Ot().setStart(i[0],i[1]);Ot().setEnd(r[0],r[1])}t(Kt(Ot(),ht)).forEach(function(e){while(o(e.parentNode)&&vt(e.parentNode,e)){yn([e],Ot())}});t(["subscript","bold","fontname","fontsize","forecolor","hilitecolor","italic","strikethrough","underline"]).forEach(function(e){ln(e,null,n)})}};f.strikethrough={action:function(e,t){if(rt("strikethrough",t)){ln("strikethrough",null,t)}else{ln("strikethrough","line-through",t)}},inlineCommandActivatedValues:["line-through"]};f.subscript={action:function(e,t){var n=rt("subscript",t);ln("subscript",null,t);if(!n){ln("subscript","subscript",t)}},indeterm:function(){var e=Kt(Ot(),function(e){return ht(e)&&e.nodeType==t.Node.TEXT_NODE});return t(e).some(function(e){return en(e,"subscript")=="subscript"})&&t(e).some(function(e){return en(e,"subscript")!="subscript"})||t(e).some(function(e){return en(e,"subscript")=="mixed"})},inlineCommandActivatedValues:["subscript"]};f.superscript={action:function(e,t){var n=rt("superscript",t);ln("superscript",null,t);if(!n){ln("superscript","superscript",t)}},indeterm:function(){var e=Kt(Ot(),function(e){return ht(e)&&e.nodeType==t.Node.TEXT_NODE});return t(e).some(function(e){return en(e,"superscript")=="superscript"})&&t(e).some(function(e){return en(e,"superscript")!="superscript"})||t(e).some(function(e){return en(e,"superscript")=="mixed"})},inlineCommandActivatedValues:["superscript"]};f.underline={action:function(e,t){if(rt("underline",t)){ln("underline",null,t)}else{ln("underline","underline",t)}},inlineCommandActivatedValues:["underline"]};f.unlink={action:function(){var e=Ot();var t=[];var n;for(n=e.startContainer;n;n=n.parentNode){if(p(n,"A")&&s(n,"href")){t.unshift(n)}}for(n=e.startContainer;n!=b(e.endContainer);n=w(n)){if(p(n,"A")&&s(n,"href")&&(j(n,e)||S(n,e.endContainer)||n==e.endContainer)){t.push(n)}}var r;for(r=0;r<t.length;r++){on(t[r],"unlink",e)}},standardInlineValueCommand:true};var xn="p";f["delete"]={action:function(n,r){var s;if(i.browser.msie&&i.browser.version<=7){Xn(r,false)}if(!r.collapsed){Fn(r);return}jn(r.startContainer,r.startOffset);var o=r.startContainer;var u=r.startOffset;var a=false;var f=false;while(true){if(u>0){a=p(o.childNodes[u-1],"br")||false;f=p(o.childNodes[u-1],"hr")||false}if(u==0&&ht(o.previousSibling)&&St(o.previousSibling)){o.parentNode.removeChild(o.previousSibling);continue}if(0<=u-1&&u-1<o.childNodes.length&&ht(o.childNodes[u-1])&&(St(o.childNodes[u-1])||a||f)){o.removeChild(o.childNodes[u-1]);u--;if(a||f){r.setStart(o,u);r.setEnd(o,u);return}continue}if(u==0&&lt(o)||St(o)){u=D(o);o=o.parentNode;continue}if(0<=u-1&&u-1<o.childNodes.length&&ht(o.childNodes[u-1])&&p(o.childNodes[u-1],"a")){In(o.childNodes[u-1],r);return}if(0<=u-1&&u-1<o.childNodes.length&&!ft(o.childNodes[u-1])&&!v(o.childNodes[u-1],["br","img"])){o=o.childNodes[u-1];u=P(o);continue}var l=true;if(l){break}}var c=hn(o,u);if(c){c.parentNode.removeChild(c);return}if(o.nodeType==t.Node.TEXT_NODE&&u!=0){r.setStart(o,u-1);r.setEnd(o,u-1);Fn(o,u-1,o,u);return}if(o.nodeType==t.Node.TEXT_NODE&&u==0&&i.browser.msie){u=1;r.setStart(o,u);r.setEnd(o,u);r.startOffset=0;Fn(r);return}if(lt(o)){return}if(0<=u-1&&u-1<o.childNodes.length&&v(o.childNodes[u-1],["br","hr","img"])){r.setStart(o,u);r.setEnd(o,u);Fn(r);return}if(v(o,["li","dt","dd"])&&o==o.parentNode.firstChild&&u==0){var h=[];var d;for(d=o.parentNode;d;d=d.parentNode){if(p(d,"li")){h.unshift(d)}}for(s=0;s<h.length;s++){Ln(h[s],r)}var m=sn([o]);yn([o],r);fn(m,r);if(v(o,["dd","dt"])&&t(k(o)).every(function(e){return!vt(o,e)||!Vt(o,e)})){o=Dt(o,xn,r)}kn(o,r);for(s=0;s<h.length;s++){An(h[s].parentNode,r)}return}var g=o;var y=u;while(true){if(y==0){y=D(g);g=g.parentNode}else if(0<=y-1&&y-1<g.childNodes.length&&ht(g.childNodes[y-1])&&St(g.childNodes[y-1])){g.removeChild(g.childNodes[y-1]);y--}else{break}}if(u==0&&t(k(o).concat(o)).filter(function(e){return ht(e)&&vt(e,o)&&bn(e)}).length){var b=e.createRange();b.setStart(o,0);b.setEnd(o,0);b=On(b);var w=F(b,function(e){return ht(e)&&!pt(e)});for(s=0;s<w.length;s++){Un(w[s],r)}return}if(p(g.childNodes[y],"table")){return}if(0<=y-1&&y-1<g.childNodes.length&&p(g.childNodes[y-1],"table")){r.setStart(g,y-1);r.setEnd(g,y);return}if(u==0&&(p(g.childNodes[y-1],"hr")||p(g.childNodes[y-1],"br")&&(p(g.childNodes[y-1].previousSibling,"br")||!lt(g.childNodes[y-1].previousSibling)))){r.setStart(o,u);r.setEnd(o,u);Fn(g,y-1,g,y);return}if(v(g.childNodes[y],["li","dt","dd"])&&lt(g.childNodes[y].firstChild)&&y!=0){var E=g.childNodes[y-1];if(lt(E.lastChild)&&!p(E.lastChild,"br")){E.appendChild(document.createElement("br"))}if(lt(E.lastChild)){E.appendChild(document.createElement("br"))}}if(v(g.childNodes[y],["li","dt","dd"])&&v(g.childNodes[y-1],["li","dt","dd"])){g=g.childNodes[y-1];y=P(g);o=g.nextSibling;u=0}else{while(0<=y-1&&y-1<g.childNodes.length){if(ht(g.childNodes[y-1])&&St(g.childNodes[y-1])){g.removeChild(g.childNodes[y-1]);y--}else{g=g.childNodes[y-1];y=P(g)}}}var S=e.createRange();S.setStart(g,y);S.setEnd(o,u);Fn(S);if(!x(document.body,r.startContainer)){if(S.startContainer.hasChildNodes()||S.startContainer.nodeType==t.Node.TEXT_NODE||ct(S.startContainer)){r.setStart(S.startContainer,S.startOffset);r.setEnd(S.startContainer,S.startOffset)}else{r.setStart(S.startContainer.parentNode,D(S.startContainer));r.setEnd(S.startContainer.parentNode,D(S.startContainer))}}}};var Vn=["address","dd","div","dt","h1","h2","h3","h4","h5","h6","p","pre"];f.formatblock={action:function(e){function u(e){return function(n){return ht(n)&&vt(n,e)&&c(n,Vn)&&!t(L(n)).some(ut)}}function a(e){return function(t){return c(t,e)&&!t.attributes.length}}function f(){return false}function l(e){return function(){return document.createElement(e)}}var n;if(/^<.*>$/.test(e)){e=e.slice(1,-1)}e=e.toLowerCase();if(t(Vn).indexOf(e)==-1){return}var r=On(Ot());var s=F(r,function(e){return ht(e)&&(En(e)||Vt(e,"p")||v(e,["dd","dt"]))&&!t(L(e)).some(ut)});var o=sn(s);for(n=0;n<s.length;n++){var h=s[n];while(t(k(h)).some(u(h))){yn([h],r)}}fn(o,r);while(s.length){var d;if(Sn(s[0])){d=[].slice.call(y(s[0].childNodes));o=sn(d);In(s[0],r);fn(o,r);s.shift()}else{d=[];d.push(s.shift());while(s.length&&s[0]==d[d.length-1].nextSibling&&!Sn(s[0])&&!p(d[d.length-1],"BR")){d.push(s.shift())}}kn(jt(d,i.inArray(e,["div","p"])==-1?a(e):f,l(e),r),r)}},indeterm:function(){var e=On(Ot());var n=I(e,function(e){return Et(e)&&ht(e)&&!e.hasChildNodes()});if(!n.length){return false}var r=null;var i;for(i=0;i<n.length;i++){var s=n[i];while(ht(s.parentNode)&&vt(s,s.parentNode)&&!c(s,Vn)){s=s.parentNode}var o="";if(ht(s)&&c(s,Vn)&&!t(L(s)).some(ut)){o=s.tagName}if(r===null){r=o}else if(r!=o){return true}}return false},value:function(){var e=On(Ot());var n=I(e,function(e){return Et(e)&&ht(e)&&!e.hasChildNodes()});if(!n.length){return""}var r=n[0];while(ht(r.parentNode)&&vt(r,r.parentNode)&&!c(r,Vn)){r=r.parentNode}if(ht(r)&&c(r,Vn)&&!t(L(r)).some(ut)){return r.tagName.toLowerCase()}return""}};f.forwarddelete={action:function(e,n){if(i.browser.msie&&i.browser.version<=7){Xn(n,true)}if(!n.collapsed){Fn(n);return}jn(n.startContainer,n.startOffset);var r=n.startContainer;var s=n.startOffset;var o=false;var u=false;while(true){if(s==P(r)&&ht(r.nextSibling)&&St(r.nextSibling)){r.parentNode.removeChild(r.nextSibling)}else if(s<r.childNodes.length&&ht(r.childNodes[s])&&(St(r.childNodes[s])||o||u)){r.removeChild(r.childNodes[s]);if(o||u){Cn(r);n.setStart(r,s);n.setEnd(r,s);return}}else if(s<r.childNodes.length&&xt(r.childNodes[s])){s++}else if(s==P(r)&&lt(r)||St(r)){s=1+D(r);r=r.parentNode}else if(s<r.childNodes.length&&!ft(r.childNodes[s])&&!v(r.childNodes[s],["br","img"])){r=r.childNodes[s];s=0}else{break}}jn(n.startContainer,n.startOffset);var a=cn(r,s);if(a){a.parentNode.removeChild(a);return}var f;if(r.nodeType==t.Node.TEXT_NODE&&s!=P(r)){n.setStart(r,s);n.setEnd(r,s);f=s+1;while(f!=r.length&&/^[\u0300-\u036f\u0591-\u05bd\u05c1\u05c2]$/.test(r.data[f])){f++}Fn(r,s,r,f);return}if(lt(r)){return}if(s<r.childNodes.length&&v(r.childNodes[s],["br","hr","img"])){n.setStart(r,s);n.setEnd(r,s);Fn(r,s,r,s+1);return}var l=r;f=s;while(true){if(f==P(l)){f=1+D(l);l=l.parentNode}else if(f<l.childNodes.length&&ht(l.childNodes[f])&&St(l.childNodes[f])){l.removeChild(l.childNodes[f])}else{break}}if(p(l.childNodes[f-1],"table")){return}if(p(l.childNodes[f],"table")){n.setStart(l,f);n.setEnd(l,f+1);return}if(s==P(r)&&v(l.childNodes[f],["br","hr"])){n.setStart(r,s);n.setEnd(r,s);Fn(l,f,l,f+1);return}while(f<l.childNodes.length){if(ht(l.childNodes[f])&&St(l.childNodes[f])){l.removeChild(l.childNodes[f])}else{l=l.childNodes[f];f=0}}var c=Fn(r,s,l,f);n.setStart(c.startContainer,c.startOffset);n.setEnd(c.endContainer,c.endOffset)}};f.indent={action:function(){var e=[];var t;for(t=Ot().endContainer;t!=Ot().commonAncestorContainer;t=t.parentNode){if(p(t,"LI")){e.unshift(t)}}for(t=Ot().startContainer;t!=Ot().commonAncestorContainer;t=t.parentNode){if(p(t,"LI")){e.unshift(t)}}for(t=Ot().commonAncestorContainer;t;t=t.parentNode){if(p(t,"LI")){e.unshift(t)}}var n;for(n=0;n<e.length;n++){Ln(e[n],Ot())}var r=On(Ot());var i=[];i=F(r,function(e){return ht(e)&&(Vt(e,"div")||Vt(e,"ol"))});if(i.length&&p(i[0],"LI")&&v(i[0].parentNode,["OL","UL"])&&p(i[0].previousSibling,"LI")){Ln(i[0].previousSibling,r)}while(i.length){var s=[];s.push(i.shift());while(i.length&&i[0]==s[s.length-1].nextSibling){s.push(i.shift())}Rn(s,r)}}};f.inserthorizontalrule={action:function(n,r){while(r.startOffset==0&&r.startContainer.parentNode){r.setStart(r.startContainer.parentNode,D(r.startContainer))}while(r.endOffset==P(r.endContainer)&&r.endContainer.parentNode){r.setEnd(r.endContainer.parentNode,1+D(r.endContainer))}Fn(r,{blockMerging:false});if(!ht(Ot().startContainer)&&!ct(Ot().startContainer)){return}if(Ot().startContainer.nodeType==t.Node.TEXT_NODE&&Ot().startOffset==0){Ot().setStart(Ot().startContainer.parentNode,D(Ot().startContainer));Ot().collapse(true)}if(Ot().startContainer.nodeType==t.Node.TEXT_NODE&&Ot().startOffset==P(Ot().startContainer)){Ot().setStart(Ot().startContainer.parentNode,1+D(Ot().startContainer));Ot().collapse(true)}var i=document.createElement("hr");r.insertNode(i);kn(i,r);r.setStart(i.parentNode,1+D(i));r.setEnd(i.parentNode,1+D(i));e.getSelection().removeAllRanges();e.getSelection().addRange(r)}};f.inserthtml={action:function(e,n){Fn(n);if(!ht(n.startContainer)&&!ct(n.startContainer)){return}var r=n.createContextualFragment(e);var i=r.lastChild;if(!i){return}var s=L(r);if(ft(n.startContainer)){t(n.startContainer.childNodes).filter(function(e,t){return ht(e)&&xt(e)&&D(e)>=t.startOffset},true).forEach(function(e){e.parentNode.removeChild(e)})}n.insertNode(r);if(ft(n.startContainer)){Cn(n.startContainer)}n.setStart(i.parentNode,1+D(i));n.setEnd(i.parentNode,1+D(i));var o;for(o=0;o<s.length;o++){kn(s[o],n)}et(n)}};f.insertimage={action:function(t){if(t===""){return}var n=Ot();Fn(n,{stripWrappers:false});if(!ht(Ot().startContainer)&&!ct(Ot().startContainer)){return}if(ft(n.startContainer)&&n.startContainer.childNodes.length==1&&p(n.startContainer.firstChild,"br")&&n.startOffset==0){n.startContainer.removeChild(n.startContainer.firstChild)}var r=document.createElement("img");r.setAttribute("src",t);n.insertNode(r);n.setStart(r.parentNode,1+D(r));n.setEnd(r.parentNode,1+D(r));e.getSelection().removeAllRanges();e.getSelection().addRange(n);r.removeAttribute("width");r.removeAttribute("height")}};f.insertlinebreak={action:function(n,r){Fn(r,{stripWrappers:false});if(!ht(r.startContainer)&&!ct(r.startContainer)){return}if(r.startContainer.nodeType==t.Node.ELEMENT_NODE&&!Vt("br",r.startContainer)){return}if(r.startContainer.nodeType!=t.Node.ELEMENT_NODE&&!Vt("br",r.startContainer.parentNode)){return}var s,o;if(r.startContainer.nodeType==t.Node.TEXT_NODE&&r.startOffset==0){s=r.startContainer.parentNode;o=D(r.startContainer);e.getSelection().collapse(s,o);r.setStart(s,o);r.setEnd(s,o)}if(r.startContainer.nodeType==t.Node.TEXT_NODE&&r.startOffset==P(r.startContainer)){s=r.startContainer.parentNode;o=1+D(r.startContainer);e.getSelection().collapse(s,o);r.setStart(s,o);r.setEnd(s,o)}var u=document.createElement("br");r.insertNode(u);e.getSelection().collapse(u.parentNode,1+D(u));r.setStart(u.parentNode,1+D(u));r.setEnd(u.parentNode,1+D(u));if(mt(u)){r.insertNode(Nn());e.getSelection().collapse(u.parentNode,1+D(u));r.setStart(u.parentNode,1+D(u));r.setEnd(u.parentNode,1+D(u))}if(i.browser.msie&&i.browser.version<8){u.parentNode.removeAttribute("style")}}};f.insertorderedlist={action:function(e,t){zn("ol",t)},indeterm:function(){return/^mixed( ol)?$/.test(Mn())},state:function(){return Mn()=="ol"}};var $n={LI:true,DT:true,DD:true};f.insertparagraph={action:function(n,r){var i;Fn(r);qn(dt(r.startContainer),r);if(!ht(r.startContainer)&&!ct(r.startContainer)){return}var s=r.startContainer;var o=r.startOffset;if(s.nodeType==t.Node.TEXT_NODE&&o!=0&&o!=P(s)){s.splitText(o)}if(s.nodeType==t.Node.TEXT_NODE&&o==P(s)){o=1+D(s);s=s.parentNode}if(s.nodeType==t.Node.TEXT_NODE||s.nodeType==t.Node.COMMENT_NODE){o=D(s);s=s.parentNode}e.getSelection().collapse(s,o);r.setStart(s,o);r.setEnd(s,o);var u=s;while(!Sn(u)&&ht(u.parentNode)&&vt(s,u.parentNode)){u=u.parentNode}if(!ht(u)||!vt(u,s)||!Sn(u)){var a=xn;var f=On(r);var l=F(f,function(e){return Vt(e,"p")}).slice(0,1);if(!l.length){if(!Vt(a,r.startContainer)){return}u=document.createElement(a);r.insertNode(u);u.appendChild(Nn());e.getSelection().collapse(u,0);r.setStart(u,0);r.setEnd(u,0);return}while(l[l.length-1].nextSibling&&Vt(l[l.length-1].nextSibling,"p")){l.push(l[l.length-1].nextSibling)}u=jt(l,function(){return false},function(){return document.createElement(a)},r)}if(!u){return}var c,h;if(u.tagName=="ADDRESS"||u.tagName=="LISTING"||u.tagName=="PRE"){var d=document.createElement("br");c=u.offsetHeight;r.insertNode(d);h=u.offsetHeight;e.getSelection().collapse(s,o+1);r.setStart(s,o+1);r.setEnd(s,o+1);if(c==h&&!T(w(d),u)){r.insertNode(Nn());e.getSelection().collapse(s,o+1);r.setEnd(s,o+1)}return}if($n[u.tagName]&&(!u.hasChildNodes()||u.childNodes.length==1&&p(u.firstChild,"br"))){yn([u],r);if(v(u,["dd","dt"])&&t(k(u)).every(function(e){return!vt(u,e)||!Vt(u,e)})){u=Dt(u,xn,r)}kn(u,r);if(p(u,"li")&&p(u.nextSibling,"li")&&v(u.nextSibling.firstChild,["ol","ul"])){var m=u.nextSibling,g=u.nextSibling.childNodes.length;for(i=0;i<g;i++){u.appendChild(m.childNodes[0])}m.parentNode.removeChild(m)}return}var y=e.createRange();y.setStart(r.startContainer,r.startOffset);y.setEnd(u,P(u));while(y.startOffset==0&&y.startContainer!=u){y.setStart(y.startContainer.parentNode,D(y.startContainer))}while(y.startOffset==P(y.startContainer)&&y.startContainer!=u){y.setStart(y.startContainer.parentNode,1+D(y.startContainer))}var b=F(y);var E=!b.length||b.length==1&&p(b[0],"br");var S;if(/^H[1-6]$/.test(u.tagName)&&E){S=xn}else if(u.tagName=="DT"&&E){S="dd"}else if(u.tagName=="DD"&&E){S="dt"}else{S=u.tagName.toLowerCase()}var x=document.createElement(S);_t(u,x);x.removeAttribute("id");u.parentNode.insertBefore(x,u.nextSibling);var N=I(y);var C=y.extractContents();var A=L(C);for(i=0;i<A.length;i++){if(A[i].nodeType==t.Node.ELEMENT_NODE&&t(N).indexOf(A[i])==-1){A[i].removeAttribute("id")}}var O=[],M=C.firstChild;if(M){do{if(!yt(M)){O.push(M)}}while(null!=(M=M.nextSibling))}if(p(x,"li")&&O.length&&v(O[0],["ul","ol"])){c=x.offsetHeight;var _=Nn();x.appendChild(_);h=x.offsetHeight;if(c!==h){x.removeChild(_)}}x.appendChild(C);Cn(u);Cn(x);e.getSelection().collapse(x,0);r.setStart(x,0);r.setEnd(x,0)}};f.inserttext={action:function(n,r){var s;Fn(r,{stripWrappers:false});if(!ht(r.startContainer)&&!ct(r.startContainer)){return}if(n.length>1){for(s=0;s<n.length;s++){f.inserttext.action(n[s],r)}return}if(n==""){return}if(n=="\n"){f.insertparagraph.action("",r);return}var o=r.startContainer;var u=r.startOffset;if(0<=u-1&&u-1<o.childNodes.length&&o.childNodes[u-1].nodeType==t.Node.TEXT_NODE){o=o.childNodes[u-1];u=P(o)}if(0<=u&&u<o.childNodes.length&&o.childNodes[u].nodeType==t.Node.TEXT_NODE){o=o.childNodes[u];u=0}var a=o.nodeType==t.Node.ELEMENT_NODE?o:o.parentNode;if(n==" "&&a.nodeType==t.Node.ELEMENT_NODE&&i.inArray(t.getComputedStyle(a).whiteSpace,["pre","pre-wrap"])==-1){n=""}var l=Dn(r);if(o.nodeType==t.Node.TEXT_NODE){o.insertData(u,n);e.getSelection().collapse(o,u);r.setStart(o,u);e.getSelection().extend(o,u+1);r.setEnd(o,u+1)}else{if(o.childNodes.length==1&&mt(o.firstChild)){o.removeChild(o.firstChild)}var c=document.createTextNode(n);r.insertNode(c);e.getSelection().collapse(c,0);r.setStart(c,0);e.getSelection().extend(c,1);r.setEnd(c,1)}Hn(l,r);jn(r.startContainer,r.startOffset);jn(r.endContainer,r.endOffset);e.getSelection().collapseToEnd();r.collapse(false)}};f.insertunorderedlist={action:function(e,t){zn("ul",t)},indeterm:function(){return/^mixed( ul)?$/.test(Mn())},state:function(){return Mn()=="ul"}};f.justifycenter={action:function(e,t){Wn("center",t)},indeterm:function(){var e=I(On(Ot()),function(e){return ht(e)&&Et(e)&&!e.hasChildNodes()});return t(e).some(function(e){return _n(e)=="center"})&&t(e).some(function(e){return _n(e)!="center"})},state:function(){var e=I(On(Ot()),function(e){return ht(e)&&Et(e)&&!e.hasChildNodes()});return e.length&&t(e).every(function(e){return _n(e)=="center"})},value:function(){var e=I(On(Ot()),function(e){return ht(e)&&Et(e)&&!e.hasChildNodes()});if(e.length){return _n(e[0])}return"left"}};f.justifyfull={action:function(e,t){Wn("justify",t)},indeterm:function(){var e=I(On(Ot()),function(e){return ht(e)&&Et(e)&&!e.hasChildNodes()});return t(e).some(function(e){return _n(e)=="justify"})&&t(e).some(function(e){return _n(e)!="justify"})},state:function(){var e=I(On(Ot()),function(e){return ht(e)&&Et(e)&&!e.hasChildNodes()});return e.length&&t(e).every(function(e){return _n(e)=="justify"})},value:function(){var e=I(On(Ot()),function(e){return ht(e)&&Et(e)&&!e.hasChildNodes()});if(e.length){return _n(e[0])}return"left"}};f.justifyleft={action:function(e,t){Wn("left",t)},indeterm:function(){var e=I(On(Ot()),function(e){return ht(e)&&Et(e)&&!e.hasChildNodes()});return t(e).some(function(e){return _n(e)=="left"})&&t(e).some(function(e){return _n(e)!="left"})},state:function(){var e=I(On(Ot()),function(e){return ht(e)&&Et(e)&&!e.hasChildNodes()});return e.length&&t(e).every(function(e){return _n(e)=="left"})},value:function(){var e=I(On(Ot()),function(e){return ht(e)&&Et(e)&&!e.hasChildNodes()});if(e.length){return _n(e[0])}return"left"}};f.justifyright={action:function(e,t){Wn("right",t)},indeterm:function(){var e=I(On(Ot()),function(e){return ht(e)&&Et(e)&&!e.hasChildNodes()});return t(e).some(function(e){return _n(e)=="right"})&&t(e).some(function(e){return _n(e)!="right"})},state:function(){var e=I(On(Ot()),function(e){return ht(e)&&Et(e)&&!e.hasChildNodes()});return e.length&&t(e).every(function(e){return _n(e)=="right"})},value:function(){var e=I(On(Ot()),function(e){return ht(e)&&Et(e)&&!e.hasChildNodes()});if(e.length){return _n(e[0])}return"left"}};f.outdent={action:function(){var e=[];(function(){var t;for(t=Ot().endContainer;t!=Ot().commonAncestorContainer;t=t.parentNode){if(p(t,"li")){e.unshift(t)}}for(t=Ot().startContainer;t;t=t.parentNode){if(p(t,"li")){e.unshift(t)}}})();t(e).forEach(function(e){Ln(e,Ot())});var n=On(Ot());var r=F(n,function(e){return ht(e)&&(!t(L(e)).some(ht)||v(e,["ol","ul"])||p(e,"li")&&v(e.parentNode,["ol","ul"]))});while(r.length){while(r.length&&(v(r[0],["OL","UL"])||!v(r[0].parentNode,["OL","UL"]))){Un(r.shift(),n)}if(!r.length){break}var i=[];i.push(r.shift());while(r.length&&r[0]==i[i.length-1].nextSibling&&!v(r[0],["OL","UL"])){i.push(r.shift())}var s=sn(i);yn(i,n);t(i).forEach(kn);fn(s,n)}}};f.selectall={action:function(){var t=document.body;if(!t){t=document.documentElement}if(!t){e.getSelection().removeAllRanges()}else{e.getSelection().selectAllChildren(t)}}};f.stylewithcss={action:function(e){u=String(e).toLowerCase()!="false"},state:function(){return u}};f.usecss={action:function(e){u=String(e).toLowerCase()=="false"}};(function(){var e=[];var n;for(n in f){if(f.hasOwnProperty(n)){e.push(n)}}t(e).forEach(function(e){if(null==f[e].relevantCssProperty){f[e].relevantCssProperty=null}if(null!=f[e].inlineCommandActivatedValues&&null==f[e].indeterm){f[e].indeterm=function(n){var r=t(Kt(n,function(e){return ht(e)&&e.nodeType==t.Node.TEXT_NODE})).map(function(t){return en(t,e)});var i=t(r).filter(function(n){return t(f[e].inlineCommandActivatedValues).indexOf(n)!=-1});return i.length>=1&&r.length-i.length>=1}}if(null!=f[e].inlineCommandActivatedValues){f[e].state=function(n){var r=Kt(n,function(e){return ht(e)&&e.nodeType==t.Node.TEXT_NODE});if(r.length==0){return t(f[e].inlineCommandActivatedValues).indexOf(en(n.startContainer,e))!=-1}return t(r).every(function(n){return t(f[e].inlineCommandActivatedValues).indexOf(en(n,e))!=-1})}}if(null!=f[e].standardInlineValueCommand){f[e].indeterm=function(){var n=t(Kt(Ot())).filter(function(e){return ht(e)&&e.nodeType==t.Node.TEXT_NODE},true).map(function(t){return en(t,e)});var r;for(r=1;r<n.length;r++){if(n[r]!=n[r-1]){return true}}return false};f[e].value=function(n){var r=Kt(n,function(e){return ht(e)&&e.nodeType==t.Node.TEXT_NODE})[0];if(typeof r=="undefined"){r=n.startContainer}return en(r,e)}}})})();return{commands:f,execCommand:tt,queryCommandIndeterm:nt,queryCommandState:rt,queryCommandValue:st,queryCommandEnabled:Z,queryCommandSupported:it,copyAttributes:_t,createEndBreak:Nn,isEndBreak:Tn,ensureContainerEditable:Cn,isEditingHost:ct,isEditable:ht,getStateOverride:U,setStateOverride:z,resetOverrides:W,unsetStateOverride:X}});define("aloha/selection",["aloha/core","jquery","util/class","util/range","util/arrays","util/strings","aloha/console","PubSub","aloha/engine","aloha/ecma5shims","aloha/rangy-core"],function(e,t,n,r,i,s,o,u,a,f){function c(e){var t;if(e.startContainer!==e.endContainer){return false}if(e.startContainer.nodeType!=1){return false}t=e.startContainer.firstChild;return!t||!t.nextSibling&&t.nodeName=="BR"}function h(e){if(e.startContainer!==e.endContainer){return false}if(e.startContainer.nodeType!=1){return false}return a.isEndBreak(e.startContainer)}function v(e,t){var n=[],r,i,s;if(1===e.nodeType&&e.nodeName!=="BODY"&&e.nodeName!=="HTML"){n.push(e.cloneNode(false).outerHTML)}else{n.push("#"+e.nodeType)}for(s=0,i=t.length;s<i;s++){r=t[s];if(r.nodeName==="BODY"||r.nodeName==="HTML"){break}n.push(r.cloneNode(false).outerHTML)}return n.join("")}function m(n,r){var s=e.activeEditable?e.activeEditable.obj.parent()[0]:null;var o=t(n).parentsUntil(s).get();var u=v(n,o);var a=r&&n===r.node&&i.equal(r.parents,o)&&u===r.html;return a?null:{node:n,parents:o,html:u}}function g(e,t){var n=e.startContainer;var r=e.endContainer;if(!n||!r){o.warn("aloha/selection","encountered range object without start or end container");return}var i=m(n,p);var s=m(r,d);if(!i&&!s){return}p=i;d=s;u.pub("aloha.selection.context-change",{range:e,event:t})}function b(e){var n;if(t.browser.msie&&e.startContainer===e.endContainer&&e.startOffset===e.endOffset&&e.startContainer.nodeType==3&&e.startOffset==e.startContainer.data.length&&e.startContainer.nextSibling){n=e.startContainer.nextSibling;if("OL"===n.nodeName||"UL"===n.nodeName){if(e.startContainer.data[e.startContainer.data.length-1]==" "){e.startOffset=e.endOffset=e.startOffset-1}else{e.startContainer.data=e.startContainer.data+" "}}}}function w(e){b(e);return e}var l=window.GENTICS;var p=null;var d=null;var y=n.extend({_constructor:function(){this.rangeObject={};this.preventSelectionChangedFlag=false;this.tagHierarchy={textNode:{},abbr:{textNode:true},b:{textNode:true,b:true,i:true,em:true,sup:true,sub:true,br:true,span:true,img:true,a:true,del:true,ins:true,u:true,cite:true,q:true,code:true,abbr:true,strong:true},pre:{textNode:true,b:true,i:true,em:true,sup:true,sub:true,br:true,span:true,img:true,a:true,del:true,ins:true,u:true,cite:true,q:true,code:true,abbr:true},blockquote:{textNode:true,b:true,i:true,em:true,sup:true,sub:true,br:true,span:true,img:true,a:true,del:true,ins:true,u:true,cite:true,q:true,code:true,abbr:true,p:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true},ins:{textNode:true,b:true,i:true,em:true,sup:true,sub:true,br:true,span:true,img:true,a:true,u:true,p:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true},ul:{li:true},ol:{li:true},li:{textNode:true,b:true,i:true,em:true,sup:true,sub:true,br:true,span:true,img:true,ul:true,ol:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,del:true,ins:true,u:true,a:true},tr:{td:true,th:true},table:{tr:true},div:{textNode:true,b:true,i:true,em:true,sup:true,sub:true,br:true,span:true,img:true,ul:true,ol:true,table:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,del:true,ins:true,u:true,p:true,div:true,pre:true,blockquote:true,a:true},h1:{textNode:true,b:true,i:true,em:true,sup:true,sub:true,br:true,span:true,img:true,a:true,del:true,ins:true,u:true}};this.tagHierarchy={textNode:this.tagHierarchy.textNode,abbr:this.tagHierarchy.abbr,br:this.tagHierarchy.textNode,img:this.tagHierarchy.textNode,b:this.tagHierarchy.b,strong:this.tagHierarchy.b,code:this.tagHierarchy.b,q:this.tagHierarchy.b,blockquote:this.tagHierarchy.blockquote,cite:this.tagHierarchy.b,i:this.tagHierarchy.b,em:this.tagHierarchy.b,sup:this.tagHierarchy.b,sub:this.tagHierarchy.b,span:this.tagHierarchy.b,del:this.tagHierarchy.del,ins:this.tagHierarchy.ins,u:this.tagHierarchy.b,p:this.tagHierarchy.b,pre:this.tagHierarchy.pre,a:this.tagHierarchy.b,ul:this.tagHierarchy.ul,ol:this.tagHierarchy.ol,li:this.tagHierarchy.li,td:this.tagHierarchy.li,div:this.tagHierarchy.div,h1:this.tagHierarchy.h1,h2:this.tagHierarchy.h1,h3:this.tagHierarchy.h1,h4:this.tagHierarchy.h1,h5:this.tagHierarchy.h1,h6:this.tagHierarchy.h1,table:this.tagHierarchy.table};this.replacingElements={h1:{p:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,pre:true,blockquote:true}};this.replacingElements={h1:this.replacingElements.h1,h2:this.replacingElements.h1,h3:this.replacingElements.h1,h4:this.replacingElements.h1,h5:this.replacingElements.h1,h6:this.replacingElements.h1,pre:this.replacingElements.h1,p:this.replacingElements.h1,blockquote:this.replacingElements.h1};this.allowedToStealElements={h1:{textNode:true}};this.allowedToStealElements={h1:this.allowedToStealElements.h1,h2:this.allowedToStealElements.h1,h3:this.allowedToStealElements.h1,h4:this.allowedToStealElements.h1,h5:this.allowedToStealElements.h1,h6:this.allowedToStealElements.h1,p:this.tagHierarchy.b}},SelectionTree:function(){this.domobj={};this.selection=undefined;this.children=[]},onChange:function(t,n,r){if(this.updateSelectionTimeout){window.clearTimeout(this.updateSelectionTimeout)}var i=this;this.updateSelectionTimeout=window.setTimeout(function(){var s=new e.Selection.SelectionRange(true);if(!s.startContainer||"HTML"===s.startContainer.nodeName||"BODY"===s.startContainer.nodeName){if(!this.updateSelectionTimeout){i.onChange(t,n,10+(r||5)*2)}return}e.Selection._updateSelection(n,s)},r||5)},preventSelectionChanged:function(){this.preventSelectionChangedFlag=true},isSelectionChangedPrevented:function(){var e=this.preventSelectionChangedFlag;this.preventSelectionChangedFlag=false;return e},isSelectionEditable:function(){return this.rangeObject.commonAncestorContainer&&t(this.rangeObject.commonAncestorContainer).contentEditable()},isFloatingMenuVisible:function(){var n=t(e.Selection.rangeObject.commonAncestorContainer).attr("data-aloha-floatingmenu-visible");if(n!=="undefined"){if(n==="true"){return true}return false}return false},updateSelection:function(e){return this._updateSelection(e,null)},_updateSelection:function(n,r){if(n&&n.originalEvent&&true===n.originalEvent.stopSelectionUpdate){return false}if(typeof r==="undefined"){return false}this.rangeObject=r=r||new e.Selection.SelectionRange(true);r.update();if(r&&r.startContainer&&r.endContainer){var i=t(r.commonAncestorContainer).closest(".aloha-editable").length>0;if(i){var s=!(3===r.startContainer.nodeType&&!t(r.startContainer.parentNode).contentEditable());var o=!(3===r.endContainer.nodeType&&!t(r.endContainer.parentNode).contentEditable());if(!s||!o){e.getSelection().removeAllRanges();return true}}}if(this.isSelectionChangedPrevented()){return true}e.trigger("aloha-selection-changed-before",[this.rangeObject,n]);e.trigger("aloha-selection-changed",[this.rangeObject,n]);g(this.rangeObject,n);e.trigger("aloha-selection-changed-after",[this.rangeObject,n]);return true},getSelectionTree:function(t){if(!t){return this.rangeObject.getSelectionTree()}if(!t.commonAncestorContainer){e.Log.error(this,"the rangeObject is missing the commonAncestorContainer");return false}this.inselection=false;if(l.Utils.Dom.doCleanup({merge:true},t)){t.update();t.select()}return this.recursiveGetSelectionTree(t,t.commonAncestorContainer)},recursiveGetSelectionTree:function(n,r){var i=t(r),s=0,o=this,u=[];i.contents().each(function(t){var i="none",a=false,f=false,l=false,c,h,p=false,d=false,v=false;if(n.isCollapsed()&&r===n.startContainer&&n.startOffset==t){u[s]=new e.Selection.SelectionTree;u[s].selection="collapsed";u[s].domobj=undefined;o.inselection=false;l=true;s++}if(!o.inselection&&!l){var m;try{m=this.nodeType}catch(g){return}switch(m){case 3:if(this===n.startContainer){o.inselection=true;i=n.startOffset>0?"partial":"full";a=n.startOffset;f=this.length}break;case 1:if(this===n.startContainer&&n.startOffset===0){o.inselection=true;i="full"}if(r===n.startContainer&&n.startOffset===t){o.inselection=true;i="full"}break}}if(o.inselection&&!l){if(i=="none"){i="full"}switch(this.nodeType){case 3:if(this===n.endContainer){o.inselection=false;if(n.endOffset<this.length){i="partial"}if(a===false){a=0}f=n.endOffset}break;case 1:if(this===n.endContainer&&n.endOffset===0){o.inselection=false}break}if(r===n.endContainer&&n.endOffset<=t){o.inselection=false;i="none"}}u[s]=new e.Selection.SelectionTree;u[s].domobj=this;u[s].selection=i;if(i=="partial"){u[s].startOffset=a;u[s].endOffset=f}u[s].children=o.recursiveGetSelectionTree(n,this);h=u[s].children.length;if(h>0){for(c=0;c<h;++c){switch(u[s].children[c].selection){case"none":p=true;break;case"full":v=true;break;case"partial":d=true;break}}if(d||v&&p){u[s].selection="partial"}else if(v&&!d&&!p){u[s].selection="full"}}s++});if(n.isCollapsed()&&r===n.startContainer&&n.startOffset==r.childNodes.length){u[s]=new e.Selection.SelectionTree;u[s].selection="collapsed";u[s].domobj=undefined}return u},getRangeObject:function(){return this.rangeObject},isRangeObjectWithinMarkup:function(n,r,i,s,o){var u=!r?n.startContainer:n.endContainer,a=this,f=t(u).parents(),l=false,c=-1;if(typeof s!=="undefined"&&typeof s!=="function"){e.Log.error(this,"parameter tagComparator is not a function")}if(typeof s==="undefined"){s=function(e,t){return a.standardTextLevelSemanticsComparator(e,t)}}if(f.length>0){f.each(function(){if(this===o){e.Log.debug(a,"reached limit dom obj");return false}if(s(this,i)){if(l===false){l=[]}e.Log.debug(a,"reached object equal to markup");c++;l[c]=this;return true}})}return l},standardSectionsAndGroupingContentComparator:function(t,n){if(t.nodeType!==1){e.Log.debug(this,"only element nodes (nodeType == 1) can be compared");return false}if(!n[0].nodeName){return false}var r=e.Selection.replacingElements[t.nodeName.toLowerCase()];return r&&r[n[0].nodeName.toLowerCase()]},standardTagNameComparator:function(t,n){if(t.nodeType===1){if(t.nodeName!=n[0].nodeName){return false}return true}e.Log.debug(this,"only element nodes (nodeType == 1) can be compared");return false},standardTextLevelSemanticsComparator:function(t,n){if(t.nodeType===1){if(t.nodeName!=n[0].nodeName){return false}if(!this.standardAttributesComparator(t,n)){return false}return true}e.Log.debug(this,"only element nodes (nodeType == 1) can be compared");return false},standardAttributesComparator:function(e,t){var n=s.words(e&&e.className||"");var r=s.words(t.length&&t[0].className||"");i.sortUnique(n);i.sortUnique(r);return i.equal(n,r)},changeMarkup:function(n,r,i){var s=r[0].tagName.toLowerCase(),o,u,l,p=this.isRangeObjectWithinMarkup(n,false,r,i,u),d=this.isRangeObjectWithinMarkup(n,true,r,i,u),v,m,g,y,b;var w;if(this.replacingElements[s]){l=n;n=new this.SelectionRange(n);if(e.activeEditable){o=e.activeEditable.obj.get(0)}else{o=t("body")}n.update(o);r.isReplacingElement=true}else{if(n.isCollapsed()){e.Log.debug(this,"early returning from applying markup because nothing is currently selected");return false}}if(e.activeEditable){u=e.activeEditable.obj[0]}else{u=t("body")}if(!r.isReplacingElement&&n.startOffset===0){if(null!=(g=this.getTextNodeSibling(false,n.commonAncestorContainer.parentNode,n.startContainer))){y=this.isRangeObjectWithinMarkup({startContainer:g,startOffset:0},false,r,i,u)}}if(!r.isReplacingElement&&n.endOffset===n.endContainer.length){if(null!=(v=this.getTextNodeSibling(true,n.commonAncestorContainer.parentNode,n.endContainer))){m=this.isRangeObjectWithinMarkup({startContainer:v,startOffset:0},false,r,i,u)}}if(!r.isReplacingElement&&p&&!d){e.Log.info(this,"markup 2 non-markup");this.prepareForRemoval(n.getSelectionTree(),r,i);t(p).addClass("preparedForRemoval");this.insertCroppedMarkups(p,n,false,i)}else if(!r.isReplacingElement&&p&&d){e.Log.info(this,"markup 2 markup");this.prepareForRemoval(n.getSelectionTree(),r,i);this.splitRelevantMarkupObject(p,d,n,i)}else if(!r.isReplacingElement&&(!p&&d||m||y)){e.Log.info(this,"non-markup 2 markup OR with next2markup");if(y&&m){b=new e.Selection.SelectionRange(n);b.startContainer=t(y[y.length-1]).textNodes()[0];b.startOffset=0;b.endContainer=t(m[m.length-1]).textNodes().last()[0];b.endOffset=b.endContainer.length;b.update();this.applyMarkup(b.getSelectionTree(),n,r,i);e.Log.info(this,"double extending previous markup(previous and after selection), actually wrapping it ...")}else if(y&&!m&&!d){this.extendExistingMarkupWithSelection(y,n,false,i);e.Log.info(this,"extending previous markup")}else if(y&&!m&&d){b=new e.Selection.SelectionRange(n);b.startContainer=t(y[y.length-1]).textNodes()[0];b.startOffset=0;b.endContainer=t(d[d.length-1]).textNodes().last()[0];b.endOffset=b.endContainer.length;b.update();this.applyMarkup(b.getSelectionTree(),n,r,i);e.Log.info(this,"double extending previous markup(previous and relevant at the end), actually wrapping it ...")}else if(!y&&m){this.extendExistingMarkupWithSelection(m,n,true,i);e.Log.info(this,"extending following markup backwards")}else{this.extendExistingMarkupWithSelection(d,n,true,i)}}else if(r.isReplacingElement||!p&&!d&&!y&&!m){e.Log.info(this,"non-markup 2 non-markup");if(c(n)){var E=r.clone();if(h(n)){E[0].appendChild(a.createEndBreak())}if(e.activeEditable&&t.browser.mozilla){e.activeEditable.obj.focus()}if(a.isEditable(n.startContainer)){a.copyAttributes(n.startContainer,E[0]);t(n.startContainer).after(E[0]).remove()}else if(a.isEditingHost(n.startContainer)){t(n.startContainer).append(E[0]);a.ensureContainerEditable(E[0])}l.startContainer=E[0];l.endContainer=E[0];l.startOffset=0;l.endOffset=0;return}this.applyMarkup(n.getSelectionTree(),n,r,i,{setRangeObject2NewMarkup:true});l.startContainer=n.startContainer;l.endContainer=n.endContainer;l.startOffset=n.startOffset;l.endOffset=n.endOffset}if(r.isReplacingElement){if(l&&l.startContainer.className&&l.startContainer.className.indexOf("preparedForRemoval")>-1){w=t(l.startContainer).parents(r[0].tagName).get(0);l.startContainer=w;n.startContainer=w}if(l&&l.endContainer.className&&l.endContainer.className.indexOf("preparedForRemoval")>-1){w=t(l.endContainer).parents(r[0].tagName).get(0);l.endContainer=w;n.endContainer=w}}t(".preparedForRemoval").zap();if(r.isReplacingElement){if(f.Node.ELEMENT_NODE===l.startContainer.nodeType&&l.startContainer.childNodes&&l.startContainer.childNodes.length<l.startOffset){l.startOffset=l.startContainer.childNodes.length;n.startOffset=l.startContainer.childNodes.length}if(f.Node.ELEMENT_NODE===l.endContainer.nodeType&&l.endContainer.childNodes&&l.endContainer.childNodes.length<l.endOffset){l.endOffset=l.endContainer.childNodes.length;n.endOffset=l.endContainer.childNodes.length}n.endContainer=l.endContainer;n.endOffset=l.endOffset;n.startContainer=l.startContainer;n.startOffset=l.startOffset;l.update();l.select()}else{n.update();n.select()}},areMarkupObjectsAsLongAsRangeObject:function(e,n,r){var i,s,o,u,a;if(r.startOffset!==0){return false}for(i=0,a=e.length;i<a;i++){s=t(e[i]);if(s.textNodes().first()[0]!==r.startContainer){return false}}for(i=0,u=n.length;i<u;i++){s=t(n[i]);o=s.textNodes().last()[0];if(o!==r.endContainer||o.length!=r.endOffset){return false}}return true},splitRelevantMarkupObject:function(e,n,r,i){t(e).addClass("preparedForRemoval");t(n).addClass("preparedForRemoval");if(this.areMarkupObjectsAsLongAsRangeObject(e,n,r)){return true}var s=this.intersectRelevantMarkupObjects(e,n);if(s){this.insertCroppedMarkups([s],r,false,i);this.insertCroppedMarkups([s],r,true,i)}else{this.insertCroppedMarkups(e,r,false,i);this.insertCroppedMarkups(n,r,true,i)}return true},intersectRelevantMarkupObjects:function(e,t){var n=false,r,i,s,o,u,a;if(!e||!t){return n}u=e.length;a=t.length;for(r=0;r<u;r++){i=e[r];for(s=0;s<a;s++){o=t[s];if(i===o){n=i}}}return n},extendExistingMarkupWithSelection:function(e,n,r,i){var s,o,u,a,f,l,c,h;if(!r){s=true}if(r){o=true}u=[];for(a=0,f=e.length;a<f;a++){u[a]=new this.SelectionRange;l=e[a];if(o&&!s){u[a].startContainer=n.startContainer;u[a].startOffset=n.startOffset;c=t(l).textNodes(true);h=c.length-1;u[a].endContainer=c[h];u[a].endOffset=c[h].length;u[a].update();this.applyMarkup(u[a].getSelectionTree(),n,this.getClonedMarkup4Wrapping(l),i,{setRangeObject2NewMarkup:true})}if(!o&&s){c=t(l).textNodes(true);u[a].startContainer=c[0];u[a].startOffset=0;u[a].endContainer=n.endContainer;u[a].endOffset=n.endOffset;u[a].update();this.applyMarkup(u[a].getSelectionTree(),n,this.getClonedMarkup4Wrapping(l),i,{setRangeObject2NewMarkup:true})}}return true},getClonedMarkup4Wrapping:function(e){var n=t(e.outerHTML).removeClass("preparedForRemoval").empty();if(n.attr("class").length===0){n.removeAttr("class")}return n},insertCroppedMarkups:function(e,n,r,i){var s,o,u,a,f,l,c;if(!r){s=true}else{o=true}a=[];for(f=0;f<e.length;f++){a[f]=new this.SelectionRange;l=e[f];if(s&&!o){c=t(l).textNodes(true);a[f].startContainer=c[0];a[f].startOffset=0;if(a[f].startContainer===n.startContainer&&a[f].startOffset===n.startOffset){continue}if(n.startOffset===0){a[f].endContainer=this.getTextNodeSibling(false,l,n.startContainer);a[f].endOffset=a[f].endContainer.length}else{a[f].endContainer=n.startContainer;a[f].endOffset=n.startOffset}a[f].update();this.applyMarkup(a[f].getSelectionTree(),n,this.getClonedMarkup4Wrapping(l),i,{setRangeObject2NextSibling:true})}if(!s&&o){a[f].startContainer=n.endContainer;a[f].startOffset=n.endOffset;u=t(l).textNodes(true);a[f].endContainer=u[u.length-1];a[f].endOffset=u[u.length-1].length;a[f].update();this.applyMarkup(a[f].getSelectionTree(),n,this.getClonedMarkup4Wrapping(l),i,{setRangeObject2PreviousSibling:true})}}return true},changeMarkupOnSelection:function(e){var t=this.getRangeObject();this.changeMarkup(t,e,this.getStandardTagComparator(e));l.Utils.Dom.doCleanup({merge:true},t);t.update();t.select();this.rangeObject=t},applyMarkup:function(t,n,r,i,s){var o,u,a,f;s=s||{};this.prepareForRemoval(t,r,i);o=this.optimizeSelectionTree4Markup(t,r,i);f=true;for(u=0;u<o.length;u++){a=o[u];if(a.wrappable){this.wrapMarkupAroundSelectionTree(a.elements,n,r,i,s)}else{e.Log.debug(this,"dive further into non-wrappable object");this.applyMarkup(a.element.children,n,r,i,s)}}},getMarkupType:function(n){var r=t(n)[0].nodeName.toLowerCase();if(n.outerHtml){e.Log.debug(this,"Node name detected: "+r+" for: "+n.outerHtml())}if(r=="#text"){return"textNode"}if(this.replacingElements[r]){return"sectionOrGroupingContent"}if(this.tagHierarchy[r]){return"textLevelSemantics"}e.Log.warn(this,"unknown markup passed to this.getMarkupType(...): "+n.outerHtml())},getStandardTagComparator:function(e){var t=this,n;switch(this.getMarkupType(e)){case"textNode":n=function(e,t){return false};break;case"sectionOrGroupingContent":n=function(e,n){return t.standardSectionsAndGroupingContentComparator(e,n)};break;default:n=function(e,n){return t.standardTextLevelSemanticsComparator(e,n)};break}return n},prepareForRemoval:function(n,r,i){var s=this,o,u;if(typeof i!=="undefined"&&typeof i!=="function"){e.Log.error(this,"parameter tagComparator is not a function")}if(typeof i==="undefined"){i=this.getStandardTagComparator(r)}for(o=0;o<n.length;o++){u=n[o];if(u.domobj&&(u.selection=="full"||u.selection=="partial"&&r.isReplacingElement)){if(u.domobj.nodeType===1&&i(u.domobj,r)){e.Log.debug(this,"Marking for removal: "+u.domobj.nodeName);t(u.domobj).addClass("preparedForRemoval")}}if(u.selection!="none"&&u.children.length>0){this.prepareForRemoval(u.children,r,i)}}},wrapMarkupAroundSelectionTree:function(n,r,i,s,o){var u=[],a=-1,f=true,l="",c="",h,p,d,v,m,g,y;e.Log.debug(this,"The formatting <"+i[0].tagName+"> will be wrapped around the selection");for(m=0;m<n.length;m++){g=n[m];if(g.domobj&&!this.canTag1WrapTag2(g.domobj.parentNode.tagName.toLowerCase(),i[0].tagName.toLowerCase())){e.Log.info(this,"Skipping the wrapping of <"+i[0].tagName.toLowerCase()+"> because this tag is not allowed inside <"+g.domobj.parentNode.tagName.toLowerCase()+">");continue}if(g.domobj&&g.domobj.nodeType===3&&t.trim(g.domobj.nodeValue).length===0){continue}if(g.domobj&&g.selection=="partial"&&!i.isReplacingElement){if(g.startOffset!==undefined&&g.endOffset===undefined){a++;l+=g.domobj.data.substr(0,g.startOffset);g.domobj.data=g.domobj.data.substr(g.startOffset,g.domobj.data.length-g.startOffset);u[a]=g.domobj}else if(g.endOffset!==undefined&&g.startOffset===undefined){a++;c+=g.domobj.data.substr(g.endOffset,g.domobj.data.length-g.endOffset);g.domobj.data=g.domobj.data.substr(0,g.endOffset);u[a]=g.domobj}else if(g.endOffset!==undefined&&g.startOffset!==undefined){if(g.startOffset==g.endOffset){e.Log.debug(this,"skipping empty selection");continue}a++;l+=g.domobj.data.substr(0,g.startOffset);y=g.domobj.data.substr(g.startOffset,g.endOffset-g.startOffset);c+=g.domobj.data.substr(g.endOffset,g.domobj.data.length-g.endOffset);g.domobj.data=y;u[a]=g.domobj}else{e.Log.debug(this,"diving into object");this.applyMarkup(g.children,r,i,s,o)}}if(g.domobj&&(g.selection=="full"||g.selection=="partial"&&i.isReplacingElement)){a++;u[a]=g.domobj}}if(u.length>0){u=t(u);t.each(u,function(e,n){if(t.browser.msie&&n.nodeType==3&&!n.nextSibling&&!n.previousSibling&&n.parentNode&&n.parentNode.nodeName.toLowerCase()=="li"){n.data=t.trim(n.data)}});v=u.wrapAll(i).parent();v.before(l).after(c);if(o.setRangeObject2NewMarkup){d=u.textNodes();if(d.index(r.startContainer)!=-1){r.startOffset=0}if(d.index(r.endContainer)!=-1){r.endOffset=r.endContainer.length}f=true}if(o.setRangeObject2NextSibling){h=true;p=v.textNodes(true).last()[0];if(u.index(r.startContainer)!=-1){r.startContainer=this.getTextNodeSibling(h,v.parent(),p);r.startOffset=0}if(u.index(r.endContainer)!=-1){r.endContainer=this.getTextNodeSibling(h,v.parent(),p);r.endOffset=r.endOffset-p.length}}if(o.setRangeObject2PreviousSibling){h=false;p=v.textNodes(true).first()[0];if(u.index(r.startContainer)!=-1){r.startContainer=this.getTextNodeSibling(h,v.parent(),p);r.startOffset=0}if(u.index(r.endContainer)!=-1){r.endContainer=this.getTextNodeSibling(h,v.parent(),p);r.endOffset=r.endContainer.length}}}},getTextNodeSibling:function(e,n,r){var i=t(n).textNodes(true),s,o;o=i.index(r);if(o==-1){return false}s=o+(!e?-1:1);return i[s]||false},optimizeSelectionTree4Markup:function(e,n,r){var i=[],s=0,o=0,u=this,a,f,l,c;if(typeof r==="undefined"){r=function(e,t){return u.standardTextLevelSemanticsComparator(t)}}for(a=0;a<e.length;a++){if(e[a].domobj&&e[a].selection!="none"){if(n.isReplacingElement&&r(n[0],t(e[a].domobj))){if(i[s]!==undefined){s++}i[s]={};i[s].wrappable=true;i[s].elements=[];i[s].elements[o]=e[a];s++}else if(this.canMarkupBeApplied2ElementAsWhole([e[a]],n)){if(i[s]===undefined){i[s]={};i[s].wrappable=true;i[s].elements=[]}if(n.isReplacingElement){c=a;for(f=a-1;f>=0;f--){if(this.canMarkupBeApplied2ElementAsWhole([e[f]],n)&&this.isMarkupAllowedToStealSelectionTreeElement(e[f],n)){c=f}else{break}}l=a;for(f=a+1;f<e.length;f++){if(this.canMarkupBeApplied2ElementAsWhole([e[f]],n)&&this.isMarkupAllowedToStealSelectionTreeElement(e[f],n)){l=f}else{break}}o=0;for(f=c;f<=l;f++){i[s].elements[o]=e[f];i[s].elements[o].selection="full";o++}o=0}else{i[s].elements[o]=e[a];o++}}else{if(i[s]!==undefined){s++}i[s]={};i[s].wrappable=false;i[s].element=e[a];o=0;s++}}}return i},isMarkupAllowedToStealSelectionTreeElement:function(e,t){if(!e.domobj){return false}var n=e.domobj.nodeName.toLowerCase(),r=n=="#text"?"textNode":n,i=t[0].nodeName.toLowerCase(),s=this.allowedToStealElements[i];return s&&s[r]},canMarkupBeApplied2ElementAsWhole:function(e,t){var n,r,i,s;if(t.jquery){n=t[0].tagName}if(t.tagName){n=t.tagName}s=true;for(r=0;r<e.length;r++){i=e[r];if(i.domobj&&(i.selection!="none"||t.isReplacingElement)){if(!this.canTag1WrapTag2(n,i.domobj.nodeName)){return false}if(i.children.length>0&&!this.canMarkupBeApplied2ElementAsWhole(i.children,t)){return false}}}return s},canTag1WrapTag2:function(e,t){e=e=="#text"?"textNode":e.toLowerCase();t=t=="#text"?"textNode":t.toLowerCase();var n=this.tagHierarchy[e];if(!n){return true}if(!this.tagHierarchy[t]){return true}return n[t]},mayInsertTag:function(t){var n;if(typeof this.rangeObject.unmodifiableMarkupAtStart=="object"){for(n=0;n<this.rangeObject.unmodifiableMarkupAtStart.length;++n){if(!this.canTag1WrapTag2(this.rangeObject.unmodifiableMarkupAtStart[n].nodeName,t)){return false}}return true}e.Log.warn(this,"Unable to determine whether tag "+t+" may be inserted");return true},toString:function(){return"Aloha.Selection"},SelectionRange:l.Utils.RangeObject.extend({_constructor:function(e){this._super(e);if(e){if(e.commonAncestorContainer){this.commonAncestorContainer=e.commonAncestorContainer}if(e.selectionTree){this.selectionTree=e.selectionTree}if(e.limitObject){this.limitObject=e.limitObject}if(e.markupEffectiveAtStart){this.markupEffectiveAtStart=e.markupEffectiveAtStart}if(e.unmodifiableMarkupAtStart){this.unmodifiableMarkupAtStart=e.unmodifiableMarkupAtStart}if(e.splitObject){this.splitObject=e.splitObject}}},commonAncestorContainer:undefined,selectionTree:undefined,markupEffectiveAtStart:[],unmodifiableMarkupAtStart:[],limitObject:undefined,splitObject:undefined,select:function(){this._super();e.Selection.updateSelection()},update:function(e){this.updatelimitObject();this.updateMarkupEffectiveAtStart();this.updateCommonAncestorContainer(e);this.selectionTree=undefined},getSelectionTree:function(){if(!this.selectionTree){this.selectionTree=e.Selection.getSelectionTree(this)}return this.selectionTree},getSelectedSiblings:function(e){var t=this.getSelectionTree();return this.recursionGetSelectedSiblings(e,t)},recursionGetSelectedSiblings:function(e,t){var n=false,r=false,i;for(i=0;i<t.length;++i){if(t[i].domobj===e){r=true;n=[]}else if(!r&&t[i].children){n=this.recursionGetSelectedSiblings(e,t[i].children);if(n!==false){break}}else if(r&&t[i].domobj&&t[i].selection!="collapsed"&&t[i].selection!="none"){n.push(t[i].domobj)}else if(r&&t[i].selection=="none"){break}}return n},updateMarkupEffectiveAtStart:function(){this.markupEffectiveAtStart=[];this.unmodifiableMarkupAtStart=[];var e=this.getStartContainerParents(),t=false,n,r,i;for(r=0;r<e.length;r++){i=e[r];if(!t&&i!==this.limitObject){this.markupEffectiveAtStart[r]=i;if(!n&&l.Utils.Dom.isSplitObject(i)){n=true;this.splitObject=i}}else{t=true;this.unmodifiableMarkupAtStart.push(i)}}if(!n){this.splitObject=false}return},updatelimitObject:function(){if(e.editables&&e.editables.length>0){var n=this.getStartContainerParents(),r=e.editables,i,s,o,u;for(i=0;i<n.length;i++){s=n[i];for(o=0;o<r.length;o++){u=r[o].obj[0];if(s===u){this.limitObject=s;return true}}}}this.limitObject=t("body");return true},toString:function(e){if(!e){return"Aloha.Selection.SelectionRange"}return"Aloha.Selection.SelectionRange {start ["+this.startContainer.nodeValue+"] offset "+this.startOffset+", end ["+this.endContainer.nodeValue+"] offset "+this.endOffset+"}"}})});var E=n.extend({_constructor:function(e){this._nativeSelection=e;this.ranges=[];this.preventChange=false},anchorNode:null,anchorOffset:0,focusNode:null,focusOffset:0,isCollapsed:false,rangeCount:0,collapse:function(e,t){this._nativeSelection.collapse(e,t)},collapseToStart:function(){throw"NOT_IMPLEMENTED"},extend:function(e,t){},modify:function(e,t,n){},collapseToEnd:function(){this._nativeSelection.collapseToEnd()},selectAllChildren:function(e){throw"NOT_IMPLEMENTED"},deleteFromDocument:function(){throw"NOT_IMPLEMENTED"},getRangeAt:function(e){return w(this._nativeSelection.getRangeAt(e))},addRange:function(t){this._nativeSelection.addRange(t);this._nativeSelection._ranges[0]=w(t);e.Selection.updateSelection()},removeRange:function(e){this._nativeSelection.removeRange()},removeAllRanges:function(){this._nativeSelection.removeAllRanges()},refresh:function(e){},toString:function(){return"Aloha.Selection"},getRangeCount:function(){return this._nativeSelection.rangeCount}});e.getSelection=function(e){e=e!==document||e!==window?window:e;return new E(window.rangy.getSelection(e))};e.createRange=function(e){return window.rangy.createRange(e)};var S=new y;e.Selection=S;return S});define("aloha/block-jump",["aloha/core","jquery","aloha/console"],function(e,t,n){function i(e,n){e.deleteData(0,e.length);if(""!==n){if(e.nextSibling&&3===e.nextSibling.nodeType){e.nextSibling.insertData(0,n)}else if(e.previousSibling&&3===e.previousSibling.nodeType){e.previousSibling.insertData(e.previousSibling.length,n)}else{e.insertData(0,n)}}setTimeout(function(){if(0===e.length){t(e).remove()}},0)}function s(){if(!r){return}var e=r.nodeValue.replace(/\u200b/,"");if(e===r.nodeValue){n.warn("Expected to remove the zero width text node fix, but couldn't find it")}i(r,e);r=null}function o(n,i){s();r=document.createTextNode("");if(i){t(n).after(r)}else{t(n).before(r)}e.bind("aloha-selection-changed",function(t){s();e.unbind(t)});return r}var r=null;return{removeZeroWidthTextNodeFix:s,insertZeroWidthTextNodeFix:o}});define("aloha/markup",["aloha/core","util/class","util/html","jquery","aloha/ecma5shims","aloha/console","aloha/block-jump"],function(e,t,n,r,i,s,o){function f(e){return"BR"===e.nodeName}function l(e){return"false"===r(e).attr("contenteditable")}function c(e){return e&&3===e.nodeType}function h(e){return!e?0:c(e)?e.length:e.childNodes.length}function p(e){return 0<e.data.replace(/\s+/g,"").length}function d(e){if(!e){return null}if(e.nextSibling){if(c(e.nextSibling)&&!p(e.nextSibling)){return d(e.nextSibling)}if(f(e.nextSibling)&&e.nextSibling===e.parentNode.lastChild){return d(e.nextSibling)}if(""===e.nextSibling.innerHTML&&!l(e.nextSibling)){return d(e.nextSibling)}return e.nextSibling}if(e.parentNode){return d(e.parentNode)}return null}function v(e){if(!e){return null}if(e.previousSibling){if(c(e.previousSibling)&&!p(e.previousSibling)){return v(e.previousSibling)}if(""===e.previousSibling.innerHTML&&!l(e.previousSibling)){return v(e.previouSibling)}return e.previousSibling}if(e.parentNode){return v(e.parentNode)}return null}function m(e,t){return 0===t||t<=e.data.length-e.data.replace(/^\s+/,"").length}function g(e){return e.parent().hasClass("aloha-editable")}function y(e,t){var n=h(e);if(n===t){return true}var r=c(e);if(r&&e.data.replace(/\s+$/,"").length===t){return true}if(1===n&&!r){return f(e.childNodes[0])}return false}function b(e){r(e).stop(true).css({opacity:0}).fadeIn(0).delay(100).fadeIn(function(){r(e).css({opacity:1})});return e}function w(e,t){return a?i.compareDocumentPosition(e,t)&16:0<r(e).find(t).length}function E(e){var t=e.startContainer;var n=e.endContainer;var r=window.$_alohaPlaceholder;return r.is(t)||r.is(n)||w(r[0],t)||w(r[0],n)}function S(e){if(window.$_alohaPlaceholder&&!E(e)){if(0===window.$_alohaPlaceholder.html().replace(/^(&nbsp;)*$/,"").length){window.$_alohaPlaceholder.remove()}window.$_alohaPlaceholder=null}}function x(t,n,i){var s=new u.Utils.RangeObject;var a=n?v(t):d(t);if(!a||l(a)){var f=r("<div>&nbsp;</div>");if(n){r(t).before(f)}else{r(t).after(f)}s.startContainer=s.endContainer=f[0];s.startOffset=s.endOffset=0;S(s);window.$_alohaPlaceholder=f}else{var c=i.startContainer.nodeType===3&&i.startContainer===i.endContainer&&i.startContainer.nodeValue!==""&&(n?i.startOffset===1:i.endOffset+1===i.endContainer.length)||i.startContainer.nodeType===1&&(!i.startOffset||i.startContainer.childNodes[i.startOffset]&&i.startContainer.childNodes[i.startOffset].nodeType===1);if(c){var p=o.insertZeroWidthTextNodeFix(t,n);s.startContainer=s.endContainer=p;s.startOffset=s.endOffset=n?1:0}else{s.startContainer=s.endContainer=a;s.startOffset=s.endOffset=n?h(a):0;if(!n){o.insertZeroWidthTextNodeFix(t,true)}}S(s)}s.select();e.trigger("aloha-block-selected",t);e.Selection.preventSelectionChanged()}var u=window.GENTICS;var a=!!(r.browser.msie&&9>parseInt(r.browser.version,10));e.Markup=t.extend({keyHandlers:{},addKeyHandler:function(e,t){if(!this.keyHandlers[e]){this.keyHandlers[e]=[]}this.keyHandlers[e].push(t)},removeKeyHandler:function(e){if(this.keyHandlers[e]){this.keyHandlers[e]=null}},insertBreak:function(){var t=e.Selection.rangeObject,n,i,s;if(!t.isCollapsed()){this.removeSelectedMarkup()}s=r("<br/>");u.Utils.Dom.insertIntoDOM(s,t,e.activeEditable.obj);i=u.Utils.Dom.searchAdjacentTextNode(s.parent().get(0),u.Utils.Dom.getIndexInParent(s.get(0))+1,false);if(i){n=i.data.search(/\S/);if(n>0){i.data=i.data.substring(n)}}t.startContainer=t.endContainer=s.get(0).parentNode;t.startOffset=t.endOffset=u.Utils.Dom.getIndexInParent(s.get(0))+1;t.correctRange();t.clearCaches();t.select()},preProcessKeyStrokes:function(t){if(t.type!=="keydown"){return false}var r,i,s;if(this.keyHandlers[t.keyCode]){i=this.keyHandlers[t.keyCode];for(s=0;s<i.length;++s){if(!i[s](t)){return false}}}if(t.keyCode===37||t.keyCode===39){if(e.getSelection().getRangeCount()){r=e.getSelection().getRangeAt(0);if(this.processCursor(r,t.keyCode)){S(e.Selection.rangeObject);return true}}return false}if(t.keyCode===8){t.preventDefault();e.execCommand("delete",false);return false}if(t.keyCode===46){e.execCommand("forwarddelete",false);return false}if(t.keyCode===13){if(!t.shiftKey&&n.allowNestedParagraph(e.activeEditable)){e.execCommand("insertparagraph",false);return false}else{e.execCommand("insertlinebreak",false);return false}}return true},processCursor:function(t,n){if(!t.collapsed){return true}o.removeZeroWidthTextNodeFix();var i=t.startContainer,s=e.getSelection();if(!i){return true}var u,f;if(r.browser.msie&&parseInt(r.browser.version,10)<=7&&c(i)){if(n==37){f=t.startOffset;while(f>0&&i.data.charAt(f-1)===""){f--}if(f!=t.startOffset){t.setStart(t.startContainer,f);t.setEnd(t.startContainer,f);s=e.getSelection();s.removeAllRanges();s.addRange(t)}}else if(n==39){f=t.startOffset;while(f<i.data.length&&i.data.charAt(f)===""){f++}if(f!=t.startOffset){t.setStart(t.startContainer,f);t.setEnd(t.startContainer,f);s.removeAllRanges();s.addRange(t)}}}if(a&&!r(i).contentEditable()){var p=r(i).parents("[contenteditable=false]");var b=p.length>0;if(b){if(g(p)){u=p[0]}else{return true}}}var w;if(!u){w=37===n||38===n;f=t.startOffset;if(c(i)){if(w){var E=1===f;if(!E&&!m(i,f)){return true}}else if(!y(i,f)){return true}}else{i=i.childNodes[f===h(i)?f-1:f]}u=w?v(i):d(i)}if(l(u)){x(u,w,t);return false}return true},processShiftEnter:function(e){this.insertHTMLBreak(e.getSelectionTree(),e)},processEnter:function(e){if(e.splitObject){this.splitRangeObject(e)}else{this.insertHTMLBreak(e.getSelectionTree(),e)}},insertHTMLCode:function(t){var n=e.Selection.rangeObject;this.insertHTMLBreak(n.getSelectionTree(),n,r(t))},insertHTMLBreak:function(t,n,i){var s,o,a,f,l,c,h,p,d;i=i||r("<br/>");for(s=0,o=t.length;s<o;++s){a=t[s];f=a.domobj?r(a.domobj):undefined;if(a.selection!=="none"){if(a.selection=="collapsed"){if(s>0){l=r(t[s-1].domobj);l.after(i)}else{c=r(t[1].domobj);c.before(i)}n.startContainer=n.endContainer=i[0].parentNode;n.startOffset=n.endOffset=u.Utils.Dom.getIndexInParent(i[0])+1;n.correctRange()}else if(a.domobj&&a.domobj.nodeType===3){if(a.domobj.nextSibling&&a.domobj.nextSibling.nodeType==1&&e.Selection.replacingElements[a.domobj.nextSibling.nodeName.toLowerCase()]){f.after("<br/>")}if(this.needEndingBreak()){d=a.domobj;while(d){if(d.nextSibling){d=false}else{d=d.parentNode;if(u.Utils.Dom.isBlockLevelElement(d)||u.Utils.Dom.isListElement(d)){break}if(d===n.limitObject){d=false}}}if(d){r(d).append('<br class="aloha-cleanme" />')}}f.between(i,a.startOffset);p=0;h=i[0];while(h){h=h.previousSibling;++p}n.startContainer=i[0].parentNode;n.endContainer=i[0].parentNode;n.startOffset=p;n.endOffset=p;n.correctRange()}else if(a.domobj&&a.domobj.nodeType===1){if(f.parent().find("br.aloha-ephemera").length===0){r(n.limitObject).find("br.aloha-ephemera").remove();r(n.commonAncestorContainer).append(this.getFillUpElement(n.splitObject))}f.after(i);n.startContainer=n.commonAncestorContainer;n.endContainer=n.startContainer;n.startOffset=s+2;n.endOffset=s+2;n.update()}}}n.select()},needEndingBreak:function(){return!r.browser.msie},getSelectedText:function(){var t=e.Selection.rangeObject;if(t.isCollapsed()){return false}return this.getFromSelectionTree(t.getSelectionTree(),true)},getFromSelectionTree:function(e,t){var n="",i,s,o,u;for(i=0,s=e.length;i<s;i++){o=e[i];if(o.selection=="partial"){if(o.domobj.nodeType===3){n+=o.domobj.data.substring(o.startOffset,o.endOffset)}else if(o.domobj.nodeType===1&&o.children){if(t){n+=this.getFromSelectionTree(o.children,t)}else{u=r(o.domobj.outerHTML).empty();u.html(this.getFromSelectionTree(o.children,t));n+=u.outerHTML()}}}else if(o.selection=="full"){if(o.domobj.nodeType===3){n+=r(o.domobj).text()}else if(o.domobj.nodeType===1&&o.children){n+=t?r(o.domobj).text():r(o.domobj).outerHTML()}}}return n},getSelectedMarkup:function(){var t=e.Selection.rangeObject;return t.isCollapsed()?null:this.getFromSelectionTree(t.getSelectionTree(),false)},removeSelectedMarkup:function(){var t=e.Selection.rangeObject,n;if(t.isCollapsed()){return}n=new e.Selection.SelectionRange;this.removeFromSelectionTree(t.getSelectionTree(),n);n.update();u.Utils.Dom.doCleanup({merge:true,removeempty:true},e.Selection.rangeObject);e.Selection.rangeObject=n;n.correctRange();n.update();n.select();e.Selection.updateSelection()},removeFromSelectionTree:function(e,t){var n,i,s,o,a,f;for(s=0,f=e.length;s<f;s++){o=e[s];if(o.selection=="partial"){if(o.domobj.nodeType===3){i="";if(o.startOffset>0){i+=o.domobj.data.substring(0,o.startOffset)}if(o.endOffset<o.domobj.data.length){i+=o.domobj.data.substring(o.endOffset,o.domobj.data.length)}o.domobj.data=i;if(!t.startContainer){t.startContainer=t.endContainer=o.domobj;t.startOffset=t.endOffset=o.startOffset}}else if(o.domobj.nodeType===1&&o.children){this.removeFromSelectionTree(o.children,t);if(n){if(n.nodeName==o.domobj.nodeName){r(n).append(r(o.domobj).contents());r(o.domobj).remove()}}else{n=o.domobj}}}else if(o.selection=="full"){if(!t.startContainer){a=u.Utils.Dom.searchAdjacentTextNode(o.domobj.parentNode,u.Utils.Dom.getIndexInParent(o.domobj)+1,false,{blocklevel:false});if(a){t.startContainer=t.endContainer=a;t.startOffset=t.endOffset=0}else{t.startContainer=t.endContainer=o.domobj.parentNode;t.startOffset=t.endOffset=u.Utils.Dom.getIndexInParent(o.domobj)+1}}r(o.domobj).remove()}}},splitRangeObject:function(t,n){var i=r(t.splitObject),s,o,a;t.update(t.splitObject);s=t.getSelectionTree();a=this.getSplitFollowUpContainer(t);this.splitRangeObjectHelper(s,t,a);if(a.hasClass("preparedForRemoval")){a.removeClass("preparedForRemoval")}o=this.getInsertAfterObject(t,a);r(a).insertAfter(o);if(t.splitObject.nodeName.toLowerCase()==="li"&&!e.Selection.standardTextLevelSemanticsComparator(t.splitObject,a)){r(t.splitObject).remove()}t.startContainer=null;var f=a.contents();if(f.length>0&&f.get(0).nodeType==1&&f.get(0).nodeName.toLowerCase()==="br"){t.startContainer=a.get(0)}if(!t.startContainer){t.startContainer=a.textNodes(true,true).first().get(0)}if(!t.startContainer){t.startContainer=a.textNodes(false).first().parent().get(0)}if(t.startContainer){t.endContainer=t.startContainer;t.startOffset=0;t.endOffset=0}else{t.startContainer=t.endContainer=a.parent().get(0);t.startOffset=t.endOffset=u.Utils.Dom.getIndexInParent(a.get(0))}t.update();t.select()},getInsertAfterObject:function(t,n){var i,s,o;for(s=0;s<t.markupEffectiveAtStart.length;s++){o=t.markupEffectiveAtStart[s];if(o===t.splitObject){i=true}if(!i){continue}if(e.Selection.canTag1WrapTag2(r(o).parent()[0].nodeName,n[0].nodeName)){return o}}return false},getFillUpElement:function(e){if(r.browser.msie){return false}return r('<br class="aloha-cleanme"/>')},removeElementContentWhitespaceObj:function(e){var t=0,n=[],r,i,s;for(r=0;r<e.length;++r){i=e[r];if(i.isElementContentWhitespace){n[n.length]=r}}for(r=0;r<n.length;++r){s=n[r];e.splice(s-t,1);++t}},splitRangeObjectHelper:function(t,n,i,s){if(!i){e.Log.warn(this,"no followUpContainer, no inBetweenMarkup, nothing to do...")}var o=this.getFillUpElement(n.splitObject),a=r(n.splitObject),f=false,l,c,h,p,d,v,m;if(t.length>0){d=i.contents();if(d.length!==t.length){this.removeElementContentWhitespaceObj(d)}for(c=0,m=t.length;c<m;++c){l=t[c];if(l.selection==="none"&&f===false||l.domobj&&l.domobj.nodeType===3&&l===t[t.length-1]&&l.startOffset===l.domobj.data.length){if(i.textNodes().length>1||l.domobj.nodeType===1&&l.children.length===0){d.eq(c).remove()}else if(u.Utils.Dom.isSplitObject(i[0])){if(o){i.html(o)}else{i.empty()}}else{i.empty();i.addClass("preparedForRemoval")}continue}else{if(l.selection!=="none"){if(l.domobj&&l.domobj.nodeType===3&&l.startOffset!==undefined){h=l.domobj.data;if(l.startOffset>0){l.domobj.data=h.substr(0,l.startOffset)}else if(t.length>1){r(l.domobj).remove()}else{v=r(l.domobj).parent();if(u.Utils.Dom.isSplitObject(v[0])){if(o){v.html(o)}else{v.empty()}}else{v.remove()}}if(h.length-l.startOffset>0){d[c].data=h.substr(l.startOffset,h.length)}else if(d.length>1){d.eq(c).remove()}else if(u.Utils.Dom.isBlockLevelElement(i[0])){if(o){i.html(o)}else{i.empty()}}else{i.empty();i.addClass("preparedForRemoval")}}f=true;if(l.children.length>0){this.splitRangeObjectHelper(l.children,n,d.eq(c),s)}}else{if(l.selection==="none"&&f===true){p=r(l.domobj).remove()}}}}}else{e.Log.error(this,"can not split splitObject due to an empty selection tree")}a.find("br.aloha-ephemera:gt(0)").remove();i.find("br.aloha-ephemera:gt(0)").remove();a.find(".preparedForRemoval").remove();i.find(".preparedForRemoval").remove();if(a.contents().length===0&&u.Utils.Dom.isSplitObject(a[0])&&o){a.html(o)}if(i.contents().length===0&&u.Utils.Dom.isSplitObject(i[0])&&o){i.html(o)}},getSplitFollowUpContainer:function(e){var t=e.splitObject.nodeName.toLowerCase(),n,i,s;switch(t){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":s=r(e.splitObject).textNodes(":not(.aloha-cleanme)").last()[0];if(s&&e.startContainer===s&&e.startOffset===s.length){n=r("<p></p>");i=r(e.splitObject.outerHTML).contents();n.append(i);return n}break;case"li":if(e.startContainer.nodeName.toLowerCase()==="br"&&r(e.startContainer).hasClass("aloha-ephemera")){n=r("<p></p>");i=r(e.splitObject.outerHTML).contents();n.append(i);return n}if(!e.splitObject.nextSibling&&r.trim(r(e.splitObject).text()).length===0){n=r("<p></p>");return n}break}return r(e.splitObject.outerHTML)},transformDomObject:function(e,t,n){var i=r(e),s=r("<"+t+">"),o,u=i[0].cloneNode(false).attributes;if(u){for(o=0;o<u.length;++o){if(typeof u[o].specified==="undefined"||u[o].specified){s.attr(u[o].nodeName,u[o].nodeValue)}}}if(i[0].style&&i[0].style.cssText){s[0].style.cssText=i[0].style.cssText}i.contents().appendTo(s);i.replaceWith(s);if(n){if(n.startContainer==e){n.startContainer=s.get(0)}if(n.endContainer==e){n.endContainer=s.get(0)}}return s},toString:function(){return"Aloha.Markup"}});e.Markup=new e.Markup;return e.Markup});define("aloha/observable",["jquery"],function(e){var t=e;return{_eventHandlers:null,bind:function(e,t,n){this._eventHandlers=this._eventHandlers||{};if(!this._eventHandlers[e]){this._eventHandlers[e]=[]}this._eventHandlers[e].push({handler:t,scope:n||window})},unbind:function(e,n){this._eventHandlers=this._eventHandlers||{};if(!this._eventHandlers[e]){return}if(!n){this._eventHandlers[e]=[]}else{this._eventHandlers[e]=t.grep(this._eventHandlers[e],function(e){if(e.handler===n){return false}return true})}},trigger:function(e){this._eventHandlers=this._eventHandlers||{};if(!this._eventHandlers[e]){return}var n=[];t.each(arguments,function(e,t){if(e>0){n.push(t)}});t.each(this._eventHandlers[e],function(e,t){t.handler.apply(t.scope,n)})},unbindAll:function(){this._eventHandlers=null}}});define("aloha/registry",["jquery","aloha/observable","util/class"],function(e,t,n){return n.extend(t,{_entries:null,_ids:null,_constructor:function(){this._entries={};this._ids=[]},register:function(e,t){this._entries[e]=t;this._ids.push(e);this.trigger("register",t,e)},unregister:function(e){var t,n=this._entries[e];delete this._entries[e];for(t in this._ids){if(this._ids.hasOwnProperty(t)&&this._ids[t]===e){this._ids.splice(t,1);break}}this.trigger("unregister",n,e)},get:function(e){return this._entries[e]},has:function(e){return this._entries[e]?true:false},getEntries:function(){return e.extend({},this._entries)},getIds:function(){return e.extend([],this._ids)}})});define("aloha/contenthandlermanager",["aloha/core","aloha/registry","util/class"],function(e,t,n){var r=t.extend({createHandler:function(e){if(typeof e.handleContent!=="function"){throw"ContentHandler has no function handleContent()."}var t=n.extend({handleContent:function(e){}},e);return new t},handleContent:function(t,n,r){var i=this;var s=n?n.contenthandler:i.getIds();if(!s){return t}var o;var u;for(o=0;o<s.length;o++){u=i.get(s[o]);if(u){t=u.handleContent(t,n,r||e.activeEditable)}if(null===t){break}}return t}});return new r});define("util/trees",["jquery"],function(e){function t(t,n,r){var i=e.type(t),s,o,u,a,f,l;if("array"===i){o=r?t:[];u=0;for(f=0,a=t.length;f<a;f++){s=n(t[f]);if(s.length){o[u++]=s[0]}}if(u!==o.length){o=o.slice(0,u)}}else if("object"===i){o=r?t:{};for(l in t){if(t.hasOwnProperty(l)){s=n(t[l]);if(s.length){o[l]=s[0]}else{delete o[l]}}}}else{o=t}return o}function n(e,n){return t(e,n,true)}function r(e,t){var n,r,i;if(1===e.nodeType){r=e.firstChild;while(r){n=t(r);i=r.nextSibling;if(n.length){if(n[0]!==r){e.replaceChild(n[0],r)}}else{e.removeChild(r)}r=i}}return e}function i(e,t,n,r){return[n(t(r),e)]}function s(e,t,n,r){return[t(n(r,e))]}function o(e,t,n,r){return t(r)?[]:[n(r,e)]}function u(e,t,n,r){var i=n(r,e);return t(i)?[]:[i]}function a(e,t,n,r){function i(r){return e(i,t,n,r)}return i(r)[0]}function f(e,r,s){return a(i,r,s?n:t,e)}function l(e,r,i){return a(s,r,i?n:t,e)}function c(e,r,i){return a(o,r,i?n:t,e)}function h(e,r,i){return a(u,r,i?n:t,e)}function p(e,t,n){return a(i,t,r,n?e:e.cloneNode(true))}function d(e,t,n){return a(s,t,r,n?e:e.cloneNode(true))}function v(e,t,n){return a(o,t,r,n?e:e.cloneNode(true))}function m(e,t,n){return a(u,t,r,n?e:e.cloneNode(true))}function g(t){var n=e.type(t);return n!=="object"&&n!=="array"}function y(e,t,n){return[t(n,e)]}function b(e,r,i){function o(e){if(g(e)){return[r(e)]}return y(o,s,e)}var s=i?n:t;return o(e)[0]}function w(e){function n(e){return y(n,t,e)}return n(e)[0]}function E(e){var t=true;var n=[];b(e,function(e){n.push(e);return e},t);return n}return{prewalk:f,postwalk:l,preprune:c,postprune:h,prewalkDom:p,postwalkDom:d,prepruneDom:v,postpruneDom:m,isLeaf:g,leaves:b,clone:w,flatten:E,walk:t,walkInplace:n,walkDomInplace:r}});define("util/browser",["jquery"],function(e){return{ie7:e.browser.msie&&parseInt(e.browser.version,10)<8}});define("util/dom2",["aloha/core","jquery","util/functions","util/maps","util/arrays","util/strings","util/browser","util/dom","util/range"],function(e,t,n,r,i,s,o,u,a){function c(e,t,n){while(t){var r=t.nextSibling;e.insertBefore(t,n);t=r}}function p(e){var t=e.outerHTML;if(typeof t!=="undefined"){return t}try{return h?h.serializeToString(e):e.xml}catch(n){return e.xml}}function d(e){var t=[];var n=p(e.cloneNode(false));var r;while(null!=(r=l.exec(n))){t.push(r[1])}return t}function v(e){var n=[];var r=d(e);var i;var s;for(i=0,s=r.length;i<s;i++){var o=r[i];var u=t.attr(e,o);if(null==u){u=""}else{u=u.toString()}n.push([o,u])}return n}function m(e,t){var n={},r,i,o,u,a,f,l;for(f=0,a=e.length;f<a;f++){o=e[f];if(o.className){i=s.words(o.className);for(l=0;l<i.length;l++){u=i[l];if(t[u]){r=n[u];if(r){r.push(o)}else{n[u]=[o]}}}}}return n}function g(e,n){var i;if(o.ie7){i=e.getElementsByTagName("*")}else{i=t(e).find("."+r.keys(n).join(",."))}return m(i,n)}function y(e,n){var r,i={},s;for(r=0,s=n.length;r<s;r++){var o=n[r];i[o]=t.makeArray(e.getElementsByTagName(o))}return i}function b(e){var t=0;while(e.previousSibling){t++;e=e.previousSibling}return t}function w(e){var t=0;var n=e.firstChild;while(n){t+=1;n=n.nextSibling}return t}function E(e){if(1===e.nodeType){return w(e)}if(3===e.nodeType){return e.length}return 0}function S(e,t){return 1===e.nodeType&&t>=w(e)||3===e.nodeType&&t===e.length&&!e.nextSibling}function x(e,t){if(1===e.nodeType&&t<w(e)){e=e.childNodes[t]}else if(3===e.nodeType&&t===e.length){e=e.nextSibling||e.parentNode}return e}function T(e){var t=e.parentNode;c(t,e.firstChild,e);t.removeChild(e)}function N(e,t){e.parentNode.replaceChild(t,e);t.appendChild(e)}function C(e,t,n){if(n){t.appendChild(e)}else{t.parentNode.insertBefore(e,t)}}function k(e,t){this.node=e;this.atEnd=t}function L(e,t){return new k(e,t)}function A(e,t){return L(x(e,t),S(e,t))}function O(e,t){var n=[];var r=e.parentNode;while(r&&!t(r)){n.push(r);r=r.parentNode}return n}function M(e,t){var n=O(e,t);var r=n.length?n[n.length-1]:e;if(r.parentNode){n.push(r.parentNode)}return n}function _(e,t){if(t(e)){return[]}var n=O(e,t);n.unshift(e);return n}function D(e,t){if(t(e)){return[e]}var n=M(e,t);n.unshift(e);return n}function P(e,t){return _(e,function(e){return e===t})}function H(e,t){return D(e,function(e){return e===t})}function B(e,t,n){while(e&&!t(e,n)){e=e.nextSibling}return e}function j(e,t,n){while(e&&!t(e,n)){e=e.parentNode}return e}function F(e){return 3===e.nodeType}function I(e,t){var n=e.parentNode;var r=e.nodeValue;if(0===t||t>=r.length){return e}var i=document.createTextNode(r.substring(0,t));var s=document.createTextNode(r.substring(t,r.length));n.insertBefore(i,e);n.insertBefore(s,e);n.removeChild(e);return i}function q(e,t,n,r,i,s){if(t!==i){return}var o=s.length;if(n===0){t=s.parentNode;n=b(s)}else if(n<o){t=s}else if(n===o){t=s.parentNode;n=b(s)+1}else{var u=s.nextSibling;t=u;n-=o}e[r].call(e,t,n)}function R(e,t,n){if(3!==e.nodeType){return}var r=n.startContainer;var i=n.startOffset;var s=n.endContainer;var o=n.endOffset;var u=I(e,t);q(n,r,i,"setStart",e,u);q(n,s,o,"setEnd",e,u)}function U(e){var t=e.startContainer;var n=e.startOffset;R(t,n,e);var r=e.endContainer;var i=e.endOffset;R(r,i,e)}function z(e,t,n,r){while(e&&!n(e,r)){var i=e.nextSibling;t(e,r);e=i}}function W(e,t,r){z(e,t,n.returnFalse,r)}function X(e,t,n){if(1===e.nodeType){W(e.firstChild,function(e){X(e,t,n)})}t(e,n)}function V(e,t,n,r){z(e,t,function(e){return e===n},r)}function $(e){if(!e){return}this.startContainer=e.startContainer;this.startOffset=e.startOffset;this.endContainer=e.endContainer;this.endOffset=e.endOffset;this.commonAncestorContainer=e.commonAncestorContainer;this.collapsed=e.collapsed}function J(e,t){if(t.atEnd){e.setStart(t.node,w(t.node))}else{e.setStart(t.node.parentNode,b(t.node))}}function K(e,t){if(t.atEnd){e.setEnd(t.node,w(t.node))}else{e.setEnd(t.node.parentNode,b(t.node))}}function Q(e,t){e.setStart(t.startContainer,t.startOffset);e.setEnd(t.endContainer,t.endOffset)}function G(e){return new $(e)}function Y(e,t,n){if(e.collapsed){return}var r=A(e.startContainer,e.startOffset);var i=A(e.endContainer,e.endOffset);var s=false;while(!r.equals(i)&&t(r)&&r.next()){s=true}n=n||t;var o=false;if(3===e.endContainer.nodeType&&e.endOffset>0&&e.endOffset<e.endContainer.length&&i.next()){if(n(i)){i.prev()}}while(!i.equals(r)&&n(i)&&i.prev()){o=true}if(s){J(e,r)}if(o){K(e,i)}}function Z(e,t,n){n=n||t;Y(e,function(e){return e.atEnd||t(e.node)},function(e){var t=e.atEnd?e.node.lastChild:e.node.previousSibling;return!t||n(t)})}function et(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}function tt(e,t){if(!e.length){return}R(t.startContainer,t.startOffset,t);var n=x(t.startContainer,t.startOffset);var r=S(t.startContainer,t.startOffset);if(!r&&3===n.nodeType){n.insertData(0,e);t.setStart(n,0);t.setEnd(n,e.length);return}var i;if(!r){i=n.previousSibling}else{i=n.lastChild}if(i&&3===i.nodeType){i.insertData(i.length,e);t.setStart(i,i.length-e.length);t.setEnd(i,i.length);return}var s=document.createTextNode(e);C(s,n,r);t.setStart(s,0);t.setEnd(s,s.length)}function nt(e){e.setStart(e.endContainer,e.endOffset)}function rt(t){var n=e.createRange();n.setStart(t.startContainer,t.startOffset);n.setEnd(t.endContainer,t.endOffset);return n}function it(e){var t=new a(e);u.extendToWord(t);Q(e,t)}function st(e){return e.cloneNode(false)}function ot(e,n,r){t(e).css(n,null==r?"":r)}function ut(e,t){t=s.dashesToCamelCase(t);return e.nodeType===1?e.style[t]:null}function at(e,t){if(e.currentStyle){return e.currentStyle[t]}var n=e.ownerDocument;if(n.defaultView&&n.defaultView.getComputedStyle){var r=n.defaultView.getComputedStyle(e,null);if(r){return r[t]||r.getPropertyValue(t)}}return null}var f=/\s+/;var l=/\s([^\/<>\s=]+)(?:=(?:"[^"]*"|'[^']*'|[^>\/\s]+))?/g;var h=window.XMLSerializer&&new window.XMLSerializer;k.prototype.next=function(){var e=this.node;var t;if(this.atEnd||1!==e.nodeType){t=e.nextSibling;if(t){this.atEnd=false}else{t=e.parentNode;if(!t){return false}this.atEnd=true}this.node=t}else{t=e.firstChild;if(t){this.node=t}else{this.atEnd=true}}return true};k.prototype.prev=function(){var e=this.node;var t;if(this.atEnd){t=e.lastChild;if(t){this.node=t}else{this.atEnd=false}}else{t=e.previousSibling;if(t){if(1===e.nodeType){this.atEnd=true}}else{t=e.parentNode;if(!t){return false}}this.node=t}return true};k.prototype.equals=function(e){return e.node===this.node&&e.atEnd===this.atEnd};k.prototype.clone=function(e){return e(e.node,e.atEnd)};k.prototype.insert=function(e){return C(e,this.node,this.atEnd)};$.prototype.update=function(){if(!this.startContainer||!this.endContainer){return}this.collapsed=this.startContainer===this.endContainer&&this.startOffset===this.endOffset;var e=_(this.startContainer,n.returnFalse);var t=_(this.endContainer,n.returnFalse);this.commonAncestorContainer=i.intersect(e,t)[0]};$.prototype.setStart=function(e,t){this.startContainer=e;this.startOffset=t;this.update()};$.prototype.setEnd=function(e,t){this.endContainer=e;this.endOffset=t;this.update()};return{moveNextAll:c,attrNames:d,attrs:v,indexByClass:g,indexByName:y,indexByClassHaveList:m,outerHtml:p,removeShallow:T,wrap:N,insert:C,cursor:L,cursorFromBoundaryPoint:A,nodeAtOffset:x,isAtEnd:S,parentsUntil:O,parentsUntilIncl:M,childAndParentsUntil:_,childAndParentsUntilIncl:D,childAndParentsUntilNode:P,childAndParentsUntilInclNode:H,next:B,parent:j,isTextNode:F,nodeIndex:b,splitTextNode:I,splitTextContainers:U,walk:W,walkRec:X,walkUntil:z,walkUntilNode:V,stableRange:G,trimRange:Y,trimRangeClosingOpening:Z,setRangeFromRef:Q,setRangeStartFromCursor:J,setRangeEndFromCursor:K,splitTextNodeAdjustRange:R,insertSelectText:tt,areRangesEq:et,collapseToEnd:nt,extendToWord:it,rangeFromRangeObject:rt,cloneShallow:st,setStyle:ot,getStyle:ut,getComputedStyle:at,nodeLength:E}});define("util/misc",[],function(){function e(e,t){var n,r;for(n=0,r=e.length;n<r;n++){if(e[n].test(t)){return true}}return false}return{anyRx:e}});define("aloha/ephemera",["jquery","aloha/core","aloha/console","util/strings","util/trees","util/arrays","util/maps","util/dom2","util/functions","util/misc","util/browser","PubSub"],function(e,t,n,r,i,s,o,u,a,f,l,c){function d(e){var t,r;for(t=0,r=e.length;t<r;t++){if(-1===e[t].indexOf(p)){n.warn('Class "'+e[t]+'" was set to be ephemeral,'+"which hurts peformance."+' Add the common substring "'+p+'" to the class to fix this problem.');p=""}}}function v(){var e=Array.prototype.slice.call(arguments);o.fillKeys(h.classMap,e,true);d(e);c.pub("aloha.ephemera.classes",{ephemera:h,newClasses:e})}function m(){var e=Array.prototype.slice.call(arguments);o.fillKeys(h.attrMap,e,true);c.pub("aloha.ephemera.attributes",{ephemera:h,newAttributes:e})}function g(e){if(e){h=e}c.pub("aloha.ephemera",{ephemera:h});return h}function y(t){e(t).addClass("aloha-ephemera")}function b(t,n){t=e(t);var i=t.attr("data-aloha-ephemera-attr");if(null==i||""===i){i=n}else if(-1===s.indexOf(r.words(i),n)){i+=" "+n}t.attr("data-aloha-ephemera-attr",i);t.addClass("aloha-ephemera-attr")}function w(t){e(t).addClass("aloha-ephemera-wrapper")}function E(t){e(t).addClass("aloha-ephemera-filler")}function S(t){var n=e(t);var i=n.attr("data-aloha-ephemera-attr");var s;var o;if(!l.ie7){n.removeAttr("data-aloha-ephemera-attr")}if(typeof i==="string"){o=r.words(i);for(s=0;s<o.length;s++){n.removeAttr(o[s])}}}function x(e,t,n,r){var i=n[t];if(i){if(true===i){return true}if(-1!==s.indexOf(i,e.nodeName)){return true}}return f.anyRx(r,t)}function T(t,n){var r=null,i=u.attrNames(t),s,o,a;for(o=0,a=i.length;o<a;o++){s=i[o];if(x(t,s,n.attrMap,n.attrRxs)){r=r||e(t);r.removeAttr(s)}}}function N(t,n){var i=t.className;if(i&&-1!==i.indexOf(p)){var o=r.words(i);if(-1!==s.indexOf(o,"aloha-cleanme")||-1!==s.indexOf(o,"aloha-ephemera")){e.removeData(t);return false}if(-1!==s.indexOf(o,"aloha-ephemera-wrapper")||-1!==s.indexOf(o,"aloha-ephemera-filler")){u.moveNextAll(t.parentNode,t.firstChild,t.nextSibling);e.removeData(t);return false}if(-1!==s.indexOf(o,"aloha-ephemera-attr")){S(t)}var a=s.filter(o,function(e){return!n.classMap[e]});if(a.length!==o.length){if(0===a.length){e(t).removeAttr("class")}else{t.className=a.join(" ")}}}T(t,n);return true}function C(e,t,n){if(1===n.nodeType){if(!N(n,e)){return[]}n=i.walkDomInplace(n,t)}n=s.reduce(e.pruneFns,n,s.applyNotNull);if(!n){return[]}return[n]}function k(e,t){function n(e){return C(t,n,e)}t=t||h;return n(e)[0]}var h={classMap:{"aloha-ephemera-wrapper":true,"aloha-ephemera-filler":true,"aloha-ephemera-attr":true,"aloha-ephemera":true,"aloha-cleanme":true},attrMap:{hidefocus:true,hideFocus:true,tabindex:true,tabIndex:true,contenteditable:["TABLE"],contentEditable:["TABLE"]},attrRxs:[/^(?:nodeIndex|sizcache|sizset|jquery)[\w\d]*$/i],pruneFns:[]};var p="aloha-";return{ephemera:g,classes:v,attributes:m,markElement:y,markAttr:b,markWrapper:w,markFiller:E,prune:k,isAttrEphemeral:x}});define("aloha/copypaste",["jquery","aloha/core"],function(e,t){function n(n){if(!n||!n.commonAncestorContainer){return null}var r=e(n.commonAncestorContainer);return r.length?t.getEditableHost(r):null}function r(){var e=t.getSelection();return e.getRangeCount()?e.getRangeAt(0):null}function i(e){var n=t.createRange();var r=t.getSelection();n.setStart(e.startContainer,e.startOffset);n.setEnd(e.endContainer,e.endOffset);r.removeAllRanges();r.addRange(n)}function s(t){i({startContainer:t,endContainer:t,startOffset:0,endOffset:t.childNodes?t.childNodes.length:t.length});e(t).focus()}return{getEditableAt:n,getRange:r,selectAllOf:s,setSelectionAt:i}});define("aloha/command",["aloha/core","aloha/registry","aloha/engine","util/dom","aloha/contenthandlermanager"],function(e,t,n,r,i){var s={execCommand:function(t,s,o,u){var a={commandId:t,preventDefault:false};e.trigger("aloha-command-will-execute",a);if(a.preventDefault===true){return}if(!u){if(!e.getSelection().getRangeCount()){return}u=e.getSelection().getRangeAt(0)}if(t.toLowerCase()==="inserthtml"){o=i.handleContent(o,{contenthandler:e.settings.contentHandler.insertHtml,command:"insertHtml"})}n.execCommand(t,s,o,u);if(e.getSelection().getRangeCount()){u=e.getSelection().getRangeAt(0);var f=u.commonAncestorContainer;if(f.parentNode){f=f.parentNode}var l=new window.GENTICS.Utils.RangeObject;l.startContainer=u.startContainer;l.startOffset=u.startOffset;l.endContainer=u.endContainer;l.endOffset=u.endOffset;r.doCleanup({merge:true,removeempty:false},l,f);l.select()}e.trigger("aloha-command-executed",t)},queryCommandEnabled:function(t,r){if(!r){if(!e.getSelection().getRangeCount()){return}r=e.getSelection().getRangeAt(0)}return n.queryCommandEnabled(t,r)},queryCommandIndeterm:function(t,r){if(!r){if(!e.getSelection().getRangeCount()){return}r=e.getSelection().getRangeAt(0)}return n.queryCommandIndeterm(t,r)},queryCommandState:function(t,r){if(!r){if(!e.getSelection().getRangeCount()){return}r=e.getSelection().getRangeAt(0)}return n.queryCommandState(t,r)},queryCommandSupported:function(e){return n.queryCommandSupported(e)},queryCommandValue:function(t,r){if(!r){if(!e.getSelection().getRangeCount()){return}r=e.getSelection().getRangeAt(0)}return n.queryCommandValue(t,r)},querySupportedCommands:function(){var e=[],t;for(t in n.commands){if(n.commands.hasOwnProperty(t)){e.push(t)}}return e},getStateOverride:n.getStateOverride,setStateOverride:n.setStateOverride,resetOverrides:n.resetOverrides,unsetStateOverride:n.unsetStateOverride};s=new(t.extend(s));e.execCommand=s.execCommand;e.queryCommandEnabled=s.queryCommandEnabled;e.queryCommandIndeterm=s.queryCommandIndeterm;e.queryCommandState=s.queryCommandState;e.queryCommandSupported=s.queryCommandSupported;e.queryCommandValue=s.queryCommandValue;e.querySupportedCommands=s.querySupportedCommands;return s});define("aloha/state-override",["aloha/core","jquery","aloha/command","util/dom2","util/maps","util/range","PubSub"],function(e,t,n,r,i,s,o){function l(e){return new s(e)}function c(){f=null;a=null}function h(t){if(!a){return}if(t.altKey||t.ctrlKey||!t.which){return}var n=e.getSelection();if(!n.getRangeCount()){return}var s=String.fromCharCode(t.which);var o=n.getRangeAt(0);r.insertSelectText(s,o);i.forEach(a,function(e,t){e(t,o)});r.collapseToEnd(o);n.removeAllRanges();n.addRange(o);t.preventDefault()}function p(e,t,n){if(!u){return}f=t;a=a||{};a[e]=n}function d(e,t,n){if(!u){return}p(e,r.rangeFromRangeObject(t),function(e,t){var i=l(t);n(e,i);r.setRangeFromRef(t,i)});t.select()}function v(e){if(null!=e){u=e}return u}var u=e.settings.stateOverride!==false;var a=null;var f=null;e.bind("aloha-selection-changed",function(e,t){if(f&&!r.areRangesEq(f,t)){c();o.pub("aloha.selection.context-change",{range:t,event:e})}});return{enabled:v,keyPressHandler:h,setWithRangeObject:d,set:p,clear:c}});define("aloha/editable",["aloha/core","util/class","jquery","aloha/pluginmanager","aloha/selection","aloha/markup","aloha/contenthandlermanager","aloha/console","aloha/block-jump","aloha/ephemera","util/dom2","PubSub","aloha/copypaste","aloha/command","aloha/state-override"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){function S(t){return o.handleContent(t.getContents(),{contenthandler:e.settings.contentHandler.smartContentChange},t)}function N(e){return e.altKey?"alt":e.ctrlKey?"ctrl":e.shiftKey?"shift":null}function C(t){if(!e.activeEditable){return}var n=x[t.which];if(n){var r=N(t);var i=(r?r+"+":"")+n;if(T[i]){return T[i](t)}}}var v=n;var m=window.unescape,g=window.GENTICS,y=false;var b={};e.defaults.contentHandler={};e.defaults.contentHandler.initEditable=["blockelement","sanitize"];e.defaults.contentHandler.getContents=["blockelement","sanitize","basic"];if(typeof e.settings.contentHandler==="undefined"){e.settings.contentHandler={}}var w=function(e){return v(e).html()};var E=w;var x={65:"a"};var T={"ctrl+a":function(){var e=h.getEditableAt(h.getRange());if(e){h.selectAllOf(e.obj[0]);return false}}};n(document).keydown(C);e.Editable=t.extend({_constructor:function(t){if(!t.attr("id")){t.attr("id",g.Utils.guid())}this.obj=t;this.originalObj=t;this.ready=false;this.sccDelimiters=[":",";",".","!","?",",",m("%u0009"),m("%u0020"),m("%u0008"),m("%u007F"),"Enter"];this.sccIdle=5e3;this.sccDelay=500;this.sccTimerIdle=false;this.sccTimerDelay=false;this.keyCodeMap={93:"Apps",18:"Alt",20:"CapsLock",17:"Control",40:"Down",35:"End",13:"Enter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",36:"Home",45:"Insert",37:"Left",224:"Meta",34:"PageDown",33:"PageUp",19:"Pause",44:"PrintScreen",39:"Right",145:"Scroll",16:"Shift",38:"Up",91:"Win",92:"Win"};this.placeholderClass="aloha-placeholder";e.registerEditable(this)},init:function(){var t=this;this.settings=e.settings;if(e.settings&&e.settings.smartContentChange){if(e.settings.smartContentChange.delimiters){this.sccDelimiters=e.settings.smartContentChange.delimiters}if(e.settings.smartContentChange.idle){this.sccIdle=e.settings.smartContentChange.idle}if(e.settings.smartContentChange.delay){this.sccDelay=e.settings.smartContentChange.delay}}if(!this.check(this.obj)){this.destroy();return}if(typeof e.settings.contentHandler.getContents==="undefined"){e.settings.contentHandler.getContents=e.defaults.contentHandler.getContents}if(typeof e.settings.contentHandler.initEditable==="undefined"){e.settings.contentHandler.initEditable=e.defaults.contentHandler.initEditable}var n=t.obj.html();n=o.handleContent(n,{contenthandler:e.settings.contentHandler.initEditable,command:"initEditable"},t);t.obj.html(n);e.bind("aloha-plugins-loaded",function(){t.obj.addClass("aloha-editable").contentEditable(true);t.obj.mousedown(function(n){if(!e.eventHandled){e.eventHandled=true;return t.activate(n)}});t.obj.mouseup(function(t){e.eventHandled=false});t.obj.focus(function(e){return t.activate(e)});var n=t.obj.add(".aloha-block",t.obj).keydown(function(e){var n=s.preProcessKeyStrokes(e);t.keyCode=e.which;if(!n){t.smartContentChange(e)}return n}).keypress(d.keyPressHandler);t.obj.keypress(function(t){e.activeEditable.smartContentChange(t)});t.obj.keyup(function(t){if(t.keyCode===27){e.deactivateEditable();return false}});t.obj.contentEditableSelectionChange(function(e){i.onChange(t.obj,e);return t.obj});t.setUnmodified();t.snapshotContent=t.getContents();if(v.browser.mozilla){t.initEmptyEditable()}t.initPlaceholder();t.ready=true;window.setTimeout(function(){e.disableObjectResizing()},20);e.trigger("aloha-editable-created",[t]);c.pub("aloha.editable.created",{data:t})})},isActive:false,originalContent:null,range:undefined,check:function(){var e=this,t=this.obj,n=t.get(0),r=n.nodeName.toLowerCase(),i=["a","abbr","address","article","aside","b","bdo","blockquote","cite","code","command","del","details","dfn","div","dl","em","footer","h1","h2","h3","h4","h5","h6","header","i","ins","menu","nav","p","pre","q","ruby","section","small","span","strong","sub","sup","var"],s,o;for(s=0;s<i.length;++s){if(r===i[s]){return true}}switch(r){case"label":case"button":break;case"textarea":case"input":o=v('<div id="'+this.getId()+'-aloha" class="aloha-'+r+'" />').insertAfter(t);o.height(t.height()).width(t.width()).html(t.val());t.hide();t.parents("form:first").submit(function(){t.val(e.getContents())});this.obj=o;return true;default:break}return false},initPlaceholder:function(){if(e.settings.placeholder&&this.isEmpty()){this.addPlaceholder()}},isEmpty:function(){var e=v.trim(this.getContents()),t=e==="<br>"?true:false;return e.length===0||t},initEmptyEditable:function(){var e=this.obj;if(this.empty(this.getContents())){v(e).prepend('<br class="aloha-cleanme" />')}},addPlaceholder:function(){var t=v("<div>"),n=v("<span>"),r,i=this.obj;if(g.Utils.Dom.allowsNesting(i[0],t[0])){r=t}else{r=n}if(v("."+this.placeholderClass,i).length!==0){return}v.each(e.settings.placeholder,function(e,t){if(i.is(e)){r.html(t)}});if(!r.is(":empty")){r.addClass(this.placeholderClass).addClass("aloha-ephemera");v(i).append(r)}v("br",i).remove()},removePlaceholder:function(e,t){var n=this.placeholderClass,r;if(v("."+this.placeholderClass,e).length===0){return}if(t===true){window.setTimeout(function(){r=new i.SelectionRange;r.startContainer=r.endContainer=e.get(0);r.startOffset=r.endOffset=0;v("."+n,e).remove();r.select()},100)}else{v("."+n,e).remove()}},destroy:function(){if(this===e.getActiveEditable()){this.blur()}switch(this.originalObj.get(0).nodeName.toLowerCase()){case"label":case"button":break;case"textarea":case"input":this.originalObj.val(this.getContents());this.obj.remove();this.originalObj.show();break;default:break}this.ready=false;this.removePlaceholder(this.obj);this.obj.removeClass("aloha-editable").contentEditable(false).unbind("mousedown click dblclick focus keydown keypress keyup");e.trigger("aloha-editable-destroyed",[this]);c.pub("aloha.editable.destroyed",{data:this});e.unregisterEditable(this)},setUnmodified:function(){this.originalContent=this.getContents()},isModified:function(){return this.originalContent!==this.getContents()},toString:function(){return"Aloha.Editable"},isDisabled:function(){return!this.obj.contentEditable()||this.obj.contentEditable()==="false"},disable:function(){return this.isDisabled()||this.obj.contentEditable(false)},enable:function(){return this.isDisabled()&&this.obj.contentEditable(true)},activate:function(t){var n=e.getActiveEditable();if(y){y=false;return}if(t&&t.type==="focus"&&n!==null&&n.obj.parent().get(0)===t.currentTarget){return}if(this.isActive||this.isDisabled()){return}this.obj.addClass("aloha-editable-active");e.activateEditable(this);y=true;this.removePlaceholder(this.obj,true);y=false;this.isActive=true;e.trigger("aloha-editable-activated",{oldActive:n,editable:this});c.pub("aloha.editable.activated",{data:{old:n,editable:this}})},blur:function(){this.obj.blur();this.isActive=false;this.initPlaceholder();this.obj.removeClass("aloha-editable-active");e.trigger("aloha-editable-deactivated",{editable:this});c.pub("aloha.editable.deactivated",{data:{editable:this}});e.activeEditable.smartContentChange({type:"blur"},null)},empty:function(e){return null===e||v.trim(e)===""||e==="<br/>"},getContents:function(t){var n=this.obj.html();var i=b[this.getId()];if(!i||n!==i.raw){a.removeZeroWidthTextNodeFix();var s=this.obj.clone(false);this.removePlaceholder(s);s=v(f.prune(s[0]));r.makeClean(s);s=v("<div>"+o.handleContent(s.html(),{contenthandler:e.settings.contentHandler.getContents,command:"getContents"},this)+"</div>");i=b[this.getId()]={};i.raw=n;i.element=s}if(t){return i.element.clone().contents()}if(null==i.serialized){i.serialized=E(i.element[0])}return i.serialized},setContents:function(t,n){var r=null;if(e.getActiveEditable()===this){e.deactivateEditable();r=this}this.obj.html(t);if(null!==r){r.activate()}this.smartContentChange({type:"set-contents"});return n?this.obj.contents():E(this.obj[0])},getId:function(){return this.obj.attr("id")},smartContentChange:function(t){function a(){if(null==o){o=n.getSnapshotContent()}return o}var n=this,r=null,i,s;if(t&&(t.metaKey||t.crtlKey||t.altKey)){return false}if(t&&t.originalEvent){i=new RegExp("U\\+(\\w{4})");s=i.exec(t.originalEvent.keyIdentifier);r=this.keyCodeMap[this.keyCode]||String.fromCharCode(t.which)||"unknown"}var o=null;if(v.inArray(r,this.sccDelimiters)>=0){clearTimeout(this.sccTimerIdle);clearTimeout(this.sccTimerDelay);this.sccTimerDelay=window.setTimeout(function(){e.trigger("aloha-smart-content-changed",{editable:n,keyIdentifier:t.originalEvent.keyIdentifier,keyCode:t.keyCode,"char":r,triggerType:"keypress",getSnapshotContent:a});S(n);u.debug("Aloha.Editable","smartContentChanged: event type keypress triggered")},this.sccDelay)}else if(t&&t.type==="paste"){e.trigger("aloha-smart-content-changed",{editable:n,keyIdentifier:null,keyCode:null,"char":null,triggerType:"paste",getSnapshotContent:a});S(n)}else if(t&&t.type==="blur"){e.trigger("aloha-smart-content-changed",{editable:n,keyIdentifier:null,keyCode:null,"char":null,triggerType:"blur",getSnapshotContent:a});S(n)}else if(t&&t.type==="block-change"){e.trigger("aloha-smart-content-changed",{editable:n,keyIdentifier:null,keyCode:null,"char":null,triggerType:"block-change",getSnapshotContent:a});S(n)}else if(r!==null){clearTimeout(this.sccTimerDelay);clearTimeout(this.sccTimerIdle);this.sccTimerIdle=window.setTimeout(function(){e.trigger("aloha-smart-content-changed",{editable:n,keyIdentifier:null,keyCode:null,"char":null,triggerType:"idle",getSnapshotContent:a});S(n)},this.sccIdle)}},getSnapshotContent:function(){var e=this.snapshotContent;this.snapshotContent=this.getContents();return e}});e.Editable.setContentSerializer=function(e){E=e};e.Editable.getContentSerializer=function(){return E}});define("aloha/plugin",["aloha/core","jquery","util/class","aloha/pluginmanager","aloha/console"],function(e,t,n,r,i){var s=n.extend({name:null,defaults:{},settings:{},dependencies:[],_constructor:function(e){if(typeof e!=="string"){i.error("Cannot initialise unnamed plugin, skipping")}else{this.name=e}},checkDependencies:function(){var n=this;var r=true;t.each(n.dependencies,function(t,s){if(!e.isPluginLoaded(s.toString())){r=false;i.error("plugin."+n.name,'Required plugin "'+s+'" not found.');return false}});return r},init:function(){},getEditableConfig:function(e){var n=null,r=false,i=this;if(this.settings.editables){t.each(this.settings.editables,function(s,o){var u;if(e.is(s)){r=true;if(o instanceof Array){n=[];n=t.merge(n,o)}else if(typeof o==="object"){n={};n["aloha-editable-selector"]=s;for(u in o){if(o.hasOwnProperty(u)){if(o[u]instanceof Array){n[u]=o[u]}else if(typeof o[u]==="object"){n[u]={};n[u]=t.extend(true,n[u],i.config[u],o[u])}else{n[u]=o[u]}}}}else{n=o}}})}if(!r){if(typeof this.settings.config==="undefined"||!this.settings.config){n=this.config}else{n=this.settings.config}}return n},makeClean:function(e){},getUID:function(e){i.deprecated("plugin","getUID() is deprecated. Use plugin.name instead.");return this.name},toString:function(){return this.name},log:function(e,t){i.deprecated("plugin","log() is deprecated. Use Aloha.console instead.");i.log(e,this,t)}});s.create=function(n,i){var o=new(s.extend(i))(n);o.settings=t.extendObjects(true,o.defaults,e.settings[n]);r.register(o);return o};return s});define("aloha/jquery.aloha",["aloha/core","aloha/selection","jquery","aloha/console"],function(e,t,n,r){function s(e,t,n,r){if(t!==r.target&&(/textarea|input|select/i.test(r.target.nodeName)||r.target.type==="text")){return}return e.apply(t,n)}function o(e){var t,r,i,o;if(typeof e.data!=="string"){return}t=e.handler;r=e.data.toLowerCase().split(" ");i={};for(o=0;o<r.length;o++){i[r[o]]=true}e.handler=function(e){if(this!==e.target){return}var r=e.type!=="keypress"&&n.hotkeys.specialKeys[e.which],o="",u;if(e.altKey&&r!=="alt"){o+="alt+"}if(e.ctrlKey&&r!=="ctrl"){o+="ctrl+"}if(e.metaKey&&!e.ctrlKey&&r!=="meta"){o+="meta+"}if(e.shiftKey&&r!=="shift"){o+="shift+"}if(r){if(i[o+r]){return s(t,this,arguments,e)}}else{u=String.fromCharCode(e.which).toLowerCase();if(i[o+u]){return s(t,this,arguments,e)}if(i[o+n.hotkeys.shiftNums[u]]){return s(t,this,arguments,e)}if(o==="shift+"){if(i[n.hotkeys.shiftNums[u]]){return s(t,this,arguments,e)}}}}}var i=window.XMLSerializer;n.fn.between=function(e,t){var n,r;if(this[0].nodeType!==3){n=this.children().size();if(t>n){t=n}if(t<=0){this.prepend(e)}else{this.children().eq(t-1).after(e)}}else{if(t<=0){this.before(e)}else if(t>=this[0].length){this.after(e)}else{r=this[0].data;this[0].data=r.substring(0,t);this.after(r.substring(t,r.length));this.after(e)}}};n.fn.contentEditable=function(e){var t=n(this);var i="contenteditable";if(n.browser.msie&&parseInt(n.browser.version,10)==7){i="contentEditable"}if(typeof e==="undefined"){if(typeof t[0]==="undefined"){r.warn("The jquery object did not contain any valid elements.");return undefined}if(typeof t[0].isContentEditable==="undefined"){r.warn("Could not determine whether the is editable or not. I assume it is.");return true}return t[0].isContentEditable}if(e===""){t.removeAttr(i)}else{if(e&&e!=="false"){e="true"}else{e="false"}t.attr(i,e)}return t};n.fn.aloha=function(){var t=this;e.bind("aloha-plugins-loaded",function(){t.each(function(t,r){if(!e.isEditable(r)){(new e.Editable(n(r))).init()}})});return t};n.fn.mahalo=function(){return this.each(function(){if(e.isEditable(this)){e.getEditableById(n(this).attr("id")).destroy()}})};n.fn.alohaText=function(){return this.each(function(){if(e.isEditable(this)){e.getEditableById(n(this).attr("id")).getContents()}})};n.fn.contentEditableSelectionChange=function(e){var r=this;this.keyup(function(n){var r=t.getRangeObject();e(n)});this.dblclick(function(t){e(t)});this.mousedown(function(e){r.selectionStarted=true});n(document).mouseup(function(n){t.eventOriginalTarget=r;if(r.selectionStarted){e(n)}t.eventOriginalTarget=false;r.selectionStarted=false});return this};n.fn.outerHtml=n.fn.outerHtml||function(){var e=n(this),t=e.get(0);if(typeof t.outerHTML!="undefined"){return t.outerHTML}try{return(new i).serializeToString(t)}catch(r){try{return t.xml}catch(s){}}};n.fn.zap=function(){return this.each(function(){n(this.childNodes).insertBefore(this)}).remove()};n.fn.textNodes=function(e,t){var r=[],i=function(s){var o,u;if(s.nodeType===3&&n.trim(s.data)&&!t||s.nodeType===3&&t||s.nodeName=="BR"&&!e){r.push(s)}else{for(o=0,u=s.childNodes.length;o<u;++o){i(s.childNodes[o])}}};i(this[0]);return n(r)};n.extendObjects=n.fn.extendObjects=function(e,t){var r,i,s,o,u,a,f=1,l=e||{},c=arguments.length,h=false,p;if(typeof l==="boolean"){h=l;l=t||{};f=2}if(typeof l!=="object"&&!n.isFunction(l)){l={}}if(c===f){l=this;--f}for(p=f;p<c;p++){if((r=arguments[p])!=null){for(i in r){if(r.hasOwnProperty(i)){s=l[i];o=r[i];if(l===o){continue}if(h&&o&&(n.isPlainObject(o)||true===(u=n.isArray(o)))){if(u){u=false;a=s&&n.isArray(s)?s:[]}else{a=s&&n.isPlainObject(s)?s:{}}if(n.isArray(o)){l[i]=o}else{l[i]=n.extendObjects(h,a,o)}}else if(o!==undefined){l[i]=o}}}}}return l};n.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",188:",",190:".",191:"/",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};n.each(["keydown","keyup","keypress"],function(){n.event.special[this]={add:o}})});define("aloha/sidebar",["aloha/core","jquery","aloha/selection","PubSub"],function(e,t,n,r){var i=+(new Date);if(!t.easing.easeOutExpo){t.extend(t.easing,{easeOutExpo:function(e,t,n,r,i){return t==i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n},easeOutElastic:function(e,t,n,r,i){var s=Math,o=1.70158,u=0,a=r;if(!t){return n}if((t/=i)==1){return n+r}if(!u){u=i*.3}if(a<s.abs(r)){a=r;o=u/4}else{o=u/(2*s.PI)*s.asin(r/a)}return a*s.pow(2,-10*t)*s.sin((t*i-o)*2*s.PI/u)+r+n}})}var s=function(n){this.id=null;this.folds={};this.button=null;this.title=t('<div class="aloha-sidebar-panel-title">'+'<span class="aloha-sidebar-panel-title-arrow"></span>'+'<span class="aloha-sidebar-panel-title-text">Untitled</span>'+"</div>");this.content=t('<div class="aloha-sidebar-panel-content">'+'<div class="aloha-sidebar-panel-content-inner">'+'<div class="aloha-sidebar-panel-content-inner-text"></div>'+"</div>"+"</div>");this.element=null;this.effectiveElement=null;this.expanded=false;this.isActive=true;this.init(n)};var o=function(r){var s=this;this.id="aloha-sidebar-"+ ++i;this.panels={};this.container=t('<div class="aloha-ui aloha-sidebar-bar">'+'<div class="aloha-sidebar-handle">'+'<span class="aloha-sidebar-handle-icon"></span>'+"</div>"+'<div class="aloha-sidebar-inner">'+'<ul class="aloha-sidebar-panels"></ul>'+"</div>"+"</div>");this.width=300;this.opened=false;this.isOpen=false;this.isCompletelyOpen=false;this.settings={rotateIcons:!t.browser.msie,overlayPage:true};t(function(){if(!(typeof e.settings.sidebar!=="undefined"&&e.settings.sidebar.disabled)){s.init(r)}})};var u=null;var a=null;t.extend(o.prototype,{init:function(e){var n=this;var r;if(typeof e==="object"){r=e.panels;delete e.panels}t.extend(this,e);if(typeof r==="object"){t.each(r,function(){n.addPanel(this,true)})}var i=this.container;if(this.position==="right"){i.addClass("aloha-sidebar-right")}i.hide().appendTo(t("body")).click(function(){n.barClicked.apply(n,arguments)}).find(".aloha-sidebar-panels").width(this.width);i.width(this.width);this.width=i.width();this.updateHeight();this.initToggler();this.container.css(this.position==="right"?"marginRight":"marginLeft",-this.width);if(this.opened){this.open(0)}this.toggleHandleIcon(this.isOpen);this.subscribeToEvents();t(window).resize(function(){n.updateHeight();n.correctHeight()});this.correctHeight()},show:function(){this.container.css("display","block");return this},hide:function(){this.container.css("display","none");return this},checkActivePanels:function(e){var n=[];if(typeof e!=="undefined"&&typeof e.markupEffectiveAtStart!=="undefined"){var r=e.markupEffectiveAtStart.length;var i;for(i=0;i<r;++i){n.push(t(e.markupEffectiveAtStart[i]))}}var s=this;t.each(this.panels,function(){s.showActivePanel(this,n)});this.correctHeight()},subscribeToEvents:function(){var t=this;r.sub("aloha.selection.context-change",function(e){if(t.isOpen){t.checkActivePanels(e.range)}t.lastRange=e.range});e.bind("aloha-editable-deactivated",function(e,n){if(t.isOpen){t.checkActivePanels()}t.lastRange=null});this.container.mousedown(function(t){t.originalEvent.stopSelectionUpdate=true;e.eventHandled=true});this.container.mouseup(function(t){t.originalEvent.stopSelectionUpdate=true;e.eventHandled=false})},correctHeight:function(){if(!this.isOpen){return}if(!this.isCompletelyOpen){this.correctHeightWhenCompletelyOpen=true;return}var e=t(window).height();var n=[];var r=[];var i;for(i in this.panels){if(this.panels.hasOwnProperty(i)){if(this.panels[i].isActive){r.push(this.panels[i]);n.push(i)}}}if(0===r.length){return}n=n.sort().join(",");if(a===n&&u===e){return}u=e;a=n;var s=this.container.find(".aloha-sidebar-inner").height();var o=s-(r[0].title.outerHeight()+10)*r.length;var f;var l;var c;var h;var p;var d=0;var v=Math;var m;while(r.length>0&&o>0){o+=d;d=0;p=[];for(m=r.length-1;m>=0;--m){f=r[m];c=f.content.find(".aloha-sidebar-panel-content-inner");l=v.min(c.height("auto").height(),v.floor(o/(m+1)));c.height(l);o-=l;h=c.find(".aloha-sidebar-panel-content-inner-text");if(h.height()>l){p.push(f);d+=l;c.css({"overflow-x":"hidden","overflow-y":"scroll"})}else{c.css("overflow-y","hidden")}if(f.expanded){f.expand()}}r=p}},showActivePanel:function(e,n){n.push(null);var r=e.content.parent("li");var i=e.activeOn;var s=t();var o=0;var u=n.length;var a;for(a=0;a<u;++a){if(i(n[a])){++o;if(n[a]){t.merge(s,n[a])}}}if(o){e.activate(s)}else{e.deactivate()}},initToggler:function(){var n=this;var r=this.container;var i=r.find(".aloha-sidebar-handle-icon");var s="aloha-sidebar-toggled";var o;var u=this.position==="right";if(this.opened){this.rotateHandleArrow(u?0:180,0)}t(function(){if(typeof e.settings.sidebar!=="undefined"&&e.settings.sidebar.handle&&e.settings.sidebar.handle.top){t(r.find(".aloha-sidebar-handle"))[0].style.top=e.settings.sidebar.handle.top}});r.find(".aloha-sidebar-handle").click(function(){if(o){clearInterval(o)}i.stop().css("marginLeft",4);if(n.isOpen){t(this).removeClass(s);n.close();n.isOpen=false}else{t(this).addClass(s);n.open();n.isOpen=true}}).hover(function(){var e=n.isOpen?-1:1;if(o){clearInterval(o)}i.stop();t(this).stop().animate(u?{marginLeft:"-="+e*5}:{marginRight:"-="+e*5},200);o=setInterval(function(){e*=-1;i.animate(u?{left:"-="+e*4}:{right:"-="+e*4},300)},300)},function(){if(o){clearInterval(o)}i.stop().css(u?"left":"right",5);t(this).stop().animate(u?{marginLeft:0}:{marginRight:0},600,"easeOutElastic")})},roundCorners:function(){var e=this.container;var t=e.find(".aloha-sidebar-panels>li:not(.aloha-sidebar-deactivated)");var n="aloha-sidebar-panel-top";var r="aloha-sidebar-panel-bottom";e.find(".aloha-sidebar-panel-top, .aloha-sidebar-panel-bottom").removeClass(n).removeClass(r);t.first().find(".aloha-sidebar-panel-title").addClass(n);t.last().find(".aloha-sidebar-panel-content").addClass(r)},updateHeight:function(){var e=t(window).height();this.container.height(e).find(".aloha-sidebar-inner").height(e)},barClicked:function(e){this.handleBarclick(t(e.target))},handleBarclick:function(e){if(e.hasClass("aloha-sidebar-panel-title")){this.togglePanel(e)}else if(!e.hasClass("aloha-sidebar-panel-content")&&!e.hasClass("aloha-sidebar-handle")&&!e.hasClass("aloha-sidebar-bar")){this.handleBarclick(e.parent())}},getPanelById:function(e){return this.panels[e]},getPanelByElement:function(e){var t=e[0].tagName==="LI"?e:e.parent("li");return this.getPanelById(t[0].id)},togglePanel:function(e){this.getPanelByElement(e).toggle()},rotateHandleIcon:function(e,t){var n=this.container.find(".aloha-sidebar-handle-icon");n.animate({angle:e},{duration:typeof t==="number"||typeof t==="string"?t:500,easing:"easeOutExpo",step:function(e,t){n.css({"-o-transform":"rotate("+e+"deg)","-webkit-transform":"rotate("+e+"deg)","-moz-transform":"rotate("+e+"deg)","-ms-transform":"rotate("+e+"deg)"})}})},toggleHandleIcon:function(e){var t=this.position==="right"^e;if(this.settings.rotateIcons){this.rotateHandleIcon(t?180:0,0)}else{var n=this.container.find(".aloha-sidebar-handle-icon");if(t){n.addClass("aloha-sidebar-handle-icon-left")}else{n.removeClass("aloha-sidebar-handle-icon-left")}}},open:function(e,n){if(this.isOpen){return this}var r=this.position==="right";var i=r?{marginRight:0}:{marginLeft:0};var s=this;this.toggleHandleIcon(true);this.container.animate(i,typeof e==="number"||typeof e==="string"?e:500,"easeOutExpo");if(!this.settings.overlayPage){t("body").animate(r?{marginRight:"+="+this.width}:{marginLeft:"+="+this.width},500,"easeOutExpo",function(){s.isCompletelyOpen=true;if(s.correctHeightWhenCompletelyOpen){s.correctHeight()}})}this.isOpen=true;this.correctHeight();if(this.lastRange){this.checkActivePanels(this.lastRange)}t("body").trigger("aloha-sidebar-opened",this);return this},close:function(e,n){if(!this.isOpen){return this}var r=this.position==="right";var i=r?{marginRight:-this.width}:{marginLeft:-this.width};this.toggleHandleIcon(false);this.container.animate(i,typeof e==="number"||typeof e==="string"?e:500,"easeOutExpo");if(!this.settings.overlayPage){t("body").animate(r?{marginRight:"-="+this.width}:{marginLeft:"-="+this.width},500,"easeOutExpo")}this.isOpen=false;this.isCompletelyOpen=false;return this},activatePanel:function(e,t){if(typeof e==="string"){e=this.getPanelById(e)}if(e){e.activate(t)}this.roundCorners();return this},expandPanel:function(e,t){if(typeof e==="string"){e=this.getPanelById(e)}if(e){e.expand(t)}return this},collapsePanel:function(e,t){if(typeof e==="string"){e=this.getPanelById(e)}if(e){e.collapse(t)}return this},addPanel:function(e,t){if(!(e instanceof s)){if(!e.width){e.width=this.width}e.sidebar=this;e=new s(e)}this.panels[e.id]=e;this.container.find(".aloha-sidebar-panels").append(e.element);this.checkActivePanels(n.getRangeObject());return e}});t.extend(s.prototype,{init:function(e){this.setTitle(e.title).setContent(e.content);delete e.title;delete e.content;t.extend(this,e);if(!this.id){this.id="aloha-sidebar-"+ ++i}var n=this.element=t('<li id="'+this.id+'">').append(this.title,this.content);if(this.expanded){this.content.height("auto")}this.toggleTitleIcon(this.expanded);this.coerceActiveOn();this.title.attr("unselectable","on").css("-moz-user-select","none").each(function(){this.onselectstart=function(){return false}});if(typeof this.onInit==="function"){this.onInit.apply(this)}},toggleTitleIcon:function(e){if(this.sidebar.settings.rotateIcons){this.rotateTitleIcon(e?90:0)}else{var t=this.title.find(".aloha-sidebar-panel-title-arrow");if(e){t.addClass("aloha-sidebar-panel-title-arrow-down")}else{t.removeClass("aloha-sidebar-panel-title-arrow-down")}}},coerceActiveOn:function(){if(typeof this.activeOn!=="function"){var e=this.activeOn;this.activeOn=function(){var t=typeof e,n;if(t==="boolean"){n=function(){return e}}else if(t==="undefined"){n=function(){return true}}else if(t==="string"){n=function(t){return t?t.is(e):false}}else{n=function(){return false}}return n}()}},activate:function(e){this.isActive=true;this.content.parent("li").show().removeClass("aloha-sidebar-deactivated");this.effectiveElement=e;if(typeof this.onActivate==="function"){this.onActivate.call(this,e)}},deactivate:function(){if(!this.isActive){return}this.isActive=false;this.content.parent("li").hide().addClass("aloha-sidebar-deactivated");this.effectiveElement=null},toggle:function(){if(this.expanded){this.collapse()}else{this.expand()}},expand:function(e){var t=this;var n=this.content;var r=n.height();var i=n.height("auto").height();n.height(r).stop().animate({height:i},500,"easeOutExpo",function(){if(typeof e==="function"){e.call(t)}});this.element.removeClass("collapsed");this.toggleTitleIcon(true);this.expanded=true;return this},collapse:function(e,t){var n=this;this.element.addClass("collapsed");this.content.stop().animate({height:3},250,"easeOutExpo",function(){if(typeof t==="function"){t.call(n)}});this.toggleTitleIcon(false);this.expanded=false;return this},setTitle:function(e){this.title.find(".aloha-sidebar-panel-title-text").html(e);return this},setContent:function(e){if(!e||e===""){e="&nbsp;"}this.content.find(".aloha-sidebar-panel-content-inner-text").html(e);return this},rotateTitleIcon:function(e,t){var n=this.title.find(".aloha-sidebar-panel-title-arrow");n.animate({angle:e},{duration:typeof t==="number"?t:500,easing:"easeOutExpo",step:function(e,t){n.css({"-o-transform":"rotate("+e+"deg)","-webkit-transform":"rotate("+e+"deg)","-moz-transform":"rotate("+e+"deg)","-ms-transform":"rotate("+e+"deg)"})}})},renderEffectiveParents:function(e,n){var r=e.first();var i=[];var s=[];var o=this.activeOn;var u;var a;while(r.length>0&&!r.is(".aloha-editable")){if(o(r)){s.push("<span>"+r[0].tagName.toLowerCase()+"</span>");u=s.length;a=[];while(u--){a.push(s[u])}i.push('<div class="aloha-sidebar-panel-parent">'+'<div class="aloha-sidebar-panel-parent-path">'+a.join("")+"</div>"+'<div class="aloha-sidebar-panel-parent-content'+'aloha-sidebar-opened">'+(typeof n==="function"?n(r):"----")+"</div>"+"</div>")}r=r.parent()}this.setContent(i.join(""));t(".aloha-sidebar-panel-parent-path").click(function(){var e=t(this).parent().find(".aloha-sidebar-panel-parent-content");if(e.hasClass("aloha-sidebar-opened")){e.hide().removeClass("aloha-sidebar-opened")}else{e.show().addClass("aloha-sidebar-opened")}});this.content.height("auto").find(".aloha-sidebar-panel-content-inner").height("auto")}});var f=new o({position:"left",width:250});var l=new o({position:"right",width:250});e.Sidebar={left:f,right:l};return e.Sidebar});window.GENTICS=window.GENTICS||{};window.GENTICS.Utils=window.GENTICS.Utils||{};define("util/position",["jquery"],function(e){var t=e,n=window.GENTICS,r=window.Class,i=window.console;n.Utils.Position={};n.Utils.Position.w=e(window);n.Utils.Position.Scroll={top:0,left:0,isScrolling:false};n.Utils.Position.ScrollCorrection={top:100,left:50};n.Utils.Position.Mouse={x:0,y:0,oldX:0,oldY:0,isMoving:false,triggeredMouseStop:true};n.Utils.Position.mouseStopCallbacks=[];n.Utils.Position.mouseMoveCallbacks=[];n.Utils.Position.update=function(){var e=this.w.scrollTop(),t=this.w.scrollLeft(),n;if(this.Scroll.isScrolling){if(this.Scroll.top==e&&this.Scroll.left==t){this.Scroll.isScrolling=false}}else{if(this.Scroll.top!=e||this.Scroll.left!=t){this.Scroll.isScrolling=true}}this.Scroll.top=e;this.Scroll.left=t;if(this.Mouse.x==this.Mouse.oldX&&this.Mouse.y==this.Mouse.oldY){this.Mouse.isMoving=false;if(!this.Mouse.triggeredMouseStop){this.Mouse.triggeredMouseStop=true;for(n=0;n<this.mouseStopCallbacks.length;n++){this.mouseStopCallbacks[n].call()}}}else{this.Mouse.isMoving=true;this.Mouse.triggeredMouseStop=false;for(n=0;n<this.mouseMoveCallbacks.length;n++){this.mouseMoveCallbacks[n].call()}}this.Mouse.oldX=this.Mouse.x;this.Mouse.oldY=this.Mouse.y};n.Utils.Position.addMouseStopCallback=function(e){this.mouseStopCallbacks.push(e);return this.mouseStopCallbacks.length-1};n.Utils.Position.addMouseMoveCallback=function(e){this.mouseMoveCallbacks.push(e);return this.mouseMoveCallbacks.length-1};e(function(){window.setInterval(function(){n.Utils.Position.update()},500)});e("html").mousemove(function(e){n.Utils.Position.Mouse.x=e.pageX;n.Utils.Position.Mouse.y=e.pageY})});define("aloha/repositoryobjects",["aloha/core","util/class"],function(e,t){var n=window.GENTICS;e.RepositoryObject=function(){};e.RepositoryDocument=t.extend({_constructor:function(e){var t=e;this.type="document";if(!t.id||!t.name||!t.repositoryId){return}n.Utils.applyProperties(this,e);this.baseType="document"}});e.RepositoryFolder=t.extend({_constructor:function(e){var t=e;this.type="folder";if(!t.id||!t.name||!t.repositoryId){return}n.Utils.applyProperties(this,e);this.baseType="folder"}})});define("aloha/repositorymanager",["jquery","util/class","aloha/core","aloha/console","aloha/repositoryobjects"],function(e,t,n,r,i){function o(e,t){var n={items:e,results:e.length};if(t){n.numItems=t.numItems;n.hasMoreItems=t.hasMoreItems;n.timeout=t.timeout}return n}function u(e,t){e(t)}var s=function(e){return e?function(e,t){return e.filter(t)}:function(e,t){var n=[];var r;for(r=0;r<e.length;r++){if(t(e[r])){n.push(e[r])}}return n}}(Array.prototype.hasOwnProperty("filter"));var a={query:function(e){return typeof e.query==="function"},getChildren:function(e){return typeof e.getChildren==="function"},getSelectedFolder:function(e){return typeof e.getSelectedFolder==="function"}};var f=t.extend({repositories:[],settings:n.settings&&n.settings.repositories||{},initialized:false,init:function(){var e=this;if(typeof e.settings.timeout==="undefined"){e.settings.timeout=5e3}var t;for(t=0;t<e.repositories.length;t++){e.initRepository(e.repositories[t])}e.initialized=true},register:function(e){var t=this;if(!t.getRepository(e.repositoryId)){t.repositories.push(e);if(t.initialized){t.initRepository(e)}}else{r.warn(t,'A repository with name "'+e.repositoryId+'" already registerd. Ignoring this.')}},initRepository:function(t){var n=this;if(!t.settings){t.settings={}}if(n.settings[t.repositoryId]){e.extend(t.settings,n.settings[t.repositoryId])}t.init()},getRepository:function(e){var t=this;var n;for(n=0;n<t.repositories.length;n++){if(t.repositories[n].repositoryId===e){return t.repositories[n]}}return null},query:function(t,n){var i=this;var f;var l=[];var c={numItems:0,hasMoreItems:false};var h;var p=t.timeout&&parseInt(t.timeout,10)||i.settings.timeout;var d=window.setTimeout(function(){c=c||{};c.timeout=true;if(h>0){r.warn(i,h+" repositories did not return before the "+"configured timeout of "+p+"ms.");h=0}clearTimeout(d);u(n,o(l,c))},p);var v=function(t,s){var a=this;if(0===h){return}if(t&&t.length){if(!t[0].repositoryId){var f=a.repositoryId;var p;for(p=0;p<t.length;p++){t[p].repositoryId=f}}e.merge(l,t)}if(s&&c){c.numItems=e.isNumeric(s.numItems)&&e.isNumeric(c.numItems)?c.numItems+s.numItems:undefined;c.hasMoreItems=typeof s.hasMoreItems==="boolean"&&typeof c.hasMoreItems==="boolean"?c.hasMoreItems||s.hasMoreItems:undefined;if(s.timeout){c.timeout=true}}else{c=undefined}r.debug(i,"The repository "+a.repositoryId+"returned with "+t.length+" results.");if(0===--h){clearTimeout(d);u(n,o(l,c))}};var m=t.repositoryId?[i.getRepository(t.repositoryId)]:i.repositories;var g=s(m,a.query);if(0===g.length){clearTimeout(d);u(n,o(l,c));return}var y=function(e){return function(){v.apply(e,arguments)}};h=g.length;for(f=0;f<g.length;f++){g[f].query(t,y(g[f]))}},getChildren:function(t,i){var o=this;var f;var l=[];var c=0;var h=t.timeout&&parseInt(t.timeout,10)||o.settings.timeout;var p=window.setTimeout(function(){if(c>0){r.warn(o,c+" repositories did not respond before the "+"configured timeout of "+h+"ms.");c=0}clearTimeout(p);u(i,l)},h);var d=function(t){if(0===c){return}if(t){e.merge(l,t)}if(0===--c){clearTimeout(p);u(i,l)}};var v=t.repositoryId?[o.getRepository(t.repositoryId)]:o.repositories;if(t.repositoryFilter&&t.repositoryFilter.length){v=s(v,function(n){return-1<e.inArray(n.repositoryId,t.repositoryFilter)})}if("aloha"===t.inFolderId){var m=t.repositoryFilter&&0<t.repositoryFilter.length;for(f=0;f<v.length;f++){l.push(new n.RepositoryFolder({id:v[f].repositoryId,name:v[f].repositoryName,repositoryId:v[f].repositoryId,type:"repository",hasMoreItems:true}))}clearTimeout(p);u(i,l);return}var g=s(v,a.getChildren);if(0===g.length){clearTimeout(p);u(i,l);return}c=g.length;for(f=0;f<g.length;f++){g[f].getChildren(t,d)}},makeClean:function(e){var t=this,n={},i=0,s=t.repositories.length;e.find("[data-gentics-aloha-repository="+this.prefix+"]").each(function(){while(i<s){n.makeClean(e);i+=1}r.debug(t,"Passing contents of HTML Element with id { "+this.attr("id")+" } for cleaning to repository { "+n.repositoryId+" }");n.makeClean(this)})},markObject:function(t,n){if(!t){return}var i=this;if(n){var s=i.getRepository(n.repositoryId);if(s){e(t).attr({"data-gentics-aloha-repository":n.repositoryId,"data-gentics-aloha-object-id":n.id});s.markObject(t,n)}else{r.error(i,'Trying to apply a repository "'+n.name+'" to an object, but item has no repositoryId.')}}else{e(t).removeAttr("data-gentics-aloha-repository").removeAttr("data-gentics-aloha-object-id")}},getObject:function(t,n){var r=this;var i=e(t);var s=i.attr("data-gentics-aloha-object-id");var o=i.attr("data-gentics-aloha-repository");var u=r.getRepository(o);if(u&&s){if(!r.itemCache){r.itemCache=[]}var a=r.itemCache[o];if(!a){a=r.itemCache[o]=[]}if(a[s]){n([a[s]])}else{u.getObjectById(s,function(e){a[s]=e[0];n(e)})}}},folderOpened:function(e){var t=this.getRepository(e.repositoryId);if(typeof t.folderOpened==="function"){t.folderOpened(e)}},folderClosed:function(e){var t=this.getRepository(e.repositoryId);if(typeof t.folderClosed==="function"){t.folderClosed(e)}},folderSelected:function(e){var t=this.getRepository(e.repositoryId);if(typeof t.folderSelected==="function"){t.folderSelected(e)}},getSelectedFolder:function(){var e=s(this.repositories,a.getSelectedFolder);var t;var n;for(t=0;t<e.length;t++){n=e[t].getSelectedFolder();if(n){return n}}return null},toString:function(){return"repositorymanager"}});n.RepositoryManager=new f;return n.RepositoryManager});define("aloha/repository",["aloha/core","util/class","aloha/repositorymanager"],function(e,t,n){var r=t.extend({_constructor:function(e,t){this.repositoryId=e;this.settings={};this.repositoryName=t||e;n.register(this)},init:function(){},query:null,getChildren:null,makeClean:function(e){},markObject:function(e,t){},setTemplate:function(e){if(e){this.template=e}else{this.template=null}},hasTemplate:function(){return this.template?true:false},getTemplate:function(){return this.template},getObjectById:function(e,t){return true}});e.AbstractRepository=r;return r});(function(e){function n(){var e,t,n=Aloha.settings.plugins&&Aloha.settings.plugins.load,r=Aloha.settings.baseUrl,i,s=/\/aloha.js(\?\S*)?$/,o=/\/[^\/]*\.js$/,u;if(!n||!r){e=document.getElementsByTagName("script");for(u=0;u<e.length;u++){t=e[u];i=t.getAttribute("data-aloha-plugins");if(null!=i){if(!n){n=i}if(!r){r=t.src.replace(o,"")}break}if(!r&&s.test(t.src)){r=t.src.replace(s,"")}}}if(typeof n==="string"&&n!==""){n=n.replace(/\s+/g,"").split(",")}return{baseUrl:r,plugins:n||[]}}function r(){var e=document.getElementsByTagName("script");for(var t=0;t<e.length;t++){var n=e[t].getAttribute("data-aloha-defer-init");if("true"===n){return true}}return false}function i(e,t,n){var r=["nls","css","vendor","res"],i,s;e[n]=t+"/"+n+"/lib";for(s=0;s<r.length;s++){var i=r[s];e[n+"/"+i]=t+"/"+n+"/"+i}}function s(e){var t={},n=[],r=[],s={},o={},u,a,f,l=Aloha.settings.basePath||"",c,h=Aloha.settings.bundles||{},p;for(p=0;p<e.length;p++){u=e[p].split("/");a=u[0];f=u[1];if(h[a]){c=l+h[a]}else{c=l+"../plugins/"+a}i(t,c,f);s[f]=c+"/"+f;n.push(f+"/"+f+"-plugin");o[f]={jquery:"aloha/jquery"}}return{paths:t,entryPoints:n,baseUrlByName:s,names:r,map:o}}function o(){var e={};var t=Array.prototype.slice.call(arguments);var n;var r;var i;for(r=0;r<t.length;r++){i=t[r];for(n in i){if(i.hasOwnProperty(n)){e[n]=t[r][n]}}}return e}function u(e,t){define(e,function(){return t})}function a(){Aloha.features={};Aloha.defaults={};Aloha.settings=Aloha.settings||{};Aloha.initialize=t.start;var r=n();var i=s(r.plugins);Aloha.settings.baseUrl=r.baseUrl;Aloha.settings.loadedPlugins=i.names;Aloha.settings._pluginBaseUrlByName=i.baseUrlByName;var a={aloha:{jquery:"aloha/jquery"},"aloha/jquery":{jquery:"jquery"},jqueryui:{jquery:"aloha/jquery"},vendor:{jquery:"aloha/jquery"},util:{jquery:"aloha/jquery"},RepositoryBrowser:{jquery:"aloha/jquery"},jstree:{jquery:"aloha/jquery"},jqgrid:{jquery:"aloha/jquery"},"jqgrid-locale-en":{jquery:"aloha/jquery"},"jqgrid-locale-de":{jquery:"aloha/jquery"},"jquery-layout":{jquery:"aloha/jquery"}};var f=o(a,i.map);var l={context:"aloha",config:{i18n:{locale:Aloha.settings.locale||"en"}},baseUrl:Aloha.settings.baseUrl,map:f};var c=e.__DEPS__||(e.__DEPS__={});c.lang=l.locale;var h={jquery:"vendor/jquery-1.7.2",jqueryui:"vendor/jquery-ui-1.9.0.custom-aloha"};var p={PubSub:"vendor/pubsub/js/pubsub-unminified",Class:"vendor/class",RepositoryBrowser:"vendor/repository-browser/js/repository-browser-unminified",jstree:"vendor/jquery.jstree",jqgrid:"vendor/jquery.jqgrid","jquery-layout":"vendor/jquery.layout-1.3.0-rc30.7","jqgrid-locale-en":"vendor/grid.locale.en","jqgrid-locale-de":"vendor/grid.locale.de","repository-browser-i18n-de":"vendor/repository-browser/js/repository-browser-unminified","repository-browser-i18n-en":"vendor/repository-browser/js/repository-browser-unminified"};var d=o(l,Aloha.settings.requireConfig);d.paths=o(h,p,i.paths,d.paths);var v=Aloha.settings.predefinedModules||{};if(Aloha.settings.jQuery){v.jquery=Aloha.settings.jQuery}var m;for(m in v)if(v.hasOwnProperty(m)){u(m,v[m]);delete d.paths[m]}var g=require.config(d);Aloha.require=function(e){if(1===arguments.length&&typeof e==="function"){return g(["aloha"],e)}return g.apply(this,arguments)};Aloha.bind=function(e,n){Aloha.require(["aloha/jquery"],function(r){Aloha.bind=function(e,n){switch(t.getReadiness(e)){case"deferred":var i=t.getPhaseByEvent(e);if(!i.deferred){i.deferred=r.Deferred()}i.deferred.done(n);break;case"immediate":n();break;case"normal":r(Aloha,"body").bind(e,n);break;default:throw"Unknown readiness"}return this};Aloha.bind(e,n)});return this};Aloha.trigger=function(e,n){Aloha.require(["aloha/jquery"],function(r){Aloha.trigger=function(e,n){var i=t.getPhaseByEvent(e);if(i){if(i.deferred){r(i.deferred.resolve);i.deferred=null}}r(Aloha,"body").trigger(e,n);return this};Aloha.trigger(e,n)});return this};Aloha.unbind=function(e){Aloha.require(["aloha/jquery"],function(t){Aloha.unbind=function(e){t(Aloha,"body").unbind(e)};Aloha.unbind(e)})};Aloha.ready=function(e){this.bind("aloha-ready",e);return this};var y=Aloha.settings.jQuery;define("aloha/jquery",["jquery"],function(e){return y||e});Aloha.jQuery=y;define("aloha",["aloha/jquery","util/json2","aloha/rangy-core","util/class","util/lang","util/range","util/dom","aloha/core","aloha/editable","aloha/console","aloha/markup","aloha/plugin","aloha/selection","aloha/command","aloha/jquery.aloha","aloha/sidebar","util/position","aloha/repositorymanager","aloha/repository","aloha/repositoryobjects","aloha/contenthandlermanager"],function(e){Aloha.features.jquery=true;Aloha.jQuery=e;Aloha.settings=e.extendObjects(true,{},Aloha.defaults,Aloha.settings);return Aloha});require(d,["aloha","aloha/jquery"],function(e,t){require(d,i.entryPoints,function(){t(function(){window.rangy.init();e.init()})})})}var t={phases:[],completed:[],start:function(e,n){t.phases=t.phases.concat(e);t.proceed(0,e,n)},proceed:function(e,n,r){if(e<n.length){var i=n[e];var s=function(){t.proceed(++e,n,r)};var o=function(){t.completed.push(i);if(i.event){Aloha.trigger(i.event)}};if(i.fn){i.fn(o,s)}else{o();s()}}else if(r){r()}},getPhaseByEvent:function(e){var n;for(n=0;n<t.phases.length;n++){if(e===t.phases[n].event){return t.phases[n]}}return null},getReadiness:function(e){var n;for(n=0;n<t.completed.length;n++){if(e===t.completed[n].event){return"immediate"}}return t.getPhaseByEvent(e)?"deferred":"normal"}};e.Aloha=e.Aloha||{};if(e.Aloha.deferInit||r()){e.Aloha.deferInit=a}else{Aloha._load=a}})(window);define("ui/context",["aloha","jquery","util/class"],function(e,t,n){var r="aloha-ui-context",i="#"+r,s;s=t(i);if(!s.length){s=t("<div>",{"class":"aloha",id:r});t(function(){s.appendTo("body")})}var o=n.extend({surfaces:[],containers:[]});t.extend(o,{selector:i,element:s});return o});define("ui/scopes",["jquery","PubSub","util/maps"],function(e,t,n){function u(e,t){if(!r.hasOwnProperty(t)){return}var n=r[t];for(var i=0;i<n.length;i++){var s=n[i];e.push(s);u(e,s)}}var r={"Aloha.empty":[],"Aloha.global":["Aloha.empty"],"Aloha.continuoustext":["Aloha.global"]},i=[],s={},o=false;Aloha.bind("aloha-selection-changed-before",function(){o=false});Aloha.bind("aloha-selection-changed-after",function(e,t,n){if(typeof n!=="undefined"&&!o){a.setScope("Aloha.continuoustext")}});var a={enterScope:function(e,n){n=n||"_globalCounter";var r=s[e];if(!r){r=s[e]={}}var i=r[n]||0;r[n]=i+1;if(!i){t.pub("aloha.ui.scope.change")}},leaveScope:function(e,r,i){r=r||"_globalCounter";var o=s[e];if(!o){return}var u=o[r];if(!u){return}u-=1;if(u&&!i){o[r]=u}else{delete o[r];if(n.isEmpty(o)){delete s[e]}t.pub("aloha.ui.scope.change")}},isActiveScope:function(t){if(s[t]){return true}var n=-1!==e.inArray(t,i);if(n){return true}return false},getPrimaryScope:function(){return i[0]},setScope:function(e){o=true;if(i[0]!=e){i=[e];u(i,e);t.pub("aloha.ui.scope.change")}},createScope:function(e,t){if(!t){t=["Aloha.empty"]}else if(typeof t==="string"){t=[t]}r[e]=t}};return a});define("ui/container",["jquery","util/class","ui/scopes"],function(e,t,n){function i(e){if(!e.showOnId){e.showOnId=++r}return e.showOnId}function s(e,t){var n=t?"show":"hide",r;for(r=0;r<e.length;r++){e[r][n]()}}function a(t,r){switch(e.type(r)){case"function":return r;case"object":if(r.scope){if(o[r.scope]){return o[r.scope]}return o[r.scope]=function(){return n.isActiveScope(r.scope)}}else{throw"Invalid showOn configuration"};default:return u}}var r=0;var o={};var u=function(){return true};var f=t.extend({element:null,_constructor:function(e,t){var n=a(this,t.showOn),r=i(n),s=e.containers[r];this.context=e;if(!s){s=e.containers[r]={shouldShow:n,containers:[]}}s.containers.push(this)},show:function(){},hide:function(){},focus:function(){},foreground:function(){},childVisible:function(e,t){},childFocus:function(e){},childForeground:function(e){}});e.extend(f,{showContainersForContext:function(e,t){var n,r,i;if(!e.containers){return}i=e.containers;for(r in i){if(i.hasOwnProperty(r)){n=i[r];s(n.containers,n.shouldShow(t))}}}});return f});define("ui/surface",["aloha/core","jquery","util/class","ui/container"],function(e,t,n,r){var i=n.extend({_constructor:function(e){e.surfaces.push(this)},isActive:function(){return true}});t.extend(i,{range:null,show:function(e){t.each(e.surfaces,function(e,t){t.show()})},hide:function(e){t.each(e.surfaces,function(e,t){t.hide()})},trackRange:function(t){t.bind("mousedown",function(t){t.originalEvent.stopSelectionUpdate=true;e.eventHandled=true;i.suppressHide=true;if(e.activeEditable){var n=e.getSelection();i.range=0<n.getRangeCount()?n.getRangeAt(0):null}});t.bind("mouseup",function(t){t.originalEvent.stopSelectionUpdate=true;e.eventHandled=false;i.suppressHide=false})}});return i});define("ui/component",["aloha/core","jquery","util/class"],function(e,t,n){var r=0;var i=n.extend({id:0,isInstance:true,container:null,type:null,visible:true,_constructor:function(){this.id=r++;this.init()},adoptParent:function(e){this.container=e},init:function(){},isVisible:function(){return this.visible},show:function(e){if(false===e){this.hide();return}if(!this.visible){this.visible=true;this.element.show();if(this.container){this.container.childVisible(this,true)}}},hide:function(){if(this.visible){this.visible=false;this.element.hide();if(this.container){this.container.childVisible(this,false)}}},focus:function(){this.element.focus();if(this.container){this.container.childFocus(this)}},foreground:function(){if(this.container){this.container.childForeground(this)}},enable:function(e){},disable:function(){}});return i});define("jqueryui",["jquery"],function(jQuery){(function(e,t){function i(t,n){var r,i,o,u=t.nodeName.toLowerCase();if("area"===u){r=t.parentNode;i=r.name;if(!t.href||!i||r.nodeName.toLowerCase()!=="map"){return false}o=e("img[usemap=#"+i+"]")[0];return!!o&&s(o)}return(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&s(t)}function s(t){return!e(t).parents().andSelf().filter(function(){return e.css(this,"visibility")==="hidden"||e.expr.filters.hidden(this)}).length}var n=0,r=/^ui-id-\d+$/;e.ui=e.ui||{};if(e.ui.version){return}e.extend(e.ui,{version:"1.9.0",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});e.fn.extend({_focus:e.fn.focus,focus:function(t,n){return typeof t==="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus();if(n){n.call(r)}},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;if(e.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))){t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0)}else{t=this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0)}return/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t){return this.css("zIndex",n)}if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0){return s}}r=r.parent()}}return 0},uniqueId:function(){return this.each(function(){if(!this.id){this.id="ui-id-"+ ++n}})},removeUniqueId:function(){return this.each(function(){if(r.test(this.id)){e(this).removeAttr("id")}})}});if(!e("<a>").outerWidth(1).jquery){e.each(["Width","Height"],function(n,r){function u(t,n,r,s){e.each(i,function(){n-=parseFloat(e.css(t,"padding"+this))||0;if(r){n-=parseFloat(e.css(t,"border"+this+"Width"))||0}if(s){n-=parseFloat(e.css(t,"margin"+this))||0}});return n}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){if(n===t){return o["inner"+r].call(this)}return this.each(function(){e(this).css(s,u(this,n)+"px")})};e.fn["outer"+r]=function(t,n){if(typeof t!=="number"){return o["outer"+r].call(this,t)}return this.each(function(){e(this).css(s,u(this,t,true,n)+"px")})}})}e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(t,!r)}});e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));n.offsetHeight;e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});e.support.minHeight=n.offsetHeight===100;e.support.selectstart="onselectstart"in n;t.removeChild(n).style.display="none"});e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r){s.plugins[i]=s.plugins[i]||[];s.plugins[i].push([n,r[i]])}},call:function(e,t,n){var r,i=e.plugins[t];if(!i||!e.element[0].parentNode||e.element[0].parentNode.nodeType===11){return}for(r=0;r<i.length;r++){if(e.options[i[r][0]]){i[r][1].apply(e.element,n)}}}},contains:e.contains,hasScroll:function(t,n){if(e(t).css("overflow")==="hidden"){return false}var r=n&&n==="left"?"scrollLeft":"scrollTop",i=false;if(t[r]>0){return true}t[r]=1;i=t[r]>0;t[r]=0;return i},isOverAxis:function(e,t,n){return e>t&&e<t+n},isOver:function(t,n,r,i,s,o){return e.ui.isOverAxis(t,r,s)&&e.ui.isOverAxis(n,i,o)}})})(jQuery);(function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n=0,r;(r=t[n])!=null;n++){try{e(r).triggerHandler("remove")}catch(s){}}i(t)};e.widget=function(t,n,r){var i,s,o,u,a=t.split(".")[0];t=t.split(".")[1];i=a+"-"+t;if(!r){r=n;n=e.Widget}e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)};e[a]=e[a]||{};s=e[a][t];o=e[a][t]=function(e,t){if(!this._createWidget){return new o(e,t)}if(arguments.length){this._createWidget(e,t)}};e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]});u=new n;u.options=e.widget.extend({},u.options);e.each(r,function(t,i){if(e.isFunction(i)){r[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},r=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;this._super=e;this._superApply=r;s=i.apply(this,arguments);this._super=t;this._superApply=n;return s}}()}});o.prototype=e.widget.extend(u,{widgetEventPrefix:t},r,{constructor:o,namespace:a,widgetName:t,widgetBaseClass:i,widgetFullName:i});if(s){e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)});delete s._childConstructors}else{n._childConstructors.push(o)}e.widget.bridge(t,o)};e.widget.extend=function(n){var i=r.call(arguments,1),s=0,o=i.length,u,a;for(;s<o;s++){for(u in i[s]){a=i[s][u];if(i[s].hasOwnProperty(u)&&a!==t){n[u]=e.isPlainObject(a)?e.widget.extend({},n[u],a):a}}}return n};e.widget.bridge=function(n,i){var s=i.prototype.widgetFullName;e.fn[n]=function(o){var u=typeof o==="string",a=r.call(arguments,1),f=this;o=!u&&a.length?e.widget.extend.apply(null,[o].concat(a)):o;if(u){this.each(function(){var r,i=e.data(this,s);if(!i){return e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+o+"'")}if(!e.isFunction(i[o])||o.charAt(0)==="_"){return e.error("no such method '"+o+"' for "+n+" widget instance")}r=i[o].apply(i,a);if(r!==i&&r!==t){f=r&&r.jquery?f.pushStack(r.get()):r;return false}})}else{this.each(function(){var t=e.data(this,s);if(t){t.option(o||{})._init()}else{new i(o,this)}})}return f}};e.Widget=function(e,t){};e.Widget._childConstructors=[];e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0];this.element=e(r);this.uuid=n++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=e.widget.extend({},this.options,this._getCreateOptions(),t);this.bindings=e();this.hoverable=e();this.focusable=e();if(r!==this){e.data(r,this.widgetName,this);e.data(r,this.widgetFullName,this);this._on({remove:"destroy"});this.document=e(r.style?r.ownerDocument:r.document||r);this.window=e(this.document[0].defaultView||this.document[0].parentWindow)}this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i=n,s,o,u;if(arguments.length===0){return e.widget.extend({},this.options)}if(typeof n==="string"){i={};s=n.split(".");n=s.shift();if(s.length){o=i[n]=e.widget.extend({},this.options[n]);for(u=0;u<s.length-1;u++){o[s[u]]=o[s[u]]||{};o=o[s[u]]}n=s.pop();if(r===t){return o[n]===t?null:o[n]}o[n]=r}else{if(r===t){return this.options[n]===t?null:this.options[n]}i[n]=r}}this._setOptions(i);return this},_setOptions:function(e){var t;for(t in e){this._setOption(t,e[t])}return this},_setOption:function(e,t){this.options[e]=t;if(e==="disabled"){this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_on:function(t,n){if(!n){n=t;t=this.element}else{t=e(t);this.bindings=this.bindings.add(t)}var r=this;e.each(n,function(n,i){function s(){if(r.options.disabled===true||e(this).hasClass("ui-state-disabled")){return}return(typeof i==="string"?r[i]:i).apply(r,arguments)}if(typeof i!=="string"){s.guid=i.guid=i.guid||s.guid||e.guid++}var o=n.match(/^(\w+)\s*(.*)$/),u=o[1]+r.eventNamespace,a=o[2];if(a){r.widget().delegate(a,u,s)}else{t.bind(u,s)}})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e==="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t);this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t);this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{};n=e.Event(n);n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase();n.target=this.element[0];s=n.originalEvent;if(s){for(i in s){if(!(i in n)){n[i]=s[i]}}}this.element.trigger(n,r);return!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===false||n.isDefaultPrevented())}};e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){if(typeof i==="string"){i={effect:i}}var o,u=!i?t:i===true||typeof i==="number"?n:i.effect||n;i=i||{};if(typeof i==="number"){i={duration:i}}o=!e.isEmptyObject(i);i.complete=s;if(i.delay){r.delay(i.delay)}if(o&&e.effects&&(e.effects.effect[u]||e.uiBackCompat!==false&&e.effects[u])){r[t](i)}else if(u!==t&&r[u]){r[u](i.duration,i.easing,s)}else{r.queue(function(n){e(this)[t]();if(s){s.call(r[0])}n()})}}});if(e.uiBackCompat!==false){e.Widget.prototype._getCreateOptions=function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]}}})(jQuery);(function(e,t){var n=false;e(document).mouseup(function(e){n=false});e.widget("ui.mouse",{version:"1.9.0",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(true===e.data(n.target,t.widgetName+".preventClickEvent")){e.removeData(n.target,t.widgetName+".preventClickEvent");n.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);if(this._mouseMoveDelegate){e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)}},_mouseDown:function(t){if(n){return}this._mouseStarted&&this._mouseUp(t);this._mouseDownEvent=t;var r=this,i=t.which===1,s=typeof this.options.cancel==="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:false;if(!i||s||!this._mouseCapture(t)){return true}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=true},this.options.delay)}if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==false;if(!this._mouseStarted){t.preventDefault();return true}}if(true===e.data(t.target,this.widgetName+".preventClickEvent")){e.removeData(t.target,this.widgetName+".preventClickEvent")}this._mouseMoveDelegate=function(e){return r._mouseMove(e)};this._mouseUpDelegate=function(e){return r._mouseUp(e)};e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);t.preventDefault();n=true;return true},_mouseMove:function(t){if(e.browser.msie&&!(document.documentMode>=9)&&!t.button){return this._mouseUp(t)}if(this._mouseStarted){this._mouseDrag(t);return t.preventDefault()}if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==false;this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)}return!this._mouseStarted},_mouseUp:function(t){e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(t.target===this._mouseDownEvent.target){e.data(t.target,this.widgetName+".preventClickEvent",true)}this._mouseStop(t)}return false},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(e){return this.mouseDelayMet},_mouseStart:function(e){},_mouseDrag:function(e){},_mouseStop:function(e){},_mouseCapture:function(e){return true}})})(jQuery);(function(e,t){function h(e,t,n){return[parseInt(e[0],10)*(l.test(e[0])?t/100:1),parseInt(e[1],10)*(l.test(e[1])?n/100:1)]}function p(t,n){return parseInt(e.css(t,n),10)||0}e.ui=e.ui||{};var n,r=Math.max,i=Math.abs,s=Math.round,o=/left|center|right/,u=/top|center|bottom/,a=/[\+\-]\d+%?/,f=/^\w+/,l=/%$/,c=e.fn.position;e.position={scrollbarWidth:function(){if(n!==t){return n}var r,i,s=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];e("body").append(s);r=o.offsetWidth;s.css("overflow","scroll");i=o.offsetWidth;if(r===i){i=s[0].clientWidth}s.remove();return n=r-i},getScrollInfo:function(t){var n=t.isWindow?"":t.element.css("overflow-x"),r=t.isWindow?"":t.element.css("overflow-y"),i=n==="scroll"||n==="auto"&&t.width<t.element[0].scrollWidth,s=r==="scroll"||r==="auto"&&t.height<t.element[0].scrollHeight;return{width:i?e.position.scrollbarWidth():0,height:s?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),r=e.isWindow(n[0]);return{element:n,isWindow:r,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:r?n.width():n.outerWidth(),height:r?n.height():n.outerHeight()}}};e.fn.position=function(t){if(!t||!t.of){return c.apply(this,arguments)}t=e.extend({},t);var n,l,d,v,m,g=e(t.of),y=e.position.getWithinInfo(t.within),b=e.position.getScrollInfo(y),w=g[0],E=(t.collision||"flip").split(" "),S={};if(w.nodeType===9){l=g.width();d=g.height();v={top:0,left:0}}else if(e.isWindow(w)){l=g.width();d=g.height();v={top:g.scrollTop(),left:g.scrollLeft()}}else if(w.preventDefault){t.at="left top";l=d=0;v={top:w.pageY,left:w.pageX}}else{l=g.outerWidth();d=g.outerHeight();v=g.offset()}m=e.extend({},v);e.each(["my","at"],function(){var e=(t[this]||"").split(" "),n,r;if(e.length===1){e=o.test(e[0])?e.concat(["center"]):u.test(e[0])?["center"].concat(e):["center","center"]}e[0]=o.test(e[0])?e[0]:"center";e[1]=u.test(e[1])?e[1]:"center";n=a.exec(e[0]);r=a.exec(e[1]);S[this]=[n?n[0]:0,r?r[0]:0];t[this]=[f.exec(e[0])[0],f.exec(e[1])[0]]});if(E.length===1){E[1]=E[0]}if(t.at[0]==="right"){m.left+=l}else if(t.at[0]==="center"){m.left+=l/2}if(t.at[1]==="bottom"){m.top+=d}else if(t.at[1]==="center"){m.top+=d/2}n=h(S.at,l,d);m.left+=n[0];m.top+=n[1];return this.each(function(){var o,u,a=e(this),f=a.outerWidth(),c=a.outerHeight(),w=p(this,"marginLeft"),x=p(this,"marginTop"),T=f+w+p(this,"marginRight")+b.width,N=c+x+p(this,"marginBottom")+b.height,C=e.extend({},m),k=h(S.my,a.outerWidth(),a.outerHeight());if(t.my[0]==="right"){C.left-=f}else if(t.my[0]==="center"){C.left-=f/2}if(t.my[1]==="bottom"){C.top-=c}else if(t.my[1]==="center"){C.top-=c/2}C.left+=k[0];C.top+=k[1];if(!e.support.offsetFractions){C.left=s(C.left);C.top=s(C.top)}o={marginLeft:w,marginTop:x};e.each(["left","top"],function(r,i){if(e.ui.position[E[r]]){e.ui.position[E[r]][i](C,{targetWidth:l,targetHeight:d,elemWidth:f,elemHeight:c,collisionPosition:o,collisionWidth:T,collisionHeight:N,offset:[n[0]+k[0],n[1]+k[1]],my:t.my,at:t.at,within:y,elem:a})}});if(e.fn.bgiframe){a.bgiframe()}if(t.using){u=function(e){var n=v.left-C.left,s=n+l-f,o=v.top-C.top,u=o+d-c,h={target:{element:g,left:v.left,top:v.top,width:l,height:d},element:{element:a,left:C.left,top:C.top,width:f,height:c},horizontal:s<0?"left":n>0?"right":"center",vertical:u<0?"top":o>0?"bottom":"middle"};if(l<f&&i(n+s)<l){h.horizontal="center"}if(d<c&&i(o+u)<d){h.vertical="middle"}if(r(i(n),i(s))>r(i(o),i(u))){h.important="horizontal"}else{h.important="vertical"}t.using.call(this,e,h)}}a.offset(e.extend(C,{using:u}))})};e.ui.position={fit:{left:function(e,t){var n=t.within,i=n.isWindow?n.scrollLeft:n.offset.left,s=n.width,o=e.left-t.collisionPosition.marginLeft,u=i-o,a=o+t.collisionWidth-s-i,f;if(t.collisionWidth>s){if(u>0&&a<=0){f=e.left+u+t.collisionWidth-s-i;e.left+=u-f}else if(a>0&&u<=0){e.left=i}else{if(u>a){e.left=i+s-t.collisionWidth}else{e.left=i}}}else if(u>0){e.left+=u}else if(a>0){e.left-=a}else{e.left=r(e.left-o,e.left)}},top:function(e,t){var n=t.within,i=n.isWindow?n.scrollTop:n.offset.top,s=t.within.height,o=e.top-t.collisionPosition.marginTop,u=i-o,a=o+t.collisionHeight-s-i,f;if(t.collisionHeight>s){if(u>0&&a<=0){f=e.top+u+t.collisionHeight-s-i;e.top+=u-f}else if(a>0&&u<=0){e.top=i}else{if(u>a){e.top=i+s-t.collisionHeight}else{e.top=i}}}else if(u>0){e.top+=u}else if(a>0){e.top-=a}else{e.top=r(e.top-o,e.top)}}},flip:{left:function(e,t){var n=t.within,r=n.offset.left+n.scrollLeft,s=n.width,o=n.isWindow?n.scrollLeft:n.offset.left,u=e.left-t.collisionPosition.marginLeft,a=u-o,f=u+t.collisionWidth-s-o,l=t.my[0]==="left"?-t.elemWidth:t.my[0]==="right"?t.elemWidth:0,c=t.at[0]==="left"?t.targetWidth:t.at[0]==="right"?-t.targetWidth:0,h=-2*t.offset[0],p,d;if(a<0){p=e.left+l+c+h+t.collisionWidth-s-r;if(p<0||p<i(a)){e.left+=l+c+h}}else if(f>0){d=e.left-t.collisionPosition.marginLeft+l+c+h-o;if(d>0||i(d)<f){e.left+=l+c+h}}},top:function(e,t){var n=t.within,r=n.offset.top+n.scrollTop,s=n.height,o=n.isWindow?n.scrollTop:n.offset.top,u=e.top-t.collisionPosition.marginTop,a=u-o,f=u+t.collisionHeight-s-o,l=t.my[1]==="top",c=l?-t.elemHeight:t.my[1]==="bottom"?t.elemHeight:0,h=t.at[1]==="top"?t.targetHeight:t.at[1]==="bottom"?-t.targetHeight:0,p=-2*t.offset[1],d,v;if(a<0){v=e.top+c+h+p+t.collisionHeight-s-r;if(e.top+c+h+p>a&&(v<0||v<i(a))){e.top+=c+h+p}}else if(f>0){d=e.top-t.collisionPosition.marginTop+c+h+p-o;if(e.top+c+h+p>f&&(d>0||i(d)<f)){e.top+=c+h+p}}}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments);e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments);e.ui.position.fit.top.apply(this,arguments)}}};(function(){var t,n,r,i,s,o=document.getElementsByTagName("body")[0],u=document.createElement("div");t=document.createElement(o?"div":"body");r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};if(o){e.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"})}for(s in r){t.style[s]=r[s]}t.appendChild(u);n=o||document.documentElement;n.insertBefore(t,n.firstChild);u.style.cssText="position: absolute; left: 10.7432222px;";i=e(u).offset().left;e.support.offsetFractions=i>10&&i<11;t.innerHTML="";n.removeChild(t)})();if(e.uiBackCompat!==false){(function(e){var n=e.fn.position;e.fn.position=function(r){if(!r||!r.offset){return n.call(this,r)}var i=r.offset.split(" "),s=r.at.split(" ");if(i.length===1){i[1]=i[0]}if(/^\d/.test(i[0])){i[0]="+"+i[0]}if(/^\d/.test(i[1])){i[1]="+"+i[1]}if(s.length===1){if(/left|center|right/.test(s[0])){s[1]="center"}else{s[1]=s[0];s[0]="center"}}return n.call(this,e.extend(r,{at:s[0]+i[0]+" "+s[1]+i[1],offset:t}))}})(jQuery)}})(jQuery);(function(e,t){e.widget("ui.draggable",e.ui.mouse,{version:"1.9.0",widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false},_create:function(){if(this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position")))this.element[0].style.position="relative";this.options.addClasses&&this.element.addClass("ui-draggable");this.options.disabled&&this.element.addClass("ui-draggable-disabled");this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;if(this.helper||n.disabled||e(t.target).is(".ui-resizable-handle"))return false;this.handle=this._getHandle(t);if(!this.handle)return false;e(n.iframeFix===true?"iframe":n.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")});return true},_mouseStart:function(t){var n=this.options;this.helper=this._createHelper(t);this.helper.addClass("ui-draggable-dragging");this._cacheHelperProportions();if(e.ui.ddmanager)e.ui.ddmanager.current=this;this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(t);this.originalPageX=t.pageX;this.originalPageY=t.pageY;n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt);if(n.containment)this._setContainment();if(this._trigger("start",t)===false){this._clear();return false}this._cacheHelperProportions();if(e.ui.ddmanager&&!n.dropBehaviour)e.ui.ddmanager.prepareOffsets(this,t);this._mouseDrag(t,true);if(e.ui.ddmanager)e.ui.ddmanager.dragStart(this,t);return true},_mouseDrag:function(t,n){this.position=this._generatePosition(t);this.positionAbs=this._convertPositionTo("absolute");if(!n){var r=this._uiHash();if(this._trigger("drag",t,r)===false){this._mouseUp({});return false}this.position=r.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";if(e.ui.ddmanager)e.ui.ddmanager.drag(this,t);return false},_mouseStop:function(t){var n=false;if(e.ui.ddmanager&&!this.options.dropBehaviour)n=e.ui.ddmanager.drop(this,t);if(this.dropped){n=this.dropped;this.dropped=false}var r=this.element[0],i=false;while(r&&(r=r.parentNode)){if(r==document){i=true}}if(!i&&this.options.helper==="original")return false;if(this.options.revert=="invalid"&&!n||this.options.revert=="valid"&&n||this.options.revert===true||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)){var s=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){if(s._trigger("stop",t)!==false){s._clear()}})}else{if(this._trigger("stop",t)!==false){this._clear()}}return false},_mouseUp:function(t){e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)});if(e.ui.ddmanager)e.ui.ddmanager.dragStop(this,t);return e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){if(this.helper.is(".ui-draggable-dragging")){this._mouseUp({})}else{this._clear()}return this},_getHandle:function(t){var n=!this.options.handle||!e(this.options.handle,this.element).length?true:false;e(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==t.target)n=true});return n},_createHelper:function(t){var n=this.options;var r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):n.helper=="clone"?this.element.clone().removeAttr("id"):this.element;if(!r.parents("body").length)r.appendTo(n.appendTo=="parent"?this.element[0].parentNode:n.appendTo);if(r[0]!=this.element[0]&&!/(fixed|absolute)/.test(r.css("position")))r.css("position","absolute");return r},_adjustOffsetFromHelper:function(t){if(typeof t=="string"){t=t.split(" ")}if(e.isArray(t)){t={left:+t[0],top:+t[1]||0}}if("left"in t){this.offset.click.left=t.left+this.margins.left}if("right"in t){this.offset.click.left=this.helperProportions.width-t.right+this.margins.left}if("top"in t){this.offset.click.top=t.top+this.margins.top}if("bottom"in t){this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])){t.left+=this.scrollParent.scrollLeft();t.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.browser.msie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else{return{top:0,left:0}}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if(t.containment=="parent")t.containment=this.helper[0].parentNode;if(t.containment=="document"||t.containment=="window")this.containment=[t.containment=="document"?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t.containment=="document"?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(t.containment=="document"?0:e(window).scrollLeft())+e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(t.containment=="document"?0:e(window).scrollTop())+(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)&&t.containment.constructor!=Array){var n=e(t.containment);var r=n[0];if(!r)return;var i=n.offset();var s=e(r).css("overflow")!="hidden";this.containment=[(parseInt(e(r).css("borderLeftWidth"),10)||0)+(parseInt(e(r).css("paddingLeft"),10)||0),(parseInt(e(r).css("borderTopWidth"),10)||0)+(parseInt(e(r).css("paddingTop"),10)||0),(s?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(e(r).css("borderLeftWidth"),10)||0)-(parseInt(e(r).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(s?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(e(r).css("borderTopWidth"),10)||0)-(parseInt(e(r).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=n}else if(t.containment.constructor==Array){this.containment=t.containment}},_convertPositionTo:function(t,n){if(!n)n=this.position;var r=t=="absolute"?1:-1;var i=this.options,s=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,o=/(html|body)/i.test(s[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r}},_generatePosition:function(t){var n=this.options,r=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,i=/(html|body)/i.test(r[0].tagName);var s=t.pageX;var o=t.pageY;if(this.originalPosition){var u;if(this.containment){if(this.relative_container){var a=this.relative_container.offset();u=[this.containment[0]+a.left,this.containment[1]+a.top,this.containment[2]+a.left,this.containment[3]+a.top]}else{u=this.containment}if(t.pageX-this.offset.click.left<u[0])s=u[0]+this.offset.click.left;if(t.pageY-this.offset.click.top<u[1])o=u[1]+this.offset.click.top;if(t.pageX-this.offset.click.left>u[2])s=u[2]+this.offset.click.left;if(t.pageY-this.offset.click.top>u[3])o=u[3]+this.offset.click.top}if(n.grid){var f=n.grid[1]?this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1]:this.originalPageY;o=u?!(f-this.offset.click.top<u[1]||f-this.offset.click.top>u[3])?f:!(f-this.offset.click.top<u[1])?f-n.grid[1]:f+n.grid[1]:f;var l=n.grid[0]?this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0]:this.originalPageX;s=u?!(l-this.offset.click.left<u[0]||l-this.offset.click.left>u[2])?l:!(l-this.offset.click.left<u[0])?l-n.grid[0]:l+n.grid[0]:l}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");if(this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval)this.helper.remove();this.helper=null;this.cancelHelperRemoval=false},_trigger:function(t,n,r){r=r||this._uiHash();e.ui.plugin.call(this,t,[n,r]);if(t=="drag")this.positionAbs=this._convertPositionTo("absolute");return e.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(e){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var r=e(this).data("draggable"),i=r.options,s=e.extend({},n,{item:r.element});r.sortables=[];e(i.connectToSortable).each(function(){var n=e.data(this,"sortable");if(n&&!n.options.disabled){r.sortables.push({instance:n,shouldRevert:n.options.revert});n.refreshPositions();n._trigger("activate",t,s)}})},stop:function(t,n){var r=e(this).data("draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;r.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert)this.instance.options.revert=true;this.instance._mouseStop(t);this.instance.options.helper=this.instance.options._helper;if(r.options.helper=="original")this.instance.currentItem.css({top:"auto",left:"auto"})}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",t,i)}})},drag:function(t,n){var r=e(this).data("draggable"),i=this;var s=function(t){var n=this.offset.click.top,r=this.offset.click.left;var i=this.positionAbs.top,s=this.positionAbs.left;var o=t.height,u=t.width;var a=t.top,f=t.left;return e.ui.isOver(i+n,s+r,a,f,o,u)};e.each(r.sortables,function(s){this.instance.positionAbs=r.positionAbs;this.instance.helperProportions=r.helperProportions;this.instance.offset.click=r.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return n.helper[0]};t.target=this.instance.currentItem[0];this.instance._mouseCapture(t,true);this.instance._mouseStart(t,true,true);this.instance.offset.click.top=r.offset.click.top;this.instance.offset.click.left=r.offset.click.left;this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top;r._trigger("toSortable",t);r.dropped=this.instance.element;r.currentItem=r.element;this.instance.fromOutside=r}if(this.instance.currentItem)this.instance._mouseDrag(t)}else{if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger("out",t,this.instance._uiHash(this.instance));this.instance._mouseStop(t,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();if(this.instance.placeholder)this.instance.placeholder.remove();r._trigger("fromSortable",t);r.dropped=false}}})}});e.ui.plugin.add("draggable","cursor",{start:function(t,n){var r=e("body"),i=e(this).data("draggable").options;if(r.css("cursor"))i._cursor=r.css("cursor");r.css("cursor",i.cursor)},stop:function(t,n){var r=e(this).data("draggable").options;if(r._cursor)e("body").css("cursor",r._cursor)}});e.ui.plugin.add("draggable","opacity",{start:function(t,n){var r=e(n.helper),i=e(this).data("draggable").options;if(r.css("opacity"))i._opacity=r.css("opacity");r.css("opacity",i.opacity)},stop:function(t,n){var r=e(this).data("draggable").options;if(r._opacity)e(n.helper).css("opacity",r._opacity)}});e.ui.plugin.add("draggable","scroll",{start:function(t,n){var r=e(this).data("draggable");if(r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML")r.overflowOffset=r.scrollParent.offset()},drag:function(t,n){var r=e(this).data("draggable"),i=r.options,s=false;if(r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"){if(!i.axis||i.axis!="x"){if(r.overflowOffset.top+r.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity)r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop+i.scrollSpeed;else if(t.pageY-r.overflowOffset.top<i.scrollSensitivity)r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop-i.scrollSpeed}if(!i.axis||i.axis!="y"){if(r.overflowOffset.left+r.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity)r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft+i.scrollSpeed;else if(t.pageX-r.overflowOffset.left<i.scrollSensitivity)r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft-i.scrollSpeed}}else{if(!i.axis||i.axis!="x"){if(t.pageY-e(document).scrollTop()<i.scrollSensitivity)s=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed);else if(e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity)s=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed)}if(!i.axis||i.axis!="y"){if(t.pageX-e(document).scrollLeft()<i.scrollSensitivity)s=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed);else if(e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity)s=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed)}}if(s!==false&&e.ui.ddmanager&&!i.dropBehaviour)e.ui.ddmanager.prepareOffsets(r,t)}});e.ui.plugin.add("draggable","snap",{start:function(t,n){var r=e(this).data("draggable"),i=r.options;r.snapElements=[];e(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var t=e(this);var n=t.offset();if(this!=r.element[0])r.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:n.top,left:n.left})})},drag:function(t,n){var r=e(this).data("draggable"),i=r.options;var s=i.snapTolerance;var o=n.offset.left,u=o+r.helperProportions.width,a=n.offset.top,f=a+r.helperProportions.height;for(var l=r.snapElements.length-1;l>=0;l--){var c=r.snapElements[l].left,h=c+r.snapElements[l].width,p=r.snapElements[l].top,d=p+r.snapElements[l].height;if(!(c-s<o&&o<h+s&&p-s<a&&a<d+s||c-s<o&&o<h+s&&p-s<f&&f<d+s||c-s<u&&u<h+s&&p-s<a&&a<d+s||c-s<u&&u<h+s&&p-s<f&&f<d+s)){if(r.snapElements[l].snapping)r.options.snap.release&&r.options.snap.release.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item}));r.snapElements[l].snapping=false;continue}if(i.snapMode!="inner"){var v=Math.abs(p-f)<=s;var m=Math.abs(d-a)<=s;var g=Math.abs(c-u)<=s;var y=Math.abs(h-o)<=s;if(v)n.position.top=r._convertPositionTo("relative",{top:p-r.helperProportions.height,left:0}).top-r.margins.top;if(m)n.position.top=r._convertPositionTo("relative",{top:d,left:0}).top-r.margins.top;if(g)n.position.left=r._convertPositionTo("relative",{top:0,left:c-r.helperProportions.width}).left-r.margins.left;if(y)n.position.left=r._convertPositionTo("relative",{top:0,left:h}).left-r.margins.left}var b=v||m||g||y;if(i.snapMode!="outer"){var v=Math.abs(p-a)<=s;var m=Math.abs(d-f)<=s;var g=Math.abs(c-o)<=s;var y=Math.abs(h-u)<=s;if(v)n.position.top=r._convertPositionTo("relative",{top:p,left:0}).top-r.margins.top;if(m)n.position.top=r._convertPositionTo("relative",{top:d-r.helperProportions.height,left:0}).top-r.margins.top;if(g)n.position.left=r._convertPositionTo("relative",{top:0,left:c}).left-r.margins.left;if(y)n.position.left=r._convertPositionTo("relative",{top:0,left:h-r.helperProportions.width}).left-r.margins.left}if(!r.snapElements[l].snapping&&(v||m||g||y||b))r.options.snap.snap&&r.options.snap.snap.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item}));r.snapElements[l].snapping=v||m||g||y||b}}});e.ui.plugin.add("draggable","stack",{start:function(t,n){var r=e(this).data("draggable").options;var i=e.makeArray(e(r.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});if(!i.length){return}var s=parseInt(i[0].style.zIndex)||0;e(i).each(function(e){this.style.zIndex=s+e});this[0].style.zIndex=s+i.length}});e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var r=e(n.helper),i=e(this).data("draggable").options;if(r.css("zIndex"))i._zIndex=r.css("zIndex");r.css("zIndex",i.zIndex)},stop:function(t,n){var r=e(this).data("draggable").options;if(r._zIndex)e(n.helper).css("zIndex",r._zIndex)}})})(jQuery);(function(e,t){e.widget("ui.droppable",{version:"1.9.0",widgetEventPrefix:"drop",options:{accept:"*",activeClass:false,addClasses:true,greedy:false,hoverClass:false,scope:"default",tolerance:"intersect"},_create:function(){var t=this.options,n=t.accept;this.isover=0;this.isout=1;this.accept=e.isFunction(n)?n:function(e){return e.is(n)};this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[];e.ui.ddmanager.droppables[t.scope].push(this);t.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];for(var n=0;n<t.length;n++)if(t[n]==this)t.splice(n,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,n){if(t=="accept"){this.accept=e.isFunction(n)?n:function(e){return e.is(n)}}e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var n=e.ui.ddmanager.current;if(this.options.activeClass)this.element.addClass(this.options.activeClass);n&&this._trigger("activate",t,this.ui(n))},_deactivate:function(t){var n=e.ui.ddmanager.current;if(this.options.activeClass)this.element.removeClass(this.options.activeClass);n&&this._trigger("deactivate",t,this.ui(n))},_over:function(t){var n=e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0])return;if(this.accept.call(this.element[0],n.currentItem||n.element)){if(this.options.hoverClass)this.element.addClass(this.options.hoverClass);this._trigger("over",t,this.ui(n))}},_out:function(t){var n=e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0])return;if(this.accept.call(this.element[0],n.currentItem||n.element)){if(this.options.hoverClass)this.element.removeClass(this.options.hoverClass);this._trigger("out",t,this.ui(n))}},_drop:function(t,n){var r=n||e.ui.ddmanager.current;if(!r||(r.currentItem||r.element)[0]==this.element[0])return false;var i=false;this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"droppable");if(t.options.greedy&&!t.options.disabled&&t.options.scope==r.options.scope&&t.accept.call(t.element[0],r.currentItem||r.element)&&e.ui.intersect(r,e.extend(t,{offset:t.element.offset()}),t.options.tolerance)){i=true;return false}});if(i)return false;if(this.accept.call(this.element[0],r.currentItem||r.element)){if(this.options.activeClass)this.element.removeClass(this.options.activeClass);if(this.options.hoverClass)this.element.removeClass(this.options.hoverClass);this._trigger("drop",t,this.ui(r));return this.element}return false},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}});e.ui.intersect=function(t,n,r){if(!n.offset)return false;var i=(t.positionAbs||t.position.absolute).left,s=i+t.helperProportions.width,o=(t.positionAbs||t.position.absolute).top,u=o+t.helperProportions.height;var a=n.offset.left,f=a+n.proportions.width,l=n.offset.top,c=l+n.proportions.height;switch(r){case"fit":return a<=i&&s<=f&&l<=o&&u<=c;break;case"intersect":return a<i+t.helperProportions.width/2&&s-t.helperProportions.width/2<f&&l<o+t.helperProportions.height/2&&u-t.helperProportions.height/2<c;break;case"pointer":var h=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,p=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,d=e.ui.isOver(p,h,l,a,n.proportions.height,n.proportions.width);return d;break;case"touch":return(o>=l&&o<=c||u>=l&&u<=c||o<l&&u>c)&&(i>=a&&i<=f||s>=a&&s<=f||i<a&&s>f);break;default:return false;break}};e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,n){var r=e.ui.ddmanager.droppables[t.options.scope]||[];var i=n?n.type:null;var s=(t.currentItem||t.element).find(":data(droppable)").andSelf();e:for(var o=0;o<r.length;o++){if(r[o].options.disabled||t&&!r[o].accept.call(r[o].element[0],t.currentItem||t.element))continue;for(var u=0;u<s.length;u++){if(s[u]==r[o].element[0]){r[o].proportions.height=0;continue e}}r[o].visible=r[o].element.css("display")!="none";if(!r[o].visible)continue;if(i=="mousedown")r[o]._activate.call(r[o],n);r[o].offset=r[o].element.offset();r[o].proportions={width:r[o].element[0].offsetWidth,height:r[o].element[0].offsetHeight}}},drop:function(t,n){var r=false;e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options)return;if(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance))r=this._drop.call(this,n)||r;if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)){this.isout=1;this.isover=0;this._deactivate.call(this,n)}});return r},dragStart:function(t,n){t.element.parentsUntil("body").bind("scroll.droppable",function(){if(!t.options.refreshPositions)e.ui.ddmanager.prepareOffsets(t,n)})},drag:function(t,n){if(t.options.refreshPositions)e.ui.ddmanager.prepareOffsets(t,n);e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible)return;var r=e.ui.intersect(t,this,this.options.tolerance);var i=!r&&this.isover==1?"isout":r&&this.isover==0?"isover":null;if(!i)return;var s;if(this.options.greedy){var o=this.options.scope;var u=this.element.parents(":data(droppable)").filter(function(){return e.data(this,"droppable").options.scope===o});if(u.length){s=e.data(u[0],"droppable");s.greedyChild=i=="isover"?1:0}}if(s&&i=="isover"){s["isover"]=0;s["isout"]=1;s._out.call(s,n)}this[i]=1;this[i=="isout"?"isover":"isout"]=0;this[i=="isover"?"_over":"_out"].call(this,n);if(s&&i=="isout"){s["isout"]=0;s["isover"]=1;s._over.call(s,n)}})},dragStop:function(t,n){t.element.parentsUntil("body").unbind("scroll.droppable");if(!t.options.refreshPositions)e.ui.ddmanager.prepareOffsets(t,n)}}})(jQuery);(function(e,t){e.widget("ui.resizable",e.ui.mouse,{version:"1.9.0",widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var t=this,n=this.options;this.element.addClass("ui-resizable");e.extend(this,{_aspectRatio:!!n.aspectRatio,aspectRatio:n.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:n.helper||n.ghost||n.animate?n.helper||"ui-resizable-helper":null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)){this.element.wrap(e('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")}));this.element=this.element.parent().data("resizable",this.element.data("resizable"));this.elementIsWrapper=true;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=this.originalElement.css("resize");this.originalElement.css("resize","none");this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"}));this.originalElement.css({margin:this.originalElement.css("margin")});this._proportionallyResize()}this.handles=n.handles||(!e(".ui-resizable-handle",this.element).length?"e,s,se":{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"});if(this.handles.constructor==String){if(this.handles=="all")this.handles="n,e,s,w,se,sw,ne,nw";var r=this.handles.split(",");this.handles={};for(var i=0;i<r.length;i++){var s=e.trim(r[i]),o="ui-resizable-"+s;var u=e('<div class="ui-resizable-handle '+o+'"></div>');u.css({zIndex:n.zIndex});if("se"==s){u.addClass("ui-icon ui-icon-gripsmall-diagonal-se")}this.handles[s]=".ui-resizable-"+s;this.element.append(u)}}this._renderAxis=function(t){t=t||this.element;for(var n in this.handles){if(this.handles[n].constructor==String)this.handles[n]=e(this.handles[n],this.element).show();if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var r=e(this.handles[n],this.element),i=0;i=/sw|ne|nw|se|n|s/.test(n)?r.outerHeight():r.outerWidth();var s=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join("");t.css(s,i);this._proportionallyResize()}if(!e(this.handles[n]).length)continue}};this._renderAxis(this.element);this._handles=e(".ui-resizable-handle",this.element).disableSelection();this._handles.mouseover(function(){if(!t.resizing){if(this.className)var e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);t.axis=e&&e[1]?e[1]:"se"}});if(n.autoHide){this._handles.hide();e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){if(n.disabled)return;e(this).removeClass("ui-resizable-autohide");t._handles.show()}).mouseleave(function(){if(n.disabled)return;if(!t.resizing){e(this).addClass("ui-resizable-autohide");t._handles.hide()}})}this._mouseInit()},_destroy:function(){this._mouseDestroy();var t=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){t(this.element);var n=this.element;n.after(this.originalElement.css({position:n.css("position"),width:n.outerWidth(),height:n.outerHeight(),top:n.css("top"),left:n.css("left")})).remove()}this.originalElement.css("resize",this.originalResizeStyle);t(this.originalElement);return this},_mouseCapture:function(t){var n=false;for(var r in this.handles){if(e(this.handles[r])[0]==t.target){n=true}}return!this.options.disabled&&n},_mouseStart:function(t){var r=this.options,i=this.element.position(),s=this.element;this.resizing=true;this.documentScroll={top:e(document).scrollTop(),left:e(document).scrollLeft()};if(s.is(".ui-draggable")||/absolute/.test(s.css("position"))){s.css({position:"absolute",top:i.top,left:i.left})}this._renderProxy();var o=n(this.helper.css("left")),u=n(this.helper.css("top"));if(r.containment){o+=e(r.containment).scrollLeft()||0;u+=e(r.containment).scrollTop()||0}this.offset=this.helper.offset();this.position={left:o,top:u};this.size=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()};this.originalSize=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()};this.originalPosition={left:o,top:u};this.sizeDiff={width:s.outerWidth()-s.width(),height:s.outerHeight()-s.height()};this.originalMousePosition={left:t.pageX,top:t.pageY};this.aspectRatio=typeof r.aspectRatio=="number"?r.aspectRatio:this.originalSize.width/this.originalSize.height||1;var a=e(".ui-resizable-"+this.axis).css("cursor");e("body").css("cursor",a=="auto"?this.axis+"-resize":a);s.addClass("ui-resizable-resizing");this._propagate("start",t);return true},_mouseDrag:function(e){var t=this.helper,n=this.options,r={},i=this,s=this.originalMousePosition,o=this.axis;var u=e.pageX-s.left||0,a=e.pageY-s.top||0;var f=this._change[o];if(!f)return false;var l=f.apply(this,[e,u,a]);this._updateVirtualBoundaries(e.shiftKey);if(this._aspectRatio||e.shiftKey)l=this._updateRatio(l,e);l=this._respectSize(l,e);this._propagate("resize",e);t.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"});if(!this._helper&&this._proportionallyResizeElements.length)this._proportionallyResize();this._updateCache(l);this._trigger("resize",e,this.ui());return false},_mouseStop:function(t){this.resizing=false;var n=this.options,r=this;if(this._helper){var i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),o=s&&e.ui.hasScroll(i[0],"left")?0:r.sizeDiff.height,u=s?0:r.sizeDiff.width;var a={width:r.helper.width()-u,height:r.helper.height()-o},f=parseInt(r.element.css("left"),10)+(r.position.left-r.originalPosition.left)||null,l=parseInt(r.element.css("top"),10)+(r.position.top-r.originalPosition.top)||null;if(!n.animate)this.element.css(e.extend(a,{top:l,left:f}));r.helper.height(r.size.height);r.helper.width(r.size.width);if(this._helper&&!n.animate)this._proportionallyResize()}e("body").css("cursor","auto");this.element.removeClass("ui-resizable-resizing");this._propagate("stop",t);if(this._helper)this.helper.remove();return false},_updateVirtualBoundaries:function(e){var t=this.options,n,i,s,o,u;u={minWidth:r(t.minWidth)?t.minWidth:0,maxWidth:r(t.maxWidth)?t.maxWidth:Infinity,minHeight:r(t.minHeight)?t.minHeight:0,maxHeight:r(t.maxHeight)?t.maxHeight:Infinity};if(this._aspectRatio||e){n=u.minHeight*this.aspectRatio;s=u.minWidth/this.aspectRatio;i=u.maxHeight*this.aspectRatio;o=u.maxWidth/this.aspectRatio;if(n>u.minWidth)u.minWidth=n;if(s>u.minHeight)u.minHeight=s;if(i<u.maxWidth)u.maxWidth=i;if(o<u.maxHeight)u.maxHeight=o}this._vBoundaries=u},_updateCache:function(e){var t=this.options;this.offset=this.helper.offset();if(r(e.left))this.position.left=e.left;if(r(e.top))this.position.top=e.top;if(r(e.height))this.size.height=e.height;if(r(e.width))this.size.width=e.width},_updateRatio:function(e,t){var n=this.options,i=this.position,s=this.size,o=this.axis;if(r(e.height))e.width=e.height*this.aspectRatio;else if(r(e.width))e.height=e.width/this.aspectRatio;if(o=="sw"){e.left=i.left+(s.width-e.width);e.top=null}if(o=="nw"){e.top=i.top+(s.height-e.height);e.left=i.left+(s.width-e.width)}return e},_respectSize:function(e,t){var n=this.helper,i=this._vBoundaries,s=this._aspectRatio||t.shiftKey,o=this.axis,u=r(e.width)&&i.maxWidth&&i.maxWidth<e.width,a=r(e.height)&&i.maxHeight&&i.maxHeight<e.height,f=r(e.width)&&i.minWidth&&i.minWidth>e.width,l=r(e.height)&&i.minHeight&&i.minHeight>e.height;if(f)e.width=i.minWidth;if(l)e.height=i.minHeight;if(u)e.width=i.maxWidth;if(a)e.height=i.maxHeight;var c=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height;var p=/sw|nw|w/.test(o),d=/nw|ne|n/.test(o);if(f&&p)e.left=c-i.minWidth;if(u&&p)e.left=c-i.maxWidth;if(l&&d)e.top=h-i.minHeight;if(a&&d)e.top=h-i.maxHeight;var v=!e.width&&!e.height;if(v&&!e.left&&e.top)e.top=null;else if(v&&!e.top&&e.left)e.left=null;return e},_proportionallyResize:function(){var t=this.options;if(!this._proportionallyResizeElements.length)return;var n=this.helper||this.element;for(var r=0;r<this._proportionallyResizeElements.length;r++){var i=this._proportionallyResizeElements[r];if(!this.borderDif){var s=[i.css("borderTopWidth"),i.css("borderRightWidth"),i.css("borderBottomWidth"),i.css("borderLeftWidth")],o=[i.css("paddingTop"),i.css("paddingRight"),i.css("paddingBottom"),i.css("paddingLeft")];this.borderDif=e.map(s,function(e,t){var n=parseInt(e,10)||0,r=parseInt(o[t],10)||0;return n+r})}i.css({height:n.height()-this.borderDif[0]-this.borderDif[2]||0,width:n.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var t=this.element,n=this.options;this.elementOffset=t.offset();if(this._helper){this.helper=this.helper||e('<div style="overflow:hidden;"></div>');var r=e.browser.msie&&e.browser.version<7,i=r?1:0,s=r?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+s,height:this.element.outerHeight()+s,position:"absolute",left:this.elementOffset.left-i+"px",top:this.elementOffset.top-i+"px",zIndex:++n.zIndex});this.helper.appendTo("body").disableSelection()}else{this.helper=this.element}},_change:{e:function(e,t,n){return{width:this.originalSize.width+t}},w:function(e,t,n){var r=this.options,i=this.originalSize,s=this.originalPosition;return{left:s.left+t,width:i.width-t}},n:function(e,t,n){var r=this.options,i=this.originalSize,s=this.originalPosition;return{top:s.top+n,height:i.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},sw:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,r]))},ne:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},nw:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,r]))}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]);t!="resize"&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}});e.ui.plugin.add("resizable","alsoResize",{start:function(t,n){var r=e(this).data("resizable"),i=r.options;var s=function(t){e(t).each(function(){var t=e(this);t.data("resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};if(typeof i.alsoResize=="object"&&!i.alsoResize.parentNode){if(i.alsoResize.length){i.alsoResize=i.alsoResize[0];s(i.alsoResize)}else{e.each(i.alsoResize,function(e){s(e)})}}else{s(i.alsoResize)}},resize:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.originalSize,o=r.originalPosition;var u={height:r.size.height-s.height||0,width:r.size.width-s.width||0,top:r.position.top-o.top||0,left:r.position.left-o.left||0},a=function(t,r){e(t).each(function(){var t=e(this),i=e(this).data("resizable-alsoresize"),s={},o=r&&r.length?r:t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(o,function(e,t){var n=(i[t]||0)+(u[t]||0);if(n&&n>=0)s[t]=n||null});t.css(s)})};if(typeof i.alsoResize=="object"&&!i.alsoResize.nodeType){e.each(i.alsoResize,function(e,t){a(e,t)})}else{a(i.alsoResize)}},stop:function(t,n){e(this).removeData("resizable-alsoresize")}});e.ui.plugin.add("resizable","animate",{stop:function(t,n){var r=e(this).data("resizable"),i=r.options;var s=r._proportionallyResizeElements,o=s.length&&/textarea/i.test(s[0].nodeName),u=o&&e.ui.hasScroll(s[0],"left")?0:r.sizeDiff.height,a=o?0:r.sizeDiff.width;var f={width:r.size.width-a,height:r.size.height-u},l=parseInt(r.element.css("left"),10)+(r.position.left-r.originalPosition.left)||null,c=parseInt(r.element.css("top"),10)+(r.position.top-r.originalPosition.top)||null;r.element.animate(e.extend(f,c&&l?{top:c,left:l}:{}),{duration:i.animateDuration,easing:i.animateEasing,step:function(){var n={width:parseInt(r.element.css("width"),10),height:parseInt(r.element.css("height"),10),top:parseInt(r.element.css("top"),10),left:parseInt(r.element.css("left"),10)};if(s&&s.length)e(s[0]).css({width:n.width,height:n.height});r._updateCache(n);r._propagate("resize",t)}})}});e.ui.plugin.add("resizable","containment",{start:function(t,r){var i=e(this).data("resizable"),s=i.options,o=i.element;var u=s.containment,a=u instanceof e?u.get(0):/parent/.test(u)?o.parent().get(0):u;if(!a)return;i.containerElement=e(a);if(/document/.test(u)||u==document){i.containerOffset={left:0,top:0};i.containerPosition={left:0,top:0};i.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}}else{var f=e(a),l=[];e(["Top","Right","Left","Bottom"]).each(function(e,t){l[e]=n(f.css("padding"+t))});i.containerOffset=f.offset();i.containerPosition=f.position();i.containerSize={height:f.innerHeight()-l[3],width:f.innerWidth()-l[1]};var c=i.containerOffset,h=i.containerSize.height,p=i.containerSize.width,d=e.ui.hasScroll(a,"left")?a.scrollWidth:p,v=e.ui.hasScroll(a)?a.scrollHeight:h;i.parentData={element:a,left:c.left,top:c.top,width:d,height:v}}},resize:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.containerSize,o=r.containerOffset,u=r.size,a=r.position,f=r._aspectRatio||t.shiftKey,l={top:0,left:0},c=r.containerElement;if(c[0]!=document&&/static/.test(c.css("position")))l=o;if(a.left<(r._helper?o.left:0)){r.size.width=r.size.width+(r._helper?r.position.left-o.left:r.position.left-l.left);if(f)r.size.height=r.size.width/r.aspectRatio;r.position.left=i.helper?o.left:0}if(a.top<(r._helper?o.top:0)){r.size.height=r.size.height+(r._helper?r.position.top-o.top:r.position.top);if(f)r.size.width=r.size.height*r.aspectRatio;r.position.top=r._helper?o.top:0}r.offset.left=r.parentData.left+r.position.left;r.offset.top=r.parentData.top+r.position.top;var h=Math.abs((r._helper?r.offset.left-l.left:r.offset.left-l.left)+r.sizeDiff.width),p=Math.abs((r._helper?r.offset.top-l.top:r.offset.top-o.top)+r.sizeDiff.height);var d=r.containerElement.get(0)==r.element.parent().get(0),v=/relative|absolute/.test(r.containerElement.css("position"));if(d&&v)h-=r.parentData.left;if(h+r.size.width>=r.parentData.width){r.size.width=r.parentData.width-h;if(f)r.size.height=r.size.width/r.aspectRatio}if(p+r.size.height>=r.parentData.height){r.size.height=r.parentData.height-p;if(f)r.size.width=r.size.height*r.aspectRatio}},stop:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.position,o=r.containerOffset,u=r.containerPosition,a=r.containerElement;var f=e(r.helper),l=f.offset(),c=f.outerWidth()-r.sizeDiff.width,h=f.outerHeight()-r.sizeDiff.height;if(r._helper&&!i.animate&&/relative/.test(a.css("position")))e(this).css({left:l.left-u.left-o.left,width:c,height:h});if(r._helper&&!i.animate&&/static/.test(a.css("position")))e(this).css({left:l.left-u.left-o.left,width:c,height:h})}});e.ui.plugin.add("resizable","ghost",{start:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.size;r.ghost=r.originalElement.clone();r.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof i.ghost=="string"?i.ghost:"");r.ghost.appendTo(r.helper)},resize:function(t,n){var r=e(this).data("resizable"),i=r.options;if(r.ghost)r.ghost.css({position:"relative",height:r.size.height,width:r.size.width})},stop:function(t,n){var r=e(this).data("resizable"),i=r.options;if(r.ghost&&r.helper)r.helper.get(0).removeChild(r.ghost.get(0))}});e.ui.plugin.add("resizable","grid",{resize:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.size,o=r.originalSize,u=r.originalPosition,a=r.axis,f=i._aspectRatio||t.shiftKey;i.grid=typeof i.grid=="number"?[i.grid,i.grid]:i.grid;var l=Math.round((s.width-o.width)/(i.grid[0]||1))*(i.grid[0]||1),c=Math.round((s.height-o.height)/(i.grid[1]||1))*(i.grid[1]||1);if(/^(se|s|e)$/.test(a)){r.size.width=o.width+l;r.size.height=o.height+c}else if(/^(ne)$/.test(a)){r.size.width=o.width+l;r.size.height=o.height+c;r.position.top=u.top-c}else if(/^(sw)$/.test(a)){r.size.width=o.width+l;r.size.height=o.height+c;r.position.left=u.left-l}else{r.size.width=o.width+l;r.size.height=o.height+c;r.position.top=u.top-c;r.position.left=u.left-l}}});var n=function(e){return parseInt(e,10)||0};var r=function(e){return!isNaN(parseInt(e,10))}})(jQuery);(function(e,t){e.widget("ui.selectable",e.ui.mouse,{version:"1.9.0",options:{appendTo:"body",autoRefresh:true,distance:0,filter:"*",tolerance:"touch"},_create:function(){var t=this;this.element.addClass("ui-selectable");this.dragged=false;var n;this.refresh=function(){n=e(t.options.filter,t.element[0]);n.addClass("ui-selectee");n.each(function(){var t=e(this);var n=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:n.left,top:n.top,right:n.left+t.outerWidth(),bottom:n.top+t.outerHeight(),startselected:false,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})};this.refresh();this.selectees=n.addClass("ui-selectee");this._mouseInit();this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item");this.element.removeClass("ui-selectable ui-selectable-disabled");this._mouseDestroy()},_mouseStart:function(t){var n=this;this.opos=[t.pageX,t.pageY];if(this.options.disabled)return;var r=this.options;this.selectees=e(r.filter,this.element[0]);this._trigger("start",t);e(r.appendTo).append(this.helper);this.helper.css({left:t.clientX,top:t.clientY,width:0,height:0});if(r.autoRefresh){this.refresh()}this.selectees.filter(".ui-selected").each(function(){var r=e.data(this,"selectable-item");r.startselected=true;if(!t.metaKey&&!t.ctrlKey){r.$element.removeClass("ui-selected");r.selected=false;r.$element.addClass("ui-unselecting");r.unselecting=true;n._trigger("unselecting",t,{unselecting:r.element})}});e(t.target).parents().andSelf().each(function(){var r=e.data(this,"selectable-item");if(r){var i=!t.metaKey&&!t.ctrlKey||!r.$element.hasClass("ui-selected");r.$element.removeClass(i?"ui-unselecting":"ui-selected").addClass(i?"ui-selecting":"ui-unselecting");r.unselecting=!i;r.selecting=i;r.selected=i;if(i){n._trigger("selecting",t,{selecting:r.element})}else{n._trigger("unselecting",t,{unselecting:r.element})}return false}})},_mouseDrag:function(t){var n=this;this.dragged=true;if(this.options.disabled)return;var r=this.options;var i=this.opos[0],s=this.opos[1],o=t.pageX,u=t.pageY;if(i>o){var a=o;o=i;i=a}if(s>u){var a=u;u=s;s=a}this.helper.css({left:i,top:s,width:o-i,height:u-s});this.selectees.each(function(){var a=e.data(this,"selectable-item");if(!a||a.element==n.element[0])return;var f=false;if(r.tolerance=="touch"){f=!(a.left>o||a.right<i||a.top>u||a.bottom<s)}else if(r.tolerance=="fit"){f=a.left>i&&a.right<o&&a.top>s&&a.bottom<u}if(f){if(a.selected){a.$element.removeClass("ui-selected");a.selected=false}if(a.unselecting){a.$element.removeClass("ui-unselecting");a.unselecting=false}if(!a.selecting){a.$element.addClass("ui-selecting");a.selecting=true;n._trigger("selecting",t,{selecting:a.element})}}else{if(a.selecting){if((t.metaKey||t.ctrlKey)&&a.startselected){a.$element.removeClass("ui-selecting");a.selecting=false;a.$element.addClass("ui-selected");a.selected=true}else{a.$element.removeClass("ui-selecting");a.selecting=false;if(a.startselected){a.$element.addClass("ui-unselecting");a.unselecting=true}n._trigger("unselecting",t,{unselecting:a.element})}}if(a.selected){if(!t.metaKey&&!t.ctrlKey&&!a.startselected){a.$element.removeClass("ui-selected");a.selected=false;a.$element.addClass("ui-unselecting");a.unselecting=true;n._trigger("unselecting",t,{unselecting:a.element})}}}});return false},_mouseStop:function(t){var n=this;this.dragged=false;var r=this.options;e(".ui-unselecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-unselecting");r.unselecting=false;r.startselected=false;n._trigger("unselected",t,{unselected:r.element})});e(".ui-selecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-selecting").addClass("ui-selected");r.selecting=false;r.selected=true;r.startselected=true;n._trigger("selected",t,{selected:r.element})});this._trigger("stop",t);this.helper.remove();return false}})})(jQuery);(function(e,t){e.widget("ui.sortable",e.ui.mouse,{version:"1.9.0",widgetEventPrefix:"sort",ready:false,options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:"auto",cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:"> *",opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var e=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?e.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):false;this.offset=this.element.offset();this._mouseInit();this.ready=true},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled");this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,n){if(t==="disabled"){this.options[t]=n;this.widget().toggleClass("ui-sortable-disabled",!!n)}else{e.Widget.prototype._setOption.apply(this,arguments)}},_mouseCapture:function(t,n){var r=this;if(this.reverting){return false}if(this.options.disabled||this.options.type=="static")return false;this._refreshItems(t);var i=null,s=e(t.target).parents().each(function(){if(e.data(this,r.widgetName+"-item")==r){i=e(this);return false}});if(e.data(t.target,r.widgetName+"-item")==r)i=e(t.target);if(!i)return false;if(this.options.handle&&!n){var o=false;e(this.options.handle,i).find("*").andSelf().each(function(){if(this==t.target)o=true});if(!o)return false}this.currentItem=i;this._removeCurrentsFromItems();return true},_mouseStart:function(t,n,r){var i=this.options;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(t);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");this.originalPosition=this._generatePosition(t);this.originalPageX=t.pageX;this.originalPageY=t.pageY;i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt);this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!=this.currentItem[0]){this.currentItem.hide()}this._createPlaceholder();if(i.containment)this._setContainment();if(i.cursor){if(e("body").css("cursor"))this._storedCursor=e("body").css("cursor");e("body").css("cursor",i.cursor)}if(i.opacity){if(this.helper.css("opacity"))this._storedOpacity=this.helper.css("opacity");this.helper.css("opacity",i.opacity)}if(i.zIndex){if(this.helper.css("zIndex"))this._storedZIndex=this.helper.css("zIndex");this.helper.css("zIndex",i.zIndex)}if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML")this.overflowOffset=this.scrollParent.offset();this._trigger("start",t,this._uiHash());if(!this._preserveHelperProportions)this._cacheHelperProportions();if(!r){for(var s=this.containers.length-1;s>=0;s--){this.containers[s]._trigger("activate",t,this._uiHash(this))}}if(e.ui.ddmanager)e.ui.ddmanager.current=this;if(e.ui.ddmanager&&!i.dropBehaviour)e.ui.ddmanager.prepareOffsets(this,t);this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(t);return true},_mouseDrag:function(t){this.position=this._generatePosition(t);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs){this.lastPositionAbs=this.positionAbs}if(this.options.scroll){var n=this.options,r=false;if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"){if(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity)this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+n.scrollSpeed;else if(t.pageY-this.overflowOffset.top<n.scrollSensitivity)this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-n.scrollSpeed;if(this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity)this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+n.scrollSpeed;else if(t.pageX-this.overflowOffset.left<n.scrollSensitivity)this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-n.scrollSpeed}else{if(t.pageY-e(document).scrollTop()<n.scrollSensitivity)r=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed);else if(e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity)r=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed);if(t.pageX-e(document).scrollLeft()<n.scrollSensitivity)r=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed);else if(e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity)r=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed)}if(r!==false&&e.ui.ddmanager&&!n.dropBehaviour)e.ui.ddmanager.prepareOffsets(this,t)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(var i=this.items.length-1;i>=0;i--){var s=this.items[i],o=s.item[0],u=this._intersectsWithPointer(s);if(!u)continue;if(s.instance!==this.currentContainer)continue;if(o!=this.currentItem[0]&&this.placeholder[u==1?"next":"prev"]()[0]!=o&&!e.contains(this.placeholder[0],o)&&(this.options.type=="semi-dynamic"?!e.contains(this.element[0],o):true)){this.direction=u==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(s)){this._rearrange(t,s)}else{break}this._trigger("change",t,this._uiHash());break}}this._contactContainers(t);if(e.ui.ddmanager)e.ui.ddmanager.drag(this,t);this._trigger("sort",t,this._uiHash());this.lastPositionAbs=this.positionAbs;return false},_mouseStop:function(t,n){if(!t)return;if(e.ui.ddmanager&&!this.options.dropBehaviour)e.ui.ddmanager.drop(this,t);if(this.options.revert){var r=this;var i=this.placeholder.offset();this.reverting=true;e(this.helper).animate({left:i.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:i.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){r._clear(t)})}else{this._clear(t,n)}return false},cancel:function(){if(this.dragging){this._mouseUp({target:null});if(this.options.helper=="original")this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");else this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--){this.containers[t]._trigger("deactivate",null,this._uiHash(this));if(this.containers[t].containerCache.over){this.containers[t]._trigger("out",null,this._uiHash(this));this.containers[t].containerCache.over=0}}}if(this.placeholder){if(this.placeholder[0].parentNode)this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.options.helper!="original"&&this.helper&&this.helper[0].parentNode)this.helper.remove();e.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){e(this.domPosition.prev).after(this.currentItem)}else{e(this.domPosition.parent).prepend(this.currentItem)}}return this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected);var r=[];t=t||{};e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);if(n)r.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))});if(!r.length&&t.key){r.push(t.key+"=")}return r.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected);var r=[];t=t||{};n.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")});return r},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height;var s=e.left,o=s+e.width,u=e.top,a=u+e.height;var f=this.offset.click.top,l=this.offset.click.left;var c=r+f>u&&r+f<a&&t+l>s&&t+l<o;if(this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]){return c}else{return s<t+this.helperProportions.width/2&&n-this.helperProportions.width/2<o&&u<r+this.helperProportions.height/2&&i-this.helperProportions.height/2<a}},_intersectsWithPointer:function(t){var n=this.options.axis==="x"||e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),r=this.options.axis==="y"||e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),i=n&&r,s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();if(!i)return false;return this.floating?o&&o=="right"||s=="down"?2:1:s&&(s=="down"?2:1)},_intersectsWithSides:function(t){var n=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),r=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),i=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();if(this.floating&&s){return s=="right"&&r||s=="left"&&!r}else{return i&&(i=="down"&&n||i=="up"&&!n)}},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return e!=0&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return e!=0&&(e>0?"right":"left")},refresh:function(e){this._refreshItems(e);this.refreshPositions();return this},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var n=[];var r=[];var i=this._connectWith();if(i&&t){for(var s=i.length-1;s>=0;s--){var o=e(i[s]);for(var u=o.length-1;u>=0;u--){var a=e.data(o[u],this.widgetName);if(a&&a!=this&&!a.options.disabled){r.push([e.isFunction(a.options.items)?a.options.items.call(a.element):e(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a])}}}}r.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var s=r.length-1;s>=0;s--){r[s][0].each(function(){n.push(this)})}return e(n)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");for(var t=0;t<this.items.length;t++){for(var n=0;n<e.length;n++){if(e[n]==this.items[t].item[0])this.items.splice(t,1)}}},_refreshItems:function(t){this.items=[];this.containers=[this];var n=this.items;var r=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]];var i=this._connectWith();if(i&&this.ready){for(var s=i.length-1;s>=0;s--){var o=e(i[s]);for(var u=o.length-1;u>=0;u--){var a=e.data(o[u],this.widgetName);if(a&&a!=this&&!a.options.disabled){r.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]);this.containers.push(a)}}}}for(var s=r.length-1;s>=0;s--){var f=r[s][1];var l=r[s][0];for(var u=0,c=l.length;u<c;u++){var h=e(l[u]);h.data(this.widgetName+"-item",f);n.push({item:h,instance:f,width:0,height:0,left:0,top:0})}}},refreshPositions:function(t){if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset()}for(var n=this.items.length-1;n>=0;n--){var r=this.items[n];if(r.instance!=this.currentContainer&&this.currentContainer&&r.item[0]!=this.currentItem[0])continue;var i=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item;if(!t){r.width=i.outerWidth();r.height=i.outerHeight()}var s=i.offset();r.left=s.left;r.top=s.top}if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this)}else{for(var n=this.containers.length-1;n>=0;n--){var s=this.containers[n].element.offset();this.containers[n].containerCache.left=s.left;this.containers[n].containerCache.top=s.top;this.containers[n].containerCache.width=this.containers[n].element.outerWidth();this.containers[n].containerCache.height=this.containers[n].element.outerHeight()}}return this},_createPlaceholder:function(t){t=t||this;var n=t.options;if(!n.placeholder||n.placeholder.constructor==String){var r=n.placeholder;n.placeholder={element:function(){var n=e(document.createElement(t.currentItem[0].nodeName)).addClass(r||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];if(!r)n.style.visibility="hidden";return n},update:function(e,i){if(r&&!n.forcePlaceholderSize)return;if(!i.height()){i.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10))}if(!i.width()){i.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10))}}}}t.placeholder=e(n.placeholder.element.call(t.element,t.currentItem));t.currentItem.after(t.placeholder);n.placeholder.update(t,t.placeholder)},_contactContainers:function(t){var n=null,r=null;for(var i=this.containers.length-1;i>=0;i--){if(e.contains(this.currentItem[0],this.containers[i].element[0]))continue;if(this._intersectsWith(this.containers[i].containerCache)){if(n&&e.contains(this.containers[i].element[0],n.element[0]))continue;n=this.containers[i];r=i}else{if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",t,this._uiHash(this));this.containers[i].containerCache.over=0}}}if(!n)return;if(this.containers.length===1){this.containers[r]._trigger("over",t,this._uiHash(this));this.containers[r].containerCache.over=1}else if(this.currentContainer!=this.containers[r]){var s=1e4;var o=null;var u=this.positionAbs[this.containers[r].floating?"left":"top"];for(var a=this.items.length-1;a>=0;a--){if(!e.contains(this.containers[r].element[0],this.items[a].item[0]))continue;var f=this.containers[r].floating?this.items[a].item.offset().left:this.items[a].item.offset().top;if(Math.abs(f-u)<s){s=Math.abs(f-u);o=this.items[a];this.direction=f-u>0?"down":"up"}}if(!o&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[r];o?this._rearrange(t,o,null,true):this._rearrange(t,null,this.containers[r].element,true);this._trigger("change",t,this._uiHash());this.containers[r]._trigger("change",t,this._uiHash(this));this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[r]._trigger("over",t,this._uiHash(this));this.containers[r].containerCache.over=1}},_createHelper:function(t){var n=this.options;var r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):n.helper=="clone"?this.currentItem.clone():this.currentItem;if(!r.parents("body").length)e(n.appendTo!="parent"?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]);if(r[0]==this.currentItem[0])this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")};if(r[0].style.width==""||n.forceHelperSize)r.width(this.currentItem.width());if(r[0].style.height==""||n.forceHelperSize)r.height(this.currentItem.height());return r},_adjustOffsetFromHelper:function(t){if(typeof t=="string"){t=t.split(" ")}if(e.isArray(t)){t={left:+t[0],top:+t[1]||0}}if("left"in t){this.offset.click.left=t.left+this.margins.left}if("right"in t){this.offset.click.left=this.helperProportions.width-t.right+this.margins.left}if("top"in t){this.offset.click.top=t.top+this.margins.top}if("bottom"in t){this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])){t.left+=this.scrollParent.scrollLeft();t.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.browser.msie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else{return{top:0,left:0}}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if(t.containment=="parent")t.containment=this.helper[0].parentNode;if(t.containment=="document"||t.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)){var n=e(t.containment)[0];var r=e(t.containment).offset();var i=e(n).css("overflow")!="hidden";this.containment=[r.left+(parseInt(e(n).css("borderLeftWidth"),10)||0)+(parseInt(e(n).css("paddingLeft"),10)||0)-this.margins.left,r.top+(parseInt(e(n).css("borderTopWidth"),10)||0)+(parseInt(e(n).css("paddingTop"),10)||0)-this.margins.top,r.left+(i?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(e(n).css("borderLeftWidth"),10)||0)-(parseInt(e(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,r.top+(i?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(e(n).css("borderTopWidth"),10)||0)-(parseInt(e(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,n){if(!n)n=this.position;var r=t=="absolute"?1:-1;var i=this.options,s=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,o=/(html|body)/i.test(s[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r}},_generatePosition:function(t){var n=this.options,r=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,i=/(html|body)/i.test(r[0].tagName);if(this.cssPosition=="relative"&&!(this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0])){this.offset.relative=this._getRelativeOffset()}var s=t.pageX;var o=t.pageY;if(this.originalPosition){if(this.containment){if(t.pageX-this.offset.click.left<this.containment[0])s=this.containment[0]+this.offset.click.left;if(t.pageY-this.offset.click.top<this.containment[1])o=this.containment[1]+this.offset.click.top;if(t.pageX-this.offset.click.left>this.containment[2])s=this.containment[2]+this.offset.click.left;if(t.pageY-this.offset.click.top>this.containment[3])o=this.containment[3]+this.offset.click.top}if(n.grid){var u=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1];o=this.containment?!(u-this.offset.click.top<this.containment[1]||u-this.offset.click.top>this.containment[3])?u:!(u-this.offset.click.top<this.containment[1])?u-n.grid[1]:u+n.grid[1]:u;var a=this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0];s=this.containment?!(a-this.offset.click.left<this.containment[0]||a-this.offset.click.left>this.containment[2])?a:!(a-this.offset.click.left<this.containment[0])?a-n.grid[0]:a+n.grid[0]:a}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_rearrange:function(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?t.item[0]:t.item[0].nextSibling);this.counter=this.counter?++this.counter:1;var i=this.counter;this._delay(function(){if(i==this.counter)this.refreshPositions(!r)})},_clear:function(t,n){this.reverting=false;var r=[];if(!this._noFinalSort&&this.currentItem.parent().length)this.placeholder.before(this.currentItem);this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var i in this._storedCSS){if(this._storedCSS[i]=="auto"||this._storedCSS[i]=="static")this._storedCSS[i]=""}this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else{this.currentItem.show()}if(this.fromOutside&&!n)r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))});if((this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!n)r.push(function(e){this._trigger("update",e,this._uiHash())});if(this!==this.currentContainer){if(!n){r.push(function(e){this._trigger("remove",e,this._uiHash())});r.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer));r.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer))}}for(var i=this.containers.length-1;i>=0;i--){if(!n)r.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[i]));if(this.containers[i].containerCache.over){r.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[i]));this.containers[i].containerCache.over=0}}if(this._storedCursor)e("body").css("cursor",this._storedCursor);if(this._storedOpacity)this.helper.css("opacity",this._storedOpacity);if(this._storedZIndex)this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex);this.dragging=false;if(this.cancelHelperRemoval){if(!n){this._trigger("beforeStop",t,this._uiHash());for(var i=0;i<r.length;i++){r[i].call(this,t)}this._trigger("stop",t,this._uiHash())}this.fromOutside=false;return false}if(!n)this._trigger("beforeStop",t,this._uiHash());this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.helper[0]!=this.currentItem[0])this.helper.remove();this.helper=null;if(!n){for(var i=0;i<r.length;i++){r[i].call(this,t)}this._trigger("stop",t,this._uiHash())}this.fromOutside=false;return true},_trigger:function(){if(e.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel()}},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}})})(jQuery);(function(e,t){var n=0,r={},i={};r.height=r.paddingTop=r.paddingBottom=r.borderTopWidth=r.borderBottomWidth="hide";i.height=i.paddingTop=i.paddingBottom=i.borderTopWidth=i.borderBottomWidth="show";e.widget("ui.accordion",{version:"1.9.0",options:{active:0,animate:{},collapsible:false,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var t=this.accordionId="ui-accordion-"+(this.element.attr("id")||++n),r=this.options;this.prevShow=this.prevHide=e();this.element.addClass("ui-accordion ui-widget ui-helper-reset");this.headers=this.element.find(r.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all");this._hoverable(this.headers);this._focusable(this.headers);this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").hide();if(!r.collapsible&&r.active===false){r.active=0}if(r.active<0){r.active+=this.headers.length}this.active=this._findActive(r.active).addClass("ui-accordion-header-active ui-state-active").toggleClass("ui-corner-all ui-corner-top");this.active.next().addClass("ui-accordion-content-active").show();this._createIcons();this.originalHeight=this.element[0].style.height;this.refresh();this.element.attr("role","tablist");this.headers.attr("role","tab").each(function(n){var r=e(this),i=r.attr("id"),s=r.next(),o=s.attr("id");if(!i){i=t+"-header-"+n;r.attr("id",i)}if(!o){o=t+"-panel-"+n;s.attr("id",o)}r.attr("aria-controls",o);s.attr("aria-labelledby",i)}).next().attr("role","tabpanel");this.headers.not(this.active).attr({"aria-selected":"false",tabIndex:-1}).next().attr({"aria-expanded":"false","aria-hidden":"true"}).hide();if(!this.active.length){this.headers.eq(0).attr("tabIndex",0)}else{this.active.attr({"aria-selected":"true",tabIndex:0}).next().attr({"aria-expanded":"true","aria-hidden":"false"})}this._on(this.headers,{keydown:"_keydown"});this._on(this.headers.next(),{keydown:"_panelKeyDown"});this._setupEvents(r.event)},_getCreateEventData:function(){return{header:this.active,content:!this.active.length?e():this.active.next()}},_createIcons:function(){var t=this.options.icons;if(t){e("<span>").addClass("ui-accordion-header-icon ui-icon "+t.header).prependTo(this.headers);this.active.children(".ui-accordion-header-icon").removeClass(t.header).addClass(t.activeHeader);this.headers.addClass("ui-accordion-icons")}},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role");this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each(function(){if(/^ui-accordion/.test(this.id)){this.removeAttribute("id")}});this._destroyIcons();e=this.headers.next().css("display","").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each(function(){if(/^ui-accordion/.test(this.id)){this.removeAttribute("id")}});if(this.options.heightStyle!=="content"){this.element.css("height",this.originalHeight);e.css("height","")}},_setOption:function(e,t){if(e==="active"){this._activate(t);return}if(e==="event"){if(this.options.event){this._off(this.headers,this.options.event)}this._setupEvents(t)}this._super(e,t);if(e==="collapsible"&&!t&&this.options.active===false){this._activate(0)}if(e==="icons"){this._destroyIcons();if(t){this._createIcons()}}if(e==="disabled"){this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t)}},_keydown:function(t){if(t.altKey||t.ctrlKey){return}var n=e.ui.keyCode,r=this.headers.length,i=this.headers.index(t.target),s=false;switch(t.keyCode){case n.RIGHT:case n.DOWN:s=this.headers[(i+1)%r];break;case n.LEFT:case n.UP:s=this.headers[(i-1+r)%r];break;case n.SPACE:case n.ENTER:this._eventHandler(t);break;case n.HOME:s=this.headers[0];break;case n.END:s=this.headers[r-1];break}if(s){e(t.target).attr("tabIndex",-1);e(s).attr("tabIndex",0);s.focus();t.preventDefault()}},_panelKeyDown:function(t){if(t.keyCode===e.ui.keyCode.UP&&t.ctrlKey){e(t.currentTarget).prev().focus()}},refresh:function(){var t,n,r=this.options.heightStyle,i=this.element.parent();this.element.css("height",this.originalHeight);if(r==="fill"){if(!e.support.minHeight){n=i.css("overflow");i.css("overflow","hidden")}t=i.height();this.element.siblings(":visible").each(function(){var n=e(this),r=n.css("position");if(r==="absolute"||r==="fixed"){return}t-=n.outerHeight(true)});if(n){i.css("overflow",n)}this.headers.each(function(){t-=e(this).outerHeight(true)});this.headers.next().each(function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")}else if(r==="auto"){t=0;this.headers.next().each(function(){t=Math.max(t,e(this).height("").height())}).height(t)}if(r!=="content"){this.element.height(this.element.height())}},_activate:function(t){var n=this._findActive(t)[0];if(n===this.active[0]){return}n=n||this.active[0];this._eventHandler({target:n,currentTarget:n,preventDefault:e.noop})},_findActive:function(t){return typeof t==="number"?this.headers.eq(t):e()},_setupEvents:function(t){var n={};if(!t){return}e.each(t.split(" "),function(e,t){n[t]="_eventHandler"});this._on(this.headers,n)},_eventHandler:function(t){var n=this.options,r=this.active,i=e(t.currentTarget),s=i[0]===r[0],o=s&&n.collapsible,u=o?e():i.next(),a=r.next(),f={oldHeader:r,oldPanel:a,newHeader:o?e():i,newPanel:u};t.preventDefault();if(s&&!n.collapsible||this._trigger("beforeActivate",t,f)===false){return}n.active=o?false:this.headers.index(i);this.active=s?e():i;this._toggle(f);r.removeClass("ui-accordion-header-active ui-state-active");if(n.icons){r.children(".ui-accordion-header-icon").removeClass(n.icons.activeHeader).addClass(n.icons.header)}if(!s){i.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top");if(n.icons){i.children(".ui-accordion-header-icon").removeClass(n.icons.header).addClass(n.icons.activeHeader)}i.next().addClass("ui-accordion-content-active")}},_toggle:function(t){var n=t.newPanel,r=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(true,true);this.prevShow=n;this.prevHide=r;if(this.options.animate){this._animate(n,r,t)}else{r.hide();n.show();this._toggleComplete(t)}r.attr({"aria-expanded":"false","aria-hidden":"true"});r.prev().attr("aria-selected","false");if(n.length&&r.length){r.prev().attr("tabIndex",-1)}else if(n.length){this.headers.filter(function(){return e(this).attr("tabIndex")===0}).attr("tabIndex",-1)}n.attr({"aria-expanded":"true","aria-hidden":"false"}).prev().attr({"aria-selected":"true",tabIndex:0})},_animate:function(e,t,n){var s,o,u,a=this,f=0,l=e.length&&(!t.length||e.index()<t.index()),c=this.options.animate||{},h=l&&c.down||c,p=function(){a._toggleComplete(n)};if(typeof h==="number"){u=h}if(typeof h==="string"){o=h}o=o||h.easing||c.easing;u=u||h.duration||c.duration;if(!t.length){return e.animate(i,u,o,p)}if(!e.length){return t.animate(r,u,o,p)}s=e.show().outerHeight();t.animate(r,{duration:u,easing:o,step:function(e,t){t.now=Math.round(e)}});e.hide().animate(i,{duration:u,easing:o,complete:p,step:function(e,n){n.now=Math.round(e);if(n.prop!=="height"){f+=n.now}else if(a.options.heightStyle!=="content"){n.now=Math.round(s-t.outerHeight()-f);f=0}}})},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all");if(t.length){t.parent()[0].className=t.parent()[0].className}this._trigger("activate",null,e)}});if(e.uiBackCompat!==false){(function(e,t){e.extend(t.options,{navigation:false,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase()}});var n=t._create;t._create=function(){if(this.options.navigation){var t=this,r=this.element.find(this.options.header),i=r.next(),s=r.add(i).find("a").filter(this.options.navigationFilter)[0];if(s){r.add(i).each(function(n){if(e.contains(this,s)){t.options.active=Math.floor(n/2);return false}})}}n.call(this)}})(jQuery,jQuery.ui.accordion.prototype);(function(e,t){e.extend(t.options,{heightStyle:null,autoHeight:true,clearStyle:false,fillSpace:false});var n=t._create,r=t._setOption;e.extend(t,{_create:function(){this.options.heightStyle=this.options.heightStyle||this._mergeHeightStyle();n.call(this)},_setOption:function(e,t){if(e==="autoHeight"||e==="clearStyle"||e==="fillSpace"){this.options.heightStyle=this._mergeHeightStyle()}r.apply(this,arguments)},_mergeHeightStyle:function(){var e=this.options;if(e.fillSpace){return"fill"}if(e.clearStyle){return"content"}if(e.autoHeight){return"auto"}}})})(jQuery,jQuery.ui.accordion.prototype);(function(e,t){e.extend(t.options.icons,{activeHeader:null,headerSelected:"ui-icon-triangle-1-s"});var n=t._createIcons;t._createIcons=function(){if(this.options.icons){this.options.icons.activeHeader=this.options.icons.activeHeader||this.options.icons.headerSelected}n.call(this)}})(jQuery,jQuery.ui.accordion.prototype);(function(e,t){t.activate=t._activate;var n=t._findActive;t._findActive=function(e){if(e===-1){e=false}if(e&&typeof e!=="number"){e=this.headers.index(this.headers.filter(e));if(e===-1){e=false}}return n.call(this,e)}})(jQuery,jQuery.ui.accordion.prototype);jQuery.ui.accordion.prototype.resize=jQuery.ui.accordion.prototype.refresh;(function(e,t){e.extend(t.options,{change:null,changestart:null});var n=t._trigger;t._trigger=function(e,t,r){var i=n.apply(this,arguments);if(!i){return false}if(e==="beforeActivate"){i=n.call(this,"changestart",t,{oldHeader:r.oldHeader,oldContent:r.oldPanel,newHeader:r.newHeader,newContent:r.newPanel})}else if(e==="activate"){i=n.call(this,"change",t,{oldHeader:r.oldHeader,oldContent:r.oldPanel,newHeader:r.newHeader,newContent:r.newPanel})}return i}})(jQuery,jQuery.ui.accordion.prototype);(function(e,t){e.extend(t.options,{animate:null,animated:"slide"});var n=t._create;t._create=function(){var e=this.options;if(e.animate===null){if(!e.animated){e.animate=false}else if(e.animated==="slide"){e.animate=300}else if(e.animated==="bounceslide"){e.animate={duration:200,down:{easing:"easeOutBounce",duration:1e3}}}else{e.animate=e.animated}}n.call(this)}})(jQuery,jQuery.ui.accordion.prototype)}})(jQuery);(function(e,t){var n=0;e.widget("ui.autocomplete",{version:"1.9.0",defaultElement:"<input>",options:{appendTo:"body",autoFocus:false,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var t,n,r;this.isMultiLine=this._isMultiLine();this.valueMethod=this.element[this.element.is("input,textarea")?"val":"text"];this.isNewMenu=true;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off");this._on({keydown:function(i){if(this.element.prop("readOnly")){t=true;r=true;n=true;return}t=false;r=false;n=false;var s=e.ui.keyCode;switch(i.keyCode){case s.PAGE_UP:t=true;this._move("previousPage",i);break;case s.PAGE_DOWN:t=true;this._move("nextPage",i);break;case s.UP:t=true;this._keyEvent("previous",i);break;case s.DOWN:t=true;this._keyEvent("next",i);break;case s.ENTER:case s.NUMPAD_ENTER:if(this.menu.active){t=true;i.preventDefault();this.menu.select(i)}break;case s.TAB:if(this.menu.active){this.menu.select(i)}break;case s.ESCAPE:if(this.menu.element.is(":visible")){this._value(this.term);this.close(i);i.preventDefault()}break;default:n=true;this._searchTimeout(i);break}},keypress:function(r){if(t){t=false;r.preventDefault();return}if(n){return}var i=e.ui.keyCode;switch(r.keyCode){case i.PAGE_UP:this._move("previousPage",r);break;case i.PAGE_DOWN:this._move("nextPage",r);break;case i.UP:this._keyEvent("previous",r);break;case i.DOWN:this._keyEvent("next",r);break}},input:function(e){if(r){r=false;e.preventDefault();return}this._searchTimeout(e)},focus:function(){this.selectedItem=null;this.previous=this._value()},blur:function(e){if(this.cancelBlur){delete this.cancelBlur;return}clearTimeout(this.searching);this.close(e);this._change(e)}});this._initSource();this.menu=e("<ul>").addClass("ui-autocomplete").appendTo(this.document.find(this.options.appendTo||"body")[0]).menu({input:e(),role:null}).zIndex(this.element.zIndex()+1).hide().data("menu");this._on(this.menu.element,{mousedown:function(t){t.preventDefault();this.cancelBlur=true;this._delay(function(){delete this.cancelBlur});var n=this.menu.element[0];if(!e(t.target).closest(".ui-menu-item").length){this._delay(function(){var t=this;this.document.one("mousedown",function(r){if(r.target!==t.element[0]&&r.target!==n&&!e.contains(n,r.target)){t.close()}})})}},menufocus:function(t,n){if(this.isNewMenu){this.isNewMenu=false;if(t.originalEvent&&/^mouse/.test(t.originalEvent.type)){this.menu.blur();this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)});return}}var r=n.item.data("ui-autocomplete-item")||n.item.data("item.autocomplete");if(false!==this._trigger("focus",t,{item:r})){if(t.originalEvent&&/^key/.test(t.originalEvent.type)){this._value(r.value)}}else{this.liveRegion.text(r.value)}},menuselect:function(e,t){var n=t.item.data("ui-autocomplete-item")||t.item.data("item.autocomplete"),r=this.previous;if(this.element[0]!==this.document[0].activeElement){this.element.focus();this.previous=r;this._delay(function(){this.previous=r;this.selectedItem=n})}if(false!==this._trigger("select",e,{item:n})){this._value(n.value)}this.term=this._value();this.close(e);this.selectedItem=n}});this.liveRegion=e("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertAfter(this.element);if(e.fn.bgiframe){this.menu.element.bgiframe()}this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching);this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete");this.menu.element.remove();this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t);if(e==="source"){this._initSource()}if(e==="appendTo"){this.menu.element.appendTo(this.document.find(t||"body")[0])}if(e==="disabled"&&t&&this.xhr){this.xhr.abort()}},_isMultiLine:function(){if(this.element.is("textarea")){return true}if(this.element.is("input")){return false}return this.element.prop("isContentEditable")},_initSource:function(){var t,n,r=this;if(e.isArray(this.options.source)){t=this.options.source;this.source=function(n,r){r(e.ui.autocomplete.filter(t,n.term))}}else if(typeof this.options.source==="string"){n=this.options.source;this.source=function(t,i){if(r.xhr){r.xhr.abort()}r.xhr=e.ajax({url:n,data:t,dataType:"json",success:function(e,t){i(e)},error:function(){i([])}})}}else{this.source=this.options.source}},_searchTimeout:function(e){clearTimeout(this.searching);this.searching=this._delay(function(){if(this.term!==this._value()){this.selectedItem=null;this.search(null,e)}},this.options.delay)},search:function(e,t){e=e!=null?e:this._value();this.term=this._value();if(e.length<this.options.minLength){return this.close(t)}if(this._trigger("search",t)===false){return}return this._search(e)},_search:function(e){this.pending++;this.element.addClass("ui-autocomplete-loading");this.cancelSearch=false;this.source({term:e},this._response())},_response:function(){var e=this,t=++n;return function(r){if(t===n){e.__response(r)}e.pending--;if(!e.pending){e.element.removeClass("ui-autocomplete-loading")}}},__response:function(e){if(e){e=this._normalize(e)}this._trigger("response",null,{content:e});if(!this.options.disabled&&e&&e.length&&!this.cancelSearch){this._suggest(e);this._trigger("open")}else{this._close()}},close:function(e){this.cancelSearch=true;this._close(e)},_close:function(e){if(this.menu.element.is(":visible")){this.menu.element.hide();this.menu.blur();this.isNewMenu=true;this._trigger("close",e)}},_change:function(e){if(this.previous!==this._value()){this._trigger("change",e,{item:this.selectedItem})}},_normalize:function(t){if(t.length&&t[0].label&&t[0].value){return t}return e.map(t,function(t){if(typeof t==="string"){return{label:t,value:t}}return e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var n=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(n,t);this.menu.refresh();n.show();this._resizeMenu();n.position(e.extend({of:this.element},this.options.position));if(this.options.autoFocus){this.menu.next()}},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,n){var r=this;e.each(n,function(e,n){r._renderItemData(t,n)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,n){return e("<li>").append(e("<a>").text(n.label)).appendTo(t)},_move:function(e,t){if(!this.menu.element.is(":visible")){this.search(null,t);return}if(this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)){this._value(this.term);this.menu.blur();return}this.menu[e](t)},widget:function(){return this.menu.element},_value:function(e){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){if(!this.isMultiLine||this.menu.element.is(":visible")){this._move(e,t);t.preventDefault()}}});e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,n){var r=new RegExp(e.ui.autocomplete.escapeRegex(n),"i");return e.grep(t,function(e){return r.test(e.label||e.value||e)})}});e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments);if(this.options.disabled||this.cancelSearch){return}if(e&&e.length){t=this.options.messages.results(e.length)}else{t=this.options.messages.noResults}this.liveRegion.text(t)}})})(jQuery);(function(e,t){var n,r,i,s,o="ui-button ui-widget ui-state-default ui-corner-all",u="ui-state-hover ui-state-active ",a="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",f=function(){var t=e(this).find(":ui-button");setTimeout(function(){t.button("refresh")},1)},l=function(t){var n=t.name,r=t.form,i=e([]);if(n){if(r){i=e(r).find("[name='"+n+"']")}else{i=e("[name='"+n+"']",t.ownerDocument).filter(function(){return!this.form})}}return i};e.widget("ui.button",{version:"1.9.0",defaultElement:"<button>",options:{disabled:null,text:true,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,f);if(typeof this.options.disabled!=="boolean"){this.options.disabled=!!this.element.prop("disabled")}else{this.element.prop("disabled",this.options.disabled)}this._determineButtonType();this.hasTitle=!!this.buttonElement.attr("title");var t=this,u=this.options,a=this.type==="checkbox"||this.type==="radio",c="ui-state-hover"+(!a?" ui-state-active":""),h="ui-state-focus";if(u.label===null){u.label=this.type==="input"?this.buttonElement.val():this.buttonElement.html()}this.buttonElement.addClass(o).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){if(u.disabled){return}e(this).addClass("ui-state-hover");if(this===n){e(this).addClass("ui-state-active")}}).bind("mouseleave"+this.eventNamespace,function(){if(u.disabled){return}e(this).removeClass(c)}).bind("click"+this.eventNamespace,function(e){if(u.disabled){e.preventDefault();e.stopImmediatePropagation()}});this.element.bind("focus"+this.eventNamespace,function(){t.buttonElement.addClass(h)}).bind("blur"+this.eventNamespace,function(){t.buttonElement.removeClass(h)});if(a){this.element.bind("change"+this.eventNamespace,function(){if(s){return}t.refresh()});this.buttonElement.bind("mousedown"+this.eventNamespace,function(e){if(u.disabled){return}s=false;r=e.pageX;i=e.pageY}).bind("mouseup"+this.eventNamespace,function(e){if(u.disabled){return}if(r!==e.pageX||i!==e.pageY){s=true}})}if(this.type==="checkbox"){this.buttonElement.bind("click"+this.eventNamespace,function(){if(u.disabled||s){return false}e(this).toggleClass("ui-state-active");t.buttonElement.attr("aria-pressed",t.element[0].checked)})}else if(this.type==="radio"){this.buttonElement.bind("click"+this.eventNamespace,function(){if(u.disabled||s){return false}e(this).addClass("ui-state-active");t.buttonElement.attr("aria-pressed","true");var n=t.element[0];l(n).not(n).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")})}else{this.buttonElement.bind("mousedown"+this.eventNamespace,function(){if(u.disabled){return false}e(this).addClass("ui-state-active");n=this;t.document.one("mouseup",function(){n=null})}).bind("mouseup"+this.eventNamespace,function(){if(u.disabled){return false}e(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(t){if(u.disabled){return false}if(t.keyCode===e.ui.keyCode.SPACE||t.keyCode===e.ui.keyCode.ENTER){e(this).addClass("ui-state-active")}}).bind("keyup"+this.eventNamespace,function(){e(this).removeClass("ui-state-active")});if(this.buttonElement.is("a")){this.buttonElement.keyup(function(t){if(t.keyCode===e.ui.keyCode.SPACE){e(this).click()}})}}this._setOption("disabled",u.disabled);this._resetButton()},_determineButtonType:function(){var e,t,n;if(this.element.is("[type=checkbox]")){this.type="checkbox"}else if(this.element.is("[type=radio]")){this.type="radio"}else if(this.element.is("input")){this.type="input"}else{this.type="button"}if(this.type==="checkbox"||this.type==="radio"){e=this.element.parents().last();t="label[for='"+this.element.attr("id")+"']";this.buttonElement=e.find(t);if(!this.buttonElement.length){e=e.length?e.siblings():this.element.siblings();this.buttonElement=e.filter(t);if(!this.buttonElement.length){this.buttonElement=e.find(t)}}this.element.addClass("ui-helper-hidden-accessible");n=this.element.is(":checked");if(n){this.buttonElement.addClass("ui-state-active")}this.buttonElement.prop("aria-pressed",n)}else{this.buttonElement=this.element}},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible");this.buttonElement.removeClass(o+" "+u+" "+a).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html());if(!this.hasTitle){this.buttonElement.removeAttr("title")}},_setOption:function(e,t){this._super(e,t);if(e==="disabled"){if(t){this.element.prop("disabled",true)}else{this.element.prop("disabled",false)}return}this._resetButton()},refresh:function(){var t=this.element.is(":disabled");if(t!==this.options.disabled){this._setOption("disabled",t)}if(this.type==="radio"){l(this.element[0]).each(function(){if(e(this).is(":checked")){e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true")}else{e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}})}else if(this.type==="checkbox"){if(this.element.is(":checked")){this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true")}else{this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false")}}},_resetButton:function(){if(this.type==="input"){if(this.options.label){this.element.val(this.options.label)}return}var t=this.buttonElement.removeClass(a),n=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),r=this.options.icons,i=r.primary&&r.secondary,s=[];if(r.primary||r.secondary){if(this.options.text){s.push("ui-button-text-icon"+(i?"s":r.primary?"-primary":"-secondary"))}if(r.primary){t.prepend("<span class='ui-button-icon-primary ui-icon "+r.primary+"'></span>")}if(r.secondary){t.append("<span class='ui-button-icon-secondary ui-icon "+r.secondary+"'></span>")}if(!this.options.text){s.push(i?"ui-button-icons-only":"ui-button-icon-only");if(!this.hasTitle){t.attr("title",e.trim(n))}}}else{s.push("ui-button-text-only")}t.addClass(s.join(" "))}});e.widget("ui.buttonset",{version:"1.9.0",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){if(e==="disabled"){this.buttons.button("option",e,t)}this._super(e,t)},refresh:function(){var t=this.element.css("direction")==="rtl";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset");this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})})(jQuery);(function($,undefined){function Datepicker(){this.debug=false;this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._datepickerShowing=false;this._inDialog=false;this._mainDivId="ui-datepicker-div";this._inlineClass="ui-datepicker-inline";this._appendClass="ui-datepicker-append";this._triggerClass="ui-datepicker-trigger";this._dialogClass="ui-datepicker-dialog";this._disableClass="ui-datepicker-disabled";this._unselectableClass="ui-datepicker-unselectable";this._currentClass="ui-datepicker-current-day";this._dayOverClass="ui-datepicker-days-cell-over";this.regional=[];this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,yearRange:"c-10:c+10",showOtherMonths:false,selectOtherMonths:false,showWeek:false,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:true,showButtonPanel:false,autoSize:false,disabled:false};$.extend(this._defaults,this.regional[""]);this.dpDiv=bindHover($('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}function bindHover(e){var t="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.delegate(t,"mouseout",function(){$(this).removeClass("ui-state-hover");if(this.className.indexOf("ui-datepicker-prev")!=-1)$(this).removeClass("ui-datepicker-prev-hover");if(this.className.indexOf("ui-datepicker-next")!=-1)$(this).removeClass("ui-datepicker-next-hover")}).delegate(t,"mouseover",function(){if(!$.datepicker._isDisabledDatepicker(instActive.inline?e.parent()[0]:instActive.input[0])){$(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover");$(this).addClass("ui-state-hover");if(this.className.indexOf("ui-datepicker-prev")!=-1)$(this).addClass("ui-datepicker-prev-hover");if(this.className.indexOf("ui-datepicker-next")!=-1)$(this).addClass("ui-datepicker-next-hover")}})}function extendRemove(e,t){$.extend(e,t);for(var n in t)if(t[n]==null||t[n]==undefined)e[n]=t[n];return e}$.extend($.ui,{datepicker:{version:"1.9.0"}});var PROP_NAME="datepicker";var dpuuid=(new Date).getTime();var instActive;$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){if(this.debug)console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){extendRemove(this._defaults,e||{});return this},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute("date:"+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}var nodeName=target.nodeName.toLowerCase();var inline=nodeName=="div"||nodeName=="span";if(!target.id){this.uuid+=1;target.id="dp"+this.uuid}var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{});if(nodeName=="input"){this._connectDatepicker(target,inst)}else if(inline){this._inlineDatepicker(target,inst)}},_newInst:function(e,t){var n=e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:n,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:t,dpDiv:!t?this.dpDiv:bindHover($('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}},_connectDatepicker:function(e,t){var n=$(e);t.append=$([]);t.trigger=$([]);if(n.hasClass(this.markerClassName))return;this._attachments(n,t);n.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(e,n,r){t.settings[n]=r}).bind("getData.datepicker",function(e,n){return this._get(t,n)});this._autoSize(t);$.data(e,PROP_NAME,t);if(t.settings.disabled){this._disableDatepicker(e)}},_attachments:function(e,t){var n=this._get(t,"appendText");var r=this._get(t,"isRTL");if(t.append)t.append.remove();if(n){t.append=$('<span class="'+this._appendClass+'">'+n+"</span>");e[r?"before":"after"](t.append)}e.unbind("focus",this._showDatepicker);if(t.trigger)t.trigger.remove();var i=this._get(t,"showOn");if(i=="focus"||i=="both")e.focus(this._showDatepicker);if(i=="button"||i=="both"){var s=this._get(t,"buttonText");var o=this._get(t,"buttonImage");t.trigger=$(this._get(t,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:o,alt:s,title:s}):$('<button type="button"></button>').addClass(this._triggerClass).html(o==""?s:$("<img/>").attr({src:o,alt:s,title:s})));e[r?"before":"after"](t.trigger);t.trigger.click(function(){if($.datepicker._datepickerShowing&&$.datepicker._lastInput==e[0])$.datepicker._hideDatepicker();else if($.datepicker._datepickerShowing&&$.datepicker._lastInput!=e[0]){$.datepicker._hideDatepicker();$.datepicker._showDatepicker(e[0])}else $.datepicker._showDatepicker(e[0]);return false})}},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t=new Date(2009,12-1,20);var n=this._get(e,"dateFormat");if(n.match(/[DM]/)){var r=function(e){var t=0;var n=0;for(var r=0;r<e.length;r++){if(e[r].length>t){t=e[r].length;n=r}}return n};t.setMonth(r(this._get(e,n.match(/MM/)?"monthNames":"monthNamesShort")));t.setDate(r(this._get(e,n.match(/DD/)?"dayNames":"dayNamesShort"))+20-t.getDay())}e.input.attr("size",this._formatDate(e,t).length)}},_inlineDatepicker:function(e,t){var n=$(e);if(n.hasClass(this.markerClassName))return;n.addClass(this.markerClassName).append(t.dpDiv).bind("setData.datepicker",function(e,n,r){t.settings[n]=r}).bind("getData.datepicker",function(e,n){return this._get(t,n)});$.data(e,PROP_NAME,t);this._setDate(t,this._getDefaultDate(t),true);this._updateDatepicker(t);this._updateAlternate(t);if(t.settings.disabled){this._disableDatepicker(e)}t.dpDiv.css("display","block")},_dialogDatepicker:function(e,t,n,r,i){var s=this._dialogInst;if(!s){this.uuid+=1;var o="dp"+this.uuid;this._dialogInput=$('<input type="text" id="'+o+'" style="position: absolute; top: -100px; width: 0px;"/>');this._dialogInput.keydown(this._doKeyDown);$("body").append(this._dialogInput);s=this._dialogInst=this._newInst(this._dialogInput,false);s.settings={};$.data(this._dialogInput[0],PROP_NAME,s)}extendRemove(s.settings,r||{});t=t&&t.constructor==Date?this._formatDate(s,t):t;this._dialogInput.val(t);this._pos=i?i.length?i:[i.pageX,i.pageY]:null;if(!this._pos){var u=document.documentElement.clientWidth;var a=document.documentElement.clientHeight;var f=document.documentElement.scrollLeft||document.body.scrollLeft;var l=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[u/2-100+f,a/2-150+l]}this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px");s.settings.onSelect=n;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);if($.blockUI)$.blockUI(this.dpDiv);$.data(this._dialogInput[0],PROP_NAME,s);return this},_destroyDatepicker:function(e){var t=$(e);var n=$.data(e,PROP_NAME);if(!t.hasClass(this.markerClassName)){return}var r=e.nodeName.toLowerCase();$.removeData(e,PROP_NAME);if(r=="input"){n.append.remove();n.trigger.remove();t.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)}else if(r=="div"||r=="span")t.removeClass(this.markerClassName).empty()},_enableDatepicker:function(e){var t=$(e);var n=$.data(e,PROP_NAME);if(!t.hasClass(this.markerClassName)){return}var r=e.nodeName.toLowerCase();if(r=="input"){e.disabled=false;n.trigger.filter("button").each(function(){this.disabled=false}).end().filter("img").css({opacity:"1.0",cursor:""})}else if(r=="div"||r=="span"){var i=t.children("."+this._inlineClass);i.children().removeClass("ui-state-disabled");i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",false)}this._disabledInputs=$.map(this._disabledInputs,function(t){return t==e?null:t})},_disableDatepicker:function(e){var t=$(e);var n=$.data(e,PROP_NAME);if(!t.hasClass(this.markerClassName)){return}var r=e.nodeName.toLowerCase();if(r=="input"){e.disabled=true;n.trigger.filter("button").each(function(){this.disabled=true}).end().filter("img").css({opacity:"0.5",cursor:"default"})}else if(r=="div"||r=="span"){var i=t.children("."+this._inlineClass);i.children().addClass("ui-state-disabled");i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",true)}this._disabledInputs=$.map(this._disabledInputs,function(t){return t==e?null:t});this._disabledInputs[this._disabledInputs.length]=e},_isDisabledDatepicker:function(e){if(!e){return false}for(var t=0;t<this._disabledInputs.length;t++){if(this._disabledInputs[t]==e)return true}return false},_getInst:function(e){try{return $.data(e,PROP_NAME)}catch(t){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,t,n){var r=this._getInst(e);if(arguments.length==2&&typeof t=="string"){return t=="defaults"?$.extend({},$.datepicker._defaults):r?t=="all"?$.extend({},r.settings):this._get(r,t):null}var i=t||{};if(typeof t=="string"){i={};i[t]=n}if(r){if(this._curInst==r){this._hideDatepicker()}var s=this._getDateDatepicker(e,true);var o=this._getMinMaxDate(r,"min");var u=this._getMinMaxDate(r,"max");extendRemove(r.settings,i);if(o!==null&&i["dateFormat"]!==undefined&&i["minDate"]===undefined)r.settings.minDate=this._formatDate(r,o);if(u!==null&&i["dateFormat"]!==undefined&&i["maxDate"]===undefined)r.settings.maxDate=this._formatDate(r,u);this._attachments($(e),r);this._autoSize(r);this._setDate(r,s);this._updateAlternate(r);this._updateDatepicker(r)}},_changeDatepicker:function(e,t,n){this._optionDatepicker(e,t,n)},_refreshDatepicker:function(e){var t=this._getInst(e);if(t){this._updateDatepicker(t)}},_setDateDatepicker:function(e,t){var n=this._getInst(e);if(n){this._setDate(n,t);this._updateDatepicker(n);this._updateAlternate(n)}},_getDateDatepicker:function(e,t){var n=this._getInst(e);if(n&&!n.inline)this._setDateFromField(n,t);return n?this._getDate(n):null},_doKeyDown:function(e){var t=$.datepicker._getInst(e.target);var n=true;var r=t.dpDiv.is(".ui-datepicker-rtl");t._keyEvent=true;if($.datepicker._datepickerShowing)switch(e.keyCode){case 9:$.datepicker._hideDatepicker();n=false;break;case 13:var i=$("td."+$.datepicker._dayOverClass+":not(."+$.datepicker._currentClass+")",t.dpDiv);if(i[0])$.datepicker._selectDay(e.target,t.selectedMonth,t.selectedYear,i[0]);var s=$.datepicker._get(t,"onSelect");if(s){var o=$.datepicker._formatDate(t);s.apply(t.input?t.input[0]:null,[o,t])}else $.datepicker._hideDatepicker();return false;break;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(e.target,e.ctrlKey?-$.datepicker._get(t,"stepBigMonths"):-$.datepicker._get(t,"stepMonths"),"M");break;case 34:$.datepicker._adjustDate(e.target,e.ctrlKey?+$.datepicker._get(t,"stepBigMonths"):+$.datepicker._get(t,"stepMonths"),"M");break;case 35:if(e.ctrlKey||e.metaKey)$.datepicker._clearDate(e.target);n=e.ctrlKey||e.metaKey;break;case 36:if(e.ctrlKey||e.metaKey)$.datepicker._gotoToday(e.target);n=e.ctrlKey||e.metaKey;break;case 37:if(e.ctrlKey||e.metaKey)$.datepicker._adjustDate(e.target,r?+1:-1,"D");n=e.ctrlKey||e.metaKey;if(e.originalEvent.altKey)$.datepicker._adjustDate(e.target,e.ctrlKey?-$.datepicker._get(t,"stepBigMonths"):-$.datepicker._get(t,"stepMonths"),"M");break;case 38:if(e.ctrlKey||e.metaKey)$.datepicker._adjustDate(e.target,-7,"D");n=e.ctrlKey||e.metaKey;break;case 39:if(e.ctrlKey||e.metaKey)$.datepicker._adjustDate(e.target,r?-1:+1,"D");n=e.ctrlKey||e.metaKey;if(e.originalEvent.altKey)$.datepicker._adjustDate(e.target,e.ctrlKey?+$.datepicker._get(t,"stepBigMonths"):+$.datepicker._get(t,"stepMonths"),"M");break;case 40:if(e.ctrlKey||e.metaKey)$.datepicker._adjustDate(e.target,+7,"D");n=e.ctrlKey||e.metaKey;break;default:n=false}else if(e.keyCode==36&&e.ctrlKey)$.datepicker._showDatepicker(this);else{n=false}if(n){e.preventDefault();e.stopPropagation()}},_doKeyPress:function(e){var t=$.datepicker._getInst(e.target);if($.datepicker._get(t,"constrainInput")){var n=$.datepicker._possibleChars($.datepicker._get(t,"dateFormat"));var r=String.fromCharCode(e.charCode==undefined?e.keyCode:e.charCode);return e.ctrlKey||e.metaKey||r<" "||!n||n.indexOf(r)>-1}},_doKeyUp:function(e){var t=$.datepicker._getInst(e.target);if(t.input.val()!=t.lastVal){try{var n=$.datepicker.parseDate($.datepicker._get(t,"dateFormat"),t.input?t.input.val():null,$.datepicker._getFormatConfig(t));if(n){$.datepicker._setDateFromField(t);$.datepicker._updateAlternate(t);$.datepicker._updateDatepicker(t)}}catch(r){$.datepicker.log(r)}}return true},_showDatepicker:function(e){e=e.target||e;if(e.nodeName.toLowerCase()!="input")e=$("input",e.parentNode)[0];if($.datepicker._isDisabledDatepicker(e)||$.datepicker._lastInput==e)return;var t=$.datepicker._getInst(e);if($.datepicker._curInst&&$.datepicker._curInst!=t){$.datepicker._curInst.dpDiv.stop(true,true);if(t&&$.datepicker._datepickerShowing){$.datepicker._hideDatepicker($.datepicker._curInst.input[0])}}var n=$.datepicker._get(t,"beforeShow");var r=n?n.apply(e,[e,t]):{};if(r===false){return}extendRemove(t.settings,r);t.lastVal=null;$.datepicker._lastInput=e;$.datepicker._setDateFromField(t);if($.datepicker._inDialog)e.value="";if(!$.datepicker._pos){$.datepicker._pos=$.datepicker._findPos(e);$.datepicker._pos[1]+=e.offsetHeight}var i=false;$(e).parents().each(function(){i|=$(this).css("position")=="fixed";return!i});var s={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null;t.dpDiv.empty();t.dpDiv.css({position:"absolute",display:"block",top:"-1000px"});$.datepicker._updateDatepicker(t);s=$.datepicker._checkOffset(t,s,i);t.dpDiv.css({position:$.datepicker._inDialog&&$.blockUI?"static":i?"fixed":"absolute",display:"none",left:s.left+"px",top:s.top+"px"});if(!t.inline){var o=$.datepicker._get(t,"showAnim");var u=$.datepicker._get(t,"duration");var a=function(){var e=t.dpDiv.find("iframe.ui-datepicker-cover");if(!!e.length){var n=$.datepicker._getBorders(t.dpDiv);e.css({left:-n[0],top:-n[1],width:t.dpDiv.outerWidth(),height:t.dpDiv.outerHeight()})}};t.dpDiv.zIndex($(e).zIndex()+1);$.datepicker._datepickerShowing=true;if($.effects&&($.effects.effect[o]||$.effects[o]))t.dpDiv.show(o,$.datepicker._get(t,"showOptions"),u,a);else t.dpDiv[o||"show"](o?u:null,a);if(!o||!u)a();if(t.input.is(":visible")&&!t.input.is(":disabled"))t.input.focus();$.datepicker._curInst=t}},_updateDatepicker:function(e){this.maxRows=4;var t=$.datepicker._getBorders(e.dpDiv);instActive=e;e.dpDiv.empty().append(this._generateHTML(e));this._attachHandlers(e);var n=e.dpDiv.find("iframe.ui-datepicker-cover");if(!!n.length){n.css({left:-t[0],top:-t[1],width:e.dpDiv.outerWidth(),height:e.dpDiv.outerHeight()})}e.dpDiv.find("."+this._dayOverClass+" a").mouseover();var r=this._getNumberOfMonths(e);var i=r[1];var s=17;e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");if(i>1)e.dpDiv.addClass("ui-datepicker-multi-"+i).css("width",s*i+"em");e.dpDiv[(r[0]!=1||r[1]!=1?"add":"remove")+"Class"]("ui-datepicker-multi");e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl");if(e==$.datepicker._curInst&&$.datepicker._datepickerShowing&&e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&e.input[0]!=document.activeElement)e.input.focus();if(e.yearshtml){var o=e.yearshtml;setTimeout(function(){if(o===e.yearshtml&&e.yearshtml){e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml)}o=e.yearshtml=null},0)}},_getBorders:function(e){var t=function(e){return{thin:1,medium:2,thick:3}[e]||e};return[parseFloat(t(e.css("border-left-width"))),parseFloat(t(e.css("border-top-width")))]},_checkOffset:function(e,t,n){var r=e.dpDiv.outerWidth();var i=e.dpDiv.outerHeight();var s=e.input?e.input.outerWidth():0;var o=e.input?e.input.outerHeight():0;var u=document.documentElement.clientWidth+(n?0:$(document).scrollLeft());var a=document.documentElement.clientHeight+(n?0:$(document).scrollTop());t.left-=this._get(e,"isRTL")?r-s:0;t.left-=n&&t.left==e.input.offset().left?$(document).scrollLeft():0;t.top-=n&&t.top==e.input.offset().top+o?$(document).scrollTop():0;t.left-=Math.min(t.left,t.left+r>u&&u>r?Math.abs(t.left+r-u):0);t.top-=Math.min(t.top,t.top+i>a&&a>i?Math.abs(i+o):0);return t},_findPos:function(e){var t=this._getInst(e);var n=this._get(t,"isRTL");while(e&&(e.type=="hidden"||e.nodeType!=1||$.expr.filters.hidden(e))){e=e[n?"previousSibling":"nextSibling"]}var r=$(e).offset();return[r.left,r.top]},_hideDatepicker:function(e){var t=this._curInst;if(!t||e&&t!=$.data(e,PROP_NAME))return;if(this._datepickerShowing){var n=this._get(t,"showAnim");var r=this._get(t,"duration");var i=function(){$.datepicker._tidyDialog(t)};if($.effects&&($.effects.effect[n]||$.effects[n]))t.dpDiv.hide(n,$.datepicker._get(t,"showOptions"),r,i);else t.dpDiv[n=="slideDown"?"slideUp":n=="fadeIn"?"fadeOut":"hide"](n?r:null,i);if(!n)i();this._datepickerShowing=false;var s=this._get(t,"onClose");if(s)s.apply(t.input?t.input[0]:null,[t.input?t.input.val():"",t]);this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:"absolute",left:"0",top:"-100px"});if($.blockUI){$.unblockUI();$("body").append(this.dpDiv)}}this._inDialog=false}},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(!$.datepicker._curInst)return;var t=$(e.target),n=$.datepicker._getInst(t[0]);if(t[0].id!=$.datepicker._mainDivId&&t.parents("#"+$.datepicker._mainDivId).length==0&&!t.hasClass($.datepicker.markerClassName)&&!t.closest("."+$.datepicker._triggerClass).length&&$.datepicker._datepickerShowing&&!($.datepicker._inDialog&&$.blockUI)||t.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!=n)$.datepicker._hideDatepicker()},_adjustDate:function(e,t,n){var r=$(e);var i=this._getInst(r[0]);if(this._isDisabledDatepicker(r[0])){return}this._adjustInstDate(i,t+(n=="M"?this._get(i,"showCurrentAtPos"):0),n);this._updateDatepicker(i)},_gotoToday:function(e){var t=$(e);var n=this._getInst(t[0]);if(this._get(n,"gotoCurrent")&&n.currentDay){n.selectedDay=n.currentDay;n.drawMonth=n.selectedMonth=n.currentMonth;n.drawYear=n.selectedYear=n.currentYear}else{var r=new Date;n.selectedDay=r.getDate();n.drawMonth=n.selectedMonth=r.getMonth();n.drawYear=n.selectedYear=r.getFullYear()}this._notifyChange(n);this._adjustDate(t)},_selectMonthYear:function(e,t,n){var r=$(e);var i=this._getInst(r[0]);i["selected"+(n=="M"?"Month":"Year")]=i["draw"+(n=="M"?"Month":"Year")]=parseInt(t.options[t.selectedIndex].value,10);this._notifyChange(i);this._adjustDate(r)},_selectDay:function(e,t,n,r){var i=$(e);if($(r).hasClass(this._unselectableClass)||this._isDisabledDatepicker(i[0])){return}var s=this._getInst(i[0]);s.selectedDay=s.currentDay=$("a",r).html();s.selectedMonth=s.currentMonth=t;s.selectedYear=s.currentYear=n;this._selectDate(e,this._formatDate(s,s.currentDay,s.currentMonth,s.currentYear))},_clearDate:function(e){var t=$(e);var n=this._getInst(t[0]);this._selectDate(t,"")},_selectDate:function(e,t){var n=$(e);var r=this._getInst(n[0]);t=t!=null?t:this._formatDate(r);if(r.input)r.input.val(t);this._updateAlternate(r);var i=this._get(r,"onSelect");if(i)i.apply(r.input?r.input[0]:null,[t,r]);else if(r.input)r.input.trigger("change");if(r.inline)this._updateDatepicker(r);else{this._hideDatepicker();this._lastInput=r.input[0];if(typeof r.input[0]!="object")r.input.focus();this._lastInput=null}},_updateAlternate:function(e){var t=this._get(e,"altField");if(t){var n=this._get(e,"altFormat")||this._get(e,"dateFormat");var r=this._getDate(e);var i=this.formatDate(n,r,this._getFormatConfig(e));$(t).each(function(){$(this).val(i)})}},noWeekends:function(e){var t=e.getDay();return[t>0&&t<6,""]},iso8601Week:function(e){var t=new Date(e.getTime());t.setDate(t.getDate()+4-(t.getDay()||7));var n=t.getTime();t.setMonth(0);t.setDate(1);return Math.floor(Math.round((n-t)/864e5)/7)+1},parseDate:function(e,t,n){if(e==null||t==null)throw"Invalid arguments";t=typeof t=="object"?t.toString():t+"";if(t=="")return null;var r=(n?n.shortYearCutoff:null)||this._defaults.shortYearCutoff;r=typeof r!="string"?r:(new Date).getFullYear()%100+parseInt(r,10);var i=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort;var s=(n?n.dayNames:null)||this._defaults.dayNames;var o=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort;var u=(n?n.monthNames:null)||this._defaults.monthNames;var a=-1;var f=-1;var l=-1;var c=-1;var h=false;var p=function(t){var n=y+1<e.length&&e.charAt(y+1)==t;if(n)y++;return n};var d=function(e){var n=p(e);var r=e=="@"?14:e=="!"?20:e=="y"&&n?4:e=="o"?3:2;var i=new RegExp("^\\d{1,"+r+"}");var s=t.substring(g).match(i);if(!s)throw"Missing number at position "+g;g+=s[0].length;return parseInt(s[0],10)};var v=function(e,n,r){var i=$.map(p(e)?r:n,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});var s=-1;$.each(i,function(e,n){var r=n[1];if(t.substr(g,r.length).toLowerCase()==r.toLowerCase()){s=n[0];g+=r.length;return false}});if(s!=-1)return s+1;else throw"Unknown name at position "+g};var m=function(){if(t.charAt(g)!=e.charAt(y))throw"Unexpected literal at position "+g;g++};var g=0;for(var y=0;y<e.length;y++){if(h)if(e.charAt(y)=="'"&&!p("'"))h=false;else m();else switch(e.charAt(y)){case"d":l=d("d");break;case"D":v("D",i,s);break;case"o":c=d("o");break;case"m":f=d("m");break;case"M":f=v("M",o,u);break;case"y":a=d("y");break;case"@":var b=new Date(d("@"));a=b.getFullYear();f=b.getMonth()+1;l=b.getDate();break;case"!":var b=new Date((d("!")-this._ticksTo1970)/1e4);a=b.getFullYear();f=b.getMonth()+1;l=b.getDate();break;case"'":if(p("'"))m();else h=true;break;default:m()}}if(g<t.length){var w=t.substr(g);if(!/^\s+/.test(w)){throw"Extra/unparsed characters found in date: "+w}}if(a==-1)a=(new Date).getFullYear();else if(a<100)a+=(new Date).getFullYear()-(new Date).getFullYear()%100+(a<=r?0:-100);if(c>-1){f=1;l=c;do{var E=this._getDaysInMonth(a,f-1);if(l<=E)break;f++;l-=E}while(true)}var b=this._daylightSavingAdjust(new Date(a,f-1,l));if(b.getFullYear()!=a||b.getMonth()+1!=f||b.getDate()!=l)throw"Invalid date";return b},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:((1970-1)*365+Math.floor(1970/4)-Math.floor(1970/100)+Math.floor(1970/400))*24*60*60*1e7,formatDate:function(e,t,n){if(!t)return"";var r=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort;var i=(n?n.dayNames:null)||this._defaults.dayNames;var s=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort;var o=(n?n.monthNames:null)||this._defaults.monthNames;var u=function(t){var n=h+1<e.length&&e.charAt(h+1)==t;if(n)h++;return n};var a=function(e,t,n){var r=""+t;if(u(e))while(r.length<n)r="0"+r;return r};var f=function(e,t,n,r){return u(e)?r[t]:n[t]};var l="";var c=false;if(t)for(var h=0;h<e.length;h++){if(c)if(e.charAt(h)=="'"&&!u("'"))c=false;else l+=e.charAt(h);else switch(e.charAt(h)){case"d":l+=a("d",t.getDate(),2);break;case"D":l+=f("D",t.getDay(),r,i);break;case"o":l+=a("o",Math.round(((new Date(t.getFullYear(),t.getMonth(),t.getDate())).getTime()-(new Date(t.getFullYear(),0,0)).getTime())/864e5),3);break;case"m":l+=a("m",t.getMonth()+1,2);break;case"M":l+=f("M",t.getMonth(),s,o);break;case"y":l+=u("y")?t.getFullYear():(t.getYear()%100<10?"0":"")+t.getYear()%100;break;case"@":l+=t.getTime();break;case"!":l+=t.getTime()*1e4+this._ticksTo1970;break;case"'":if(u("'"))l+="'";else c=true;break;default:l+=e.charAt(h)}}return l},_possibleChars:function(e){var t="";var n=false;var r=function(t){var n=i+1<e.length&&e.charAt(i+1)==t;if(n)i++;return n};for(var i=0;i<e.length;i++)if(n)if(e.charAt(i)=="'"&&!r("'"))n=false;else t+=e.charAt(i);else switch(e.charAt(i)){case"d":case"m":case"y":case"@":t+="0123456789";break;case"D":case"M":return null;case"'":if(r("'"))t+="'";else n=true;break;default:t+=e.charAt(i)}return t},_get:function(e,t){return e.settings[t]!==undefined?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()==e.lastVal){return}var n=this._get(e,"dateFormat");var r=e.lastVal=e.input?e.input.val():null;var i,s;i=s=this._getDefaultDate(e);var o=this._getFormatConfig(e);try{i=this.parseDate(n,r,o)||s}catch(u){this.log(u);r=t?"":r}e.selectedDay=i.getDate();e.drawMonth=e.selectedMonth=i.getMonth();e.drawYear=e.selectedYear=i.getFullYear();e.currentDay=r?i.getDate():0;e.currentMonth=r?i.getMonth():0;e.currentYear=r?i.getFullYear():0;this._adjustInstDate(e)},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(e,t,n){var r=function(e){var t=new Date;t.setDate(t.getDate()+e);return t};var i=function(t){try{return $.datepicker.parseDate($.datepicker._get(e,"dateFormat"),t,$.datepicker._getFormatConfig(e))}catch(n){}var r=(t.toLowerCase().match(/^c/)?$.datepicker._getDate(e):null)||new Date;var i=r.getFullYear();var s=r.getMonth();var o=r.getDate();var u=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g;var a=u.exec(t);while(a){switch(a[2]||"d"){case"d":case"D":o+=parseInt(a[1],10);break;case"w":case"W":o+=parseInt(a[1],10)*7;break;case"m":case"M":s+=parseInt(a[1],10);o=Math.min(o,$.datepicker._getDaysInMonth(i,s));break;case"y":case"Y":i+=parseInt(a[1],10);o=Math.min(o,$.datepicker._getDaysInMonth(i,s));break}a=u.exec(t)}return new Date(i,s,o)};var s=t==null||t===""?n:typeof t=="string"?i(t):typeof t=="number"?isNaN(t)?n:r(t):new Date(t.getTime());s=s&&s.toString()=="Invalid Date"?n:s;if(s){s.setHours(0);s.setMinutes(0);s.setSeconds(0);s.setMilliseconds(0)}return this._daylightSavingAdjust(s)},_daylightSavingAdjust:function(e){if(!e)return null;e.setHours(e.getHours()>12?e.getHours()+2:0);return e},_setDate:function(e,t,n){var r=!t;var i=e.selectedMonth;var s=e.selectedYear;var o=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=o.getDate();e.drawMonth=e.selectedMonth=e.currentMonth=o.getMonth();e.drawYear=e.selectedYear=e.currentYear=o.getFullYear();if((i!=e.selectedMonth||s!=e.selectedYear)&&!n)this._notifyChange(e);this._adjustInstDate(e);if(e.input){e.input.val(r?"":this._formatDate(e))}},_getDate:function(e){var t=!e.currentYear||e.input&&e.input.val()==""?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(e){var t=this._get(e,"stepMonths");var n="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){window["DP_jQuery_"+dpuuid].datepicker._adjustDate(n,-t,"M")},next:function(){window["DP_jQuery_"+dpuuid].datepicker._adjustDate(n,+t,"M")},hide:function(){window["DP_jQuery_"+dpuuid].datepicker._hideDatepicker()},today:function(){window["DP_jQuery_"+dpuuid].datepicker._gotoToday(n)},selectDay:function(){window["DP_jQuery_"+dpuuid].datepicker._selectDay(n,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this);return false},selectMonth:function(){window["DP_jQuery_"+dpuuid].datepicker._selectMonthYear(n,this,"M");return false},selectYear:function(){window["DP_jQuery_"+dpuuid].datepicker._selectMonthYear(n,this,"Y");return false}};$(this).bind(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t=new Date;t=this._daylightSavingAdjust(new Date(t.getFullYear(),t.getMonth(),t.getDate()));var n=this._get(e,"isRTL");var r=this._get(e,"showButtonPanel");var i=this._get(e,"hideIfNoPrevNext");var s=this._get(e,"navigationAsDateFormat");var o=this._getNumberOfMonths(e);var u=this._get(e,"showCurrentAtPos");var a=this._get(e,"stepMonths");var f=o[0]!=1||o[1]!=1;var l=this._daylightSavingAdjust(!e.currentDay?new Date(9999,9,9):new Date(e.currentYear,e.currentMonth,e.currentDay));var c=this._getMinMaxDate(e,"min");var h=this._getMinMaxDate(e,"max");var p=e.drawMonth-u;var d=e.drawYear;if(p<0){p+=12;d--}if(h){var v=this._daylightSavingAdjust(new Date(h.getFullYear(),h.getMonth()-o[0]*o[1]+1,h.getDate()));v=c&&v<c?c:v;while(this._daylightSavingAdjust(new Date(d,p,1))>v){p--;if(p<0){p=11;d--}}}e.drawMonth=p;e.drawYear=d;var m=this._get(e,"prevText");m=!s?m:this.formatDate(m,this._daylightSavingAdjust(new Date(d,p-a,1)),this._getFormatConfig(e));var g=this._canAdjustMonth(e,-1,d,p)?'<a class="ui-datepicker-prev ui-corner-all" data-handler="prev" data-event="click"'+' title="'+m+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"e":"w")+'">'+m+"</span></a>":i?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+m+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"e":"w")+'">'+m+"</span></a>";var y=this._get(e,"nextText");y=!s?y:this.formatDate(y,this._daylightSavingAdjust(new Date(d,p+a,1)),this._getFormatConfig(e));var b=this._canAdjustMonth(e,+1,d,p)?'<a class="ui-datepicker-next ui-corner-all" data-handler="next" data-event="click"'+' title="'+y+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"w":"e")+'">'+y+"</span></a>":i?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+y+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"w":"e")+'">'+y+"</span></a>";var w=this._get(e,"currentText");var E=this._get(e,"gotoCurrent")&&e.currentDay?l:t;w=!s?w:this.formatDate(w,E,this._getFormatConfig(e));var S=!e.inline?'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" data-handler="hide" data-event="click">'+this._get(e,"closeText")+"</button>":"";var x=r?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(n?S:"")+(this._isInRange(e,E)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" data-handler="today" data-event="click"'+">"+w+"</button>":"")+(n?"":S)+"</div>":"";var T=parseInt(this._get(e,"firstDay"),10);T=isNaN(T)?0:T;var N=this._get(e,"showWeek");var C=this._get(e,"dayNames");var k=this._get(e,"dayNamesShort");var L=this._get(e,"dayNamesMin");var A=this._get(e,"monthNames");var O=this._get(e,"monthNamesShort");var M=this._get(e,"beforeShowDay");var _=this._get(e,"showOtherMonths");var D=this._get(e,"selectOtherMonths");var P=this._get(e,"calculateWeek")||this.iso8601Week;var H=this._getDefaultDate(e);var B="";for(var j=0;j<o[0];j++){var F="";this.maxRows=4;for(var I=0;I<o[1];I++){var q=this._daylightSavingAdjust(new Date(d,p,e.selectedDay));var R=" ui-corner-all";var U="";if(f){U+='<div class="ui-datepicker-group';if(o[1]>1)switch(I){case 0:U+=" ui-datepicker-group-first";R=" ui-corner-"+(n?"right":"left");break;case o[1]-1:U+=" ui-datepicker-group-last";R=" ui-corner-"+(n?"left":"right");break;default:U+=" ui-datepicker-group-middle";R="";break}U+='">'}U+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+R+'">'+(/all|left/.test(R)&&j==0?n?b:g:"")+(/all|right/.test(R)&&j==0?n?g:b:"")+this._generateMonthYearHeader(e,p,d,c,h,j>0||I>0,A,O)+'</div><table class="ui-datepicker-calendar"><thead>'+"<tr>";var z=N?'<th class="ui-datepicker-week-col">'+this._get(e,"weekHeader")+"</th>":"";for(var W=0;W<7;W++){var X=(W+T)%7;z+="<th"+((W+T+6)%7>=5?' class="ui-datepicker-week-end"':"")+">"+'<span title="'+C[X]+'">'+L[X]+"</span></th>"}U+=z+"</tr></thead><tbody>";var V=this._getDaysInMonth(d,p);if(d==e.selectedYear&&p==e.selectedMonth)e.selectedDay=Math.min(e.selectedDay,V);var J=(this._getFirstDayOfMonth(d,p)-T+7)%7;var K=Math.ceil((J+V)/7);var Q=f?this.maxRows>K?this.maxRows:K:K;this.maxRows=Q;var G=this._daylightSavingAdjust(new Date(d,p,1-J));for(var Y=0;Y<Q;Y++){U+="<tr>";var Z=!N?"":'<td class="ui-datepicker-week-col">'+this._get(e,"calculateWeek")(G)+"</td>";for(var W=0;W<7;W++){var et=M?M.apply(e.input?e.input[0]:null,[G]):[true,""];var tt=G.getMonth()!=p;var nt=tt&&!D||!et[0]||c&&G<c||h&&G>h;Z+='<td class="'+((W+T+6)%7>=5?" ui-datepicker-week-end":"")+(tt?" ui-datepicker-other-month":"")+(G.getTime()==q.getTime()&&p==e.selectedMonth&&e._keyEvent||H.getTime()==G.getTime()&&H.getTime()==q.getTime()?" "+this._dayOverClass:"")+(nt?" "+this._unselectableClass+" ui-state-disabled":"")+(tt&&!_?"":" "+et[1]+(G.getTime()==l.getTime()?" "+this._currentClass:"")+(G.getTime()==t.getTime()?" ui-datepicker-today":""))+'"'+((!tt||_)&&et[2]?' title="'+et[2]+'"':"")+(nt?"":' data-handler="selectDay" data-event="click" data-month="'+G.getMonth()+'" data-year="'+G.getFullYear()+'"')+">"+(tt&&!_?"&#xa0;":nt?'<span class="ui-state-default">'+G.getDate()+"</span>":'<a class="ui-state-default'+(G.getTime()==t.getTime()?" ui-state-highlight":"")+(G.getTime()==l.getTime()?" ui-state-active":"")+(tt?" ui-priority-secondary":"")+'" href="#">'+G.getDate()+"</a>")+"</td>";G.setDate(G.getDate()+1);G=this._daylightSavingAdjust(G)}U+=Z+"</tr>"}p++;if(p>11){p=0;d++}U+="</tbody></table>"+(f?"</div>"+(o[0]>0&&I==o[1]-1?'<div class="ui-datepicker-row-break"></div>':""):"");F+=U}B+=F}B+=x+($.browser.msie&&parseInt($.browser.version,10)<7&&!e.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':"");e._keyEvent=false;return B},_generateMonthYearHeader:function(e,t,n,r,i,s,o,u){var a=this._get(e,"changeMonth");var f=this._get(e,"changeYear");var l=this._get(e,"showMonthAfterYear");var c='<div class="ui-datepicker-title">';var h="";if(s||!a)h+='<span class="ui-datepicker-month">'+o[t]+"</span>";else{var p=r&&r.getFullYear()==n;var d=i&&i.getFullYear()==n;h+='<select class="ui-datepicker-month" data-handler="selectMonth" data-event="change">';for(var v=0;v<12;v++){if((!p||v>=r.getMonth())&&(!d||v<=i.getMonth()))h+='<option value="'+v+'"'+(v==t?' selected="selected"':"")+">"+u[v]+"</option>"}h+="</select>"}if(!l)c+=h+(s||!(a&&f)?"&#xa0;":"");if(!e.yearshtml){e.yearshtml="";if(s||!f)c+='<span class="ui-datepicker-year">'+n+"</span>";else{var m=this._get(e,"yearRange").split(":");var g=(new Date).getFullYear();var y=function(e){var t=e.match(/c[+-].*/)?n+parseInt(e.substring(1),10):e.match(/[+-].*/)?g+parseInt(e,10):parseInt(e,10);return isNaN(t)?g:t};var b=y(m[0]);var w=Math.max(b,y(m[1]||""));b=r?Math.max(b,r.getFullYear()):b;w=i?Math.min(w,i.getFullYear()):w;e.yearshtml+='<select class="ui-datepicker-year" data-handler="selectYear" data-event="change">';for(;b<=w;b++){e.yearshtml+='<option value="'+b+'"'+(b==n?' selected="selected"':"")+">"+b+"</option>"}e.yearshtml+="</select>";c+=e.yearshtml;e.yearshtml=null}}c+=this._get(e,"yearSuffix");if(l)c+=(s||!(a&&f)?"&#xa0;":"")+h;c+="</div>";return c},_adjustInstDate:function(e,t,n){var r=e.drawYear+(n=="Y"?t:0);var i=e.drawMonth+(n=="M"?t:0);var s=Math.min(e.selectedDay,this._getDaysInMonth(r,i))+(n=="D"?t:0);var o=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(r,i,s)));e.selectedDay=o.getDate();e.drawMonth=e.selectedMonth=o.getMonth();e.drawYear=e.selectedYear=o.getFullYear();if(n=="M"||n=="Y")this._notifyChange(e)},_restrictMinMax:function(e,t){var n=this._getMinMaxDate(e,"min");var r=this._getMinMaxDate(e,"max");var i=n&&t<n?n:t;i=r&&i>r?r:i;return i},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");if(t)t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return t==null?[1,1]:typeof t=="number"?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return(new Date(e,t,1)).getDay()},_canAdjustMonth:function(e,t,n,r){var i=this._getNumberOfMonths(e);var s=this._daylightSavingAdjust(new Date(n,r+(t<0?t:i[0]*i[1]),1));if(t<0)s.setDate(this._getDaysInMonth(s.getFullYear(),s.getMonth()));return this._isInRange(e,s)},_isInRange:function(e,t){var n=this._getMinMaxDate(e,"min");var r=this._getMinMaxDate(e,"max");return(!n||t.getTime()>=n.getTime())&&(!r||t.getTime()<=r.getTime())},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");t=typeof t!="string"?t:(new Date).getFullYear()%100+parseInt(t,10);return{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,n,r){if(!t){e.currentDay=e.selectedDay;e.currentMonth=e.selectedMonth;e.currentYear=e.selectedYear}var i=t?typeof t=="object"?t:this._daylightSavingAdjust(new Date(r,n,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),i,this._getFormatConfig(e))}});$.fn.datepicker=function(e){if(!this.length){return this}if(!$.datepicker.initialized){$(document).mousedown($.datepicker._checkExternalClick).find(document.body).append($.datepicker.dpDiv);$.datepicker.initialized=true}var t=Array.prototype.slice.call(arguments,1);if(typeof e=="string"&&(e=="isDisabled"||e=="getDate"||e=="widget"))return $.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this[0]].concat(t));if(e=="option"&&arguments.length==2&&typeof arguments[1]=="string")return $.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this[0]].concat(t));return this.each(function(){typeof e=="string"?$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this].concat(t)):$.datepicker._attachDatepicker(this,e)})};$.datepicker=new Datepicker;$.datepicker.initialized=false;$.datepicker.uuid=(new Date).getTime();$.datepicker.version="1.9.0";window["DP_jQuery_"+dpuuid]=$})(jQuery);(function(e,t){var n="ui-dialog ui-widget ui-widget-content ui-corner-all ",r={buttons:true,height:true,maxHeight:true,maxWidth:true,minHeight:true,minWidth:true,width:true},i={maxHeight:true,maxWidth:true,minHeight:true,minWidth:true};e.widget("ui.dialog",{version:"1.9.0",options:{autoOpen:true,buttons:{},closeOnEscape:true,closeText:"close",dialogClass:"",draggable:true,hide:null,height:"auto",maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var n=e(this).css(t).offset().top;if(n<0){e(this).css("top",t.top-n)}}},resizable:true,show:null,stack:true,title:"",width:300,zIndex:1e3},_create:function(){this.originalTitle=this.element.attr("title");if(typeof this.originalTitle!=="string"){this.originalTitle=""}this.oldPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)};this.options.title=this.options.title||this.originalTitle;var t=this,r=this.options,i=r.title||"&#160;",s=(this.uiDialog=e("<div>")).addClass(n+r.dialogClass).css({display:"none",outline:0,zIndex:r.zIndex}).attr("tabIndex",-1).keydown(function(n){if(r.closeOnEscape&&!n.isDefaultPrevented()&&n.keyCode&&n.keyCode===e.ui.keyCode.ESCAPE){t.close(n);n.preventDefault()}}).mousedown(function(e){t.moveToTop(false,e)}).appendTo("body"),o=this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(s),u=(this.uiDialogTitlebar=e("<div>")).addClass("ui-dialog-titlebar  ui-widget-header  "+"ui-corner-all  ui-helper-clearfix").prependTo(s),a=e("<a href='#'></a>").addClass("ui-dialog-titlebar-close  ui-corner-all").attr("role","button").click(function(e){e.preventDefault();t.close(e)}).appendTo(u),f=(this.uiDialogTitlebarCloseText=e("<span>")).addClass("ui-icon ui-icon-closethick").text(r.closeText).appendTo(a),l=e("<span>").uniqueId().addClass("ui-dialog-title").html(i).prependTo(u),c=(this.uiDialogButtonPane=e("<div>")).addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),h=(this.uiButtonSet=e("<div>")).addClass("ui-dialog-buttonset").appendTo(c);s.attr({role:"dialog","aria-labelledby":l.attr("id")});u.find("*").add(u).disableSelection();this._hoverable(a);this._focusable(a);if(r.draggable&&e.fn.draggable){this._makeDraggable()}if(r.resizable&&e.fn.resizable){this._makeResizable()}this._createButtons(r.buttons);this._isOpen=false;if(e.fn.bgiframe){s.bgiframe()}this._on(s,{keydown:function(t){if(!r.modal||t.keyCode!==e.ui.keyCode.TAB){return}var n=e(":tabbable",s),i=n.filter(":first"),o=n.filter(":last");if(t.target===o[0]&&!t.shiftKey){i.focus(1);return false}else if(t.target===i[0]&&t.shiftKey){o.focus(1);return false}}})},_init:function(){if(this.options.autoOpen){this.open()}},_destroy:function(){var e,t=this.oldPosition;if(this.overlay){this.overlay.destroy()}this.uiDialog.hide();this.element.removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body");this.uiDialog.remove();if(this.originalTitle){this.element.attr("title",this.originalTitle)}e=t.parent.children().eq(t.index);if(e.length&&e[0]!==this.element[0]){e.before(this.element)}else{t.parent.append(this.element)}},widget:function(){return this.uiDialog},close:function(t){var n=this,r,i;if(!this._isOpen){return}if(false===this._trigger("beforeClose",t)){return}this._isOpen=false;if(this.overlay){this.overlay.destroy()}if(this.options.hide){this.uiDialog.hide(this.options.hide,function(){n._trigger("close",t)})}else{this.uiDialog.hide();this._trigger("close",t)}e.ui.dialog.overlay.resize();if(this.options.modal){r=0;e(".ui-dialog").each(function(){if(this!==n.uiDialog[0]){i=e(this).css("z-index");if(!isNaN(i)){r=Math.max(r,i)}}});e.ui.dialog.maxZ=r}return this},isOpen:function(){return this._isOpen},moveToTop:function(t,n){var r=this.options,i;if(r.modal&&!t||!r.stack&&!r.modal){return this._trigger("focus",n)}if(r.zIndex>e.ui.dialog.maxZ){e.ui.dialog.maxZ=r.zIndex}if(this.overlay){e.ui.dialog.maxZ+=1;e.ui.dialog.overlay.maxZ=e.ui.dialog.maxZ;this.overlay.$el.css("z-index",e.ui.dialog.overlay.maxZ)}i={scrollTop:this.element.scrollTop(),scrollLeft:this.element.scrollLeft()};e.ui.dialog.maxZ+=1;this.uiDialog.css("z-index",e.ui.dialog.maxZ);this.element.attr(i);this._trigger("focus",n);return this},open:function(){if(this._isOpen){return}var t,n=this.options,r=this.uiDialog;this._size();this._position(n.position);r.show(n.show);this.overlay=n.modal?new e.ui.dialog.overlay(this):null;this.moveToTop(true);t=this.element.find(":tabbable");if(!t.length){t=this.uiDialogButtonPane.find(":tabbable");if(!t.length){t=r}}t.eq(0).focus();this._isOpen=true;this._trigger("open");return this},_createButtons:function(t){var n,r,i=this,s=false;this.uiDialogButtonPane.remove();this.uiButtonSet.empty();if(typeof t==="object"&&t!==null){e.each(t,function(){return!(s=true)})}if(s){e.each(t,function(t,n){n=e.isFunction(n)?{click:n,text:t}:n;var r=e("<button type='button'>").attr(n,true).unbind("click").click(function(){n.click.apply(i.element[0],arguments)}).appendTo(i.uiButtonSet);if(e.fn.button){r.button()}});this.uiDialog.addClass("ui-dialog-buttons");this.uiDialogButtonPane.appendTo(this.uiDialog)}else{this.uiDialog.removeClass("ui-dialog-buttons")}},_makeDraggable:function(){function r(e){return{position:e.position,offset:e.offset}}var t=this,n=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(n,i){e(this).addClass("ui-dialog-dragging");t._trigger("dragStart",n,r(i))},drag:function(e,n){t._trigger("drag",e,r(n))},stop:function(i,s){n.position=[s.position.left-t.document.scrollLeft(),s.position.top-t.document.scrollTop()];e(this).removeClass("ui-dialog-dragging");t._trigger("dragStop",i,r(s));e.ui.dialog.overlay.resize()}})},_makeResizable:function(n){function u(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}n=n===t?this.options.resizable:n;var r=this,i=this.options,s=this.uiDialog.css("position"),o=typeof n==="string"?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:i.maxWidth,maxHeight:i.maxHeight,minWidth:i.minWidth,minHeight:this._minHeight(),handles:o,start:function(t,n){e(this).addClass("ui-dialog-resizing");r._trigger("resizeStart",t,u(n))},resize:function(e,t){r._trigger("resize",e,u(t))},stop:function(t,n){e(this).removeClass("ui-dialog-resizing");i.height=e(this).height();i.width=e(this).width();r._trigger("resizeStop",t,u(n));e.ui.dialog.overlay.resize()}}).css("position",s).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var e=this.options;if(e.height==="auto"){return e.minHeight}else{return Math.min(e.minHeight,e.height)}},_position:function(t){var n=[],r=[0,0],i;if(t){if(typeof t==="string"||typeof t==="object"&&"0"in t){n=t.split?t.split(" "):[t[0],t[1]];if(n.length===1){n[1]=n[0]}e.each(["left","top"],function(e,t){if(+n[e]===n[e]){r[e]=n[e];n[e]=t}});t={my:n.join(" "),at:n.join(" "),offset:r.join(" ")}}t=e.extend({},e.ui.dialog.prototype.options.position,t)}else{t=e.ui.dialog.prototype.options.position}i=this.uiDialog.is(":visible");if(!i){this.uiDialog.show()}this.uiDialog.position(t);if(!i){this.uiDialog.hide()}},_setOptions:function(t){var n=this,s={},o=false;e.each(t,function(e,t){n._setOption(e,t);if(e in r){o=true}if(e in i){s[e]=t}});if(o){this._size()}if(this.uiDialog.is(":data(resizable)")){this.uiDialog.resizable("option",s)}},_setOption:function(t,r){var i,s,o=this.uiDialog;switch(t){case"buttons":this._createButtons(r);break;case"closeText":this.uiDialogTitlebarCloseText.text(""+r);break;case"dialogClass":o.removeClass(this.options.dialogClass).addClass(n+r);break;case"disabled":if(r){o.addClass("ui-dialog-disabled")}else{o.removeClass("ui-dialog-disabled")}break;case"draggable":i=o.is(":data(draggable)");if(i&&!r){o.draggable("destroy")}if(!i&&r){this._makeDraggable()}break;case"position":this._position(r);break;case"resizable":s=o.is(":data(resizable)");if(s&&!r){o.resizable("destroy")}if(s&&typeof r==="string"){o.resizable("option","handles",r)}if(!s&&r!==false){this._makeResizable(r)}break;case"title":e(".ui-dialog-title",this.uiDialogTitlebar).html(""+(r||"&#160;"));break}this._super(t,r)},_size:function(){var t,n,r,i=this.options,s=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0});if(i.minWidth>i.width){i.width=i.minWidth}t=this.uiDialog.css({height:"auto",width:i.width}).outerHeight();n=Math.max(0,i.minHeight-t);if(i.height==="auto"){if(e.support.minHeight){this.element.css({minHeight:n,height:"auto"})}else{this.uiDialog.show();r=this.element.css("height","auto").height();if(!s){this.uiDialog.hide()}this.element.height(Math.max(r,n))}}else{this.element.height(Math.max(i.height-t,0))}if(this.uiDialog.is(":data(resizable)")){this.uiDialog.resizable("option","minHeight",this._minHeight())}}});e.extend(e.ui.dialog,{uuid:0,maxZ:0,getTitleId:function(e){var t=e.attr("id");if(!t){this.uuid+=1;t=this.uuid}return"ui-dialog-title-"+t},overlay:function(t){this.$el=e.ui.dialog.overlay.create(t)}});e.extend(e.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:e.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(e){return e+".dialog-overlay"}).join(" "),create:function(t){if(this.instances.length===0){setTimeout(function(){if(e.ui.dialog.overlay.instances.length){e(document).bind(e.ui.dialog.overlay.events,function(t){if(e(t.target).zIndex()<e.ui.dialog.overlay.maxZ){return false}})}},1);e(window).bind("resize.dialog-overlay",e.ui.dialog.overlay.resize)}var n=this.oldInstances.pop()||e("<div>").addClass("ui-widget-overlay");e(document).bind("keydown.dialog-overlay",function(r){var i=e.ui.dialog.overlay.instances;if(i.length!==0&&i[i.length-1]===n&&t.options.closeOnEscape&&!r.isDefaultPrevented()&&r.keyCode&&r.keyCode===e.ui.keyCode.ESCAPE){t.close(r);r.preventDefault()}});n.appendTo(document.body).css({width:this.width(),height:this.height()});if(e.fn.bgiframe){n.bgiframe()}this.instances.push(n);return n},destroy:function(t){var n=e.inArray(t,this.instances),r=0;if(n!==-1){this.oldInstances.push(this.instances.splice(n,1)[0])}if(this.instances.length===0){e([document,window]).unbind(".dialog-overlay")}t.height(0).width(0).remove();e.each(this.instances,function(){r=Math.max(r,this.css("z-index"))});this.maxZ=r},height:function(){var t,n;if(e.browser.msie){t=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);n=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);if(t<n){return e(window).height()+"px"}else{return t+"px"}}else{return e(document).height()+"px"}},width:function(){var t,n;if(e.browser.msie){t=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);n=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);if(t<n){return e(window).width()+"px"}else{return t+"px"}}else{return e(document).width()+"px"}},resize:function(){var t=e([]);e.each(e.ui.dialog.overlay.instances,function(){t=t.add(this)});t.css({width:0,height:0}).css({width:e.ui.dialog.overlay.width(),height:e.ui.dialog.overlay.height()})}});e.extend(e.ui.dialog.overlay.prototype,{destroy:function(){e.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);(function(e,t){var n=false;e.widget("ui.menu",{version:"1.9.0",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element;this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,e.proxy(function(e){if(this.options.disabled){e.preventDefault()}},this));if(this.options.disabled){this.element.addClass("ui-state-disabled").attr("aria-disabled","true")}this._on({"mousedown .ui-menu-item > a":function(e){e.preventDefault()},"click .ui-state-disabled > a":function(e){e.preventDefault()},"click .ui-menu-item:has(a)":function(t){var r=e(t.target).closest(".ui-menu-item");if(!n&&r.not(".ui-state-disabled").length){n=true;this.select(t);if(r.has(".ui-menu").length){this.expand(t)}else if(!this.element.is(":focus")){this.element.trigger("focus",[true]);if(this.active&&this.active.parents(".ui-menu").length===1){clearTimeout(this.timer)}}}},"mouseenter .ui-menu-item":function(t){var n=e(t.currentTarget);n.siblings().children(".ui-state-active").removeClass("ui-state-active");this.focus(t,n)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var n=this.active||this.element.children(".ui-menu-item").eq(0);if(!t){this.focus(e,n)}},blur:function(t){this._delay(function(){if(!e.contains(this.element[0],this.document[0].activeElement)){this.collapseAll(t)}})},keydown:"_keydown"});this.refresh();this._on(this.document,{click:function(t){if(!e(t.target).closest(".ui-menu").length){this.collapseAll(t)}n=false}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show();this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);if(t.data("ui-menu-submenu-carat")){t.remove()}});this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){function a(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var n,r,i,s,o,u=true;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:if(this.active&&!this.active.is(".ui-state-disabled")){this.expand(t)}break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:u=false;r=this.previousFilter||"";i=String.fromCharCode(t.keyCode);s=false;clearTimeout(this.filterTimer);if(i===r){s=true}else{i=r+i}o=new RegExp("^"+a(i),"i");n=this.activeMenu.children(".ui-menu-item").filter(function(){return o.test(e(this).children("a").text())});n=s&&n.index(this.active.next())!==-1?this.active.nextAll(".ui-menu-item"):n;if(!n.length){i=String.fromCharCode(t.keyCode);o=new RegExp("^"+a(i),"i");n=this.activeMenu.children(".ui-menu-item").filter(function(){return o.test(e(this).children("a").text())})}if(n.length){this.focus(t,n);if(n.length>1){this.previousFilter=i;this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)}else{delete this.previousFilter}}else{delete this.previousFilter}}if(u){t.preventDefault()}},_activate:function(e){if(!this.active.is(".ui-state-disabled")){if(this.active.children("a[aria-haspopup='true']").length){this.expand(e)}else{this.select(e)}}},refresh:function(){var t,n=this.options.icons.submenu,r=this.element.find(this.options.menus+":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"});t=r.add(this.element);t.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()});t.children(":not(.ui-menu-item)").each(function(){var t=e(this);if(!/[^\-\s]/.test(t.text())){t.addClass("ui-widget-content ui-menu-divider")}});t.children(".ui-state-disabled").attr("aria-disabled","true");r.each(function(){var t=e(this),r=t.prev("a"),i=e("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",true);r.attr("aria-haspopup","true").prepend(i);t.attr("aria-labelledby",r.attr("id"))});if(this.active&&!e.contains(this.element[0],this.active[0])){this.blur()}},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},focus:function(e,t){var n,r;this.blur(e,e&&e.type==="focus");this._scrollIntoView(t);this.active=t.first();r=this.active.children("a").addClass("ui-state-focus");if(this.options.role){this.element.attr("aria-activedescendant",r.attr("id"))}this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active");if(e&&e.type==="keydown"){this._close()}else{this.timer=this._delay(function(){this._close()},this.delay)}n=t.children(".ui-menu");if(n.length&&/^mouse/.test(e.type)){this._startOpening(n)}this.activeMenu=t.parent();this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var n,r,i,s,o,u;if(this._hasScroll()){n=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0;r=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0;i=t.offset().top-this.activeMenu.offset().top-n-r;s=this.activeMenu.scrollTop();o=this.activeMenu.height();u=t.height();if(i<0){this.activeMenu.scrollTop(s+i)}else if(i+u>o){this.activeMenu.scrollTop(s+i-o+u)}}},blur:function(e,t){if(!t){clearTimeout(this.timer)}if(!this.active){return}this.active.children("a").removeClass("ui-state-focus");this.active=null;this._trigger("blur",e,{item:this.active})},_startOpening:function(e){clearTimeout(this.timer);if(e.attr("aria-hidden")!=="true"){return}this.timer=this._delay(function(){this._close();this._open(e)},this.delay)},_open:function(t){var n=e.extend({of:this.active},this.options.position);clearTimeout(this.timer);this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true");t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(n)},collapseAll:function(t,n){clearTimeout(this.timer);this.timer=this._delay(function(){var r=n?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));if(!r.length){r=this.element}this._close(r);this.blur(t);this.activeMenu=r},this.delay)},_close:function(e){if(!e){e=this.active?this.active.parent():this.element}e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);if(t&&t.length){this._close();this.focus(e,t)}},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();if(t&&t.length){this._open(t.parent());this._delay(function(){this.focus(e,t)})}},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,n){var r;if(this.active){if(e==="first"||e==="last"){r=this.active[e==="first"?"prevAll":"nextAll"](".ui-menu-item").eq(-1)}else{r=this.active[e+"All"](".ui-menu-item").eq(0)}}if(!r||!r.length||!this.active){r=this.activeMenu.children(".ui-menu-item")[t]()}this.focus(n,r)},nextPage:function(t){var n,r,i;if(!this.active){this.next(t);return}if(this.isLastItem()){return}if(this._hasScroll()){r=this.active.offset().top;i=this.element.height();this.active.nextAll(".ui-menu-item").each(function(){n=e(this);return n.offset().top-r-i<0});this.focus(t,n)}else{this.focus(t,this.activeMenu.children(".ui-menu-item")[!this.active?"first":"last"]())}},previousPage:function(t){var n,r,i;if(!this.active){this.next(t);return}if(this.isFirstItem()){return}if(this._hasScroll()){r=this.active.offset().top;i=this.element.height();this.active.prevAll(".ui-menu-item").each(function(){n=e(this);return n.offset().top-r+i>0});this.focus(t,n)}else{this.focus(t,this.activeMenu.children(".ui-menu-item").first())}},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var n={item:this.active};if(!this.active.has(".ui-menu").length){this.collapseAll(t,true)}this._trigger("select",t,n)}})})(jQuery);(function(e,t){e.widget("ui.progressbar",{version:"1.9.0",options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()});this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element);this.oldValue=this._value();this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow");this.valueDiv.remove()},value:function(e){if(e===t){return this._value()}this._setOption("value",e);return this},_setOption:function(e,t){if(e==="value"){this.options.value=t;this._refreshValue();if(this._value()===this.options.max){this._trigger("complete")}}this._super(e,t)},_value:function(){var e=this.options.value;if(typeof e!=="number"){e=0}return Math.min(this.options.max,Math.max(this.min,e))},_percentage:function(){return 100*this._value()/this.options.max},_refreshValue:function(){var e=this.value(),t=this._percentage();if(this.oldValue!==e){this.oldValue=e;this._trigger("change")}this.valueDiv.toggle(e>this.min).toggleClass("ui-corner-right",e===this.options.max).width(t.toFixed(0)+"%");this.element.attr("aria-valuenow",e)}})})(jQuery);(function(e,t){var n=5;e.widget("ui.slider",e.ui.mouse,{version:"1.9.0",widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null},_create:function(){var t,r=this.options,i=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),s="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",o=r.values&&r.values.length||1,u=[];this._keySliding=false;this._mouseSliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider"+" ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+(r.disabled?" ui-slider-disabled ui-disabled":""));this.range=e([]);if(r.range){if(r.range===true){if(!r.values){r.values=[this._valueMin(),this._valueMin()]}if(r.values.length&&r.values.length!==2){r.values=[r.values[0],r.values[0]]}}this.range=e("<div></div>").appendTo(this.element).addClass("ui-slider-range"+" ui-widget-header"+(r.range==="min"||r.range==="max"?" ui-slider-range-"+r.range:""))}for(t=i.length;t<o;t++){u.push(s)}this.handles=i.add(e(u.join("")).appendTo(this.element));this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).mouseenter(function(){if(!r.disabled){e(this).addClass("ui-state-hover")}}).mouseleave(function(){e(this).removeClass("ui-state-hover")}).focus(function(){if(!r.disabled){e(".ui-slider .ui-state-focus").removeClass("ui-state-focus");e(this).addClass("ui-state-focus")}else{e(this).blur()}}).blur(function(){e(this).removeClass("ui-state-focus")});this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)});this._on(this.handles,{keydown:function(t){var r,i,s,o,u=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:t.preventDefault();if(!this._keySliding){this._keySliding=true;e(t.target).addClass("ui-state-active");r=this._start(t,u);if(r===false){return}}break}o=this.options.step;if(this.options.values&&this.options.values.length){i=s=this.values(u)}else{i=s=this.value()}switch(t.keyCode){case e.ui.keyCode.HOME:s=this._valueMin();break;case e.ui.keyCode.END:s=this._valueMax();break;case e.ui.keyCode.PAGE_UP:s=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.PAGE_DOWN:s=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax()){return}s=this._trimAlignValue(i+o);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin()){return}s=this._trimAlignValue(i-o);break}this._slide(t,u,s)},keyup:function(t){var n=e(t.target).data("ui-slider-handle-index");if(this._keySliding){this._keySliding=false;this._stop(t,n);this._change(t,n);e(t.target).removeClass("ui-state-active")}}});this._refreshValue();this._animateOff=false},_destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider"+" ui-slider-horizontal"+" ui-slider-vertical"+" ui-slider-disabled"+" ui-widget"+" ui-widget-content"+" ui-corner-all");this._mouseDestroy()},_mouseCapture:function(t){var n,r,i,s,o,u,a,f,l=this,c=this.options;if(c.disabled){return false}this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();n={x:t.pageX,y:t.pageY};r=this._normValueFromMouse(n);i=this._valueMax()-this._valueMin()+1;this.handles.each(function(t){var n=Math.abs(r-l.values(t));if(i>n){i=n;s=e(this);o=t}});if(c.range===true&&this.values(1)===c.min){o+=1;s=e(this.handles[o])}u=this._start(t,o);if(u===false){return false}this._mouseSliding=true;this._handleIndex=o;s.addClass("ui-state-active").focus();a=s.offset();f=!e(t.target).parents().andSelf().is(".ui-slider-handle");this._clickOffset=f?{left:0,top:0}:{left:t.pageX-a.left-s.width()/2,top:t.pageY-a.top-s.height()/2-(parseInt(s.css("borderTopWidth"),10)||0)-(parseInt(s.css("borderBottomWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0)};if(!this.handles.hasClass("ui-state-hover")){this._slide(t,o,r)}this._animateOff=true;return true},_mouseStart:function(e){return true},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(t);this._slide(e,this._handleIndex,n);return false},_mouseStop:function(e){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(e,this._handleIndex);this._change(e,this._handleIndex);this._handleIndex=null;this._clickOffset=null;this._animateOff=false;return false},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,n,r,i,s;if(this.orientation==="horizontal"){t=this.elementSize.width;n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)}else{t=this.elementSize.height;n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)}r=n/t;if(r>1){r=1}if(r<0){r=0}if(this.orientation==="vertical"){r=1-r}i=this._valueMax()-this._valueMin();s=this._valueMin()+r*i;return this._trimAlignValue(s)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};if(this.options.values&&this.options.values.length){n.value=this.values(t);n.values=this.values()}return this._trigger("start",e,n)},_slide:function(e,t,n){var r,i,s;if(this.options.values&&this.options.values.length){r=this.values(t?0:1);if(this.options.values.length===2&&this.options.range===true&&(t===0&&n>r||t===1&&n<r)){n=r}if(n!==this.values(t)){i=this.values();i[t]=n;s=this._trigger("slide",e,{handle:this.handles[t],value:n,values:i});r=this.values(t?0:1);if(s!==false){this.values(t,n,true)}}}else{if(n!==this.value()){s=this._trigger("slide",e,{handle:this.handles[t],value:n});if(s!==false){this.value(n)}}}},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};if(this.options.values&&this.options.values.length){n.value=this.values(t);n.values=this.values()}this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};if(this.options.values&&this.options.values.length){n.value=this.values(t);n.values=this.values()}this._trigger("change",e,n)}},value:function(e){if(arguments.length){this.options.value=this._trimAlignValue(e);this._refreshValue();this._change(null,0);return}return this._value()},values:function(t,n){var r,i,s;if(arguments.length>1){this.options.values[t]=this._trimAlignValue(n);this._refreshValue();this._change(null,t);return}if(arguments.length){if(e.isArray(arguments[0])){r=this.options.values;i=arguments[0];for(s=0;s<r.length;s+=1){r[s]=this._trimAlignValue(i[s]);this._change(null,s)}this._refreshValue()}else{if(this.options.values&&this.options.values.length){return this._values(t)}else{return this.value()}}}else{return this._values()}},_setOption:function(t,n){var r,i=0;if(e.isArray(this.options.values)){i=this.options.values.length}e.Widget.prototype._setOption.apply(this,arguments);switch(t){case"disabled":if(n){this.handles.filter(".ui-state-focus").blur();this.handles.removeClass("ui-state-hover");this.handles.prop("disabled",true);this.element.addClass("ui-disabled")}else{this.handles.prop("disabled",false);this.element.removeClass("ui-disabled")}break;case"orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case"value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case"values":this._animateOff=true;this._refreshValue();for(r=0;r<i;r+=1){this._change(null,r)}this._animateOff=false;break}},_value:function(){var e=this.options.value;e=this._trimAlignValue(e);return e},_values:function(e){var t,n,r;if(arguments.length){t=this.options.values[e];t=this._trimAlignValue(t);return t}else{n=this.options.values.slice();for(r=0;r<n.length;r+=1){n[r]=this._trimAlignValue(n[r])}return n}},_trimAlignValue:function(e){if(e<=this._valueMin()){return this._valueMin()}if(e>=this._valueMax()){return this._valueMax()}var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t,r=e-n;if(Math.abs(n)*2>=t){r+=n>0?t:-t}return parseFloat(r.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,n,r,i,s,o=this.options.range,u=this.options,a=this,f=!this._animateOff?u.animate:false,l={};if(this.options.values&&this.options.values.length){this.handles.each(function(r,i){n=(a.values(r)-a._valueMin())/(a._valueMax()-a._valueMin())*100;l[a.orientation==="horizontal"?"left":"bottom"]=n+"%";e(this).stop(1,1)[f?"animate":"css"](l,u.animate);if(a.options.range===true){if(a.orientation==="horizontal"){if(r===0){a.range.stop(1,1)[f?"animate":"css"]({left:n+"%"},u.animate)}if(r===1){a.range[f?"animate":"css"]({width:n-t+"%"},{queue:false,duration:u.animate})}}else{if(r===0){a.range.stop(1,1)[f?"animate":"css"]({bottom:n+"%"},u.animate)}if(r===1){a.range[f?"animate":"css"]({height:n-t+"%"},{queue:false,duration:u.animate})}}}t=n})}else{r=this.value();i=this._valueMin();s=this._valueMax();n=s!==i?(r-i)/(s-i)*100:0;l[this.orientation==="horizontal"?"left":"bottom"]=n+"%";this.handle.stop(1,1)[f?"animate":"css"](l,u.animate);if(o==="min"&&this.orientation==="horizontal"){this.range.stop(1,1)[f?"animate":"css"]({width:n+"%"},u.animate)}if(o==="max"&&this.orientation==="horizontal"){this.range[f?"animate":"css"]({width:100-n+"%"},{queue:false,duration:u.animate})}if(o==="min"&&this.orientation==="vertical"){this.range.stop(1,1)[f?"animate":"css"]({height:n+"%"},u.animate)}if(o==="max"&&this.orientation==="vertical"){this.range[f?"animate":"css"]({height:100-n+"%"},{queue:false,duration:u.animate})}}}})})(jQuery);(function(e){function t(e){return function(){var t=this.element.val();e.apply(this,arguments);this._refresh();if(t!==this.element.val()){this._trigger("change")}}}e.widget("ui.spinner",{version:"1.9.0",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:true,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max);this._setOption("min",this.options.min);this._setOption("step",this.options.step);this._value(this.element.val(),true);this._draw();this._on(this._events);this._refresh();this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t={},n=this.element;e.each(["min","max","step"],function(e,r){var i=n.attr(r);if(i!==undefined&&i.length){t[r]=i}});return t},_events:{keydown:function(e){if(this._start(e)&&this._keydown(e)){e.preventDefault()}},keyup:"_stop",focus:function(){this.uiSpinner.addClass("ui-state-active");this.previous=this.element.val()},blur:function(e){if(this.cancelBlur){delete this.cancelBlur;return}this._refresh();this.uiSpinner.removeClass("ui-state-active");if(this.previous!==this.element.val()){this._trigger("change",e)}},mousewheel:function(e,t){if(!t){return}if(!this.spinning&&!this._start(e)){return false}this._spin((t>0?1:-1)*this.options.step,e);clearTimeout(this.mousewheelTimer);this.mousewheelTimer=this._delay(function(){if(this.spinning){this._stop(e)}},100);e.preventDefault()},"mousedown .ui-spinner-button":function(t){function r(){var e=this.element[0]===this.document[0].activeElement;if(!e){this.element.focus();this.previous=n;this._delay(function(){this.previous=n})}}var n;n=this.element[0]===this.document[0].activeElement?this.previous:this.element.val();t.preventDefault();r.call(this);this.cancelBlur=true;this._delay(function(){delete this.cancelBlur;r.call(this)});if(this._start(t)===false){return}this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){if(!e(t.currentTarget).hasClass("ui-state-active")){return}if(this._start(t)===false){return false}this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this._hoverable(e);this.element.attr("role","spinbutton");this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all");if(this.buttons.height()>Math.ceil(e.height()*.5)&&e.height()>0){e.height(e.height())}if(this.options.disabled){this.disable()}},_keydown:function(t){var n=this.options,r=e.ui.keyCode;switch(t.keyCode){case r.UP:this._repeat(null,1,t);return true;case r.DOWN:this._repeat(null,-1,t);return true;case r.PAGE_UP:this._repeat(null,n.page,t);return true;case r.PAGE_DOWN:this._repeat(null,-n.page,t);return true}return false},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-state-default ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return""+"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'>"+"<span class='ui-icon "+this.options.icons.up+"'>&#9650;</span>"+"</a>"+"<a class='ui-spinner-button ui-spinner-down ui-corner-br'>"+"<span class='ui-icon "+this.options.icons.down+"'>&#9660;</span>"+"</a>"},_start:function(e){if(!this.spinning&&this._trigger("start",e)===false){return false}if(!this.counter){this.counter=1}this.spinning=true;return true},_repeat:function(e,t,n){e=e||500;clearTimeout(this.timer);this.timer=this._delay(function(){this._repeat(40,t,n)},e);this._spin(t*this.options.step,n)},_spin:function(e,t){var n=this.value()||0;if(!this.counter){this.counter=1}n=this._adjustValue(n+e*this._increment(this.counter));if(!this.spinning||this._trigger("spin",t,{value:n})!==false){this._value(n);this.counter++}},_increment:function(t){var n=this.options.incremental;if(n){return e.isFunction(n)?n(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1)}return 1},_precision:function(){var e=this._precisionOf(this.options.step);if(this.options.min!==null){e=Math.max(e,this._precisionOf(this.options.min))}return e},_precisionOf:function(e){var t=e.toString(),n=t.indexOf(".");return n===-1?0:t.length-n-1},_adjustValue:function(e){var t,n,r=this.options;t=r.min!==null?r.min:0;n=e-t;n=Math.round(n/r.step)*r.step;e=t+n;e=parseFloat(e.toFixed(this._precision()));if(r.max!==null&&e>r.max){return r.max}if(r.min!==null&&e<r.min){return r.min}return e},_stop:function(e){if(!this.spinning){return}clearTimeout(this.timer);clearTimeout(this.mousewheelTimer);this.counter=0;this.spinning=false;this._trigger("stop",e)},_setOption:function(e,t){if(e==="culture"||e==="numberFormat"){var n=this._parse(this.element.val());this.options[e]=t;this.element.val(this._format(n));return}if(e==="max"||e==="min"||e==="step"){if(typeof t==="string"){t=this._parse(t)}}this._super(e,t);if(e==="disabled"){if(t){this.element.prop("disabled",true);this.buttons.button("disable")}else{this.element.prop("disabled",false);this.buttons.button("enable")}}},_setOptions:t(function(e){this._super(e);this._value(this.element.val())}),_parse:function(e){if(typeof e==="string"&&e!==""){e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e}return e===""||isNaN(e)?null:e},_format:function(e){if(e===""){return""}return window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},_value:function(e,t){var n;if(e!==""){n=this._parse(e);if(n!==null){if(!t){n=this._adjustValue(n)}e=this._format(n)}}this.element.val(e);this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",false).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow");this.uiSpinner.replaceWith(this.element)},stepUp:t(function(e){this._stepUp(e)}),_stepUp:function(e){this._spin((e||1)*this.options.step)},stepDown:t(function(e){this._stepDown(e)}),_stepDown:function(e){this._spin((e||1)*-this.options.step)},pageUp:t(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:t(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){if(!arguments.length){return this._parse(this.element.val())}t(this._value).call(this,e)},widget:function(){return this.uiSpinner}})})(jQuery);(function(e,t){function i(){return++n}function s(e){e=e.cloneNode(false);return e.hash.length>1&&e.href.replace(r,"")===location.href.replace(r,"")}var n=0,r=/#.*$/;e.widget("ui.tabs",{version:"1.9.0",delay:300,options:{active:null,collapsible:false,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var t,n=this,r=this.options,i=r.active;this.running=false;this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",r.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(t){if(e(this).is(".ui-state-disabled")){t.preventDefault()}}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){if(e(this).closest("li").is(".ui-state-disabled")){this.blur()}});this._processTabs();if(i===null){if(location.hash){this.anchors.each(function(e,t){if(t.hash===location.hash){i=e;return false}})}if(i===null){i=this.tabs.filter(".ui-tabs-active").index()}if(i===null||i===-1){i=this.tabs.length?0:false}}if(i!==false){i=this.tabs.index(this.tabs.eq(i));if(i===-1){i=r.collapsible?false:0}}r.active=i;if(!r.collapsible&&r.active===false&&this.anchors.length){r.active=0}if(e.isArray(r.disabled)){r.disabled=e.unique(r.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return n.tabs.index(e)}))).sort()}if(this.options.active!==false&&this.anchors.length){this.active=this._findActive(this.options.active)}else{this.active=e()}this._refresh();if(this.active.length){this.load(r.active)}},_getCreateEventData:function(){return{tab:this.active,panel:!this.active.length?e():this._getPanelForTab(this.active)}},_tabKeydown:function(t){var n=e(this.document[0].activeElement).closest("li"),r=this.tabs.index(n),i=true;if(this._handlePageNav(t)){return}switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:r++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:i=false;r--;break;case e.ui.keyCode.END:r=this.anchors.length-1;break;case e.ui.keyCode.HOME:r=0;break;case e.ui.keyCode.SPACE:t.preventDefault();clearTimeout(this.activating);this._activate(r);return;case e.ui.keyCode.ENTER:t.preventDefault();clearTimeout(this.activating);this._activate(r===this.options.active?false:r);return;default:return}t.preventDefault();clearTimeout(this.activating);r=this._focusNextTab(r,i);if(!t.ctrlKey){n.attr("aria-selected","false");this.tabs.eq(r).attr("aria-selected","true");this.activating=this._delay(function(){this.option("active",r)},this.delay)}},_panelKeydown:function(t){if(this._handlePageNav(t)){return}if(t.ctrlKey&&t.keyCode===e.ui.keyCode.UP){t.preventDefault();this.active.focus()}},_handlePageNav:function(t){if(t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP){this._activate(this._focusNextTab(this.options.active-1,false));return true}if(t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN){this._activate(this._focusNextTab(this.options.active+1,true));return true}},_findNextTab:function(t,n){function i(){if(t>r){t=0}if(t<0){t=r}return t}var r=this.tabs.length-1;while(e.inArray(i(),this.options.disabled)!==-1){t=n?t+1:t-1}return t},_focusNextTab:function(e,t){e=this._findNextTab(e,t);this.tabs.eq(e).focus();return e},_setOption:function(e,t){if(e==="active"){this._activate(t);return}if(e==="disabled"){this._setupDisabled(t);return}this._super(e,t);if(e==="collapsible"){this.element.toggleClass("ui-tabs-collapsible",t);if(!t&&this.options.active===false){this._activate(0)}}if(e==="event"){this._setupEvents(t)}if(e==="heightStyle"){this._setupHeightStyle(t)}},_tabId:function(e){return e.attr("aria-controls")||"ui-tabs-"+i()},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t,n=this.options,r=this.tablist.children(":has(a[href])");n.disabled=e.map(r.filter(".ui-state-disabled"),function(e){return r.index(e)});this._processTabs();if(n.active===false||!this.anchors.length){n.active=false;this.active=e()}else if(this.active.length&&!e.contains(this.tablist[0],this.active[0])){if(this.tabs.length===n.disabled.length){n.active=false;this.active=e()}else{this._activate(this._findNextTab(Math.max(0,n.active-1),false))}}else{n.active=this.tabs.index(this.active)}this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled);this._setupEvents(this.options.event);this._setupHeightStyle(this.options.heightStyle);this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1});this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"});if(!this.active.length){this.tabs.eq(0).attr("tabIndex",0)}else{this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0});this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})}},_processTabs:function(){var t=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist");this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1});this.anchors=this.tabs.map(function(){return e("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1});this.panels=e();this.anchors.each(function(n,r){var i,o,u,a=e(r).uniqueId().attr("id"),f=e(r).closest("li"),l=f.attr("aria-controls");if(s(r)){i=r.hash;o=t.element.find(t._sanitizeSelector(i))}else{u=t._tabId(f);i="#"+u;o=t.element.find(i);if(!o.length){o=t._createPanel(u);o.insertAfter(t.panels[n-1]||t.tablist)}o.attr("aria-live","polite")}if(o.length){t.panels=t.panels.add(o)}if(l){f.data("ui-tabs-aria-controls",l)}f.attr({"aria-controls":i.substring(1),"aria-labelledby":a});o.attr("aria-labelledby",a)});this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",true)},_setupDisabled:function(t){if(e.isArray(t)){if(!t.length){t=false}else if(t.length===this.anchors.length){t=true}}for(var n=0,r;r=this.tabs[n];n++){if(t===true||e.inArray(n,t)!==-1){e(r).addClass("ui-state-disabled").attr("aria-disabled","true")}else{e(r).removeClass("ui-state-disabled").removeAttr("aria-disabled")}}this.options.disabled=t},_setupEvents:function(t){var n={click:function(e){e.preventDefault()}};if(t){e.each(t.split(" "),function(e,t){n[t]="_eventHandler"})}this._off(this.anchors.add(this.tabs).add(this.panels));this._on(this.anchors,n);this._on(this.tabs,{keydown:"_tabKeydown"});this._on(this.panels,{keydown:"_panelKeydown"});this._focusable(this.tabs);this._hoverable(this.tabs)},_setupHeightStyle:function(t){var n,r,i=this.element.parent();if(t==="fill"){if(!e.support.minHeight){r=i.css("overflow");i.css("overflow","hidden")}n=i.height();this.element.siblings(":visible").each(function(){var t=e(this),r=t.css("position");if(r==="absolute"||r==="fixed"){return}n-=t.outerHeight(true)});if(r){i.css("overflow",r)}this.element.children().not(this.panels).each(function(){n-=e(this).outerHeight(true)});this.panels.each(function(){e(this).height(Math.max(0,n-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")}else if(t==="auto"){n=0;this.panels.each(function(){n=Math.max(n,e(this).height("").height())}).height(n)}},_eventHandler:function(t){var n=this.options,r=this.active,i=e(t.currentTarget),s=i.closest("li"),o=s[0]===r[0],u=o&&n.collapsible,a=u?e():this._getPanelForTab(s),f=!r.length?e():this._getPanelForTab(r),l={oldTab:r,oldPanel:f,newTab:u?e():s,newPanel:a};t.preventDefault();if(s.hasClass("ui-state-disabled")||s.hasClass("ui-tabs-loading")||this.running||o&&!n.collapsible||this._trigger("beforeActivate",t,l)===false){return}n.active=u?false:this.tabs.index(s);this.active=o?e():s;if(this.xhr){this.xhr.abort()}if(!f.length&&!a.length){e.error("jQuery UI Tabs: Mismatching fragment identifier.")}if(a.length){this.load(this.tabs.index(s),t)}this._toggle(t,l)},_toggle:function(t,n){function o(){r.running=false;r._trigger("activate",t,n)}function u(){n.newTab.closest("li").addClass("ui-tabs-active ui-state-active");if(i.length&&r.options.show){r._show(i,r.options.show,o)}else{i.show();o()}}var r=this,i=n.newPanel,s=n.oldPanel;this.running=true;if(s.length&&this.options.hide){this._hide(s,this.options.hide,function(){n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active");u()})}else{n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active");s.hide();u()}s.attr({"aria-expanded":"false","aria-hidden":"true"});n.oldTab.attr("aria-selected","false");if(i.length&&s.length){n.oldTab.attr("tabIndex",-1)}else if(i.length){this.tabs.filter(function(){return e(this).attr("tabIndex")===0}).attr("tabIndex",-1)}i.attr({"aria-expanded":"true","aria-hidden":"false"});n.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(t){var n,r=this._findActive(t);if(r[0]===this.active[0]){return}if(!r.length){r=this.active}n=r.find(".ui-tabs-anchor")[0];this._eventHandler({target:n,currentTarget:n,preventDefault:e.noop})},_findActive:function(t){return t===false?e():this.tabs.eq(t)},_getIndex:function(e){if(typeof e==="string"){e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))}return e},_destroy:function(){if(this.xhr){this.xhr.abort()}this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible");this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role");this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeData("href.tabs").removeData("load.tabs").removeUniqueId();this.tabs.add(this.panels).each(function(){if(e.data(this,"ui-tabs-destroy")){e(this).remove()}else{e(this).removeClass("ui-state-default ui-state-active ui-state-disabled "+"ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}});this.tabs.each(function(){var t=e(this),n=t.data("ui-tabs-aria-controls");if(n){t.attr("aria-controls",n)}else{t.removeAttr("aria-controls")}});if(this.options.heightStyle!=="content"){this.panels.css("height","")}},enable:function(n){var r=this.options.disabled;if(r===false){return}if(n===t){r=false}else{n=this._getIndex(n);if(e.isArray(r)){r=e.map(r,function(e){return e!==n?e:null})}else{r=e.map(this.tabs,function(e,t){return t!==n?t:null})}}this._setupDisabled(r)},disable:function(n){var r=this.options.disabled;if(r===true){return}if(n===t){r=true}else{n=this._getIndex(n);if(e.inArray(n,r)!==-1){return}if(e.isArray(r)){r=e.merge([n],r).sort()}else{r=[n]}}this._setupDisabled(r)},load:function(t,n){t=this._getIndex(t);var r=this,i=this.tabs.eq(t),o=i.find(".ui-tabs-anchor"),u=this._getPanelForTab(i),a={tab:i,panel:u};if(s(o[0])){return}this.xhr=e.ajax(this._ajaxSettings(o,n,a));if(this.xhr&&this.xhr.statusText!=="canceled"){i.addClass("ui-tabs-loading");u.attr("aria-busy","true");this.xhr.success(function(e){setTimeout(function(){u.html(e);r._trigger("load",n,a)},1)}).complete(function(e,t){setTimeout(function(){if(t==="abort"){r.panels.stop(false,true)}i.removeClass("ui-tabs-loading");u.removeAttr("aria-busy");if(e===r.xhr){delete r.xhr}},1)})}},_ajaxSettings:function(t,n,r){var i=this;return{url:t.attr("href"),beforeSend:function(t,s){return i._trigger("beforeLoad",n,e.extend({jqXHR:t,ajaxSettings:s},r))}}},_getPanelForTab:function(t){var n=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+n))}});if(e.uiBackCompat!==false){e.ui.tabs.prototype._ui=function(e,t){return{tab:e,panel:t,index:this.anchors.index(e)}};e.widget("ui.tabs",e.ui.tabs,{url:function(e,t){this.anchors.eq(e).attr("href",t)}});e.widget("ui.tabs",e.ui.tabs,{options:{ajaxOptions:null,cache:false},_create:function(){this._super();var t=this;this._on({tabsbeforeload:function(n,r){if(e.data(r.tab[0],"cache.tabs")){n.preventDefault();return}r.jqXHR.success(function(){if(t.options.cache){e.data(r.tab[0],"cache.tabs",true)}})}})},_ajaxSettings:function(t,n,r){var i=this.options.ajaxOptions;return e.extend({},i,{error:function(e,t,n){try{i.error(e,t,r.tab.closest("li").index(),r.tab[0])}catch(n){}}},this._superApply(arguments))},_setOption:function(e,t){if(e==="cache"&&t===false){this.anchors.removeData("cache.tabs")}this._super(e,t)},_destroy:function(){this.anchors.removeData("cache.tabs");this._super()},url:function(e,t){this.anchors.eq(e).removeData("cache.tabs");this._superApply(arguments)}});e.widget("ui.tabs",e.ui.tabs,{abort:function(){if(this.xhr){this.xhr.abort()}}});e.widget("ui.tabs",e.ui.tabs,{options:{spinner:"<em>Loading&#8230;</em>"},_create:function(){this._super();this._on({tabsbeforeload:function(e,t){if(e.target!==this.element[0]||!this.options.spinner){return}var n=t.tab.find("span"),r=n.html();n.html(this.options.spinner);t.jqXHR.complete(function(){n.html(r)})}})}});e.widget("ui.tabs",e.ui.tabs,{options:{enable:null,disable:null},enable:function(t){var n=this.options,r;if(t&&n.disabled===true||e.isArray(n.disabled)&&e.inArray(t,n.disabled)!==-1){r=true}this._superApply(arguments);if(r){this._trigger("enable",null,this._ui(this.anchors[t],this.panels[t]))}},disable:function(t){var n=this.options,r;if(t&&n.disabled===false||e.isArray(n.disabled)&&e.inArray(t,n.disabled)===-1){r=true}this._superApply(arguments);if(r){this._trigger("disable",null,this._ui(this.anchors[t],this.panels[t]))}}});e.widget("ui.tabs",e.ui.tabs,{options:{add:null,remove:null,tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"},add:function(n,r,i){if(i===t){i=this.anchors.length}var s,o,u=this.options,a=e(u.tabTemplate.replace(/#\{href\}/g,n).replace(/#\{label\}/g,r)),f=!n.indexOf("#")?n.replace("#",""):this._tabId(a);a.addClass("ui-state-default ui-corner-top").data("ui-tabs-destroy",true);a.attr("aria-controls",f);s=i>=this.tabs.length;o=this.element.find("#"+f);if(!o.length){o=this._createPanel(f);if(s){if(i>0){o.insertAfter(this.panels.eq(-1))}else{o.appendTo(this.element)}}else{o.insertBefore(this.panels[i])}}o.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").hide();if(s){a.appendTo(this.tablist)}else{a.insertBefore(this.tabs[i])}u.disabled=e.map(u.disabled,function(e){return e>=i?++e:e});this.refresh();if(this.tabs.length===1&&u.active===false){this.option("active",0)}this._trigger("add",null,this._ui(this.anchors[i],this.panels[i]));return this},remove:function(t){t=this._getIndex(t);var n=this.options,r=this.tabs.eq(t).remove(),i=this._getPanelForTab(r).remove();if(r.hasClass("ui-tabs-active")&&this.anchors.length>2){this._activate(t+(t+1<this.anchors.length?1:-1))}n.disabled=e.map(e.grep(n.disabled,function(e){return e!==t}),function(e){return e>=t?--e:e});this.refresh();this._trigger("remove",null,this._ui(r.find("a")[0],i[0]));return this}});e.widget("ui.tabs",e.ui.tabs,{length:function(){return this.anchors.length}});e.widget("ui.tabs",e.ui.tabs,{options:{idPrefix:"ui-tabs-"},_tabId:function(t){var n=t.is("li")?t.find("a[href]"):t;n=n[0];return e(n).closest("li").attr("aria-controls")||n.title&&n.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF\-]/g,"")||this.options.idPrefix+i()}});e.widget("ui.tabs",e.ui.tabs,{options:{panelTemplate:"<div></div>"},_createPanel:function(t){return e(this.options.panelTemplate).attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",true)}});e.widget("ui.tabs",e.ui.tabs,{_create:function(){var e=this.options;if(e.active===null&&e.selected!==t){e.active=e.selected===-1?false:e.selected}this._super();e.selected=e.active;if(e.selected===false){e.selected=-1}},_setOption:function(e,t){if(e!=="selected"){return this._super(e,t)}var n=this.options;this._super("active",t===-1?false:t);n.selected=n.active;if(n.selected===false){n.selected=-1}},_eventHandler:function(e){this._superApply(arguments);this.options.selected=this.options.active;if(this.options.selected===false){this.options.selected=-1}}});e.widget("ui.tabs",e.ui.tabs,{options:{show:null,select:null},_create:function(){this._super();if(this.options.active!==false){this._trigger("show",null,this._ui(this.active.find(".ui-tabs-anchor")[0],this._getPanelForTab(this.active)[0]))}},_trigger:function(e,t,n){var r=this._superApply(arguments);if(!r){return false}if(e==="beforeActivate"&&n.newTab.length){r=this._super("select",t,{tab:n.newTab.find(".ui-tabs-anchor")[0],panel:n.newPanel[0],index:n.newTab.closest("li").index()})}else if(e==="activate"&&n.newTab.length){r=this._super("show",t,{tab:n.newTab.find(".ui-tabs-anchor")[0],panel:n.newPanel[0],index:n.newTab.closest("li").index()})}return r}});e.widget("ui.tabs",e.ui.tabs,{select:function(e){e=this._getIndex(e);if(e===-1){if(this.options.collapsible&&this.options.selected!==-1){e=this.options.selected}else{return}}this.anchors.eq(e).trigger(this.options.event+this.eventNamespace)}});(function(){var t=0;e.widget("ui.tabs",e.ui.tabs,{options:{cookie:null},_create:function(){var e=this.options,t;if(e.active==null&&e.cookie){t=parseInt(this._cookie(),10);if(t===-1){t=false}e.active=t}this._super()},_cookie:function(n){var r=[this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+ ++t)];if(arguments.length){r.push(n===false?-1:n);r.push(this.options.cookie)}return e.cookie.apply(null,r)},_refresh:function(){this._super();if(this.options.cookie){this._cookie(this.options.active,this.options.cookie)}},_eventHandler:function(e){this._superApply(arguments);if(this.options.cookie){this._cookie(this.options.active,this.options.cookie)}},_destroy:function(){this._super();if(this.options.cookie){this._cookie(null,this.options.cookie)}}})})();e.widget("ui.tabs",e.ui.tabs,{_trigger:function(t,n,r){var i=e.extend({},r);if(t==="load"){i.panel=i.panel[0];i.tab=i.tab.find(".ui-tabs-anchor")[0]}return this._super(t,n,i)}});e.widget("ui.tabs",e.ui.tabs,{options:{fx:null},_getFx:function(){var t,n,r=this.options.fx;if(r){if(e.isArray(r)){t=r[0];n=r[1]}else{t=n=r}}return r?{show:n,hide:t}:null},_toggle:function(e,t){function o(){n.running=false;n._trigger("activate",e,t)}function u(){t.newTab.closest("li").addClass("ui-tabs-active ui-state-active");if(r.length&&s.show){r.animate(s.show,s.show.duration,function(){o()})}else{r.show();o()}}var n=this,r=t.newPanel,i=t.oldPanel,s=this._getFx();if(!s){return this._super(e,t)}n.running=true;if(i.length&&s.hide){i.animate(s.hide,s.hide.duration,function(){t.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active");u()})}else{t.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active");i.hide();u()}}})}})(jQuery);(function(e){function n(t,n){var r=(t.attr("aria-describedby")||"").split(/\s+/);r.push(n);t.data("ui-tooltip-id",n).attr("aria-describedby",e.trim(r.join(" ")))}function r(t){var n=t.data("ui-tooltip-id"),r=(t.attr("aria-describedby")||"").split(/\s+/),i=e.inArray(n,r);if(i!==-1){r.splice(i,1)}t.removeData("ui-tooltip-id");r=e.trim(r.join(" "));if(r){t.attr("aria-describedby",r)}else{t.removeAttr("aria-describedby")}}var t=0;e.widget("ui.tooltip",{version:"1.9.0",options:{content:function(){return e(this).attr("title")},hide:true,items:"[title]",position:{my:"left+15 center",at:"right center",collision:"flipfit flipfit"},show:true,tooltipClass:null,track:false,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"});this.tooltips={}},_setOption:function(t,n){var r=this;if(t==="disabled"){this[n?"_disable":"_enable"]();this.options[t]=n;return}this._super(t,n);if(t==="content"){e.each(this.tooltips,function(e,t){r._updateContent(t)})}},_disable:function(){var t=this;e.each(this.tooltips,function(n,r){var i=e.Event("blur");i.target=i.currentTarget=r[0];t.close(i,true)});this.element.find(this.options.items).andSelf().each(function(){var t=e(this);if(t.is("[title]")){t.data("ui-tooltip-title",t.attr("title")).attr("title","")}})},_enable:function(){this.element.find(this.options.items).andSelf().each(function(){var t=e(this);if(t.data("ui-tooltip-title")){t.attr("title",t.data("ui-tooltip-title"))}})},open:function(t){var n=e(t?t.target:this.element).closest(this.options.items);if(!n.length){return}if(this.options.track&&n.data("ui-tooltip-id")){this._find(n).position(e.extend({of:n},this.options.position));this._off(this.document,"mousemove");return}if(n.attr("title")){n.data("ui-tooltip-title",n.attr("title"))}n.data("tooltip-open",true);this._updateContent(n,t)},_updateContent:function(e,t){var n,r=this.options.content,i=this;if(typeof r==="string"){return this._open(t,e,r)}n=r.call(e[0],function(n){if(!e.data("tooltip-open")){return}i._delay(function(){this._open(t,e,n)})});if(n){this._open(t,e,n)}},_open:function(t,r,i){function u(e){o.of=e;s.position(o)}var s,o;if(!i){return}s=this._find(r);if(s.length){s.find(".ui-tooltip-content").html(i);return}if(r.is("[title]")){if(t&&t.type==="mouseover"){r.attr("title","")}else{r.removeAttr("title")}}s=this._tooltip(r);n(r,s.attr("id"));s.find(".ui-tooltip-content").html(i);if(this.options.track&&t&&/^mouse/.test(t.originalEvent.type)){o=e.extend({},this.options.position);this._on(this.document,{mousemove:u});u(t)}else{s.position(e.extend({of:r},this.options.position))}s.hide();this._show(s,this.options.show);this._trigger("open",t,{tooltip:s});this._on(r,{mouseleave:"close",focusout:"close",keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var n=e.Event(t);n.currentTarget=r[0];this.close(n,true)}}})},close:function(t,n){var i=this,s=e(t?t.currentTarget:this.element),o=this._find(s);if(this.closing){return}if(!n&&t&&t.type!=="focusout"&&this.document[0].activeElement===s[0]){return}if(s.data("ui-tooltip-title")){s.attr("title",s.data("ui-tooltip-title"))}r(s);o.stop(true);this._hide(o,this.options.hide,function(){e(this).remove();delete i.tooltips[this.id]});s.removeData("tooltip-open");this._off(s,"mouseleave focusout keyup");this._off(this.document,"mousemove");this.closing=true;this._trigger("close",t,{tooltip:o});this.closing=false},_tooltip:function(n){var r="ui-tooltip-"+t++,i=e("<div>").attr({id:r,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));e("<div>").addClass("ui-tooltip-content").appendTo(i);i.appendTo(this.document[0].body);if(e.fn.bgiframe){i.bgiframe()}this.tooltips[r]=n;return i},_find:function(t){var n=t.data("ui-tooltip-id");return n?e("#"+n):e()},_destroy:function(){var t=this;e.each(this.tooltips,function(n,r){var i=e.Event("blur");i.target=i.currentTarget=r[0];t.close(i,true);e("#"+n).remove();if(r.data("ui-tooltip-title")){r.attr("title",r.data("ui-tooltip-title"));r.removeData("ui-tooltip-title")}})}})})(jQuery);jQuery.effects||function(e,t){var n=e.uiBackCompat!==false,r="ui-effects-";e.effects={effect:{}};(function(t,n){function p(e,t,n){var r=a[t.type]||{};if(e==null){return n||!t.def?null:t.def}e=r.floor?~~e:parseFloat(e);if(isNaN(e)){return t.def}if(r.mod){return(e+r.mod)%r.mod}return 0>e?0:r.max<e?r.max:e}function d(e){var n=o(),r=n._rgba=[];e=e.toLowerCase();h(s,function(t,i){var s,o=i.re.exec(e),a=o&&i.parse(o),f=i.space||"rgba";if(a){s=n[f](a);n[u[f].cache]=s[u[f].cache];r=n._rgba=s._rgba;return false}});if(r.length){if(r.join()==="0,0,0,0"){t.extend(r,c.transparent)}return n}return c[e]}function v(e,t,n){n=(n+1)%1;if(n*6<1){return e+(t-e)*n*6}if(n*2<1){return t}if(n*3<2){return e+(t-e)*(2/3-n)*6}return e}var r="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor".split(" "),i=/^([\-+])=\s*(\d+\.?\d*)/,s=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1]*2.55,e[2]*2.55,e[3]*2.55,e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],o=t.Color=function(e,n,r,i){return new t.Color.fn.parse(e,n,r,i)},u={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},a={"byte":{floor:true,max:255},percent:{max:1},degrees:{mod:360,floor:true}},f=o.support={},l=t("<p>")[0],c,h=t.each;l.style.cssText="background-color:rgba(1,1,1,.5)";f.rgba=l.style.backgroundColor.indexOf("rgba")>-1;h(u,function(e,t){t.cache="_"+e;t.props.alpha={idx:3,type:"percent",def:1}});o.fn=t.extend(o.prototype,{parse:function(r,i,s,a){if(r===n){this._rgba=[null,null,null,null];return this}if(r.jquery||r.nodeType){r=t(r).css(i);i=n}var f=this,l=t.type(r),v=this._rgba=[],m;if(i!==n){r=[r,i,s,a];l="array"}if(l==="string"){return this.parse(d(r)||c._default)}if(l==="array"){h(u.rgba.props,function(e,t){v[t.idx]=p(r[t.idx],t)});return this}if(l==="object"){if(r instanceof o){h(u,function(e,t){if(r[t.cache]){f[t.cache]=r[t.cache].slice()}})}else{h(u,function(t,n){var i=n.cache;h(n.props,function(e,t){if(!f[i]&&n.to){if(e==="alpha"||r[e]==null){return}f[i]=n.to(f._rgba)}f[i][t.idx]=p(r[e],t,true)});if(f[i]&&e.inArray(null,f[i].slice(0,3))<0){f[i][3]=1;if(n.from){f._rgba=n.from(f[i])}}})}return this}},is:function(e){var t=o(e),n=true,r=this;h(u,function(e,i){var s,o=t[i.cache];if(o){s=r[i.cache]||i.to&&i.to(r._rgba)||[];h(i.props,function(e,t){if(o[t.idx]!=null){n=o[t.idx]===s[t.idx];return n}})}return n});return n},_space:function(){var e=[],t=this;h(u,function(n,r){if(t[r.cache]){e.push(n)}});return e.pop()},transition:function(e,t){var n=o(e),r=n._space(),i=u[r],s=this.alpha()===0?o("transparent"):this,f=s[i.cache]||i.to(s._rgba),l=f.slice();n=n[i.cache];h(i.props,function(e,r){var i=r.idx,s=f[i],o=n[i],u=a[r.type]||{};if(o===null){return}if(s===null){l[i]=o}else{if(u.mod){if(o-s>u.mod/2){s+=u.mod}else if(s-o>u.mod/2){s-=u.mod}}l[i]=p((o-s)*t+s,r)}});return this[r](l)},blend:function(e){if(this._rgba[3]===1){return this}var n=this._rgba.slice(),r=n.pop(),i=o(e)._rgba;return o(t.map(n,function(e,t){return(1-r)*i[t]+r*e}))},toRgbaString:function(){var e="rgba(",n=t.map(this._rgba,function(e,t){return e==null?t>2?1:0:e});if(n[3]===1){n.pop();e="rgb("}return e+n.join()+")"},toHslaString:function(){var e="hsla(",n=t.map(this.hsla(),function(e,t){if(e==null){e=t>2?1:0}if(t&&t<3){e=Math.round(e*100)+"%"}return e});if(n[3]===1){n.pop();e="hsl("}return e+n.join()+")"},toHexString:function(e){var n=this._rgba.slice(),r=n.pop();if(e){n.push(~~(r*255))}return"#"+t.map(n,function(e,t){e=(e||0).toString(16);return e.length===1?"0"+e:e}).join("")},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString()}});o.fn.parse.prototype=o.fn;u.hsla.to=function(e){if(e[0]==null||e[1]==null||e[2]==null){return[null,null,null,e[3]]}var t=e[0]/255,n=e[1]/255,r=e[2]/255,i=e[3],s=Math.max(t,n,r),o=Math.min(t,n,r),u=s-o,a=s+o,f=a*.5,l,c;if(o===s){l=0}else if(t===s){l=60*(n-r)/u+360}else if(n===s){l=60*(r-t)/u+120}else{l=60*(t-n)/u+240}if(f===0||f===1){c=f}else if(f<=.5){c=u/a}else{c=u/(2-a)}return[Math.round(l)%360,c,f,i==null?1:i]};u.hsla.from=function(e){if(e[0]==null||e[1]==null||e[2]==null){return[null,null,null,e[3]]}var t=e[0]/360,n=e[1],r=e[2],i=e[3],s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s,u,a,f;return[Math.round(v(o,s,t+1/3)*255),Math.round(v(o,s,t)*255),Math.round(v(o,s,t-1/3)*255),i]};h(u,function(e,r){var s=r.props,u=r.cache,a=r.to,f=r.from;o.fn[e]=function(e){if(a&&!this[u]){this[u]=a(this._rgba)}if(e===n){return this[u].slice()}var r,i=t.type(e),l=i==="array"||i==="object"?e:arguments,c=this[u].slice();h(s,function(e,t){var n=l[i==="object"?e:t.idx];if(n==null){n=c[t.idx]}c[t.idx]=p(n,t)});if(f){r=o(f(c));r[u]=c;return r}else{return o(c)}};h(s,function(n,r){if(o.fn[n]){return}o.fn[n]=function(s){var o=t.type(s),u=n==="alpha"?this._hsla?"hsla":"rgba":e,a=this[u](),f=a[r.idx],l;if(o==="undefined"){return f}if(o==="function"){s=s.call(this,f);o=t.type(s)}if(s==null&&r.empty){return this}if(o==="string"){l=i.exec(s);if(l){s=f+parseFloat(l[2])*(l[1]==="+"?1:-1)}}a[r.idx]=s;return this[u](a)}})});h(r,function(e,n){t.cssHooks[n]={set:function(e,r){var i,s,u="";if(t.type(r)!=="string"||(i=d(r))){r=o(i||r);if(!f.rgba&&r._rgba[3]!==1){s=n==="backgroundColor"?e.parentNode:e;while((u===""||u==="transparent")&&s&&s.style){try{u=t.css(s,"backgroundColor");s=s.parentNode}catch(a){}}r=r.blend(u&&u!=="transparent"?u:"_default")}r=r.toRgbaString()}try{e.style[n]=r}catch(r){}}};t.fx.step[n]=function(e){if(!e.colorInit){e.start=o(e.elem,n);e.end=o(e.end);e.colorInit=true}t.cssHooks[n].set(e.elem,e.start.transition(e.end,e.pos))}});t.cssHooks.borderColor={expand:function(e){var t={};h(["Top","Right","Bottom","Left"],function(n,r){t["border"+r+"Color"]=e});return t}};c=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}})(jQuery);(function(){function i(){var t=this.ownerDocument.defaultView?this.ownerDocument.defaultView.getComputedStyle(this,null):this.currentStyle,n={},r,i,s;if(t&&t.length&&t[0]&&t[t[0]]){s=t.length;while(s--){r=t[s];if(typeof t[r]==="string"){n[e.camelCase(r)]=t[r]}}}else{for(r in t){if(typeof t[r]==="string"){n[r]=t[r]}}}return n}function s(t,n){var i={},s,o;for(s in n){o=n[s];if(t[s]!==o){if(!r[s]){if(e.fx.step[s]||!isNaN(parseFloat(o))){i[s]=o}}}}return i}var n=["add","remove","toggle"],r={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,n){e.fx.step[n]=function(e){if(e.end!=="none"&&!e.setAttr||e.pos===1&&!e.setAttr){jQuery.style(e.elem,n,e.end);e.setAttr=true}}});e.effects.animateClass=function(t,r,o,u){var a=e.speed(r,o,u);return this.queue(function(){var r=e(this),o=r.attr("class")||"",u,f=a.children?r.find("*").andSelf():r;f=f.map(function(){var t=e(this);return{el:t,start:i.call(this)}});u=function(){e.each(n,function(e,n){if(t[n]){r[n+"Class"](t[n])}})};u();f=f.map(function(){this.end=i.call(this.el[0]);this.diff=s(this.start,this.end);return this});r.attr("class",o);f=f.map(function(){var t=this,n=e.Deferred(),r=jQuery.extend({},a,{queue:false,complete:function(){n.resolve(t)}});this.el.animate(this.diff,r);return n.promise()});e.when.apply(e,f.get()).done(function(){u();e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})});a.complete.call(r[0])})})};e.fn.extend({_addClass:e.fn.addClass,addClass:function(t,n,r,i){return n?e.effects.animateClass.call(this,{add:t},n,r,i):this._addClass(t)},_removeClass:e.fn.removeClass,removeClass:function(t,n,r,i){return n?e.effects.animateClass.call(this,{remove:t},n,r,i):this._removeClass(t)},_toggleClass:e.fn.toggleClass,toggleClass:function(n,r,i,s,o){if(typeof r==="boolean"||r===t){if(!i){return this._toggleClass(n,r)}else{return e.effects.animateClass.call(this,r?{add:n}:{remove:n},i,s,o)}}else{return e.effects.animateClass.call(this,{toggle:n},r,i,s)}},switchClass:function(t,n,r,i,s){return e.effects.animateClass.call(this,{add:n,remove:t},r,i,s)}})})();(function(){function i(n,r,i,s){if(e.isPlainObject(n)){r=n;n=n.effect}n={effect:n};if(r===t){r={}}if(e.isFunction(r)){s=r;i=null;r={}}if(typeof r==="number"||e.fx.speeds[r]){s=i;i=r;r={}}if(e.isFunction(i)){s=i;i=null}if(r){e.extend(n,r)}i=i||r.duration;n.duration=e.fx.off?0:typeof i==="number"?i:i in e.fx.speeds?e.fx.speeds[i]:e.fx.speeds._default;n.complete=s||r.complete;return n}function s(t){if(!t||typeof t==="number"||e.fx.speeds[t]){return true}if(typeof t==="string"&&!e.effects.effect[t]){if(n&&e.effects[t]){return false}return true}return false}e.extend(e.effects,{version:"1.9.0",save:function(e,t){for(var n=0;n<t.length;n++){if(t[n]!==null){e.data(r+t[n],e[0].style[t[n]])}}},restore:function(e,n){var i,s;for(s=0;s<n.length;s++){if(n[s]!==null){i=e.data(r+n[s]);if(i===t){i=""}e.css(n[s],i)}}},setMode:function(e,t){if(t==="toggle"){t=e.is(":hidden")?"show":"hide"}return t},getBaseline:function(e,t){var n,r;switch(e[0]){case"top":n=0;break;case"middle":n=.5;break;case"bottom":n=1;break;default:n=e[0]/t.height}switch(e[1]){case"left":r=0;break;case"center":r=.5;break;case"right":r=1;break;default:r=e[1]/t.width}return{x:r,y:n}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper")){return t.parent()}var n={width:t.outerWidth(true),height:t.outerHeight(true),"float":t.css("float")},r=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),i={width:t.width(),height:t.height()},s=document.activeElement;try{s.id}catch(o){s=document.body}t.wrap(r);if(t[0]===s||e.contains(t[0],s)){e(s).focus()}r=t.parent();if(t.css("position")==="static"){r.css({position:"relative"});t.css({position:"relative"})}else{e.extend(n,{position:t.css("position"),zIndex:t.css("z-index")});e.each(["top","left","bottom","right"],function(e,r){n[r]=t.css(r);if(isNaN(parseInt(n[r],10))){n[r]="auto"}});t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})}t.css(i);return r.css(n).show()},removeWrapper:function(t){var n=document.activeElement;if(t.parent().is(".ui-effects-wrapper")){t.parent().replaceWith(t);if(t[0]===n||e.contains(t[0],n)){e(n).focus()}}return t},setTransition:function(t,n,r,i){i=i||{};e.each(n,function(e,n){var s=t.cssUnit(n);if(s[0]>0){i[n]=s[0]*r+s[1]}});return i}});e.fn.extend({effect:function(t,r,s,o){function h(t){function s(){if(e.isFunction(r)){r.call(n[0])}if(e.isFunction(t)){t()}}var n=e(this),r=u.complete,i=u.mode;if(n.is(":hidden")?i==="hide":i==="show"){s()}else{l.call(n[0],u,s)}}var u=i.apply(this,arguments),a=u.mode,f=u.queue,l=e.effects.effect[u.effect],c=!l&&n&&e.effects[u.effect];if(e.fx.off||!(l||c)){if(a){return this[a](u.duration,u.complete)}else{return this.each(function(){if(u.complete){u.complete.call(this)}})}}if(l){return f===false?this.each(h):this.queue(f||"fx",h)}else{return c.call(this,{options:u,duration:u.duration,callback:u.complete,mode:u.mode})}},_show:e.fn.show,show:function(e){if(s(e)){return this._show.apply(this,arguments)}else{var t=i.apply(this,arguments);t.mode="show";return this.effect.call(this,t)}},_hide:e.fn.hide,hide:function(e){if(s(e)){return this._hide.apply(this,arguments)}else{var t=i.apply(this,arguments);t.mode="hide";return this.effect.call(this,t)}},__toggle:e.fn.toggle,toggle:function(t){if(s(t)||typeof t==="boolean"||e.isFunction(t)){return this.__toggle.apply(this,arguments)}else{var n=i.apply(this,arguments);n.mode="toggle";return this.effect.call(this,n)}},cssUnit:function(t){var n=this.css(t),r=[];e.each(["em","px","%","pt"],function(e,t){if(n.indexOf(t)>0){r=[parseFloat(n),t]}});return r}})})();(function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,n){t[n]=function(t){return Math.pow(t,e+2)}});e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return e===0||e===1?e:-Math.pow(2,8*(e-1))*Math.sin(((e-1)*80-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){var t,n=4;while(e<((t=Math.pow(2,--n))-1)/11){}return 1/Math.pow(4,3-n)-7.5625*Math.pow((t*3-2)/22-e,2)}});e.each(t,function(t,n){e.easing["easeIn"+t]=n;e.easing["easeOut"+t]=function(e){return 1-n(1-e)};e.easing["easeInOut"+t]=function(e){return e<.5?n(e*2)/2:1-n(e*-2+2)/2}})})()}(jQuery);(function(e,t){var n=/up|down|vertical/,r=/up|left|vertical|horizontal/;e.effects.effect.blind=function(t,i){var s=e(this),o=["position","top","bottom","left","right","height","width"],u=e.effects.setMode(s,t.mode||"hide"),a=t.direction||"up",f=n.test(a),l=f?"height":"width",c=f?"top":"left",h=r.test(a),p={},d=u==="show",v,m,g;if(s.parent().is(".ui-effects-wrapper")){e.effects.save(s.parent(),o)}else{e.effects.save(s,o)}s.show();v=e.effects.createWrapper(s).css({overflow:"hidden"});m=v[l]();g=parseFloat(v.css(c))||0;p[l]=d?m:0;if(!h){s.css(f?"bottom":"right",0).css(f?"top":"left","auto").css({position:"absolute"});p[c]=d?g:m+g}if(d){v.css(l,0);if(!h){v.css(c,g+m)}}v.animate(p,{duration:t.duration,easing:t.easing,queue:false,complete:function(){if(u==="hide"){s.hide()}e.effects.restore(s,o);e.effects.removeWrapper(s);i()}})}})(jQuery);(function(e,t){e.effects.effect.bounce=function(t,n){var r=e(this),i=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(r,t.mode||"effect"),o=s==="hide",u=s==="show",a=t.direction||"up",f=t.distance,l=t.times||5,c=l*2+(u||o?1:0),h=t.duration/c,p=t.easing,d=a==="up"||a==="down"?"top":"left",v=a==="up"||a==="left",m,g,y,b=r.queue(),w=b.length;if(u||o){i.push("opacity")}e.effects.save(r,i);r.show();e.effects.createWrapper(r);if(!f){f=r[d==="top"?"outerHeight":"outerWidth"]()/3}if(u){y={opacity:1};y[d]=0;r.css("opacity",0).css(d,v?-f*2:f*2).animate(y,h,p)}if(o){f=f/Math.pow(2,l-1)}y={};y[d]=0;for(m=0;m<l;m++){g={};g[d]=(v?"-=":"+=")+f;r.animate(g,h,p).animate(y,h,p);f=o?f*2:f/2}if(o){g={opacity:0};g[d]=(v?"-=":"+=")+f;r.animate(g,h,p)}r.queue(function(){if(o){r.hide()}e.effects.restore(r,i);e.effects.removeWrapper(r);n()});if(w>1){b.splice.apply(b,[1,0].concat(b.splice(w,c+1)))}r.dequeue()}})(jQuery);(function(e,t){e.effects.effect.clip=function(t,n){var r=e(this),i=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(r,t.mode||"hide"),o=s==="show",u=t.direction||"vertical",a=u==="vertical",f=a?"height":"width",l=a?"top":"left",c={},h,p,d;e.effects.save(r,i);r.show();h=e.effects.createWrapper(r).css({overflow:"hidden"});p=r[0].tagName==="IMG"?h:r;d=p[f]();if(o){p.css(f,0);p.css(l,d/2)}c[f]=o?d:0;c[l]=o?0:d/2;p.animate(c,{queue:false,duration:t.duration,easing:t.easing,complete:function(){if(!o){r.hide()}e.effects.restore(r,i);e.effects.removeWrapper(r);n()}})}})(jQuery);(function(e,t){e.effects.effect.drop=function(t,n){var r=e(this),i=["position","top","bottom","left","right","opacity","height","width"],s=e.effects.setMode(r,t.mode||"hide"),o=s==="show",u=t.direction||"left",a=u==="up"||u==="down"?"top":"left",f=u==="up"||u==="left"?"pos":"neg",l={opacity:o?1:0},c;e.effects.save(r,i);r.show();e.effects.createWrapper(r);c=t.distance||r[a==="top"?"outerHeight":"outerWidth"](true)/2;if(o){r.css("opacity",0).css(a,f==="pos"?-c:c)}l[a]=(o?f==="pos"?"+=":"-=":f==="pos"?"-=":"+=")+c;r.animate(l,{queue:false,duration:t.duration,easing:t.easing,complete:function(){if(s==="hide"){r.hide()}e.effects.restore(r,i);e.effects.removeWrapper(r);n()}})}})(jQuery);(function(e,t){e.effects.effect.explode=function(t,n){function y(){c.push(this);if(c.length===r*i){b()}}function b(){s.css({visibility:"visible"});e(c).remove();if(!u){s.hide()}n()}var r=t.pieces?Math.round(Math.sqrt(t.pieces)):3,i=r,s=e(this),o=e.effects.setMode(s,t.mode||"hide"),u=o==="show",a=s.show().css("visibility","hidden").offset(),f=Math.ceil(s.outerWidth()/i),l=Math.ceil(s.outerHeight()/r),c=[],h,p,d,v,m,g;for(h=0;h<r;h++){v=a.top+h*l;g=h-(r-1)/2;for(p=0;p<i;p++){d=a.left+p*f;m=p-(i-1)/2;s.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-p*f,top:-h*l}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:f,height:l,left:d+(u?m*f:0),top:v+(u?g*l:0),opacity:u?0:1}).animate({left:d+(u?0:m*f),top:v+(u?0:g*l),opacity:u?1:0},t.duration||500,t.easing,y)}}}})(jQuery);(function(e,t){e.effects.effect.fade=function(t,n){var r=e(this),i=e.effects.setMode(r,t.mode||"toggle");r.animate({opacity:i},{queue:false,duration:t.duration,easing:t.easing,complete:n})}})(jQuery);(function(e,t){e.effects.effect.fold=function(t,n){var r=e(this),i=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(r,t.mode||"hide"),o=s==="show",u=s==="hide",a=t.size||15,f=/([0-9]+)%/.exec(a),l=!!t.horizFirst,c=o!==l,h=c?["width","height"]:["height","width"],p=t.duration/2,d,v,m={},g={};e.effects.save(r,i);r.show();d=e.effects.createWrapper(r).css({overflow:"hidden"});v=c?[d.width(),d.height()]:[d.height(),d.width()];if(f){a=parseInt(f[1],10)/100*v[u?0:1]}if(o){d.css(l?{height:0,width:a}:{height:a,width:0})}m[h[0]]=o?v[0]:a;g[h[1]]=o?v[1]:0;d.animate(m,p,t.easing).animate(g,p,t.easing,function(){if(u){r.hide()}e.effects.restore(r,i);e.effects.removeWrapper(r);n()})}})(jQuery);(function(e,t){e.effects.effect.highlight=function(t,n){var r=e(this),i=["backgroundImage","backgroundColor","opacity"],s=e.effects.setMode(r,t.mode||"show"),o={backgroundColor:r.css("backgroundColor")};if(s==="hide"){o.opacity=0}e.effects.save(r,i);r.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(o,{queue:false,duration:t.duration,easing:t.easing,complete:function(){if(s==="hide"){r.hide()}e.effects.restore(r,i);n()}})}})(jQuery);(function(e,t){e.effects.effect.pulsate=function(t,n){var r=e(this),i=e.effects.setMode(r,t.mode||"show"),s=i==="show",o=i==="hide",u=s||i==="hide",a=(t.times||5)*2+(u?1:0),f=t.duration/a,l=0,c=r.queue(),h=c.length,p;if(s||!r.is(":visible")){r.css("opacity",0).show();l=1}for(p=1;p<a;p++){r.animate({opacity:l},f,t.easing);l=1-l}r.animate({opacity:l},f,t.easing);r.queue(function(){if(o){r.hide()}n()});if(h>1){c.splice.apply(c,[1,0].concat(c.splice(h,a+1)))}r.dequeue()}})(jQuery);(function(e,t){e.effects.effect.puff=function(t,n){var r=e(this),i=e.effects.setMode(r,t.mode||"hide"),s=i==="hide",o=parseInt(t.percent,10)||150,u=o/100,a={height:r.height(),width:r.width()};e.extend(t,{effect:"scale",queue:false,fade:true,mode:i,complete:n,percent:s?o:100,from:s?a:{height:a.height*u,width:a.width*u}});r.effect(t)};e.effects.effect.scale=function(t,n){var r=e(this),i=e.extend(true,{},t),s=e.effects.setMode(r,t.mode||"effect"),o=parseInt(t.percent,10)||(parseInt(t.percent,10)===0?0:s==="hide"?0:100),u=t.direction||"both",a=t.origin,f={height:r.height(),width:r.width(),outerHeight:r.outerHeight(),outerWidth:r.outerWidth()},l={y:u!=="horizontal"?o/100:1,x:u!=="vertical"?o/100:1};i.effect="size";i.queue=false;i.complete=n;if(s!=="effect"){i.origin=a||["middle","center"];i.restore=true}i.from=t.from||(s==="show"?{height:0,width:0}:f);i.to={height:f.height*l.y,width:f.width*l.x,outerHeight:f.outerHeight*l.y,outerWidth:f.outerWidth*l.x};if(i.fade){if(s==="show"){i.from.opacity=0;i.to.opacity=1}if(s==="hide"){i.from.opacity=1;i.to.opacity=0}}r.effect(i)};e.effects.effect.size=function(t,n){var r=e(this),i=["position","top","bottom","left","right","width","height","overflow","opacity"],s=["position","top","bottom","left","right","overflow","opacity"],o=["width","height","overflow"],u=["fontSize"],a=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],f=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],l=e.effects.setMode(r,t.mode||"effect"),c=t.restore||l!=="effect",h=t.scale||"both",p=t.origin||["middle","center"],d,v,m,g=r.css("position");if(l==="show"){r.show()}d={height:r.height(),width:r.width(),outerHeight:r.outerHeight(),outerWidth:r.outerWidth()};r.from=t.from||d;r.to=t.to||d;m={from:{y:r.from.height/d.height,x:r.from.width/d.width},to:{y:r.to.height/d.height,x:r.to.width/d.width}};if(h==="box"||h==="both"){if(m.from.y!==m.to.y){i=i.concat(a);r.from=e.effects.setTransition(r,a,m.from.y,r.from);r.to=e.effects.setTransition(r,a,m.to.y,r.to)}if(m.from.x!==m.to.x){i=i.concat(f);r.from=e.effects.setTransition(r,f,m.from.x,r.from);r.to=e.effects.setTransition(r,f,m.to.x,r.to)}}if(h==="content"||h==="both"){if(m.from.y!==m.to.y){i=i.concat(u);r.from=e.effects.setTransition(r,u,m.from.y,r.from);r.to=e.effects.setTransition(r,u,m.to.y,r.to)}}e.effects.save(r,c?i:s);r.show();e.effects.createWrapper(r);r.css("overflow","hidden").css(r.from);if(p){v=e.effects.getBaseline(p,d);r.from.top=(d.outerHeight-r.outerHeight())*v.y;r.from.left=(d.outerWidth-r.outerWidth())*v.x;r.to.top=(d.outerHeight-r.to.outerHeight)*v.y;r.to.left=(d.outerWidth-r.to.outerWidth)*v.x}r.css(r.from);if(h==="content"||h==="both"){a=a.concat(["marginTop","marginBottom"]).concat(u);f=f.concat(["marginLeft","marginRight"]);o=i.concat(a).concat(f);r.find("*[width]").each(function(){var n=e(this),r={height:n.height(),width:n.width()};if(c){e.effects.save(n,o)}n.from={height:r.height*m.from.y,width:r.width*m.from.x};n.to={height:r.height*m.to.y,width:r.width*m.to.x};if(m.from.y!==m.to.y){n.from=e.effects.setTransition(n,a,m.from.y,n.from);n.to=e.effects.setTransition(n,a,m.to.y,n.to)}if(m.from.x!==m.to.x){n.from=e.effects.setTransition(n,f,m.from.x,n.from);n.to=e.effects.setTransition(n,f,m.to.x,n.to)}n.css(n.from);n.animate(n.to,t.duration,t.easing,function(){if(c){e.effects.restore(n,o)}})})}r.animate(r.to,{queue:false,duration:t.duration,easing:t.easing,complete:function(){if(r.to.opacity===0){r.css("opacity",r.from.opacity)}if(l==="hide"){r.hide()}e.effects.restore(r,c?i:s);if(!c){if(g==="static"){r.css({position:"relative",top:r.to.top,left:r.to.left})}else{e.each(["top","left"],function(e,t){r.css(t,function(t,n){var i=parseInt(n,10),s=e?r.to.left:r.to.top;if(n==="auto"){return s+"px"}return i+s+"px"})})}}e.effects.removeWrapper(r);n()}})}})(jQuery);(function(e,t){e.effects.effect.shake=function(t,n){var r=e(this),i=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(r,t.mode||"effect"),o=t.direction||"left",u=t.distance||20,a=t.times||3,f=a*2+1,l=Math.round(t.duration/f),c=o==="up"||o==="down"?"top":"left",h=o==="up"||o==="left",p={},d={},v={},m,g=r.queue(),y=g.length;e.effects.save(r,i);r.show();e.effects.createWrapper(r);p[c]=(h?"-=":"+=")+u;d[c]=(h?"+=":"-=")+u*2;v[c]=(h?"-=":"+=")+u*2;r.animate(p,l,t.easing);for(m=1;m<a;m++){r.animate(d,l,t.easing).animate(v,l,t.easing)}r.animate(d,l,t.easing).animate(p,l/2,t.easing).queue(function(){if(s==="hide"){r.hide()}e.effects.restore(r,i);e.effects.removeWrapper(r);n()});if(y>1){g.splice.apply(g,[1,0].concat(g.splice(y,f+1)))}r.dequeue()}})(jQuery);(function(e,t){e.effects.effect.slide=function(t,n){var r=e(this),i=["position","top","bottom","left","right","width","height"],s=e.effects.setMode(r,t.mode||"show"),o=s==="show",u=t.direction||"left",a=u==="up"||u==="down"?"top":"left",f=u==="up"||u==="left",l,c={};e.effects.save(r,i);r.show();l=t.distance||r[a==="top"?"outerHeight":"outerWidth"](true);e.effects.createWrapper(r).css({overflow:"hidden"});if(o){r.css(a,f?isNaN(l)?"-"+l:-l:l)}c[a]=(o?f?"+=":"-=":f?"-=":"+=")+l;r.animate(c,{queue:false,duration:t.duration,easing:t.easing,complete:function(){if(s==="hide"){r.hide()}e.effects.restore(r,i);e.effects.removeWrapper(r);n()}})}})(jQuery);(function(e,t){e.effects.effect.transfer=function(t,n){var r=e(this),i=e(t.to),s=i.css("position")==="fixed",o=e("body"),u=s?o.scrollTop():0,a=s?o.scrollLeft():0,f=i.offset(),l={top:f.top-u,left:f.left-a,height:i.innerHeight(),width:i.innerWidth()},c=r.offset(),h=e('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(t.className).css({top:c.top-u,left:c.left-a,height:r.innerHeight(),width:r.innerWidth(),position:s?"fixed":"absolute"}).animate(l,t.duration,t.easing,function(){h.remove();n()})}})(jQuery)});define("ui/tab",["aloha/core","jquery","ui/container","ui/component","PubSub","jqueryui"],function(e,t,n,r,i){function u(e){var n,r,i,s=false;if(t("button:not(.aloha-multisplit-toggle)",e.panel).length!==0){s=true}return s}var s=0;var o={};var a=n.extend({_elemBySlot:null,_groupBySlot:null,_groupByComponent:null,_constructor:function(e,n,r){var i=this,o,u,a,f,l,c,h;this._elemBySlot={};this._groupBySlot={};this._groupByComponent={};this._slotsList=[];this._super(e,n);this.container=n.container;this.list=this.container.data("list");this.panels=this.container.data("panels");this.id="tab-ui-container-"+ ++s;this.panel=t("<div>",{id:this.id,unselectable:"on"});this.handle=t('<li><a href="'+location.href.replace(/#.*$/,"")+"#"+this.id+'">'+n.label+"</a></li>");for(o=0;o<r.length;o++){if(typeof r[o]==="string"){if(1===r[o].length&&r[o].charCodeAt(0)===10){this.panel.append("<div>",{unselectable:"on"})}else{a=t("<span>",{unselectable:"on"});this._elemBySlot[r[o]]=a;this.panel.append(a)}}else{l=t("<div>",{"class":"aloha-ui-component-group aloha-ui-hidden",unselectable:"on"}).appendTo(this.panel);c={element:l,visibleCounter:0};f=r[o];for(u=0;u<f.length;u++){this._groupBySlot[f[u]]=c;if(f[u]&&1===f[u].length&&f[u].charCodeAt(0)===10){l.append(t("<div>",{unselectable:"on"}))}else{h=f[u];a=t("<span>",{unselectable:"on"});this._elemBySlot[f[u]]=a;l.append(a)}}}}this.panel.append(t("<div>",{"class":"aloha-ui-clear",unselectable:"on"}));this.handle.appendTo(this.list);this.panel.appendTo(this.panels);this.container.tabs("refresh");var p=n.container.data("aloha-tabs");this.index=p.length;p.push(this)},adoptInto:function(e,t){var n=this._elemBySlot[e],r;if(!n){return false}o[e]=t;t.adoptParent(this);n.append(t.element);r=this._groupBySlot[e];this._slotsList.push(e);if(r){this._groupByComponent[t.id]=r;if(t.isVisible()){if(!r.visibleCounter){r.element.removeClass("aloha-ui-hidden")}r.visibleCounter+=1}}return true},foreground:function(){this.container.tabs("select",this.index)},childForeground:function(e){this.foreground()},hasVisibleComponents:function(){var e=this._elemBySlot;var t;for(t in e){if(e.hasOwnProperty(t)&&o[t]){if(o[t].visible){return true}}}return false},childVisible:function(e,t){if(t){e.container.show()}else if(!e.container.hasVisibleComponents()){e.container.hide()}var n=this._groupByComponent[e.id];if(!n){return}if(t){if(0===n.visibleCounter){n.element.removeClass("aloha-ui-hidden")}n.visibleCounter+=1}else{n.visibleCounter-=1;if(0===n.visibleCounter){n.element.addClass("aloha-ui-hidden")}}},show:function(){if(!this.list.children().length||!u(this)){return}this.handle.show();this.visible=true;this.container.show();if(!this.container.find(".ui-tabs-active").length||this.container.tabs("option","selected")===this.index){this.foreground()}},hide:function(){var e=this.list.children();if(0===e.length){return}this.handle.hide();this.visible=false;if(this.index===this.container.tabs("option","selected")){e=this.container.data("aloha-tabs");var t;for(t=0;t<e.length;++t){if(e[t].visible){this.container.tabs("select",t);return}}this.handle.removeClass("ui-tabs-active");this.container.hide()}}});t.extend(a,{createContainer:function(){var e=t("<div>",{unselectable:"on"});var n=t("<ul>",{unselectable:"on"}).appendTo(e);var r=t("<div>",{unselectable:"on"}).appendTo(e);e.data("list",n).data("panels",r).data("aloha-tabs",[]).tabs({select:function(t,n){var r=e.data("aloha-tabs");e.data("aloha-active-container",r[n.index]);i.pub("aloha.ui.container.selected",{data:r[n.index]})}});return e}});return a});define("ui/subguarded",["aloha/core","jquery","PubSub"],function(e,t,n){function o(e){if(!e.alohaUid){e.alohaUid=++r}return e.alohaUid}function u(e){return s[e]||[]}function a(e){return i[e.alohaUid]||[]}function f(e,t){if(!i[e.alohaUid]){i[e.alohaUid]=[]}i[e.alohaUid].push(t);return i[e.alohaUid]}function l(e,t){if(!s[e]){s[e]=[]}s[e].push(t);return s[e]}function c(e){var t=u(e);var n;for(n=0;n<t.length;n++){t[n].apply(null,[a(t[n])].concat(arguments))}}function h(){var t=Array.prototype.slice.call(arguments);var r=t.shift();if(typeof r==="string"){r=[r]}var i=t.shift();o(i);f(i,t);var s;var u;var a=function(e,t,n){c(u,e,t,n)};var h=function(){c(u)};for(s=0;s<r.length;s++){u=r[s];l(u,i);e.bind(u,a);n.sub(u,h)}}var r=0;var i={};var s={};return h});define("vendor/amplify.store",["util/json2"],function(){var e={};(function(e,t){function i(e,i){n.addType(e,function(s,o,u){var a,f,l,c,h=o,p=(new Date).getTime();if(!s){h={};c=[];l=0;try{s=i.length;while(s=i.key(l++)){if(r.test(s)){f=JSON.parse(i.getItem(s));if(f.expires&&f.expires<=p){c.push(s)}else{h[s.replace(r,"")]=f.data}}}while(s=c.pop()){i.removeItem(s)}}catch(d){}return h}s="__amplify__"+s;if(o===t){a=i.getItem(s);f=a?JSON.parse(a):{expires:-1};if(f.expires&&f.expires<=p){i.removeItem(s)}else{return f.data}}else{if(o===null){i.removeItem(s)}else{f=JSON.stringify({data:o,expires:u.expires?p+u.expires:null});try{i.setItem(s,f)}catch(d){n[e]();try{i.setItem(s,f)}catch(d){throw n.error()}}}}return h})}var n=e.store=function(e,t,r,i){var i=n.type;if(r&&r.type&&r.type in n.types){i=r.type}return n.types[i](e,t,r||{})};n.types={};n.type=null;n.addType=function(e,t){if(!n.type){n.type=e}n.types[e]=t;n[e]=function(t,r,i){i=i||{};i.type=e;return n(t,r,i)}};n.error=function(){return"amplify.store quota exceeded"};var r=/^__amplify__/;for(var s in{localStorage:1,sessionStorage:1}){try{if(window[s].getItem){i(s,window[s])}}catch(o){}}if(window.globalStorage){try{i("globalStorage",window.globalStorage[window.location.hostname]);if(n.type==="sessionStorage"){n.type="globalStorage"}}catch(o){}}(function(){if(n.types.localStorage){return}var e=document.createElement("div"),r="amplify";e.style.display="none";document.getElementsByTagName("head")[0].appendChild(e);try{e.addBehavior("#default#userdata");e.load(r)}catch(i){e.parentNode.removeChild(e);return}n.addType("userData",function(i,s,o){e.load(r);var u,a,f,l,c,h=s,p=(new Date).getTime();if(!i){h={};c=[];l=0;while(u=e.XMLDocument.documentElement.attributes[l++]){a=JSON.parse(u.value);if(a.expires&&a.expires<=p){c.push(u.name)}else{h[u.name]=a.data}}while(i=c.pop()){e.removeAttribute(i)}e.save(r);return h}i=i.replace(/[^-._0-9A-Za-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u37f-\u1fff\u200c-\u200d\u203f\u2040\u2070-\u218f]/g,"-");if(s===t){u=e.getAttribute(i);a=u?JSON.parse(u):{expires:-1};if(a.expires&&a.expires<=p){e.removeAttribute(i)}else{return a.data}}else{if(s===null){e.removeAttribute(i)}else{f=e.getAttribute(i);a=JSON.stringify({data:s,expires:o.expires?p+o.expires:null});e.setAttribute(i,a)}}try{e.save(r)}catch(d){if(f===null){e.removeAttribute(i)}else{e.setAttribute(i,f)}n.userData();try{e.setAttribute(i,a);e.save(r)}catch(d){if(f===null){e.removeAttribute(i)}else{e.setAttribute(i,f)}throw n.error()}}return h})})();(function(){function i(e){return e===t?t:JSON.parse(JSON.stringify(e))}var e={},r={};n.addType("memory",function(n,s,o){if(!n){return i(e)}if(s===t){return i(e[n])}if(r[n]){clearTimeout(r[n]);delete r[n]}if(s===null){delete e[n];return null}e[n]=s;if(o.expires){r[n]=setTimeout(function(){delete e[n];delete r[n]},o.expires)}return s})})()})(e);return e});define("ui/floating",["jquery","aloha/core","ui/surface","ui/subguarded","PubSub","vendor/amplify.store","util/browser"],function(e,t,n,r,i,s,o){function h(t,n,r,s){if("absolute"===l){n.top+=f.scrollTop();n.left+=f.scrollLeft()}c.offset=n;t.stop().animate(n,r,function(){s(n);i.pub("aloha.floating.changed",{position:e.extend({},c)})})}function p(e,t,n,r){t.top-=e.height()+u;h(e,t,n,r)}function d(e,t,n,r){t.top+=u;h(e,t,n,r)}function v(e){s.store("Aloha.FloatingMenu.pinned","true");s.store("Aloha.FloatingMenu.top",e.top);s.store("Aloha.FloatingMenu.left",e.left)}function m(){s.store("Aloha.FloatingMenu.pinned",null);s.store("Aloha.FloatingMenu.top",null);s.store("Aloha.FloatingMenu.left",null)}function g(){if(s.store("Aloha.FloatingMenu.pinned")==="true"){return{top:parseInt(s.store("Aloha.FloatingMenu.top"),10),left:parseInt(s.store("Aloha.FloatingMenu.left"),10),isPinned:true}}return{top:null,left:null,isPinned:false}}function y(e){var t=e.left;var n=e.top;if(n<0){n=0}else if(n>f.height()){n=f.height()/2}if(t<0){t=0}else if(t>f.width()){t=f.width()/2}return{top:n,left:t}}function b(t,n,r,i){if(typeof r!=="number"){r=a}var s=(parseInt(e("body").css("marginTop"),10)||0)+(parseInt(e("body").css("paddingTop"),10)||0);var o=t.$element;var u=n.obj.offset();var l=u.top;var c=u.left;var h=f.scrollTop();var v=l-h-s;var m=c+o.width()-f.width();if(m>0){c=Math.max(0,c-m)}if(v>=o.height()){p(o,{top:l-h,left:c},r,i)}else if(v+o.height()>v+n.obj.height()){d(o,{top:l+n.obj.height(),left:c},r,i)}else{d(o,{top:s,left:c},r,i)}}function w(e,t,n){var r=e.$element;if(n){m();r.find(".aloha-ui-pin").removeClass("aloha-ui-pin-down")}else{v(t);r.find(".aloha-ui-pin").addClass("aloha-ui-pin-down")}r.css({position:"fixed",top:t.top})}function E(e,t,n,r,i){var s;for(s=0;s<e.length;s++){if(e[s][0].isActive()){e[s][1](n,r,i)}}}function S(t){if(e.browser.msie){var n=t.$element.parent();t.$element.appendTo("body");t.$element.css("position",l);if(n.length){t.$element.appendTo(n)}else{t.$element.detach()}}else{t.$element.css("position",l)}}function x(e,t){r(["aloha-selection-changed","aloha.ui.container.selected"],E,e,function(){e._move()});var n=function(){var n=y({top:t.pinTop,left:t.pinLeft});t.setFloatingPosition(n);e.$element.css({top:n.top,left:n.left})};f.scroll(function(){e._move(0)});f.resize(function(){if(!t.isFloatingMode){n()}});e.addPin();S(e);if(!t.isFloatingMode){n()}e.$element.css("z-index",10100).draggable({distance:20,stop:function(e,n){t.setFloatingPosition(n.position);if(!t.isFloatingMode){v(n.position)}}})}var u=10;var a=500;var f=e(window);var l=o.ie7?"absolute":"fixed";var c={style:l,offset:{top:0,left:0}};return{getPinState:g,makeFloating:x,floatSurface:b,togglePinSurface:w,POSITION_STYLE:l}});(function(){function t(e,t,n,r,i,s){if(t[e]){n.push(e);if(t[e]===true||t[e]===1){r.push(i+e+"/"+s)}}}function n(e,t,n,r,i){var s=r+t+"/"+i;if(require._fileExists(e.toUrl(s))){n.push(s)}}function r(e,t,n){var i;for(i in t){if(t.hasOwnProperty(i)&&(!e.hasOwnProperty(i)||n)){e[i]=t[i]}else if(typeof t[i]==="object"){r(e[i],t[i],n)}}}var e=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(i){var s=i.config();return{version:"2.0.1",load:function(i,o,u,a){a=a||{};if(a.locale){s.locale=a.locale}var f,l=e.exec(i),c=l[1],h=l[4],p=l[5],d=h.split("-"),v=[],m={},g,y,b="";if(l[5]){c=l[1];f=c+p}else{f=i;p=l[4];h=s.locale;if(!h){h=s.locale=typeof navigator==="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()}d=h.split("-")}if(a.isBuild){v.push(f);n(o,"root",v,c,p);for(g=0;g<d.length;g++){y=d[g];b+=(b?"-":"")+y;n(o,b,v,c,p)}o(v,function(){u()})}else{o([f],function(e){var n=[],i;t("root",e,n,v,c,p);for(g=0;g<d.length;g++){i=d[g];b+=(b?"-":"")+i;t(b,e,n,v,c,p)}o(v,function(){var t,i,s;for(t=n.length-1;t>-1&&n[t];t--){s=n[t];i=e[s];if(i===true||i===1){i=o(c+s+"/"+p)}r(m,i)}m.t=function(e,t){if(this[e]){return this[e]}else if(t){return t}else{return e}};u(m)})})}}}})})();define("ui/nls/i18n",{root:{"button.dismiss.label":"Dismiss","button.bold.label":"Bold","button.italic.label":"Italic","button.strikethrough.label":"Strikethrough","button.subscript.label":"Subscript","button.superscript.label":"Superscript","button.underline.label":"Underline","button.yes.label":"Yes","button.no.label":"No","button.p.label":"Paragraph","button.h1.label":"Heading 1","button.h2.label":"Heading 2","button.h3.label":"Heading 3","button.h4.label":"Heading 4","button.h5.label":"Heading 5","button.h6.label":"Heading 6","button.pre.label":"Preformatted text","button.removeFormatting.label":"Remove formatting","button.ol.label":"Insert ordered list","button.ul.label":"Insert unordered list","button.indent.label":"Indent list","button.outdent.label":"Outdent list","button.createLink.label":"Insert link","button.removeLink.label":"Remove link","button.createAbbr.label":"Insert abbreviation","button.characterPicker.label":"Pick special characters","button.createLink.label":"Insert link","button.removeLink.label":"Remove link","button.createAbbr.label":"Insert abbreviation","button.characterPicker.label":"Pick special characters","button.justifyLeft.label":"Align to the left","button.justifyRight.label":"Align to the right","button.justifyCenter.label":"Center","button.justifyFull.label":"Justify","button.horizontalRule.label":"Insert horizontal rule","button.createLanguageAnnotation.label":"Insert language annotation","button.metaview.label":"Switch between meta and normal view","button.quote.label":"Format selection as quote","button.blockquote.label":"Format selection as blockquote","tab.format.label":"Format","tab.insert.label":"Insert","tab.abbr.label":"Abbreviation","tab.img.label":"Image","tab.link.label":"Link","tab.list.label":"List","tab.table.label":"Table","tab.col.label":"Table Column","tab.row.label":"Table Row","tab.cell.label":"Table Cell","tab.wai-lang.label":"Language annotation"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("ui/toolbar",["jquery","aloha/core","ui/surface","ui/tab","ui/floating","ui/context","i18n!ui/nls/i18n","jqueryui"],function(e,t,n,r,i,s,o){var u=n.extend({_moveTimeout:null,$_container:null,_tabBySlot:null,_tabs:[],_constructor:function(t,n){var s,a,f,l;this._super(t);this.$element=e("<div>",{"class":"aloha-ui aloha-ui-toolbar",unselectable:"on"});this.$_container=r.createContainer().appendTo(this.$element);this._tabBySlot={};for(f=0;f<n.length;f++){s=n[f];a=new r(t,{label:o.t(s.label,s.label),showOn:s.showOn,container:this.$_container},s.components);for(l in a._elemBySlot){if(a._elemBySlot.hasOwnProperty(l)){this._tabBySlot[l]=a}}this._tabs.push({tab:a,settings:s})}i.makeFloating(this,u)},adoptInto:function(e,t){var n=this._tabBySlot[e];return n&&n.adoptInto(e,t)},getActiveContainer:function(){return this.$_container.data("aloha-active-container")},getContainers:function(){return this.$_container.data("aloha-tabs")},_move:function(e){var n=this;if(n._moveTimeout){clearTimeout(n._moveTimeout)}n._moveTimeout=setTimeout(function(){n._moveTimeout=null;if(t.activeEditable&&u.isFloatingMode){i.floatSurface(n,t.activeEditable,e,u.setFloatingPosition)}},20)},addPin:function(){var t=e('<div class="aloha-ui-pin">');var n=this.$element;n.find(".ui-tabs").append(t);n.find(".ui-tabs").hover(function(){n.addClass("aloha-ui-hover")},function(){n.removeClass("aloha-ui-hover")});if(!u.isFloatingMode){t.addClass("aloha-ui-pin-down")}var r=this;t.click(function(){u.isFloatingMode=!u.isFloatingMode;var t;if(u.isFloatingMode){t={top:u.pinTop,left:u.pinLeft}}else{t=r.$element.offset();t.top-=e(window).scrollTop()}u.setFloatingPosition(t);i.togglePinSurface(r,t,u.isFloatingMode)})},show:function(){u.$surfaceContainer.children().detach();u.$surfaceContainer.append(this.$element);u.$surfaceContainer.stop().fadeTo(200,1);var e=u.getFloatingPosition();this.$element.stop().css({top:e.top,left:e.left});this._move()},hide:function(){u.$surfaceContainer.stop().fadeOut(200,function(){u.$surfaceContainer.children().detach()})}});e.extend(u,{$surfaceContainer:null,isFloatingMode:true,pinLeft:0,pinTop:0,init:function(){u.$surfaceContainer=e("<div>",{"class":"aloha aloha-surface aloha-toolbar",unselectable:"on"}).hide();e(function(){u.$surfaceContainer.appendTo("body")});n.trackRange(u.$surfaceContainer);var t=i.getPinState();u.pinTop=t.top;u.pinLeft=t.left;u.isFloatingMode=!t.isPinned},setFloatingPosition:function(e){u.pinTop=e.top;u.pinLeft=e.left},getFloatingPosition:function(){return{top:u.pinTop,left:u.pinLeft}}});u.init();return u});define("ui/settings",["jquery","util/arrays","util/maps","util/trees"],function(e,t,n,r){function s(r,i,s){function c(t){return"array"===e.type(t)?!t.length:l[t]}var f=n.fillTuples({},t.map(i,function(e){return[e.label,e]}));var l=a(r,s);r=u(r,f,c);i=o(i,l,c);return r.concat(i)}function o(t,n,i){var s,o,u=[],a,f;for(s=0;s<t.length;s++){a=t[s];if(!n[a.label]){f=r.postprune(a.components,i);if(f){o=e.extend({},a);o.components=f;u.push(o)}}}return u}function u(t,n,i){var s,o,u=[],a,f,l,c;for(s=0;s<t.length;s++){a=t[s];f=a.components||[];l=n[a.label];if(!a.exclusive&&l){c=r.postprune(l.components,i);if(c){f=f.concat(c)}}o=e.extend({},l||{},a);o.components=f;u.push(o)}return u}function a(e,t){var i,s=n.fillKeys({},t,true);for(i=0;i<e.length;i++){s[e[i].label]=true;n.fillKeys(s,r.flatten(e[i].components),true)}return s}var i={tabs:[{label:"tab.format.label",showOn:{scope:"Aloha.continuoustext"},components:[["bold","strong","italic","emphasis","underline","\n","subscript","superscript","strikethrough","quote"],["formatLink","formatAbbr","formatNumeratedHeaders","toggleDragDrop","\n","toggleMetaView","wailang","toggleFormatlessPaste"],["alignLeft","alignCenter","alignRight","alignJustify","\n","orderedList","unorderedList","indentList","outdentList","colorPicker"],["formatBlock"]]},{label:"tab.insert.label",showOn:{scope:"Aloha.continuoustext"},components:[["createTable","characterPicker","insertLink","insertImage","insertAbbr","insertToc","insertHorizontalRule","insertTag"]]},{label:"tab.link.label",showOn:{scope:"link"},components:["editLink","removeLink","linkBrowser"]},{label:"tab.img.label",showOn:{scope:"image"},components:[["imageSource","\n","imageTitle"],["imageResizeWidth","\n","imageResizeHeight"],["imageAlignLeft","imageAlignRight","imageAlignNone","imageIncPadding","\n","imageCropButton","imageCnrReset","imageCnrRatio","imageDecPadding"],["imageBrowser"]]},{label:"tab.abbr.label",showOn:{scope:"abbr"},components:[["abbrText","removeAbbr"]]},{label:"tab.wai-lang.label",showOn:{scope:"wai-lang"},components:[["wailangfield","removewailang"]]},{label:"tab.table.label",showOn:{scope:"table.cell"},components:[["mergecells","splitcells","tableCaption","tableSummary","naturalFit"],["formatTable"]]},{label:"tab.col.label",showOn:{scope:"table.column"},components:[["addcolumnleft","addcolumnright","deletecolumns","columnheader","mergecellsColumn","splitcellsColumn","formatColumn"]]},{label:"tab.row.label",showOn:{scope:"table.row"},components:[["addrowbefore","addrowafter","deleterows","rowheader","mergecellsRow","splitcellsRow","formatRow"]]},{label:"tab.cell.label",showOn:{scope:"table.cell"},components:[["alignTop","alignMiddle","alignBottom","formatCell"]]}]};return{defaultToolbarSettings:i,combineToolbarSettings:s}});define("ui/ui-plugin",["jquery","aloha","ui/context","ui/container","ui/surface","ui/toolbar","ui/scopes","ui/settings","PubSub","jqueryui"],function(e,t,n,r,i,s,o,u,a){function c(){var e=t.settings.toolbar,n=u.defaultToolbarSettings;if(!e){return n.tabs}return u.combineToolbarSettings(e.tabs||[],n.tabs,e.exclude||[])}function h(){var t=l._tabs,n=o.getPrimaryScope(),r,i;for(i=0;i<t.length;i++){r=t[i].settings;if("object"===e.type(r.showOn)&&r.showOn.scope===n){t[i].tab.foreground();break}}}function p(e,t){return l.adoptInto(e,t)}function d(e){i.show(f);r.showContainersForContext(f,e)}var f=new n,l=new s(f,c());t.bind("aloha-editable-activated",function(e,t){i.show(f);r.showContainersForContext(f,e)});t.bind("aloha-editable-deactivated",function(e,t){if(!i.suppressHide){i.hide(f)}});a.sub("aloha.ui.scope.change",function(){r.showContainersForContext(f);h(o.getPrimaryScope())});return{adoptInto:p,showToolbar:d}});define("ui/ui",["jquery","ui/ui-plugin"],function(e,t){function r(r,i,s){var o,u;if("string"!==e.type(r)){s=i;i=r;r=s.name}else{s=e.extend({name:r},s)}if(!i.isInstance){o=s?i.extend(s):i;u=new o}else{u=i}n[r]=u;t.adoptInto(r,u);return u}function i(e){return n[e]||null}var n={};return{adopt:r,getAdoptedComponent:i}});define("ui/utils",["jquery","jqueryui"],function(e){function t(t,n){return e("<label>",{"class":"aloha-ui-label"}).append(e("<span>",{"class":"aloha-ui-label-text",text:t})).append(n)}function n(e,t,n){e.button({label:r(t),text:!!(t.text||t.html),icons:{primary:t.icon||t.iconUrl&&"aloha-ui-inline-icon-container"||null,secondary:n&&"aloha-jqueryui-icon ui-icon-triangle-1-s"||null}});if(t.iconUrl){e.button("widget").children(".ui-button-icon-primary").append(s(t.iconUrl))}return e}function r(e){return e.html||e.text||e.tooltip}function i(e){var t=r(e);if(e.iconUrl){t=s(e.iconUrl)+t}return t}function s(e){return'<img class="aloha-ui-inline-icon" src="'+e+'">'}function o(t){return e("<button>",t).attr("type","button")}return{wrapWithLabel:t,makeButton:n,makeButtonElement:o,makeButtonLabel:r,makeButtonLabelWithIcon:i,makeButtonIconFromUrl:s}});define("ui/vendor/jquery-ui-autocomplete-html",["jquery","jqueryui"],function(e){(function(e){function r(t,n){var r=new RegExp(e.ui.autocomplete.escapeRegex(n),"i");return e.grep(t,function(t){return r.test(e("<div>").html(t.label||t.value||t).text())})}var t=e.ui.autocomplete.prototype,n=t._initSource;e.extend(t,{_initSource:function(){if(this.options.html&&e.isArray(this.options.source)){this.source=function(e,t){t(r(this.options.source,e.term))}}else{n.call(this)}},_renderItem:function(t,n){return e("<li></li>").data("item.autocomplete",n).append(e("<a></a>")[this.options.html?"html":"text"](n.label)).appendTo(t)}})})(e)});define("ui/port-helper-attribute-field",["jquery","ui/ui","ui/component","ui/scopes","ui/context","ui/utils","aloha/repositorymanager","aloha/selection","aloha/console","ui/vendor/jquery-ui-autocomplete-html"],function(e,t,n,r,i,s,o,u,a){var f=function(r){function S(e,t){if(t.item){j(t.item.obj)}k()}function x(){k()}function T(t,n){if(!e(t.target).is(":visible")){return}L();if(H()===c){B("")}}function N(e){if(e.keyCode==13||e.keyCode==27){e.preventDefault()}}function C(e){if(g&&y!==H()){g=null;y=null}if(!g){I(w,H())}if(e.keyCode==13||e.keyCode==27){u.getRangeObject().select();k()}}function k(){A();if(!b||E===e(b).attr(w)){return}if(!g){o.markObject(b)}if(H()===""){M()}}function L(){var t=e(b);if(p){t.addClass(p)}if(h){return}A();if(t.context&&t.context.style&&t.context.style["background-color"]){t.attr("data-original-background-color",t.context.style["background-color"])}t.css("background-color","#80B5F2")}function A(){var t=e(b);if(p){t.removeClass(p)}if(h){return}var n=t.attr("data-original-background-color");t.css("background-color",n||"");if(!t.attr("style")){t.removeAttr("style")}t.removeAttr("data-original-background-color")}function O(e,t){return e.replace(/\{([^}]+)\}/g,function(e,n){return n in t?t[n]:""})}function M(){if(null===c){return}d.css("color","#AAA");d.val(c)}function _(e){m=e}function D(e){l=e}function P(t,n){d.bind(t,e.proxy(n,Q))}function H(){return d.val()}function B(e){d.val(e);d.css("color","black")}function j(e){g=e;if(e){var t=e[f];B(t);y=t;I(w,e[a]);o.markObject(b,e)}else{y=null}}function F(){return g}function I(t,n,r,i){if(b){var s=true;if(typeof i!="undefined"){var o=new RegExp(r);if(!i.match(o)){s=false}}if(s){e(b).attr(t,n)}else{e(b).removeAttr(t)}}}function q(t,n){b=t;w=n;j(null);if(t&&n){E=e(t).attr(n);B(e(b).attr(w))}else{B("");return}o.getObject(t,function(e){if(e&&e.length>0){j(e[0])}})}function R(){return b}function U(){v.focus();d.focus()}function z(){v.foreground()}function W(){d.show()}function X(){d.hide()}function V(){return d.attr("id")}function J(){return true}function K(){return d[0]}var a=r.valueField||"id",f=r.displayField||"name",l=r.objectTypeFilter||["all"],c=r.placeholder,h=!!r.noTargetHighlight,p=r.targetHighlightClass,d=r.element?e(r.element):e('<input id="aloha-attribute-field-'+r.name+'">'),v,m,g,y,b,w,E;if(r.cls){d.addClass(r.cls)}if(r.width){d.width(r.width)}v=t.adopt(r.name,n,{scope:r.scope,init:function(){if(r.element){this.element=d}else{if(r.label){this.element=s.wrapWithLabel(r.label,d);if(r.labelClass){this.element.addClass(r.labelClass)}}else{this.element=e("<span>").append(d)}}d.autocomplete({html:true,appendTo:i.selector,source:function(t,n){o.query({queryString:t.term,objectTypeFilter:l},function(t){n(e.map(t.items,function(e){return{label:O(m,e),value:e.name,obj:e}}))})},select:S})}});d.bind("focus",T).bind("blur",x).bind("keydown",N).bind("keyup",C);M();Aloha.bind("aloha-editable-deactivated",x);var Q={getInputElem:K,hasInputElem:J,getInputId:V,hide:X,show:W,foreground:z,focus:U,getTargetObject:R,setTargetObject:q,setAttribute:I,getItem:F,setItem:j,setValue:B,getValue:H,addListener:P,setObjectTypeFilter:D,setTemplate:_,setPlaceholder:M};return Q};return f});define("ui/button",["jquery","ui/component","ui/utils","jqueryui"],function(e,t,n){var r=t.extend({init:function(){this._super();this.createButtonElement();n.makeButton(this.buttonElement,this).button("widget").tooltip({tooltipClass:"aloha aloha-ui-tooltip",position:{my:"left top",at:"right bottom"}}).click(e.proxy(function(){this.buttonElement.tooltip("close",null,true);this._onClick()},this))},_onClick:function(){this.click()},click:function(){},createButtonElement:function(){var e=n.makeButtonElement();if(this["class"]){e.addClass(this["class"])}this.element=this.buttonElement=e;return e},disable:function(){this.element.button("option","disabled",false)},enable:function(e){this.element.button("option","disabled",e===false)}});return r});define("ui/toggleButton",["jquery","ui/button","jqueryui"],function(e,t){var n=0;var r=t.extend({_checked:false,setState:function(e){if(this._checked===e){return}this._checked=e;if(e){this.element.addClass("aloha-button-active")}else{this.element.removeClass("aloha-button-active")}},getState:function(){return this._checked},_onClick:function(){this.setState(!this._checked);this.click()}});return r});define("link/nls/i18n",{root:{"button.addlink.tooltip":"Insert Link","button.removelink.tooltip":"Remove Link","newlink.defaulttext":"New Link","floatingmenu.tab.link":"Link","link.target.self":"Self","link.target.blank":"Blank","link.target.parent":"Parent","link.target.top":"Top","link.target.framename":"Framename","link.target.legend":"Target","link.title.legend":"Title",insertLink:"ctrl+k"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("aloha/nls/i18n",{root:{"plugin.abbr.floatingmenu.tab.abbr":"Abbreviation","floatingmenu.tab.format":"Format","floatingmenu.tab.insert":"Insert",yes:"Yes",no:"No",cancel:"Cancel","repository.no_item_found":"No item found.","repository.loading":"Loading","repository.no_items_found_yet":"No items found yet..."},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("util/keys",["jquery"],function(e){function n(e){return t[e]}var t=function(){var t={};e.each({8:"backspace",9:"tab",13:"enter",16:"shift control alt",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",37:"left up right down",45:"insert",46:"delete",48:"0 1 2 3 4 5 6 7 8 9",65:"a b c d e f g h i j k l m n o p q r s t u v w x y z",112:"f1 f2 f3 f4 f5 f6 f7 f8 f9 f10 f11 f12 f13 f14 f15"},function(n,r){var i=parseInt(n,10);e.each(r.split(" "),function(e,n){t[i+e]=n})});return t}();return{getToken:n,keyCodeTokenMap:e.extend({},t)}});define("link/link-plugin",["aloha","aloha/plugin","aloha/ephemera","jquery","ui/port-helper-attribute-field","ui/ui","ui/scopes","ui/surface","ui/button","ui/toggleButton","i18n!link/nls/i18n","i18n!aloha/nls/i18n","aloha/console","PubSub","util/keys"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){function w(){r(document).bind("keydown.aloha-link.pointer-fix",function(e){if(e.metaKey||d.getToken(e.keyCode)==="control"){r("body").addClass("aloha-link-pointer")}}).bind("keyup.aloha-link.pointer-fix",function(e){if(e.metaKey||d.getToken(e.keyCode)==="control"){r("body").removeClass("aloha-link-pointer")}})}function E(){r(document).unbind(".aloha-link.pointer-fix")}function S(t){t.obj.delegate("a","click.aloha-link.meta-click-link",function(t){if(t.metaKey||t.ctrlKey){e.activeEditable.blur();window.setTimeout(function(){location.href=t.target},0);t.stopPropagation();return false}})}function x(e){e.obj.unbind(".aloha-link.meta-click-link")}function T(t,n){var i,s=false;if(!t.ignoreNextSelectionChangedEvent&&e.Selection.isSelectionEditable()&&e.activeEditable!=null){i=t.findLinkMarkup(n);if(i){t.toggleLinkScope(true);t.hrefField.setTargetObject(i,"href");if(r("#"+t.hrefField.getInputId()).length==0){if(t.hrefUpdateInt!==null){clearInterval(t.hrefUpdateInt)}t.hrefUpdateInt=setInterval(function(){if(r("#"+t.hrefField.getInputId()).length>0){t.hrefField.setTargetObject(i,"href");clearInterval(t.hrefUpdateInt)}},200)}e.trigger("aloha-link-selected");s=true;p.pub("aloha.link.selected",{input:t.hrefField.getInputElem(),href:t.hrefField.getValue(),element:t.hrefField.getTargetObject()})}else{t.toggleLinkScope(false);t.hrefField.setTargetObject(null);e.trigger("aloha-link-unselected")}}else{t.toggleLinkScope(false)}t.ignoreNextSelectionChangedEvent=false;return s}var v=window.GENTICS,m="aloha-link",g="",y;var b={merge:true,mergeable:function(e){return"aloha-new-link"===e.className&&e.nextSibling&&"aloha-new-link"===e.nextSibling.className}};n.classes("aloha-link-pointer","aloha-link-text");return t.create("link",{config:["a"],title:null,titleregex:null,targetregex:"",target:"",cssclassregex:null,cssclass:"",objectTypeFilter:[],onHrefChange:null,ignoreNextSelectionChangedEvent:false,hrefUpdateInt:null,hotKey:{insertLink:l.t("insertLink","ctrl+k")},hrefValue:"http://",init:function(){var t=this;if("undefined"!==typeof this.settings.title){this.title=this.settings.title}if("undefined"!==typeof this.settings.titleregex){this.titleregex=this.settings.titleregex}if(typeof this.settings.targetregex!="undefined"){this.targetregex=this.settings.targetregex}if(typeof this.settings.target!="undefined"){this.target=this.settings.target}if(typeof this.settings.cssclassregex!="undefined"){this.cssclassregex=this.settings.cssclassregex}if(typeof this.settings.cssclass!="undefined"){this.cssclass=this.settings.cssclass}if(typeof this.settings.objectTypeFilter!="undefined"){this.objectTypeFilter=this.settings.objectTypeFilter}if(typeof this.settings.onHrefChange!="undefined"){this.onHrefChange=this.settings.onHrefChange}if(typeof this.settings.hotKey!="undefined"){r.extend(true,this.hotKey,this.settings.hotKey)}if(typeof this.settings.hrefValue!="undefined"){this.hrefValue=this.settings.hrefValue}this.createButtons();this.subscribeEvents();this.bindInteractions();e.bind("aloha-plugins-loaded",function(){t.initSidebar(e.Sidebar.right);p.pub("aloha.link.ready",{plugin:t})})},nsSel:function(){var e=[],t=m;r.each(arguments,function(){e.push("."+(this==""?t:t+"-"+this))});return r.trim(e.join(" "))},nsClass:function(){var e=[],t=m;r.each(arguments,function(){e.push(this==""?t:t+"-"+this)});return r.trim(e.join(" "))},initSidebar:function(e){var t=this;t.sidebar=e;e.addPanel({id:t.nsClass("sidebar-panel-target"),title:l.t("floatingmenu.tab.link"),content:"",expanded:true,activeOn:"a, link",onInit:function(){var e=this,n=this.setContent('<div class="'+t.nsClass("target-container")+'"><fieldset><legend>'+l.t("link.target.legend")+'</legend><ul><li><input type="radio" name="targetGroup" class="'+t.nsClass("radioTarget")+'" value="_self" /><span>'+l.t("link.target.self")+"</span></li>"+'<li><input type="radio" name="targetGroup" class="'+t.nsClass("radioTarget")+'" value="_blank" /><span>'+l.t("link.target.blank")+"</span></li>"+'<li><input type="radio" name="targetGroup" class="'+t.nsClass("radioTarget")+'" value="_parent" /><span>'+l.t("link.target.parent")+"</span></li>"+'<li><input type="radio" name="targetGroup" class="'+t.nsClass("radioTarget")+'" value="_top" /><span>'+l.t("link.target.top")+"</span></li>"+'<li><input type="radio" name="targetGroup" class="'+t.nsClass("radioTarget")+'" value="framename" /><span>'+l.t("link.target.framename")+"</span></li>"+'<li><input type="text" class="'+t.nsClass("framename")+'" /></li></ul></fieldset></div>'+'<div class="'+t.nsClass("title-container")+'" ><fieldset><legend>'+l.t("link.title.legend")+'</legend><input type="text" class="'+t.nsClass("linkTitle")+'" /></fieldset></div>').content;r(t.nsSel("framename")).live("keyup",function(){r(e.effective).attr("target",r(this).val().replace('"',"&quot;").replace("'","&#39;"))});r(t.nsSel("radioTarget")).live("change",function(){if(r(this).val()=="framename"){r(t.nsSel("framename")).slideDown()}else{r(t.nsSel("framename")).slideUp().val("");r(e.effective).attr("target",r(this).val())}});r(t.nsSel("linkTitle")).live("keyup",function(){r(e.effective).attr("title",r(this).val().replace('"',"&quot;").replace("'","&#39;"))})},onActivate:function(e){var n=this;n.effective=e;if(r(n.effective).attr("target")!=null){var i=true;r(t.nsSel("framename")).hide().val("");r(t.nsSel("radioTarget")).each(function(){r(this).removeAttr("checked");if(r(this).val()===r(n.effective).attr("target")){i=false;r(this).attr("checked","checked")}});if(i){r(t.nsSel('radioTarget[value="framename"]')).attr("checked","checked");r(t.nsSel("framename")).val(r(n.effective).attr("target")).show()}}else{r(t.nsSel("radioTarget")).first().attr("checked","checked");r(n.effective).attr("target",r(t.nsSel("radioTarget")).first().val())}var n=this;n.effective=e;r(t.nsSel("linkTitle")).val(r(n.effective).attr("title"))}});e.show()},subscribeEvents:function(){var t=this,n={};var i=0;e.bind("aloha-editable-created",function(e,s){var o=t.getEditableConfig(s.obj),u=r.inArray("a",o)!==-1;n[s.getId()]=u;if(!u){return}s.obj.bind("keydown.aloha-link",t.hotKey.insertLink,function(){if(t.findLinkMarkup()){t.hrefField.foreground();t.hrefField.focus()}else{t.insertLink(true)}return false});s.obj.find("a").each(function(){t.addLinkEventHandlers(this)});if(0===i++){w()}});e.bind("aloha-editable-destroyed",function(e,t){t.obj.unbind(".aloha-link");if(0===--i){E()}});e.bind("aloha-editable-activated",function(r,i){if(n[e.activeEditable.getId()]){t._formatLinkButton.show();t._insertLinkButton.show()}else{t._formatLinkButton.hide();t._insertLinkButton.hide()}S(i.editable)});var s=false;e.bind("aloha-selection-changed",function(r,i){var o=false;if(e.activeEditable&&n[e.activeEditable.getId()]){o=T(t,i);if(o&&s!==o){t.hrefField.foreground()}}s=o});var o=this;e.bind("aloha-editable-deactivated",function(e,t){if(s){setTimeout(function(){if(!s){o.toggleLinkScope(false)}},100);s=false}x(t.editable)})},toggleLinkScope:function(t){if(this._isScopeActive===t&&e.activeEditable&&this._isScopeActive_editableId===e.activeEditable.getId()){return}this._isScopeActive=t;this._isScopeActive_editableId=e.activeEditable&&e.activeEditable.getId();if(t){this.hrefField.show();this._insertLinkButton.hide();if(e.activeEditable&&e.activeEditable.obj[0].nodeName==="A"){this._removeLinkButton.hide()}else{this._removeLinkButton.show()}this._formatLinkButton.setState(true);o.enterScope(this.name,"link")}else{this.hrefField.hide();this._insertLinkButton.show();this._removeLinkButton.hide();this._formatLinkButton.setState(false);o.leaveScope(this.name,"link",true)}},addLinkEventHandlers:function(t){var n=this;r(t).mouseenter(function(r){e.Log.debug(n,"mouse over link.");n.mouseOverLink=t;n.updateMousePointer()});r(t).mouseleave(function(t){e.Log.debug(n,"mouse left link.");n.mouseOverLink=null;n.updateMousePointer()});r(t).click(function(t){if(t.metaKey){e.activeEditable.blur();window.setTimeout(function(){location.href=t.target},0);t.stopPropagation();return false}})},createButtons:function(){var e=this;this._formatLinkButton=s.adopt("formatLink",f,{tooltip:l.t("button.addlink.tooltip"),icon:"aloha-icon aloha-icon-link",scope:"Aloha.continuoustext",click:function(){e.formatLink()}});this._insertLinkButton=s.adopt("insertLink",a,{tooltip:l.t("button.addlink.tooltip"),icon:"aloha-icon aloha-icon-link",scope:"Aloha.continuoustext",click:function(){e.insertLink(false)}});this.hrefField=i({name:"editLink",width:320,valueField:"url",cls:"aloha-link-href-field",scope:"Aloha.continuoustext",noTargetHighlight:true,targetHighlightClass:"aloha-focus"});this.hrefField.setTemplate("<span><b>{name}</b><br/>{url}</span>");this.hrefField.setObjectTypeFilter(this.objectTypeFilter);this._removeLinkButton=s.adopt("removeLink",a,{tooltip:l.t("button.removelink.tooltip"),icon:"aloha-icon aloha-icon-unlink",scope:"Aloha.continuoustext",click:function(){e.removeLink()}})},bindInteractions:function(){var t=this;this.hrefField.addListener("keyup",function(n){if(d.getToken(n.keyCode)==="escape"){var i=t.hrefField.getValue();if(i[0]=="/"||i[0]=="#"||i.match(/^.*\.([a-z]){2,4}$/i)||i.match(/^([a-z]){3,10}:\/\/.+/i)||i.match(/^(mailto|tel):.+/i)){}else{var s=t.hrefField.getValue();t.hrefField.setValue(s);if(s==t.hrefValue||s==""){t.removeLink(false)}}}t.hrefChange();if(d.getToken(n.keyCode)==="enter"){var u=e.Selection.getRangeObject();t.ignoreNextSelectionChangedEvent=true;u.startContainer=u.endContainer;u.startOffset=u.endOffset;u.select();t.ignoreNextSelectionChangedEvent=true;var s=r(t.hrefField.getInputElem()).attr("value");if(s==t.hrefValue||s==""){t.removeLink(false)}window.setTimeout(function(){o.setScope("Aloha.continuoustext")},100)}else{y=r(t.hrefField.getInputElem()).attr("value");if(g!=y){g=y}}});r(document).keydown(function(n){e.Log.debug(t,"Meta key down.");t.metaKey=n.metaKey;t.updateMousePointer()}).keyup(function(n){e.Log.debug(t,"Meta key up.");t.metaKey=n.metaKey;t.updateMousePointer()})},updateMousePointer:function(){if(this.metaKey&&this.mouseOverLink){e.Log.debug(this,"set pointer");r(this.mouseOverLink).removeClass("aloha-link-text");r(this.mouseOverLink).addClass("aloha-link-pointer")}else{r(this.mouseOverLink).removeClass("aloha-link-pointer");r(this.mouseOverLink).addClass("aloha-link-text")}},findLinkMarkup:function(t){if(typeof t=="undefined"){t=e.Selection.getRangeObject()}if(e.activeEditable){var n=e.activeEditable.obj;if(n[0]&&n[0].nodeName==="A"){n=n.parent()}return t.findMarkup(function(){return this.nodeName=="A"},n)}else{return null}},formatLink:function(){if(e.activeEditable){if(this.findLinkMarkup(e.Selection.getRangeObject())){this.removeLink()}else{this.insertLink()}}},insertLink:function(t){var n=this,i=e.Selection.getRangeObject(),s,o;if(!(i.startContainer&&i.endContainer)){return}if(this.findLinkMarkup(i)){return}this.hrefField.foreground();if(i.isCollapsed()&&t!==false){v.Utils.Dom.extendToWord(i)}if(i.isCollapsed()){s=l.t("newlink.defaulttext");o=r('<a href="'+n.hrefValue+'" class="aloha-new-link">'+s+"</a>");v.Utils.Dom.insertIntoDOM(o,i,r(e.activeEditable.obj));i.startContainer=i.endContainer=o.contents().get(0);i.startOffset=0;i.endOffset=s.length}else{o=r('<a href="'+n.hrefValue+'" class="aloha-new-link"></a>');v.Utils.Dom.addMarkup(i,o,false);v.Utils.Dom.doCleanup(b,i)}e.activeEditable.obj.find("a.aloha-new-link").each(function(e){n.addLinkEventHandlers(this);r(this).removeClass("aloha-new-link")});i.select();this.hrefField.focus();if(this.hrefField.hasInputElem()){r(this.hrefField.getInputElem()).attr("value",n.hrefValue).select()}var u=e.createRange();u.setStart(i.startContainer,i.startOffset);u.setEnd(i.endContainer,i.endOffset);p.pub("aloha.link.insert",{range:u});this.hrefChange()},removeLink:function(t){var n=e.Selection.getRangeObject(),r=this.findLinkMarkup();this.hrefField.setItem(null);if(r){v.Utils.Dom.removeFromDOM(r,n,true);n.startContainer=n.endContainer;n.startOffset=n.endOffset;n.select();if(typeof t=="undefined"||t===true){o.setScope("Aloha.continuoustext")}}},automaticallySetTitle:function(e,t,n){var i=r(e.getTargetObject()).attr("title");var s=!i||t===i;if(t&&s){e.setAttribute("title",t,n,e.getValue())}},hrefChange:function(){var t=this;this.automaticallySetTitle(this.hrefField,this.title,this.titleregex);if(this.target!=""){this.hrefField.setAttribute("target",this.target,this.targetregex,this.hrefField.getValue())}if(null!=this.cssclassregex){this.hrefField.setAttribute("class",this.cssclass,this.cssclassregex,this.hrefField.getValue())}var n=t.hrefField.getValue();var r=t.hrefField.getTargetObject();e.trigger("aloha-link-href-change",{href:n,obj:r,item:t.hrefField.getItem()});p.pub("aloha.link.changed",{href:n,element:r,input:t.hrefField.getInputElem()});if(typeof this.onHrefChange=="function"){this.onHrefChange.call(this,this.hrefField.getTargetObject(),this.hrefField.getValue(),this.hrefField.getItem())}}})});define("ui/dialog",["jquery","ui/component","i18n!ui/nls/i18n"],function(e,t,n){function r(t){var n={};if(t.text){n.text=t.text}if(t.html){n.html=t.html}return e("<div>",n)}function i(t){return function(){t.apply(this);e(this).dialog("destroy").remove()}}function s(e){var t;for(t in e){if(e.hasOwnProperty(t)){e[t]=i(e[t])}}return e}function o(e,t){var n="aloha aloha-dialog";if(e.cls){n+=" "+e.cls}return{resizable:false,modal:true,title:e.title||t,dialogClass:n,zIndex:10200}}return{confirm:function(t){var i=t.buttons||{};var u=n.t("button.yes.label");var a=n.t("button.no.label");if(i.Yes!==null&&u!=="Yes"){i[u]=i.Yes;delete i.Yes}if(i.No!==null&&a!=="No"){i[a]=i.No;delete i.No}i[u]=i[u]||t.yes||e.noop;i[a]=i[a]||t.no||e.noop;if(t.answer){var f=i[u];var l=i[a];i[u]=function(){f();t.answer(true)};i[a]=function(){l();t.answer(false)}}var c=r(t).dialog(e.extend(o(t,"Confirm"),{buttons:s(i)}));return function(){c.dialog("destroy").remove()}},alert:function(t){var i={};i[n.t("button.dismiss.label")]=e.noop;var u=r(t).dialog(e.extend(o(t,"Alert"),{buttons:s(i)}));return function(){u.dialog("destroy").remove()}},modal:function(t){var n=r(t).dialog(e.extend(o(t,""),t));n.parent().find(".ui-dialog-titlebar").remove();return n},progress:function(t){var n=e("<div>").progressbar({value:null!=t.value?t.value:100});var i=r(t).dialog(e.extend(o(t,"Progress"),{open:function(){e(this).append(n)}}));return function(e){if(null!=e){n.progressbar({value:e})}else{i.dialog("destroy").remove()}}}}});define("ui/multiSplit",["jquery","ui/component","ui/button","ui/utils"],function(e,t,n,r){var i=t.extend({_activeButton:null,_isOpen:false,init:function(){this._super();var t=this;var n=this.element=e("<div>",{"class":"aloha-multisplit"});var i=this.contentElement=e("<div>",{"class":"aloha-multisplit-content"}).appendTo(n);var s=this.toggleButton=r.makeButtonElement({"class":"aloha-multisplit-toggle",click:function(){t.toggle()}}).button().appendTo(n);this.buttons=[];var o=this.getButtons();if(0===o.length){n.hide()}for(var u=0;u<o.length;u++){this.addButton(o[u])}e("body").click(function(e){if(t._isOpen&&!t.element.is(e.target)&&0===t.element.find(e.target).length){t.close()}})},addButton:function(e){var t=this;var r=new(n.extend({tooltip:e.tooltip,icon:e.wide?e.icon:"aloha-large-icon "+e.icon,iconOnly:e.wide?false:true,init:function(){this._super();if(e.init){e.init.call(this)}},click:function(){e.click.apply(t,arguments);t.close()}}));if(!e.wide){r.element.addClass("aloha-large-button")}t.buttons[e.name]={settings:e,component:r,element:r.element,visible:true};var i=this.contentElement.children(".aloha-ui-multisplit-fullwidth");if(!e.wide&&i.length){i.before(r.element[0])}else{this.contentElement.append(r.element[0])}},setActiveButton:function(e){if(!e){e=null}if(null!==this._activeButton){this.buttons[this._activeButton].element.removeClass("aloha-multisplit-active")}this._activeButton=e;if(null!==e){this.buttons[e].element.addClass("aloha-multisplit-active")}},toggle:function(){this.element.toggleClass("aloha-multisplit-open");this._isOpen=!this._isOpen},open:function(){this.element.addClass("aloha-multisplit-open");this._isOpen=true},close:function(){this.element.removeClass("aloha-multisplit-open");this._isOpen=false},show:function(e){if(!e){e=null}if(null!==e&&this.buttons[e]!==undefined){this.buttons[e].element.show();this.buttons[e].visible=true;this.element.show()}},hide:function(e){var t,n=false;if(!e){e=null}if(null!==e&&this.buttons[e]!==undefined){this.buttons[e].element.hide();this.buttons[e].visible=false;for(t in this.buttons){if(this.buttons.hasOwnProperty(t)){if(this.buttons[t].visible){this.element.show();n=true;break}}}if(!n){this.element.hide()}}}});return i});define("ui/port-helper-multi-split",["aloha/core","jquery","ui/ui","ui/multiSplit"],function(e,t,n,r){function i(e){var i;i=n.adopt(e.name,r,{scope:e.scope,getButtons:function(){var n=[];t.each(e.items,function(e,t){n.push({tooltip:t.tooltip,text:t.text,name:t.name,icon:t.iconClass,click:t.click,init:function(){if(t.cls){this.element.addClass(t.cls)}if(t.init){t.init.call(this)}},wide:t.wide})});return n}});return{pushItem:function(e){i.addButton(e)},showItem:function(e){i.show(e)},hideItem:function(e){i.hide(e)},setActiveItem:function(e){i.setActiveButton(e)}}}return i});define("table/nls/i18n",{root:{"floatingmenu.tab.table":"Table","floatingmenu.tab.tablelayout":"Table Layout","deleterows.confirm":"Do you really want to delete the selected rows?","deletecolumns.confirm":"Do you really want to delete the selected columns?","deletetable.confirm":"Do you really want to delete the table?",Table:"Table","button.createtable.tooltip":"Insert Table","button.addcolleft.tooltip":"Add Column left","button.addcolright.tooltip":"Add Column right","button.delcols.tooltip":"Delete Columns","button.addrowbefore.tooltip":"Add Row before","button.addrowafter.tooltip":"Add Row after","button.delrows.tooltip":"Delete Rows","button.caption.tooltip":"Table caption","button.naturalfit.tooltip":"Reset table sizing","empty.caption":"Table caption","button.removeFormat.tooltip":"Remove formatting","button.removeFormat.text":"Remove formatting","button.rowheader.tooltip":"Format row as table header","button.columnheader.tooltip":"Format column as table header","button.mergecells.tooltip":"Merge Cells","button.splitcells.tooltip":"Split Cells","table.label.target":"Summary","table.sidebar.title":"Table","table.mergeCells.notRectangular":"Only a rectangular selection can be merged","table.addColumns.nonConsecutive":"Please select a single column or a consecutive range of columns","table.createTable.nestedTablesNoSupported":"Sorry, nested tables are not supported"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("table/table-create-layer",["jquery"],function(e){CreateLayer=function(e){this.TablePlugin=e};CreateLayer.prototype.parameters={elemId:"aloha-table-createLayer",className:"aloha-table-createdialog",numX:10,numY:10,layer:undefined,target:undefined};CreateLayer.prototype.config=new Object;CreateLayer.prototype.visible=false;CreateLayer.prototype.show=function(){var e=this.get("layer");if(e==null){this.create()}else{this.setPosition(e);e.find("td").removeClass("hover");e.show()}this.visible=true};CreateLayer.prototype.create=function(){var t=this;var n=e("<div></div>");n.id=this.get("elemId");n.addClass(this.get("className"));var r=e("<table></table>");r.css("width",(this.get("numX")+6)*15);var i;var s;for(var o=0;o<this.get("numY");o++){i=e("<tr></tr>");for(var u=0;u<this.get("numX");u++){s=e("<td></td>");if(o==0&&u==0){s.addClass("hover")}s.bind("mouseover",{rowId:o,colId:u},function(e){t.handleMouseOver(e,r)});s.bind("click",{rowId:o,colId:u},function(e){var n=e.data.rowId+1;var r=e.data.colId+1;t.TablePlugin.createTable(r,n);t.hide()});i.append(s)}r.append(i)}n.append(r);this.set("layer",n);this.setPosition();n.bind("click",function(e){e.stopPropagation()}).mousedown(function(e){e.stopPropagation()});e("body").append(n).bind("click",function(n){if(t.visible&&!(n.target===t.get("target")[0]||e.contains(t.get("target")[0],n.target))){t.hide()}})};CreateLayer.prototype.handleMouseOver=function(t,n){var r=t.data.rowId;var i=t.data.colId;var s=n.find("tr");for(var o=0;o<=s.length;o++){var u=e(s[o]).find("td");for(var a=0;a<=u.length;a++){if(o<=r&&a<=i){e(u[a]).addClass("hover")}else{e(u[a]).removeClass("hover")}}}};CreateLayer.prototype.setPosition=function(){var t=e(this.get("target"));var n=t.offset();this.get("layer").css("left",n.left+"px");this.get("layer").css("top",n.top+t.height()+"px")};CreateLayer.prototype.hide=function(){this.get("layer").hide();this.visible=false};CreateLayer.prototype.get=function(e){if(this.config[e]){return this.config[e]}if(this.parameters[e]){return this.parameters[e]}return undefined};CreateLayer.prototype.set=function(e,t){if(this.config[e]){this.config[e]=t}else{this.parameters[e]=t}};return CreateLayer});define("table/table-plugin-utils",["jquery"],function(e){var t={cellIndexToGridColumn:function(e,n,r){var i=null;t.walkCells(e,function(e,t,s,o,u){if(e===n&&t===r){i=s;return false}});return i},walkCells:function(e,n){var r=[];for(var i=0;i<e.length;i++){var s=e[i].cells;var o=0;for(var u=0;u<s.length;u++){var a=s[u];var f=t.colspan(a);var l=t.rowspan(a);while(r[u+o]){r[u+o]-=1;o+=1}if(false===n(i,u,u+o,f,l)){return}for(var c=0;c<f;c++){if(r[u+o+c]){throw"an impossible case has occurred"}r[u+o+c]=l-1}o+=f-1}for(;u+o<r.length;o++){if(r[u+o]){r[u+o]-=1}}}},makeGrid:function(e){var n=[];t.walkCells(e,function(t,r,i,s,o){var u=e[t].cells[r];for(var a=0;a<o;a++){n[t+a]=n[t+a]||[];for(var f=0;f<s;f++){n[t+a][i+f]={cell:u,colspan:s,rowspan:o,spannedX:f,spannedY:a}}}});return n},containsDomCell:function(e){return 0===e.spannedX&&0===e.spannedY},leftDomCell:function(e,t,n){do{var r=e[t][n];if(0===r.spannedY){return r.cell}n-=r.spannedX+1}while(n>=0);return null},splitCell:function(n,r){var i=e(n);var s=t.colspan(n);var o=t.rowspan(n);if(1===s&&1===o){return}var u=i.parent();var a=u.parent().children();var f=u.index();var l=i.index();var c=t.makeGrid(a);var h=t.cellIndexToGridColumn(a,f,l);for(var p=0;p<o;p++){for(var d=0===p?1:0;d<s;d++){var v=t.leftDomCell(c,f+p,h);if(null==v){a.eq(f+p).prepend(r())}else{e(v).after(r())}}}i.removeAttr("colSpan");i.removeAttr("rowSpan")},rowspan:function(t){return parseInt(e(t).attr("rowspan"))||1},colspan:function(t){return parseInt(e(t).attr("colspan"))||1},walkGrid:function(e,t){for(var n=0;n<e.length;n++){for(var r=0;r<e[n].length;r++){if(false===t(e[n][r],r,n)){return}}}},walkGridInsideRect:function(e,n,r){t.walkGrid(e,function(e,t,i){if(i>=n.top&&i<n.bottom&&t>=n.left&&t<n.right){return r(e,t,i)}})},leftTrimArray:function(e){for(var t=0;t<e.length;t++){if(null!=e[t]){return e.slice(t,e.length)}}return[]},makeContour:function(e,n){var r=[];var i=[];var s=[];var o=[];t.walkGrid(e,function(e,t,u){if(n(e,t,u)){if(null==r[u]||t<r[u]){r[u]=t}if(null==i[u]||t>i[u]){i[u]=t}if(null==s[t]||u<s[t]){s[t]=u}if(null==o[t]||u>o[t]){o[t]=u}}});r=t.leftTrimArray(r);i=t.leftTrimArray(i);s=t.leftTrimArray(s);o=t.leftTrimArray(o);return{left:r,right:i,top:s,bottom:o}},indexOfAnyBut:function(e,t){for(var n=0;n<e.length;n++){if(t!==e[n]){return n}}return-1},isConsecutive:function(e){for(var t=1;t<e.length;t++){if(1!==Math.abs(e[t]-e[t-1])){return false}}return true},resizeCellWidth:function(t,n){e(t).css("width",n);e(t).find(".aloha-table-cell-editable").eq(0).css({width:n,"word-wrap":"break-word"})},getMinColWidth:function(n){var r=n.closest("tbody").children("tr");var i=n.closest("tr");var s=t.cellIndexToGridColumn(r,r.index(i),i.children().index(n));var o="";t.walkCells(r,function(t,n,i,u,a){if(i===s){var f=e(e(r[t]).children()[n]);if(u>1){return}var l=f.text().split(" ");for(var c=0;c<l.length;c++){if(l[c].length>o.length){o=l[c]}}}});var u=e("<span></span>");u.css("text-indent",-9999);u.css("display","inline");u.text(o);e(n).append(u);var a=u.width();e(u).remove();return a},getCellResizeBoundaries:function(n,r,i){var s,o;t.walkCells(r,function(u,a,f,l,c){var h=e(e(r[u]).children()[a]);if(h.hasClass("aloha-table-selectrow")||h.closest("tr").hasClass("aloha-table-selectcolumn")){return true}if(f===n&&l===1){s=h.offset().left+t.getCellBorder(h)+h.width()-t.getMinColWidth(h)}if(f===n-1&&l===1){o=h.offset().left+t.getCellBorder(h)+t.getCellPadding(h)+t.getMinColWidth(h)}if(s&&o){i(s,o);return false}})},getCellBorder:function(e){return(e.outerWidth()-e.innerWidth())/2},getCellPadding:function(e){return e.innerWidth()-e.width()}};return t});define("table/table-cell",["jquery","table/table-plugin-utils"],function(e,t){var n=function(t,n){if(null==t){t="<td>&nbsp;</td>"}t=e(t).get(0);this.obj=e(t);this.tableObj=n;n.cells.push(this)};n.prototype.tableObj=undefined;n.prototype.obj=undefined;n.prototype.wrapper=undefined;n.prototype.hasFocus=false;n.prototype.activate=function(){var n=this;var r=n.obj;r.wrapInner("<div/>");var i=r.children("div").eq(0);i.contentEditable(true);i.addClass("aloha-table-cell-editable");i.bind("focus",function(e){if(t.colspan(n.obj)>1||t.rowspan(n.obj)>1){n.tableObj.tablePlugin._splitcellsButton.enable(true)}else{n.tableObj.tablePlugin._splitcellsButton.enable(false)}if(e.currentTarget){e.currentTarget.indexOf=function(){return-1}}n._editableFocus(e)});i.bind("mousedown",function(r){if(r.currentTarget){r.currentTarget.indexOf=function(){return-1}}n._editableMouseDown(r);n.tableObj.selection.baseCellPosition=[n._virtualY(),n._virtualX()];if(r.shiftKey){var i=n.tableObj.selection.lastBaseCellPosition[1];var s=n.tableObj.selection.lastBaseCellPosition[0];var o=n.tableObj.selection.baseCellPosition;var u=o[1];if(u>i){u=i;i=o[1]}var a=o[0];if(a>s){a=s;s=o[0]}var f={top:a,right:i,bottom:s,left:u};var l=n.tableObj;var c=l.obj.children().children("tr");var h=t.makeGrid(c);l.selection.selectedCells=[];var p=l.get("classCellSelected");t.walkGrid(h,function(n,r,i){if(t.containsDomCell(n)){if(i>=f.top&&i<=f.bottom&&r>=f.left&&r<=f.right){e(n.cell).addClass(p);l.selection.selectedCells.push(n.cell)}else{e(n.cell).removeClass(p)}}});l.selection.notifyCellsSelected()}else{n.tableObj.selection.lastBaseCellPosition=n.tableObj.selection.baseCellPosition;n._editableMouseDown(r);n._startCellSelection()}});i.bind("blur",function(e){n._editableBlur(e)});i.bind("keyup",function(e){n._editableKeyUp(e)});i.bind("keydown",function(e){n._editableKeyDown(e)});i.bind("mouseover",function(e){n._selectCellRange()});i.contentEditableSelectionChange(function(e){Aloha.Selection.onChange(i,e);return i});r.bind("mousedown",function(e){window.setTimeout(function(){n.wrapper.trigger("focus");n._selectAll(i)},1);if(!e.shiftKey){n.tableObj.selection.unselectCells();n._startCellSelection()}e.stopPropagation()});if(r.get(0)){r.get(0).onselectstart=function(){return false}}this.wrapper=r.children();if(this.wrapper.get(0)){this.wrapper.get(0).onselectstart=function(){window.event.cancelBubble=true};this.wrapper.get(0).ondragstart=function(){return false}}return this};n.prototype.deactivate=function(){var t=e(this.obj.children(".aloha-table-cell-editable"));if(t.length){t.parent().append(t.contents());t.remove();this.obj.unbind("click");this.obj.unbind("mousedown");if(e.trim(this.obj.attr("class"))==""){this.obj.removeAttr("class")}}};n.prototype.toString=function(){return"TableCell"};n.prototype._editableFocus=function(e){if(!this.hasFocus){this.tableObj.focus();this.obj.addClass("aloha-table-cell_active");this.hasFocus=true;this.tableObj.selection.selectionType="cell"}};n.prototype._editableBlur=function(e){this.hasFocus=false;this.obj.removeClass("aloha-table-cell_active")};n.prototype._virtualX=function(){var e=this.tableObj.obj.children().children("tr");var n=this.obj.parent().index();var r=this.obj.index();return t.cellIndexToGridColumn(e,n,r)};n.prototype._virtualY=function(){return this.obj.parent("tr").index()};n.prototype._startCellSelection=function(){if(!this.tableObj.selection.cellSelectionMode){this.tableObj.selection.unselectCells();this.tableObj.selection.cellSelectionMode=true;var t=this;e("body").bind("mouseup.cellselection",function(){t._endCellSelection()});this.tableObj.selection.baseCellPosition=[this._virtualY(),this._virtualX()]}};n.prototype._endCellSelection=function(){if(this.tableObj.selection.cellSelectionMode){this.tableObj.selection.cellSelectionMode=false;this.tableObj.selection.baseCellPosition=null;this.tableObj.selection.lastSelectionRange=null;this.tableObj.selection.selectionType="cell";e("body").unbind("mouseup.cellselection")}};n.prototype._getSelectedRect=function(){var e=this._virtualX();var t=this._virtualY();var n=this.tableObj.selection.baseCellPosition;var r=n[1];if(r>e){r=e;e=n[1]}var i=n[0];if(i>t){i=t;t=n[0]}return{top:i,right:e,bottom:t,left:r}};n.prototype._selectCellRange=function(){if(this.tableObj.selection.resizeMode||!this.tableObj.selection.cellSelectionMode){return}var n=this._getSelectedRect();var r=this.tableObj;var i=r.obj.children().children("tr");var s=t.makeGrid(i);r.selection.selectedCells=[];var o=r.get("classCellSelected");t.walkGrid(s,function(i,s,u){if(t.containsDomCell(i)){if(u>=n.top&&u<=n.bottom&&s>=n.left&&s<=n.right){e(i.cell).addClass(o);r.selection.selectedCells.push(i.cell)}else{e(i.cell).removeClass(o)}}});r.selection.notifyCellsSelected()};n.prototype._selectAll=function(t){var n=t.jquery?t.get(0):t;if(!e.browser.msie){var r=window.getSelection();if(r.setBaseAndExtent){r.setBaseAndExtent(n,0,n,Math.max(0,n.innerText.length-1))}else{if(window.opera&&n.innerHTML.substring(n.innerHTML.length-4)=="<BR>"){n.innerHTML=n.innerHTML+"&#160;"}var i=document.createRange();i.selectNodeContents(n);r.removeAllRanges();r.addRange(i)}}else if(document.getSelection){var r=document.getSelection();var i=document.createRange();i.selectNodeContents(n);r.removeAllRanges();r.addRange(i)}else if(document.selection){var i=document.body.createTextRange();i.moveToElementText(n);i.select()}};n.prototype._editableMouseDown=function(e){this.tableObj.selection.unselectCells();if(this.tableObj.hasFocus){e.stopPropagation()}};n.prototype._editableKeyUp=function(e){};n.prototype._editableKeyDown=function(e){var t=9;this._checkForEmptyEvent(e);if(this.obj[0]===this.tableObj.obj.find("tr:last td:last")[0]){if(t==e.keyCode&&!e.altKey&&!e.shiftKey&&!e.ctrlKey){this.tableObj.addRow(this.obj.parent().index()+1);this.tableObj.cells[this.tableObj.cells.length-1]._selectAll(this.wrapper.get(0));e.stopPropagation();return}}};n.prototype._checkForEmptyEvent=function(t){var n=e(this.wrapper),r=n.text();if(n.children().length>0){return}if(r===""){this.wrapper.text("");this.wrapper.get(0).blur();this.wrapper.get(0).focus()}};n.getContainer=function(t){if(e(t.firstChild).hasClass("aloha-table-cell-editable")){return t.firstChild}else{return t}};return n});define("table/table-selection",["aloha","jquery","table/table-plugin-utils","table/table-cell","ui/dialog","i18n!table/nls/i18n"],function(e,t,n,r,i,s){function a(e){return{top:e.top[0],right:e.right[0]+1,bottom:e.bottom[0]+1,left:e.left[0]}}function f(e,t,r){var i=true;if(-1!==n.indexOfAnyBut(t.top,t.top[0])||-1!==n.indexOfAnyBut(t.right,t.right[0])||-1!==n.indexOfAnyBut(t.bottom,t.bottom[0])||-1!==n.indexOfAnyBut(t.left,t.left[0])){i=false}else{var s=a(t);n.walkGridInsideRect(e,s,function(e){if(!r(e)){i=false;return false}})}return i}var o=function(e){this.table=e},u=function(e){return"string"===typeof e&&""!==t.trim(e)||e.nodeType&&(e.nodeType===document.TEXT_NODE&&""!==t.trim(e.data)||e.nodeType===document.ELEMENT_NODE)};o.prototype.selectionType=undefined;o.prototype.selectedCells=new Array;o.prototype.selectedColumnIdxs=new Array;o.prototype.selectedRowIdxs=new Array;o.prototype.cellSelectionMode=false;o.prototype.baseCellPosition=null;o.prototype.lastSelectionRange=null;o.prototype.selectColumns=function(e){this.unselectCells();var r=this.table.getRows();r.shift();var i=n.makeGrid(r);for(var s=0;s<e.length;s++){if(-1!==t.inArray(e[s],this.selectedColumnIdxs)){continue}this.selectedColumnIdxs.push(e[s]);for(var o=0;o<i.length;o++){var u=i[o][e[s]];if(n.containsDomCell(u)){t(u.cell).addClass(this.table.get("classCellSelected"));this.selectedCells.push(u.cell)}}}this.selectionType="column"};o.prototype.selectRows=function(e){this.unselectCells();var n=this.table.getRows();e.sort(function(e,t){return e-t});for(var r=0;r<e.length;r++){if(n[e[r]]){for(var i=0;i<this.selectedRowIdxs.length;i++){if(e[r]==this.selectedRowIdxs[i]){return}}this.selectedRowIdxs.push(e[r]);for(var s=1;s<n[e[r]].cells.length;s++){this.selectedCells.push(n[e[r]].cells[s]);t(n[e[r]].cells[s]).addClass(this.table.get("classCellSelected"))}}}this.selectionType="row"};o.prototype.selectAll=function(){var e=t.map(this.table.getRows(),function(e,t){return t});e.shift();this.selectRows(e)};o.prototype.notifyCellsSelected=function(){e.trigger("aloha-table-selection-changed")};o.prototype._notifyCellsUnselected=function(){e.trigger("aloha-table-selection-changed")};o.prototype.isHeader=function(){if(this.selectedCells.length==0){return false}for(var e=0;e<this.selectedCells.length;e++){if(!this.selectedCells[e]||this.selectedCells[e].nodeName.toLowerCase()!="th"){return false}}return true};o.prototype.unselectCells=function(){var e;if(this.cellSelectionMode){return}if(this.selectedCells.length>0){e=this.table.getRows();for(var n=0;n<e.length;n++){for(var r=1;r<e[n].cells.length;r++){t(e[n].cells[r]).removeClass(this.table.get("classCellSelected"))}}this.selectedCells=new Array;this.selectedColumnIdxs=new Array;this.selectedRowIdxs=new Array;this.selectionType="cell";this._notifyCellsUnselected()}};o.prototype.selectionIndex=function(e){for(var t=0;t<this.selectedCells.length;t++){if(this.selectedCells[t]===e){return t}}return-1};o.prototype.mergeCells=function(){var o=this.selectedCells;if(0===o.length){return}var l=function(e){return-1!=t.inArray(e.cell,o)};var c=n.makeGrid(this.table.getRows());var h=n.makeContour(c,l);if(!f(c,h,l)){i.alert({title:s.t("Table"),text:s.t("table.mergeCells.notRectangular")});return}var p=a(h);var d=t(c[p.top][p.left].cell);var v=t(r.getContainer(d.get(0)));n.walkGridInsideRect(c,p,function(e,n,i){if(n-e.spannedX===p.left&&i-e.spannedY===p.top){return}var s=e.cell;var o=t(r.getContainer(s)).contents();for(var a=0;a<o.length;a++){if(u(o[a])){v.append(" ");v.append(o);break}}t(s).remove()});d.attr({rowspan:p.bottom-p.top,colspan:p.right-p.left});this.selectedCells=[d.get(0)];this.cellSelectionMode=false;this.baseCellPosition=null;this.lastSelectionRange=null;this.selectionType="cell";e.trigger("aloha-table-selection-changed")};o.prototype.splitCells=function(){var r=this;var i=this.selectedCells;if(i.length>0){t(i).each(function(){n.splitCell(this,function(){return r.table.newActiveCell().obj})});this.cellSelectionMode=false;this.baseCellPosition=null;this.lastSelectionRange=null;this.selectionType="cell";e.trigger("aloha-table-selection-changed")}};o.prototype.cellsAreMergeable=function(){var e=this.selectedCells;if(e.length<2){return false}var r=function(n){return-1!=t.inArray(n.cell,e)};var i=n.makeGrid(this.table.getRows());var s=n.makeContour(i,r);if(!f(i,s,r)){return false}else{return true}};o.prototype.cellsAreSplitable=function(){var e=0;if(this.selectedCells.length>0){t(this.selectedCells).each(function(){var t=this;var r=n.colspan(t);var i=n.rowspan(t);if(r>1||i>1){e++}});if(e>0){return true}else{return false}}else{return false}};return o});define("table/table",["aloha","jquery","ui/scopes","ui/dialog","i18n!table/nls/i18n","table/table-cell","table/table-selection","table/table-plugin-utils","util/html","util/dom2"],function(e,t,n,r,i,s,o,u,a,f){function h(e){if(e.jquery){e=e[0]}var t,n=[],r;for(t=0;t<e.childNodes.length;t++){r=e.childNodes[t];n.push(r);if(r.nodeType===1){n=n.concat(h(r))}}return n}function p(e,n){var r;if("first"===e){r=t("[contenteditable]",n).first()[0].firstChild;if(l===r){r=t("*",n).first()[0].firstChild}}else if("last"===e){r=h(t("td:last",n)).reverse()[0]}return r}function v(e){var n=e.obj,r,i,s,o=e.getRows(),a=o.length,f,l,c,h=0,p=[a],d,v;for(r=0;r<a;r++){s=t(o[r]);f=s.children("td, th");l=f.length;c=u.cellIndexToGridColumn(o,r,l-1)+1;v=parseInt(f.last().attr("colspan"),10);if(v==0){}else if(!isNaN(v)){if(v==1){f.last().removeAttr("colspan")}c+=v-1}rowSpan=parseInt(f.last().attr("rowspan"),10);if(rowSpan>1){for(i=1;i<rowSpan-1;i++){if(v>1){p[r+i]+=v}else{p[r+i]+=1}}}p[r]+=c;if(p[r]>h){h=p[r]}}for(r=0;r<a;r++){d=h-p[r];if(d>0){t(o[r]).append((new Array(d+1)).join("<td></td>"))}}}function m(e,n,r,i){var s;var o=false;for(var u=0;u<r.length;u++){i.showItem(r[u].name)}i.setActiveItem();for(var u=0;u<n.length;u++){if(t(e[0]).hasClass(n[u].cssClass)){o=true;s=n[u].name;break}}t(e).each(function(e){if(!t(this).hasClass(s)){o=false}});if(o){i.setActiveItem(s)}}function g(e,t){var n=-1;var r=null;if("before"===e){r=t.selectedCells[0]}else if("after"===e){var i=t.selectedCells.length-1;r=t.selectedCells[i]}if(r&&r.nodeType==1){n=r.parentNode.rowIndex}return n}var l=void 0;var c=window.GENTICS;var d=function(e,n){this.obj=t(e);v(this);if(!this.obj.attr("id")){this.obj.attr("id",c.Utils.guid())}this.tablePlugin=n;this.selection=new o(this);this.refresh()};t.extend(d.prototype,{obj:l,tableWrapper:l,cells:l,numRows:l,numCols:l,isActive:false,hasFocus:false,parentEditable:l,mousedown:false,clickedColumnId:-1,clickedRowId:-1,columnsToSelect:[],rowsToSelect:[],fmPluginId:l});d.prototype.refresh=function(){this.numCols=this.countVirtualCols();var e=this.getRows();this.numRows=e.length;this.cells=[];for(var n=0;n<e.length;n++){var r=t(e[n]);var i=r.children();for(var s=0;s<i.length;s++){var o=i[s];var u=this.newCell(o)}}};d.prototype.countVirtualCols=function(){var e=this.obj.children().children("tr:first-child").children();return e.length-e.filter("."+this.get("classLeftUpperCorner")).length};d.prototype.get=function(e){return this.tablePlugin.get(e)};d.prototype.set=function(e,t){this.tablePlugin.set(e,t)};d.prototype.activate=function(){function o(e){return!a.isUnrenderedNode(e)}function u(e){var t=e.startOffset;var n=e.startContainer;if(0===t){return true}if(1===n.nodeType){return!a.findNodeRight(n.childNodes[t-1],o)}if(3===n.nodeType){return a.isWSPorZWSPText(n.data.substr(0,t))}return false}function h(e){var t=e.startOffset;var n=e.startContainer;if(f.nodeLength(n)===t){return true}if(1===n.nodeType){return!a.findNodeLeft(n.childNodes[t-1],o)}if(3===n.nodeType){return a.isWSPorZWSPText(n.data.substr(t))}return false}if(this.isActive){return}var n=this,r,i,s;this.obj.addClass(this.get("className"));this.obj.contentEditable(false);if(this.obj.attr("id")==""){this.obj.attr("id",c.Utils.guid())}this.selection.selectionType=l;s=this.obj.children("tbody");if(s.length===0){s=this.obj}s.bind("keydown",function(e){if(!e.ctrlKey&&!e.shiftKey){if(n.selection.selectedCells.length>0&&n.selection.selectedCells[0].length>0){n.selection.selectedCells[0][0].firstChild.focus()}}});e.bind("aloha-command-will-execute",function(t,r){var i=e.getSelection().getRangeAt(0);var s;if("forwarddelete"===r.commandId){if(!i.collapsed||!h(i)){return}var l=i.commonAncestorContainer;if(3===l.nodeType){s=l.parentNode&&a.findNodeLeft(l.parentNode.nextSibling,o)}else if(1===l.nodeType){s=a.findNodeLeft(l.nextSibling,o)}if(s===n.tableWrapper){r.preventDefault=true;e.getSelection().collapse(p("first",n.obj),0)}}else if("delete"===r.commandId){if(!i.collapsed||!u(i)){return}var l=i.commonAncestorContainer;if(3===l.nodeType){s=l.parentNode&&a.findNodeRight(l.parentNode.previousSibling,o)}else if(1===l.nodeType){s=a.findNodeRight(l.previousSibling,o)}if(s===n.tableWrapper){var c=p("last",n.obj);r.preventDefault=true;e.getSelection().collapse(c,f.nodeLength(c))}}});s.delegate("td","mousemove",function(e){var r=t(this);var i=3;if(t(this).hasClass("aloha-table-selectrow")||t(this).closest("tr").hasClass("aloha-table-selectcolumn"))return;var s=function(t){return e.pageX-t.offset().left<i};var o=function(t){return e.pageY-t.offset().top<i};var u=function(t){var n=t.closest("tr");if(n.next("tr").length>0){return false}var r=e.pageY-(n.offset().top+n.outerHeight());return r>i*-1&&r<i};var a=n.tablePlugin.colResize;var f=n.tablePlugin.rowResize;if(a&&s(r)){r.css("cursor","col-resize");return n.attachColumnResize(r)}else if(f&&o(r)){r.css("cursor","row-resize");return n.attachRowResize(r)}else if(f&&u(r)){r.css("cursor","row-resize");return n.attachRowResize(r,true)}else{r.css("cursor","default");return n.detachRowColResize(r)}});s.bind("mousemove",function(e){var r=t(this).closest("table");var i=function(t){var n=e.pageX-(t.offset().left+t.outerWidth());return n>-5&&n<5};var s=n.tablePlugin.tableResize;if(s&&i(r)){return n.attachTableResizeWidth(r)}});s.bind("mousedown",function(e){if(!n.hasFocus){n.focus()}e.stopPropagation();e.preventDefault();return false});i=t('<div class="'+this.get("classTableWrapper")+'" data-block-skip-scope="true"></div>');i.contentEditable(false);this.obj.wrap(i);var d=this.obj.parent();if(d.alohaBlock){d.alohaBlock()}r=this.obj.parents("."+this.get("classTableWrapper"));r.get(0).onresizestart=function(e){return false};r.get(0).oncontrolselect=function(e){return false};r.get(0).ondragstart=function(e){return false};r.get(0).onmovestart=function(e){return false};this.tableWrapper=this.obj.parents("."+this.get("classTableWrapper")).get(0);t(this.cells).each(function(){this.activate()});this.attachSelectionColumn();this.attachSelectionRow();this.makeCaptionEditable();this.checkWai();this.isActive=true;e.trigger("aloha-table-activated")};d.prototype.makeCaptionEditable=function(){var e=this.obj.find("caption").eq(0);if(e){this.tablePlugin.makeCaptionEditable(e)}};d.prototype.checkWai=function(){var e=this.wai;if(!e){return}e.removeClass(this.get("waiGreen"));e.removeClass(this.get("waiRed"));if(t.trim(this.obj[0].summary)!=""){e.addClass(this.get("waiGreen"))}else{e.addClass(this.get("waiRed"))}};d.prototype.attachSelectionColumn=function(){var e=t("<td>"),n,r,i,s=this,o,u;e.html("");s=this;o=this.obj.context.rows;for(u=0;u<o.length;u++){i=t(o[u]);r=e.clone();r.addClass(this.get("classSelectionColumn"));r.css("width",this.get("selectionArea")+"px");i.prepend(r);n=u+1;this.attachRowSelectionEventsToCell(r)}};d.prototype.attachRowSelectionEventsToCell=function(e){var t=this;e.unbind("mousedown");e.unbind("mouseover");e.get(0).onselectstart=function(){return false};e.bind("mousedown",function(e){return t.rowSelectionMouseDown(e)});e.bind("mouseover",function(e){if(t.mousedown){return t.rowSelectionMouseOver(e)}})};d.prototype.rowSelectionMouseDown=function(e){this.focus();if(this.selection.selectedCells.length==0){this.rowsToSelect=[]}this.clickedRowId=e.currentTarget.parentNode.rowIndex;if(e.metaKey){var n=t.inArray(this.clickedRowId,this.rowsToSelect);if(n>=0){this.rowsToSelect.splice(n,1)}else{this.rowsToSelect.push(this.clickedRowId)}}else if(e.shiftKey){this.rowsToSelect.sort(function(e,t){return e-t});var r=this.rowsToSelect[0];var i=this.clickedRowId;if(r>i){r=i;i=this.rowsToSelect[0]}this.rowsToSelect=[];for(var s=r;s<=i;s++){this.rowsToSelect.push(s)}}else{this.rowsToSelect=[this.clickedRowId]}this.selectRows();e.preventDefault();e.stopPropagation();this.tablePlugin.summary.focus();return false};d.prototype.rowSelectionMouseOver=function(e){var n=e.currentTarget.parentNode.rowIndex,r,i,s,o;if(this.mousedown&&this.clickedRowId>=0){r=t.inArray(n,this.rowsToSelect);i=n<this.clickedRowId?n:this.clickedRowId;s=n<this.clickedRowId?this.clickedRowId:n;this.rowsToSelect=new Array;for(o=i;o<=s;o++){this.rowsToSelect.push(o)}this.selectRows();e.preventDefault();e.stopPropagation();return false}};d.prototype.attachSelectionRow=function(){var e=this;var n=t("<td>");n.html("");var r=0;for(var i=0;i<this.obj.context.rows.length;i++){var s=0;for(var o=0;o<this.obj.context.rows[i].cells.length;o++){var a=u.colspan(this.obj.context.rows[i].cells[o]);s+=a}if(r<s){r=s}}var f=t("<tr>");f.addClass(this.get("classSelectionRow"));f.css("height",this.get("selectionArea")+"px");for(var i=0;i<r;i++){var l=n.clone();if(i>0){this.attachColumnSelectEventsToCell(l)}else{var l=t("<td>").clone();l.addClass(this.get("classLeftUpperCorner"));var c=function(t){e.focus();e.selection.selectAll();e.tablePlugin.activeTable.selection.selectionType="cell";e.tablePlugin.updateFloatingMenuScope();e._removeCursorSelection();if(e.tablePlugin.settings.summaryinsidebar){e.tablePlugin.sidebar.open();e.tablePlugin.sidebarPanel.activate(e.obj);e.tablePlugin.sidebar.correctHeight()}try{e.tablePlugin.summary.focus();t.stopPropagation();t.preventDefault()}catch(t){}return false};this.wai=t("<div/>").width(25).height(12).click(c);l.append(this.wai)}f.append(l)}t(document).bind("mouseup",function(t){e.columnSelectionMouseUp(t)});this.obj.find("tr:first").before(f)};d.prototype.attachColumnSelectEventsToCell=function(e){var t=this;e.unbind("mousedown");e.unbind("mouseover");e.get(0).onselectstart=function(){return false};e.bind("mousedown",function(e){t.columnSelectionMouseDown(e)});e.bind("mouseover",function(e){t.columnSelectionMouseOver(e)})};d.prototype.columnSelectionMouseDown=function(e){this.focus();if(this.selection.selectedCells.length==0){this.columnsToSelect=[]}this.clickedColumnId=t(e.currentTarget.parentNode).children().index(e.currentTarget);if(e.metaKey){var n=t.inArray(this.clickedColumnId,this.columnsToSelect);if(n>=0){this.columnsToSelect.splice(n,1)}else{this.columnsToSelect.push(this.clickedColumnId)}}else if(e.shiftKey){this.columnsToSelect.sort(function(e,t){return e-t});var r=this.columnsToSelect[0];var i=this.clickedColumnId;if(r>i){r=i;i=this.columnsToSelect[0]}this.columnsToSelect=[];for(var s=r;s<=i;s++){this.columnsToSelect.push(s)}}else{this.columnsToSelect=[this.clickedColumnId]}this.selectColumns();e.preventDefault();e.stopPropagation();return false};d.prototype.columnSelectionMouseOver=function(e){var t=e.currentTarget.cellIndex,n=[],r,i;if(this.mouseDownColIdx){r=t<this.mouseDownColIdx?t:this.mouseDownColIdx;i=t<this.mouseDownColIdx?this.mouseDownColIdx:t;for(var s=r;s<=i;s++){n.push(s)}this.selectColumns(n)}};d.prototype.columnSelectionMouseUp=function(e){this.mouseDownColIdx=false};d.prototype.deleteRows=function(){var e=[],n={},s=this;if(0===this.selection.selectedCells.length){return}for(var o=0;o<this.selection.selectedCells.length;o++){n[this.selection.selectedCells[o].parentNode.rowIndex]=true}for(rowId in n){e.push(rowId)}var a=false;if(e.length==this.numRows){a=true}if(a){var f=this;r.confirm({title:i.t("Table"),text:i.t("deletetable.confirm"),yes:function(){f.deleteTable()}})}else{e.sort(function(e,t){return e-t});var l=e[0];if(l>this.numRows-e.length){l--}var c=this.getRows();t.each(e,function(e,t){var n=c[t];for(var r=0;r<n.cells.length;r++){u.splitCell(n.cells[r],function(){return s.newActiveCell().obj})}});var h=u.makeGrid(c);t.each(e,function(e,n){var r=h[n];for(var i=0;i<r.length;){var s=r[i];var o=u.rowspan(s.cell);if(1<o){t(s.cell).attr("rowspan",o-1)}i+=s.colspan}t(c[n]).remove()});this.numRows-=e.length;window.setTimeout(function(){var e=t(c[1].cells[l+1]);e.focus()},5);this.selection.unselectCells()}};d.prototype.deleteColumns=function(){var e=[],n=[],s=this.getRows(),o=this,a=[],f,l;var c=u.makeGrid(s);var h=1;if(this.selection.selectedColumnIdxs.length==c[0].length-h){r.confirm({title:i.t("Table"),text:i.t("deletetable.confirm"),yes:function(){o.deleteTable()}})}else{e.sort(function(e,t){return e-t});var p=this.selection.selectedColumnIdxs.sort(function(e,t){return t-e});for(var d=0;d<p.length;d++){var v=p[d];for(var m=0;m<s.length;m++){var l=c[m][v];if(!l){continue}if(0===l.spannedX){if(1<l.colspan){var g=this.newActiveCell().obj;t(l.cell).after(g);g.attr("rowspan",l.rowspan);g.attr("colspan",l.colspan-1)}t(l.cell).remove()}else{t(l.cell).attr("colspan",l.colspan-1)}m+=l.rowspan-1}c=u.makeGrid(s)}this.numCols-=e.length;window.setTimeout(function(){var e=t(s[1].cells[1]);e.focus()},5);this.selection.unselectCells()}};d.prototype.deleteTable=function(){var t=-1;for(var n=0;n<this.tablePlugin.TableRegistry.length;n++){if(this.tablePlugin.TableRegistry[n].obj.attr("id")==this.obj.attr("id")){t=n;break}}if(t>=0){this.deactivate();this.selection.selectionType=l;this.tablePlugin.TableRegistry.splice(n,1);var r=e.Selection.rangeObject;r.endContainer=this.obj.get(0).parentNode;r.startContainer=r.endContainer;r.endOffset=c.Utils.Dom.getIndexInParent(this.obj.get(0));r.startOffset=r.endOffset;r.clearCaches();this.obj.remove();this.parentEditable.obj.focus();r.correctRange();r.select()}};d.prototype.addRowBeforeSelection=function(e){var t=g("before",this.selection);if(-1!==t){this.addRow(t)}};d.prototype.addRowAfterSelection=function(){var e=g("after",this.selection);if(-1!==e){this.addRow(e+1)}};d.prototype.addRow=function(e){var n=this;var r=1;var i=this.countVirtualCols();var s=this.obj.children().children("tr");for(var o=0;o<r;o++){var a=t("<tr>");var f=t("<td>");f.addClass(this.get("classSelectionColumn"));this.attachRowSelectionEventsToCell(f);a.append(f);var l=u.makeGrid(s);var c=1;if(e>=l.length){for(var h=c;h<l[0].length;h++){a.append(this.newActiveCell().obj)}}else{for(var h=c;h<l[e].length;){var p=l[e][h];if(u.containsDomCell(p)){var d=p.colspan;while(d--){a.append(this.newActiveCell().obj)}}else{t(p.cell).attr("rowspan",p.rowspan+1)}h+=p.colspan}}if(e>=s.length){s.eq(s.length-1).after(a)}else{s.eq(e).before(a)}}this.numRows+=r};d.prototype.addColumnsRight=function(){this.addColumns("right")};d.prototype.addColumnsLeft=function(){this.addColumns("left")};d.prototype.addColumns=function(e){var n=this,s=t("<td>"),o=this.getRows(),a,f,l=[],c=this.selection.selectedColumnIdxs;if(0===c.length){return}c.sort(function(e,t){return e-t});if(!u.isConsecutive(c)){r.alert({title:i.t("Table"),text:i.t("table.addColumns.nonConsecutive")});return}if("left"===e){f=c[0];for(var h=0;h<this.selection.selectedColumnIdxs.length;h++){this.selection.selectedColumnIdxs[h]+=1}}else{f=c[c.length-1]}var p=u.makeGrid(o);for(var h=0;h<o.length;h++){a=s.clone();a.html("");if(h==0){this.attachColumnSelectEventsToCell(a)}else{cellObj=this.newActiveCell(a.get(0));a=cellObj.obj}var d=u.leftDomCell(p,h,f);if(null==d){t(o[h]).prepend(a)}else{if("left"===e&&u.containsDomCell(p[h][f])){t(d).before(a)}else{t(d).after(a)}}this.numCols++}};d.prototype.focus=function(){if(!this.hasFocus){if(!this.parentEditable.isActive){this.parentEditable.obj.focus()}this.tablePlugin.setFocusedTable(this)}};d.prototype.focusOut=function(){if(this.hasFocus){this.tablePlugin.setFocusedTable(l);this.selection.selectionType=l}};d.prototype._removeCursorSelection=function(){var n=e.getSelection();if(!n||!n._nativeSelection||n._nativeSelection._ranges.length==0){return}var r=n.getRangeAt(0);if(null==r.startContainer){return}if(0!==t(r.startContainer).closest("table").length){return}if(0===this.selection.selectedCells.length){return}var i=s.getContainer(this.selection.selectedCells[0]);t(i).focus()};d.prototype.selectColumns=function(e){var t;if(e){t=e}else{t=this.columnsToSelect}n.setScope(this.tablePlugin.name+".column");this.selection.selectColumns(t);this.tablePlugin._columnheaderButton.setState(this.selection.isHeader());m(this.selection.selectedCells,this.tablePlugin.columnConfig,this.tablePlugin.columnMSItems,this.tablePlugin.columnMSButton);this.obj.find("div.aloha-ui-table-cell-editable").blur();this.selection.notifyCellsSelected();this._removeCursorSelection()};d.prototype.selectRows=function(){n.setScope(this.tablePlugin.name+".row");this.selection.selectRows(this.rowsToSelect);this.tablePlugin._rowheaderButton.setState(this.selection.isHeader());m(this.selection.selectedCells,this.tablePlugin.rowConfig,this.tablePlugin.rowMSItems,this.tablePlugin.rowMSButton);this.obj.find("div.aloha-ui-table-cell-editable").blur();this.selection.notifyCellsSelected();this._removeCursorSelection()};d.prototype.deactivate=function(){var e=this.obj.parent();if(e.mahaloBlock){e.mahaloBlock()}this.obj.removeClass(this.get("className"));if(t.trim(this.obj.attr("class"))==""){this.obj.removeAttr("class")}this.obj.removeAttr("contenteditable");if(this.obj.parents("."+this.get("classTableWrapper")).length){this.obj.unwrap()}this.obj.find("tr."+this.get("classSelectionRow")+":first").remove();var n=this;t.each(this.obj.context.rows,function(){t(this).children("td."+n.get("classSelectionColumn")).remove()});this.obj.find("td, th").removeClass(this.get("classCellSelected"));this.obj.find("td, th").removeClass("aloha-table-cell_active");this.obj.find("td, th").css("cursor","");this.obj.unbind();this.obj.children("tbody").unbind();for(var r=0;r<this.cells.length;r++){var i=this.cells[r];i.deactivate()}this.obj.find("caption div").each(function(){t(this).contents().unwrap()});this.isActive=false};d.prototype.attachColumnResize=function(e){var n=this;n.detachRowColResize(e);var r=e.closest("tbody").children("tr");var i=e.closest("tr");var s=u.cellIndexToGridColumn(r,r.index(i),i.children().index(e));var o=function(e){var n,i;u.walkCells(r,function(o,a,f,l,c){var h=t(t(r[o]).children()[a]);if(h.hasClass("aloha-table-selectrow")||h.closest("tr").hasClass("aloha-table-selectcolumn")||l>1){return true}if(f===s){if(!i){i=h.width()-e}u.resizeCellWidth(h,i)}else if(f===s-1){if(!n){n=h.width()+e}u.resizeCellWidth(h,n)}return true})};e.bind("mousedown.resize",function(){var i=t("<div></div>");i.css({height:t(e).closest("tbody").innerHeight(),width:t(e).outerWidth()-t(e).innerWidth(),top:t(e).closest("tbody").offset().top,left:t(e).offset().left,position:"absolute","background-color":"#80B5F2"});t("body").append(i);u.getCellResizeBoundaries(s,r,function(r,s){n.selection.resizeMode=true;t("body").bind("mousemove.dnd_col_resize",function(e){if(e.pageX>s&&e.pageX<r){i.css("left",e.pageX)}});t("body").bind("mouseup.dnd_col_resize",function(u){var a=0;if(u.pageX<s){a=s-e.offset().left}else if(u.pageX>s&&u.pageX<r){a=u.pageX-e.offset().left}else if(u.pageX>r){a=r-e.offset().left}if(a!==0){o(a)}t("body").unbind("mousemove.dnd_col_resize");t("body").unbind("mouseup.dnd_col_resize");n.selection.resizeMode=false;i.remove()})})})};d.prototype.attachRowResize=function(e,n){var r=this;r.detachRowColResize(e);var i=function(t){var r;if(n){r=e.closest("tr")}else{r=e.closest("tr").prev("tr")}var i=r.height();var s=i+t;if(s<0){s=1}r.css("height",s)};e.bind("mousedown.resize",function(){var s=t("<div></div>");var o=function(){if(n){return e.offset().top+e.outerHeight()}else{return e.offset().top}};s.css({width:e.closest("tbody").innerWidth(),height:e.outerHeight()-e.innerHeight(),top:o(),left:e.closest("tbody").offset().left,position:"absolute","background-color":"#80B5F2"});t("body").append(s);var u=function(){if(n){return e.closest("tr").offset().top}else{return e.closest("tr").prev("tr").offset().top}};r.selection.resizeMode=true;t("body").bind("mousemove.dnd_row_resize",function(e){if(e.pageY>u()){s.css("top",e.pageY)}});t("body").bind("mouseup.dnd_row_resize",function(o){var u=0;if(n){u=o.pageY-(e.offset().top+e.outerHeight())}else{u=o.pageY-e.offset().top}i(u);t("body").unbind("mousemove.dnd_row_resize");t("body").unbind("mouseup.dnd_row_resize");r.selection.resizeMode=false;s.remove()})})};d.prototype.attachTableResizeWidth=function(e){var n=this;var r=e.closest(".aloha-table-wrapper");var i=e.find("tr:not(.aloha-table-selectcolumn) td:last-child");var s;t.each(i,function(){if(!t(this).attr("colspan")||t(this).attr("colspan")<2){s=t(this);return false}});i.css("cursor","col-resize");var o=function(n){var r=e.find("tr");var i=s.closest("tr");var o=u.cellIndexToGridColumn(r,r.index(i),i.children().index(s));var a=n-u.getCellBorder(s)-u.getCellPadding(s);u.walkCells(r,function(e,n,i,s,f){var l=t(t(r[e]).children()[n]);if(l.hasClass("aloha-table-selectrow")||l.closest("tr").hasClass("aloha-table-selectcolumn")||s>1){return true}if(i===o){u.resizeCellWidth(l,a)}else{u.resizeCellWidth(l,l.width())}return true})};i.bind("mousedown.resize",function(){var a=t("<div></div>");a.css({height:e.children("tbody").innerHeight(),width:s.outerWidth()-s.innerWidth(),top:e.find("tbody").offset().top,left:e.offset().left+e.outerWidth(),position:"absolute","background-color":"#80B5F2"});t("body").append(a);var f=r.offset().left+r.width();var l=s.offset().left+(s.innerWidth()-s.width())+u.getMinColWidth(s);n.selection.resizeMode=true;t("body").bind("mousemove.dnd_col_resize",function(e){if(e.pageX>l&&e.pageX<f){a.css("left",e.pageX)}});t("body").bind("mouseup.dnd_col_resize",function(e){var r=0;if(e.pageX<=l){r=l-s.offset().left}else if(e.pageX>l&&e.pageX<f){r=e.pageX-s.offset().left}else if(e.pageX>f){r=f-s.offset().left}o(r);t("body").unbind("mousemove.dnd_col_resize");t("body").unbind("mouseup.dnd_col_resize");i.unbind("mousedown.resize");i.css("cursor","default");n.selection.resizeMode=false;a.remove()})})};d.prototype.detachRowColResize=function(e){return e.unbind("mousedown.resize")};d.prototype.toString=function(){return"Table"};d.prototype.newCell=function(e){return new s(e,this)};d.prototype.newActiveCell=function(e){var t=new s(e,this);t.activate();return t};d.prototype.getRows=function(){var e=this.obj.get(0).rows;return t.makeArray(e)};return d});define("table/table-plugin",["aloha","jquery","aloha/plugin","aloha/pluginmanager","ui/ui","ui/scopes","ui/button","ui/toggleButton","ui/dialog","ui/port-helper-attribute-field","ui/port-helper-multi-split","i18n!table/nls/i18n","i18n!aloha/nls/i18n","table/table-create-layer","table/table","table/table-plugin-utils","util/dom","aloha/console"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){function E(e){return 0<e.parents(".aloha-editable table").length}function S(e){var t;var n;var r=e.parents();for(t=0;t<r.length;t++){n=r.eq(t);if(n.is(".aloha-editable")){return false}if(n.is(".aloha-block")){return true}}return false}function x(e){return b.Utils.Dom.isEditable(e)}function T(e){var t=e.is("table")?"table":"table table";if(e.find(t).length){g.warn("Table Plugin","Nested tables found. They will not be initialized.");return true}return false}function N(t){var n=y(t);var r=x(t)&&!E(n)&&!S(n);if(r){var i=new d(t,w);var s=y(m.getEditingHostOf(t));i.parentEditable=e.getEditableById(s.attr("id"));w.TableRegistry.push(i);T(n);if(e.activeEditable===i.parentEditable){i.activate()}return i}return null}function C(n,r){var i,s,o=n.selection.isHeader(),u,a,f;for(i=0;i<n.selection.selectedCells.length;i++){u=n.selection.selectedCells[i];for(s=0;s<n.cells.length;s++){if(u===n.cells[s].obj[0]){cell=n.cells[s];break}}if(o){f=e.Markup.transformDomObject(u,"td").removeAttr("scope").get(0)}else{f=e.Markup.transformDomObject(u,"th").attr("scope",r).get(0)}if(cell!=null){cell.obj[0]=f;cell.deactivate();cell.activate()}t(n.selection.selectedCells[i]).bind("mousedown",function(e){var n=t(this).children("div").eq(0);window.setTimeout(function(){n.trigger("focus")},1)})}}function k(e,n,r){var i=true;for(var s=0;s<r.length;s++){if(t(r[s]).attr("class").indexOf(n)<0){i=false;break}}if(!i){for(var s=0;s<r.length;s++){t(r[s]).addClass(n);for(var o=0;o<e.length;o++){if(e[o].cssClass!=n){t(r[s]).removeClass(e[o].cssClass)}}}}else{for(var s=0;s<r.length;s++){t(r[s]).removeClass(n)}}}function A(){var e=[],n=L;t.each(arguments,function(){e.push("."+(this==""?n:n+"-"+this))});return t.trim(e.join(" "))}function O(){var e=[],n=L;t.each(arguments,function(){e.push(this==""?n:n+"-"+this)});return t.trim(e.join(" "))}function M(e,n){var r=e.endContainer,i=e.startContainer,s=r.nodeType==3?r.length:r.childNodes.length;if(i.nodeType==3&&i.parentNode.tagName=="P"&&i.parentNode.childNodes.length==1&&/^(\s|%A0)$/.test(escape(i.data))){i.data="";e.startOffset=0;if(r==i){e.endOffset=0}}if(!b.Utils.Dom.allowsNesting(i.nodeType==3?i.parentNode:i,n)){if(e.startOffset==0){t(i.nodeType==3?i.parentNode:i).addClass("aloha-table-cleanme")}if(e.endOffset==s){t(r.nodeType==3?r.parentNode:r).addClass("aloha-table-cleanme")}}}function _(){var e=t(".aloha-table-cleanme").removeClass("aloha-table-cleanme");for(var n=0;n<e.length;n++){if(t.trim(t(e[n]).html())==""&&!b.Utils.Dom.isEditingHost(e[n])){t(e[n]).remove()}}}var y=t;var b=window.GENTICS;var w=new n("table");w.createLayer=undefined;w.config=["table"];w.TableRegistry=new Array;w.activeTable=undefined;w.parameters={className:"aloha-table",classSelectionRow:"aloha-table-selectcolumn",classSelectionColumn:"aloha-table-selectrow",classLeftUpperCorner:"aloha-table-leftuppercorner",classTableWrapper:"aloha-table-wrapper",classCellSelected:"aloha-cell-selected",waiRed:"aloha-wai-red",waiGreen:"aloha-wai-green",selectionArea:10};w.checkConfig=function(e){if(typeof e=="object"&&e.length){var t=[];for(var n=0;n<e.length;n++){if(e[n]){t.push({name:e[n].name,text:e[n].text?e[n].text:e[n].name,tooltip:e[n].tooltip?e[n].tooltip:e[n].text,iconClass:e[n].iconClass?e[n].iconClass:"aloha-icon-"+e[n].name,cssClass:e[n].cssClass?e[n].cssClass:e[n].name})}}e=t}else{e=[]}return e};w.init=function(){var n=this,r={};this.tableConfig=this.checkConfig(this.tableConfig||this.settings.tableConfig);this.columnConfig=this.checkConfig(this.columnConfig||this.settings.columnConfig);this.rowConfig=this.checkConfig(this.rowConfig||this.settings.rowConfig);this.cellConfig=this.checkConfig(this.cellConfig||this.settings.cellConfig);this.tableResize=this.settings.tableResize===undefined?false:this.settings.tableResize;this.colResize=this.settings.colResize===undefined?false:this.settings.colResize;this.rowResize=this.settings.rowResize===undefined?false:this.settings.rowResize;if(t.browser.msie&&parseInt(t.browser.version,10)<8){this.tableResize=false;this.colResize=false;this.rowResize=false}this.createLayer=new p(this);e.bind("aloha-editable-created",function(e,i){var s=n.getEditableConfig(i.obj);r[i.getId()]=-1!==t.inArray("table",s);i.obj.bind("mousedown",function(e){w.setFocusedTable(undefined)});i.obj.find("table").each(function(e,t){N(t)})});this.initTableButtons();e.bind("aloha-table-selection-changed",function(){if(typeof w.activeTable!=="undefined"&&w.activeTable.selection){w.updateFloatingMenuScope();if(w.activeTable.selection.cellsAreSplitable()){n._splitcellsButton.enable(true);n._splitcellsRowButton.enable(true);n._splitcellsColumnButton.enable(true)}else{n._splitcellsButton.enable(false);n._splitcellsRowButton.enable(false);n._splitcellsColumnButton.enable(false)}if(w.activeTable.selection.cellsAreMergeable()){n._mergecellsButton.enable(true);n._mergecellsRowButton.enable(true);n._mergecellsColumnButton.enable(true)}else{n._mergecellsButton.enable(false);n._mergecellsRowButton.enable(false);n._mergecellsColumnButton.enable(false)}}});e.bind("aloha-selection-changed",function(t,i){if(!i.startContainer||!e.activeEditable){return}if(r[e.activeEditable.getId()]&&e.Selection.mayInsertTag("table")){n._createTableButton.show()}else{n._createTableButton.hide()}if(!n.activeTable){return}var s=i.findMarkup(function(){return this.nodeName==="TABLE"},e.activeEditable.obj);if(s){w.updateFloatingMenuScope();w.setActiveCellStyle()}else{n.activeTable.selection.cellSelectionMode=false;n.activeTable.selection.baseCellPosition=null;n.activeTable.selection.lastSelectionRange=null;n.activeTable.focusOut()}});e.bind("aloha-editable-activated",function(e,r){n._splitcellsButton.enable(false);n._mergecellsButton.enable(false);n._splitcellsRowButton.enable(false);n._mergecellsRowButton.enable(false);n._splitcellsColumnButton.enable(false);n._mergecellsColumnButton.enable(false);r.editable.obj.find("table").each(function(){var e=w.TableRegistry;for(var n=0;n<e.length;n++){if(e[n].obj.attr("id")===t(this).attr("id")){e[n].activate();return true}}N(this)})});e.bind("aloha-editable-deactivated",function(){if(w.activeTable){w.activeTable.selection.unselectCells()}w.setFocusedTable(undefined);var e=w.TableRegistry;for(var t=0;t<e.length;t++){e[t].deactivate()}});e.bind("aloha-smart-content-changed",function(){if(e.activeEditable){e.activeEditable.obj.find("table").each(function(){if(w.indexOfTableInRegistry(this)==-1){if(N(this)){this.id=b.Utils.guid()}}})}});if(this.settings.summaryinsidebar){e.bind("aloha-plugins-loaded",function(){n.initSidebar(e.Sidebar.right.show())})}};var L="aloha-table";w.initSidebar=function(e){var n=this;n.sidebar=e;n.sidebarPanel=e.addPanel({id:O("sidebar-panel"),title:c.t("table.sidebar.title"),content:"",expanded:true,activeOn:"table",onInit:function(){var e=this,r=this.setContent('<label class="'+O("label")+'" for="'+O("textarea")+'" >'+c.t("table.label.target")+"</label>"+'<textarea id="'+O("textarea")+'" class="'+O("textarea")+'" />').content;t(A("textarea")).live("keyup",function(){t(e.effective).attr("summary",t(A("textarea")).val());var r=t('div[class*="wai"]',"table#"+t(e.effective).attr("id"));r.removeClass(n.get("waiGreen"));r.removeClass(n.get("waiRed"));if(t(A("textarea")).val().trim()!=""){r.addClass(n.get("waiGreen"))}else{r.addClass(n.get("waiRed"))}})},onActivate:function(e){var n=this;n.effective=e;t(A("textarea")).val(t(n.effective).attr("summary"))}});e.show()};w.isEditableTable=function(e){return b.Utils.Dom.isEditable(e)};w.indexOfTableInRegistry=function(e){var t=this.TableRegistry;for(var n=0;n<t.length;n++){if(t[n].obj[0].id==e.id){return n}}return-1};w.getTableFromRegistry=function(e){var t=this.indexOfTableInRegistry(e);if(t>-1){return this.TableRegistry[t]}return null};w.isSelectionInTable=function(){var n=e.Selection.getRangeObject();var r=t(n.commonAncestorContainer);if(r.length==0){return false}if(r.parents(".aloha-editable table").length){return true}return false};w.preventNestedTables=function(){if(this.isSelectionInTable()){a.alert({title:c.t("Table"),text:c.t("table.createTable.nestedTablesNoSupported")});return true}return false};w.initMergeSplitCellsBtns=function(){this._mergecellsButton=i.adopt("mergecells",o,{tooltip:c.t("button.mergecells.tooltip"),icon:"aloha-icon aloha-icon-mergecells",scope:this.name+".cell",click:function(){if(w.activeTable){w.activeTable.selection.mergeCells()}}});this._splitcellsButton=i.adopt("splitcells",o,{tooltip:c.t("button.splitcells.tooltip"),icon:"aloha-icon aloha-icon-splitcells",scope:this.name+".cell",click:function(){var t;if(w.activeTable){if(w.activeTable.selection.selectedCells.length>0){w.activeTable.selection.splitCells()}else{t=w.selectedOrActiveCells();if(t.length>0){v.splitCell(t,function(){return w.activeTable.newActiveCell().obj});e.trigger("aloha-table-selection-changed")}}}}});this._mergecellsRowButton=i.adopt("mergecellsRow",o,{tooltip:c.t("button.mergecells.tooltip"),icon:"aloha-icon aloha-icon-mergecells",scope:this.name+".row",click:function(){if(w.activeTable){w.activeTable.selection.mergeCells()}}});this._splitcellsRowButton=i.adopt("splitcellsRow",o,{tooltip:c.t("button.splitcells.tooltip"),icon:"aloha-icon aloha-icon-splitcells",scope:this.name+".row",click:function(){if(w.activeTable){w.activeTable.selection.splitCells()}}});this._mergecellsColumnButton=i.adopt("mergecellsColumn",o,{tooltip:c.t("button.mergecells.tooltip"),icon:"aloha-icon aloha-icon-mergecells",scope:this.name+".column",click:function(){if(w.activeTable){w.activeTable.selection.mergeCells()}}});this._splitcellsColumnButton=i.adopt("splitcellsColumn",o,{tooltip:c.t("button.splitcells.tooltip"),icon:"aloha-icon aloha-icon-splitcells",scope:this.name+".column",click:function(){if(w.activeTable){w.activeTable.selection.splitCells()}}})};w.initNaturalFitBtn=function(){var e=this;if(this.colResize||this.rowResize){this._tableNaturalFitButton=i.adopt("naturalFit",o,{tooltip:c.t("button.naturalfit.tooltip"),icon:"aloha-icon aloha-icon-table-naturalfit",scope:this.name+".cell",click:function(){if(e.activeTable){var n=e.activeTable.obj;n.find("td, th").each(function(){t(this).find("div").css("width","");t(this).css("width","")});n.find("tr").each(function(){t(this).css("height","")})}}})}};w.initRowsBtns=function(){var e=this;this._addrowbeforeButton=i.adopt("addrowbefore",o,{tooltip:c.t("button.addrowbefore.tooltip"),icon:"aloha-icon aloha-icon-addrowbefore",scope:this.name+".row",click:function(){if(e.activeTable){e.activeTable.addRowBeforeSelection()}}});this._addrowafterButton=i.adopt("addrowafter",o,{tooltip:c.t("button.addrowafter.tooltip"),icon:"aloha-icon aloha-icon-addrowafter",scope:this.name+".row",click:function(){if(e.activeTable){e.activeTable.addRowAfterSelection()}}});this._deleterowsButton=i.adopt("deleterows",o,{tooltip:c.t("button.delrows.tooltip"),icon:"aloha-icon aloha-icon-deleterows",scope:this.name+".row",click:function(){if(e.activeTable){var t=e.activeTable;a.confirm({title:c.t("Table"),text:c.t("deleterows.confirm"),yes:function(){t.deleteRows()}})}}});this._rowheaderButton=i.adopt("rowheader",u,{tooltip:c.t("button.rowheader.tooltip"),icon:"aloha-icon aloha-icon-rowheader",scope:this.name+".row",click:function(){if(e.activeTable){e.activeTable.refresh();C(e.activeTable,"column");e.activeTable.selection.unselectCells();e.activeTable.selection.selectRows(e.activeTable.selection.selectedRowIdxs)}}});this.rowMSItems=[];t.each(this.rowConfig,function(t,n){e.rowMSItems.push({name:n.name,text:c.t(n.text),tooltip:c.t(n.tooltip),iconClass:"aloha-icon aloha-row-layout "+n.iconClass,click:function(){if(e.activeTable){k(e.rowConfig,n.cssClass,e.activeTable.selection.selectedCells);e.activeTable.selectRows()}}})});if(this.rowMSItems.length>0){this.rowMSItems.push({name:"removeFormat",text:c.t("button.removeFormat.text"),tooltip:c.t("button.removeFormat.tooltip"),cls:"aloha-ui-multisplit-fullwidth",wide:true,click:function(){if(e.activeTable){var n=e.activeTable.selection.selectedCells;for(var r=0;r<n.length;r++){for(var i=0;i<e.rowConfig.length;i++){t(n[r]).removeClass(e.rowConfig[i].cssClass)}}e.activeTable.selectRows()}}})}this.rowMSButton=l({items:this.rowMSItems,name:"formatRow",hideIfEmpty:true,scope:this.name+".row"})};w.initColumnBtns=function(){var e=this;this._addcolumnleftButton=i.adopt("addcolumnleft",o,{tooltip:c.t("button.addcolleft.tooltip"),icon:"aloha-icon aloha-icon-addcolumnleft",scope:this.name+".column",click:function(){if(e.activeTable){e.activeTable.addColumnsLeft()}}});this._addcolumnrightButton=i.adopt("addcolumnright",o,{tooltip:c.t("button.addcolright.tooltip"),icon:"aloha-icon aloha-icon-addcolumnright",scope:this.name+".column",click:function(){if(e.activeTable){e.activeTable.addColumnsRight()}}});this._deletecolumnsButton=i.adopt("deletecolumns",o,{tooltip:c.t("button.delcols.tooltip"),icon:"aloha-icon aloha-icon-deletecolumns",scope:this.name+".column",click:function(){if(e.activeTable){var t=e.activeTable;a.confirm({title:c.t("Table"),text:c.t("deletecolumns.confirm"),yes:function(){t.deleteColumns()}})}}});this._columnheaderButton=i.adopt("columnheader",u,{tooltip:c.t("button.columnheader.tooltip"),icon:"aloha-icon aloha-icon-columnheader",scope:this.name+".column",click:function(){if(e.activeTable){e.activeTable.refresh();C(e.activeTable,"row");e.activeTable.selection.unselectCells();e.activeTable.selection.selectColumns(e.activeTable.selection.selectedColumnIdxs)}}});this.columnMSItems=[];t.each(this.columnConfig,function(t,n){var r={name:n.name,text:c.t(n.text),tooltip:c.t(n.tooltip),iconClass:"aloha-icon aloha-column-layout "+n.iconClass,click:function(t,r,i){if(e.activeTable){k(e.columnConfig,n.cssClass,e.activeTable.selection.selectedCells);e.activeTable.selectColumns()}}};e.columnMSItems.push(r)});if(this.columnMSItems.length>0){this.columnMSItems.push({name:"removeFormat",text:c.t("button.removeFormat.text"),tooltip:c.t("button.removeFormat.tooltip"),cls:"aloha-ui-multisplit-fullwidth",wide:true,click:function(){if(e.activeTable){var n=e.activeTable.selection.selectedCells;for(var r=0;r<n.length;r++){for(var i=0;i<e.columnConfig.length;i++){t(n[r]).removeClass(e.columnConfig[i].cssClass)}}e.activeTable.selectColumns()}}})}this.columnMSButton=l({items:this.columnMSItems,name:"formatColumn",hideIfEmpty:true,scope:this.name+".column"})};w.initCellBtns=function(){var e=this;this.cellMSItems=[];t.each(this.cellConfig,function(t,n){var r={name:n.name,text:c.t(n.text),tooltip:c.t(n.tooltip),iconClass:"aloha-icon aloha-column-layout "+n.iconClass,click:function(t,r,i){if(e.activeTable){k(e.cellConfig,n.cssClass,e.selectedOrActiveCells());e.setActiveCellStyle()}}};e.cellMSItems.push(r)});if(this.cellMSItems.length>0){this.cellMSItems.push({name:"removeFormat",text:c.t("button.removeFormat.text"),tooltip:c.t("button.removeFormat.tooltip"),cls:"aloha-ui-multisplit-fullwidth",wide:true,click:function(){if(e.activeTable){var n=e.selectedOrActiveCells();for(var r=0;r<n.length;r++){for(var i=0;i<e.cellConfig.length;i++){t(n[r]).removeClass(e.cellConfig[i].cssClass)}}e.setActiveCellStyle()}}})}this.cellMSButton=l({items:this.cellMSItems,name:"formatCell",hideIfEmpty:true,scope:this.name+".cell"})};w.initTableButtons=function(){var n=this;s.createScope(this.name+".row","Aloha.continuoustext");s.createScope(this.name+".column","Aloha.continuoustext");s.createScope(this.name+".cell","Aloha.continuoustext");this._createTableButton=i.adopt("createTable",o,{tooltip:c.t("button.createtable.tooltip"),icon:"aloha-icon aloha-icon-createTable",scope:"Aloha.continuoustext",click:function(){w.createDialog(this.element)}});this.initColumnBtns();this.initRowsBtns();this.initCellBtns();this.initMergeSplitCellsBtns();this.initNaturalFitBtn();this.tableMSItems=[];var r=this.tableConfig;t.each(r,function(e,t){n.tableMSItems.push({name:t.name,text:c.t(t.text),tooltip:c.t(t.tooltip),iconClass:"aloha-icon aloha-table-layout "+t.iconClass,click:function(){if(n.activeTable){if(!n.activeTable.obj.hasClass(t.cssClass)){for(var e=0;e<r.length;e++){n.activeTable.obj.removeClass(r[e].cssClass)}n.activeTable.obj.addClass(t.cssClass);n.tableMSButton.setActiveItem(t.cssClass)}else{for(var e=0;e<r.length;e++){n.activeTable.obj.removeClass(r[e].cssClass)}n.tableMSButton.setActiveItem()}}}})});if(this.tableMSItems.length>0){this.tableMSItems.push({name:"removeFormat",text:c.t("button.removeFormat.text"),tooltip:c.t("button.removeFormat.tooltip"),cls:"aloha-ui-multisplit-fullwidth",wide:true,click:function(){if(n.activeTable){for(var e=0;e<r.length;e++){n.activeTable.obj.removeClass(n.tableConfig[e].cssClass)}n.tableMSButton.setActiveItem()}}})}this.tableMSButton=l({items:this.tableMSItems,name:"formatTable",hideIfEmpty:true,scope:this.name+".cell"});this._tableCaptionButton=i.adopt("tableCaption",u,{tooltip:c.t("button.caption.tooltip"),icon:"aloha-icon aloha-icon-table-caption",scope:this.name+".cell",click:function(){if(n.activeTable){if(n.activeTable.obj.children("caption").is("caption")){n.activeTable.obj.children("caption").remove()}else{var r=c.t("empty.caption");var i=t("<caption></caption>");n.activeTable.obj.prepend(i);n.makeCaptionEditable(i,r);var s=i.find("div").eq(0);var o=s.contents().eq(0);if(o.length>0){var u=new b.Utils.RangeObject;u.startContainer=u.endContainer=o.get(0);u.startOffset=0;u.endOffset=o.text().length;n.activeTable.obj.find("div.aloha-table-cell-editable").blur();s.focus();u.select();e.Selection.updateSelection()}}}}});this.summary=f({width:275,name:"tableSummary",noTargetHighlight:true,scope:this.name+".cell"});this.summary.addListener("keyup",function(e){if(n.activeTable){n.activeTable.checkWai()}})};w.makeCaptionEditable=function(e,n){var r=this;var i=e.children("div");if(i.length===0){i=t("<div></div>");t(i).addClass("aloha-ui");t(i).addClass("aloha-editable-caption");if(e.contents().length>0){i.append(e.contents());e.append(i)}else{if(n){i.text(n)}e.append(i)}}else if(i.length>1){e.children("div:not(:first-child)").each(function(){$this=t(this);i.eq(0).append($this.contents());$this.remove()});i=i.eq(0)}i.contentEditable(true)};w.createDialog=function(e){this.createLayer.set("target",e);this.createLayer.show()};w.createTable=function(n,r){if(this.preventNestedTables()){return}if(e.activeEditable&&typeof e.activeEditable.obj!=="undefined"){var i=document.createElement("table");var s=i.id=b.Utils.guid();var o=document.createElement("tbody");for(var u=0;u<r;u++){var a=document.createElement("tr");for(var f=0;f<n;f++){var l=document.createTextNode("");var c=document.createElement("td");c.appendChild(l);a.appendChild(c)}o.appendChild(a)}i.appendChild(o);M(e.Selection.getRangeObject(),i);b.Utils.Dom.insertIntoDOM(t(i),e.Selection.getRangeObject(),e.activeEditable.obj);_();var h=document.getElementById(s);var p=N(h);if(p){if(y.browser.msie){window.setTimeout(function(){p.cells[0].wrapper.get(0).focus()},20)}else{p.cells[0].wrapper.get(0).focus()}}p.focus();w.activeTable.selection.selectionType="cell";w.updateFloatingMenuScope()}else{this.error("There is no active Editable where the table can be				inserted!")}};w.setFocusedTable=function(e){var t=this;if(null==e&&null!=this.activeTable){this.activeTable.selection.unselectCells()}for(var n=0;n<w.TableRegistry.length;n++){w.TableRegistry[n].hasFocus=false}if(typeof e!="undefined"){this.summary.setTargetObject(e.obj,"summary");if(e.obj.children("caption").is("caption")){this._tableCaptionButton.setState(true);var r=e.obj.children("caption");t.makeCaptionEditable(r)}e.hasFocus=true}w.activeTable=e;for(var n=0;n<this.tableMSItems.length;n++){this.tableMSButton.showItem(this.tableMSItems[n].name)}this.tableMSButton.setActiveItem();if(this.activeTable){for(var n=0;n<this.tableConfig.length;n++){if(this.activeTable.obj.hasClass(this.tableConfig[n].cssClass)){this.tableMSButton.setActiveItem(this.tableConfig[n].name)}}}};w.error=function(t){e.Log.error(this,t)};w.debug=function(t){e.Log.debug(this,t)};w.info=function(t){e.Log.info(this,t)};w.log=function(t){e.log("log",this,t)};w.get=function(e){if(this.config[e]){return this.config[e]}if(this.parameters[e]){return this.parameters[e]}return undefined};w.set=function(e,t){if(this.config[e]){this.config[e]=t}else{this.parameters[e]=t}};w.makeClean=function(e){var n=this;e.find("table").each(function(){if(n.getTableFromRegistry(this)){(new d(this,n)).deactivate();t(this).attr("id",null)}})};w.toString=function(){return this.prefix};w.updateFloatingMenuScope=function(){if(null!=w.activeTable&&null!=w.activeTable.selection.selectionType){s.setScope(w.name+"."+w.activeTable.selection.selectionType)}};w.setActiveCellStyle=function(){var e=this;var n=false;var r;this.cellMSButton.setActiveItem();var i=e.selectedOrActiveCells();for(var s=0;s<e.cellConfig.length;s++){if(t(i[0]).hasClass(e.cellConfig[s].cssClass)){r=e.cellConfig[s].name;n=true;break}}t(i).each(function(e){if(!t(this).hasClass(r)){n=false}});if(n){this.cellMSButton.setActiveItem(r)}};w.selectedOrActiveCells=function(){var t=this;var n=this.activeTable.selection.selectedCells;if(!n||n.length<1){var r=function(){var t=e.Selection.getRangeObject();if(e.activeEditable){return t.findMarkup(function(){return this.nodeName.toLowerCase()==="td"},e.activeEditable.obj)}else{return null}};var i=r();return i?[i]:[]}else{return n}};r.register(w);return w});define("format/nls/i18n",{root:{"button.strong.tooltip":"Strong","button.em.tooltip":"Emphasize","button.b.tooltip":"Bold","button.i.tooltip":"Italic","button.u.tooltip":"Underline","button.cite.tooltip":"Cite","button.q.tooltip":"Tooltip","button.code.tooltip":"Code","button.abbr.tooltip":"Abbreviation","button.del.tooltip":"Strikethrough","button.s.tooltip":"Strikethrough","button.sub.tooltip":"Subscript","button.sup.tooltip":"Superscript","button.p.tooltip":"Paragraph","button.h1.tooltip":"Heading 1","button.h2.tooltip":"Heading 2","button.h3.tooltip":"Heading 3","button.h4.tooltip":"Heading 4","button.h5.tooltip":"Heading 5","button.h6.tooltip":"Heading 6","button.pre.tooltip":"Preformatted text","button.title.tooltip":"Title","button.removeFormat.tooltip":"Remove formatting","button.removeFormat.text":"Remove formatting",GENTICS_button_p:"GENTICS_button_p",GENTICS_button_h1:"GENTICS_button_h1",GENTICS_button_h2:"GENTICS_button_h2",GENTICS_button_h3:"GENTICS_button_h3",GENTICS_button_h4:"GENTICS_button_h4",GENTICS_button_h5:"GENTICS_button_h5",GENTICS_button_h6:"GENTICS_button_h6",GENTICS_button_pre:"GENTICS_button_pre",GENTICS_button_title:"GENTICS_button_title",formatBold:"Ctrl+b",formatItalic:"Ctrl+i",formatUnderline:"Ctrl+u",formatParagraph:"Alt+Ctrl+0",formatH1:"Alt+Ctrl+1",formatH2:"Alt+Ctrl+2",formatH3:"Alt+Ctrl+3",formatH4:"Alt+Ctrl+4",formatH5:"Alt+Ctrl+5",formatH6:"Alt+Ctrl+6",formatPre:"Alt+Ctrl+P",formatDel:"Ctrl+\\",formatSub:"Ctrl+,",formatSup:"Ctrl+.","floatingmenu.tab.format":"Format","format.class.legend":"CSS class","format.class.none":"none"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("format/format-plugin",["aloha","aloha/plugin","aloha/state-override","jquery","util/arrays","util/maps","ui/ui","ui/toggleButton","ui/port-helper-multi-split","PubSub","i18n!format/nls/i18n","i18n!aloha/nls/i18n","aloha/selection"],function(e,t,n,r,i,s,o,u,a,f,l,c){function b(e){var t=r(".aloha-cell-selected");if(t.length>0){var n=0;t.each(function(){var t=r(this).find("div"),i=t.find(e);if(i.length>0){i.contents().unwrap();n++}t.contents().wrap("<"+e+"></"+e+">")});if(n===t.length){t.find(e).contents().unwrap()}return true}return false}function w(e,t){if(b(t)){return false}e.addMarkup(t);return false}function E(t,n){if(b(n)){return false}t.changeMarkup(n);if(e.activeEditable&&r.browser.mozilla){e.activeEditable.obj.focus()}if(e.activeEditable){e.trigger("aloha-format-block")}}function S(e,t){var n=d[t];var r=n;if(v.hasOwnProperty(t)){r=v[t]}var i=o.adopt(r,u,{tooltip:l.t("button."+t+".tooltip"),icon:"aloha-icon aloha-icon-"+r,scope:"Aloha.continuoustext",click:function(){return w(e,t)}});return i}function x(e,t){return{name:t,tooltip:l.t("button."+t+".tooltip"),iconClass:"aloha-icon "+l.t("aloha-large-icon-"+t),markup:r("<"+t+">"),click:function(){return E(e,t)}}}function T(e,t){return{name:t,text:l.t("button."+t+".text"),tooltip:l.t("button."+t+".tooltip"),wide:true,cls:"aloha-ui-multisplit-fullwidth",click:function(){e.removeFormat()}}}function N(t){e.Selection.changeMarkupOnSelection(r("<"+t+">"))}function C(t,n){n.select();A(t,e.Selection.getRangeObject())}function k(e,t,n){h.Utils.Dom.addMarkup(t,n);C(e,t)}function L(t){var s=this;var o=r("<"+t+">");var u=e.Selection.rangeObject;if(typeof t==="undefined"||t==""){return}var a=y[o[0].nodeName]||[o[0].nodeName];var f=u.findMarkup(function(){return-1!==i.indexOf(a,this.nodeName)},e.activeEditable.obj);if(f){if(u.isCollapsed()){h.Utils.Dom.removeFromDOM(f,u,true)}else{h.Utils.Dom.removeMarkup(u,r(f),e.activeEditable.obj)}C(s,u)}else{if(u.isCollapsed()){h.Utils.Dom.extendToWord(u);if(u.isCollapsed()){if(n.enabled()){n.setWithRangeObject(d[t],u,function(e,t){k(s,t,o)});return}}}k(s,u,o)}}function A(t,n){var i,s,o,u,a;r.each(t.buttons,function(t,s){var a=false;var f=y[s.markup[0].nodeName]||[s.markup[0].nodeName];for(o=0;o<n.markupEffectiveAtStart.length;o++){i=n.markupEffectiveAtStart[o];for(u=0;u<f.length;u++){if(e.Selection.standardTextLevelSemanticsComparator(i,r("<"+f[u]+">"))){s.handle.setState(true);a=true}}}if(!a){s.handle.setState(false)}});if(t.multiSplitItems.length>0){s=false;for(o=0;o<n.markupEffectiveAtStart.length&&!s;o++){i=n.markupEffectiveAtStart[o];for(u=0;u<t.multiSplitItems.length&&!s;u++){a=t.multiSplitItems[u];if(!a.markup){continue}if(e.Selection.standardTextLevelSemanticsComparator(i,a.markup)){t.multiSplitButton.setActiveItem(a.name);s=true}}}if(!s){t.multiSplitButton.setActiveItem(null)}}}var h=window.GENTICS;var p="aloha-format";var d={b:"bold",strong:"bold",i:"italic",em:"italic",del:"strikethrough",sub:"subscript",sup:"superscript",u:"underline",s:"strikethrough"};var v={strong:"strong",em:"emphasis",s:"strikethrough2"};var m={u:true,em:true,strong:true,b:true,i:true,cite:true,q:true,code:true,abbr:true,del:true,s:true,sub:true,sup:true};var g={p:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,pre:true};var y={B:["STRONG","B"],I:["EM","I"],STRONG:["STRONG","B"],EM:["EM","I"]};return t.create("format",{config:["b","i","sub","sup","p","h1","h2","h3","h4","h5","h6","pre","removeFormat"],availableButtons:["u","strong","del","em","b","i","s","sub","sup","p","h1","h2","h3","h4","h5","h6","pre","removeFormat"],hotKey:{formatBold:"ctrl+b",formatItalic:"ctrl+i",formatParagraph:"alt+ctrl+0",formatH1:"alt+ctrl+1",formatH2:"alt+ctrl+2",formatH3:"alt+ctrl+3",formatH4:"alt+ctrl+4",formatH5:"alt+ctrl+5",formatH6:"alt+ctrl+6",formatPre:"ctrl+p",formatDel:"ctrl+d",formatSub:"alt+shift+s",formatSup:"ctrl+shift+s"},init:function(){var t=this;if(typeof this.settings.hotKey!=="undefined"){r.extend(true,this.hotKey,this.settings.hotKey)}this.initButtons();e.bind("aloha-plugins-loaded",function(){t.initSidebar(e.Sidebar.right)});e.bind("aloha-editable-activated",function(e,n){t.applyButtonConfig(n.editable.obj);n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatBold,function(){t.addMarkup("b");return false});n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatItalic,function(){t.addMarkup("i");return false});n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatParagraph,function(){t.changeMarkup("p");return false});n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatH1,function(){t.changeMarkup("h1");return false});n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatH2,function(){t.changeMarkup("h2");return false});n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatH3,function(){t.changeMarkup("h3");return false});n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatH4,function(){t.changeMarkup("h4");return false});n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatH5,function(){t.changeMarkup("h5");return false});n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatH6,function(){t.changeMarkup("h6");return false});n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatPre,function(){t.changeMarkup("pre");return false});n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatDel,function(){t.addMarkup("del");return false});n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatSub,function(){t.addMarkup("sub");return false});n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatSup,function(){t.addMarkup("sup");return false})});e.bind("aloha-editable-deactivated",function(e,t){t.editable.obj.unbind("keydown.aloha.format")})},applyButtonConfig:function(e){var t=this.getEditableConfig(e),n,i,s;if(typeof t==="object"){var o=[];r.each(t,function(e,t){if(!(typeof e==="number"&&typeof t==="string")){o.push(e)}});if(o.length>0){t=o}}this.formatOptions=t;for(n in this.buttons){if(this.buttons.hasOwnProperty(n)){if(r.inArray(n,t)!==-1){this.buttons[n].handle.show()}else{this.buttons[n].handle.hide()}}}s=this.multiSplitItems.length;for(i=0;i<s;i++){if(r.inArray(this.multiSplitItems[i].name,t)!==-1){this.multiSplitButton.showItem(this.multiSplitItems[i].name)}else{this.multiSplitButton.hideItem(this.multiSplitItems[i].name)}}},initButtons:function(){var t=this;this.buttons={};this.multiSplitItems=[];r.each(this.availableButtons,function(n,i){var s=false;if(typeof n!=="number"&&typeof i!=="string"){s=i;i=n}if(m[i]){t.buttons[i]={handle:S(t,i),markup:r("<"+i+">",{"class":s||""})}}else if(g[i]){t.multiSplitItems.push(x(t,i))}else if("removeFormat"===i){t.multiSplitItems.push(T(t,i))}else{e.log("warn",t,'Button "'+i+'" is not defined')}});this.multiSplitButton=a({name:"formatBlock",items:this.multiSplitItems,hideIfEmpty:true,scope:"Aloha.continuoustext"});f.sub("aloha.selection.context-change",function(e){A(t,e.range)})},initSidebar:function(e){var t=this;t.sidebar=e;e.addPanel({id:t.nsClass("sidebar-panel-class"),title:l.t("floatingmenu.tab.format"),content:"",expanded:true,activeOn:this.formatOptions||false,onInit:function(){},onActivate:function(e){var n=this;n.effective=e;if(!e[0]){return}n.format=e[0].nodeName.toLowerCase();var i=r("<div>").attr("class",t.nsClass("target-container"));var s=r("<fieldset>");s.append(r("<legend>"+n.format+" "+l.t("format.class.legend")).append(r("<select>")));i.append(s);var o='<div class="'+t.nsClass("target-container")+'"><fieldset><legend>'+l.t("format.class.legend")+'</legend><select name="targetGroup" class="'+t.nsClass("radioTarget")+'">'+'<option value="">'+l.t("format.class.none")+"</option>";if(t.config[n.format]&&t.config[n.format]["class"]){r.each(t.config[n.format]["class"],function(e,t){o+='<option value="'+e+'" >'+t+"</option>"})}o+="</select></fieldset></div>";var n=this,u=this.setContent(o).content;r(t.nsSel("framename")).live("keyup",function(){r(n.effective).attr("target",r(this).val().replace('"',"&quot;").replace("'","&#39;"))});var n=this;n.effective=e;r(t.nsSel("linkTitle")).val(r(n.effective).attr("title"))}});e.show()},nsClass:function(){var e=[],t=p;r.each(arguments,function(){e.push(this==""?t:t+"-"+this)});return r.trim(e.join(" "))},nsSel:function(){var e=[],t=p;r.each(arguments,function(){e.push("."+(this==""?t:t+"-"+this))});return r.trim(e.join(" "))},addMarkup:L,changeMarkup:N,removeFormat:function(){var t=["u","strong","em","b","i","q","del","s","code","sub","sup","p","h1","h2","h3","h4","h5","h6","pre","quote","blockquote"],n=e.Selection.rangeObject,i;if(this.settings.removeFormats){t=this.settings.removeFormats}if(n.isCollapsed()){return}for(i=0;i<t.length;i++){h.Utils.Dom.removeMarkup(n,r("<"+t[i]+">"),e.activeEditable.obj)}n.select()},toString:function(){return"format"}})});define("list/nls/i18n",{root:{"button.createulist.tooltip":"Insert Unordered List","button.createolist.tooltip":"Insert Ordered List","button.indentlist.tooltip":"Indent List","button.outdentlist.tooltip":"Outdent List","floatingmenu.tab.list":"Lists"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("list/list-plugin",["aloha","jquery","aloha/plugin","ui/ui","ui/scopes","ui/button","ui/toggleButton","i18n!list/nls/i18n","i18n!aloha/nls/i18n","aloha/engine","PubSub"],function(e,t,n,r,s,o,u,a,f,l,c){function p(n,r){t(n).find(n.nodeName).each(function(){if(d(this)){e.Markup.transformDomObject(this,r,e.Selection.rangeObject)}});e.Markup.transformDomObject(n,r,e.Selection.rangeObject)}function d(t){var n=e.Selection.getSelectionTree();return v(n,t)}function v(e,n){var r=false;t.each(e,function(e,t){if(t.domobj===n&&t.selection!=="none"||v(t.children,n)){r=true}});return r}function g(n){if(8!=n.keyCode&&46!=n.keyCode){return false}var r=e.getSelection().getRangeAt(0);var i=r.startContainer;var s=t(i).closest("ul, ol");if(!s.length){return false}var o=s.parent().closest("ul, ol");if(!o.length){return false}var u=e.getSelection().getAllRanges();var a=false;o.each(function(){a=a||y(t(this))});if(a){e.getSelection().setRanges(u);for(var f=0;f<u.length;f++){u[f].detach()}}return a}function y(n){var r=false;n.children("ul, ol").each(function(){e.Log.debug("performing list-nesting cleanup");if(!t(this).prev("li").append(this).length){t(this).parent().prepend(document.createElement("li")).append(this)}r=true});return r}var h=window.GENTICS;var m=n.create("list",{config:["ul","ol"],transformableElements:{p:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,ul:true,ol:true},init:function(){var n=this;this._orderedListButton=r.adopt("orderedList",u,{tooltip:a.t("button.createolist.tooltip"),icon:"aloha-icon aloha-icon-orderedlist",scope:"Aloha.continuoustext",click:function(){n.transformList(true)}});this._unorderedListButton=r.adopt("unorderedList",u,{tooltip:a.t("button.createulist.tooltip"),icon:"aloha-icon aloha-icon-unorderedlist",scope:"Aloha.continuoustext",click:function(){n.transformList(false)}});this._indentListButton=r.adopt("indentList",o,{tooltip:a.t("button.indentlist.tooltip"),icon:"aloha-icon aloha-icon-indent",scope:"Aloha.continuoustext",click:function(){n.indentList()}});this._outdentListButton=r.adopt("outdentList",o,{tooltip:a.t("button.outdentlist.tooltip"),icon:"aloha-icon aloha-icon-outdent",scope:"Aloha.continuoustext",click:function(){n.outdentList()}});s.createScope("Aloha.List","Aloha.continuoustext");c.sub("aloha.selection.context-change",function(r){var i,s,o=r.range;n._outdentListButton.show(false);n._indentListButton.show(false);n._unorderedListButton.setState(false);n._orderedListButton.setState(false);for(i=0;i<o.markupEffectiveAtStart.length;i++){s=o.markupEffectiveAtStart[i];if(e.Selection.standardTagNameComparator(s,t("<ul></ul>"))){n._unorderedListButton.setState(true);n._outdentListButton.show(true);n._indentListButton.show(true);break}if(e.Selection.standardTagNameComparator(s,t("<ol></ol>"))){n._orderedListButton.setState(true);n._outdentListButton.show(true);n._indentListButton.show(true);break}}if(e.activeEditable){n.applyButtonConfig(e.activeEditable.obj)}});e.Markup.addKeyHandler(9,function(e){return n.processTab(e)})},applyButtonConfig:function(n){var r=this.getEditableConfig(n);if(e.Selection.rangeObject.unmodifiableMarkupAtStart[0]){if(t.inArray("ul",r)!=-1&&e.Selection.canTag1WrapTag2(e.Selection.rangeObject.unmodifiableMarkupAtStart[0].nodeName,"ul")!=-1){this._unorderedListButton.show(true)}else{this._unorderedListButton.show(false)}if(t.inArray("ol",r)!=-1&&e.Selection.canTag1WrapTag2(e.Selection.rangeObject.unmodifiableMarkupAtStart[0].nodeName,"ol")!=-1){this._orderedListButton.show(true)}else{this._orderedListButton.show(false)}}},processTab:function(e){if(e.keyCode===9){if(e.shiftKey){return this.outdentList()}else{return this.indentList()}}return true},getStartingDomObjectToTransform:function(){var t=e.Selection.rangeObject,n,r;for(n=0;n<t.markupEffectiveAtStart.length;n++){r=t.markupEffectiveAtStart[n];if(this.transformableElements[r.nodeName.toLowerCase()]){return r}}return false},getNearestSelectedListItem:function(){var t=e.Selection.rangeObject,n,r;for(n=0;n<t.markupEffectiveAtStart.length;n++){r=t.markupEffectiveAtStart[n];if(h.Utils.Dom.isListElement(r)){return r}}return false},transformList:function(n){var r=this.getStartingDomObjectToTransform(),i,s,o,u,a,f,c,d,v;this._outdentListButton.show(true);this._indentListButton.show(true);if(!r){e.Selection.changeMarkupOnSelection(t("<p></p>"));r=this.getStartingDomObjectToTransform();if(!r){if(e.Selection.rangeObject.startContainer.contentEditable){u=n?t("<ol></ol>"):t("<ul></ul>");o=t("<li></li>");u.append(o);var m=o.get(0);var g=e.getActiveEditable().obj;m.appendChild(document.createTextNode(""));g.append(u);g.focus();var y=e.createRange();var b=e.getSelection();y.setStart(m.firstChild,0);y.setEnd(m.firstChild,0);b.removeAllRanges();b.addRange(y);e.Selection.updateSelection();return}else{e.Log.error(this,"Could not transform selection into a list");return}}}v=r.nodeName.toLowerCase();if(v=="ul"&&!n){u=t(r);f=u.parent();if(f.length>0&&h.Utils.Dom.isListElement(f.get(0))){if(f.get(0).nodeName.toLowerCase()==="li"){f.after(u.children());u.remove()}else{u.children().unwrap()}}else{d=t(r);t.each(d.children("li"),function(t,n){c=e.Markup.transformDomObject(n,"p",e.Selection.rangeObject);c.after(c.children("ol,ul"));l.ensureContainerEditable(c.get(0))});d.children().unwrap()}}else if(v=="ul"&&n){p(r,"ol");this.mergeAdjacentLists(t(r))}else if(v=="ol"&&!n){p(r,"ul");this.mergeAdjacentLists(t(r))}else if(v=="ol"&&n){u=t(r);f=u.parent();if(f.length>0&&h.Utils.Dom.isListElement(f.get(0))){if(f.get(0).nodeName.toLowerCase()==="li"){f.after(u.children());u.remove()}else{u.children().unwrap()}}else{d=t(r);t.each(d.children("li"),function(t,n){c=e.Markup.transformDomObject(n,"p",e.Selection.rangeObject);c.after(c.children("ol,ul"));l.ensureContainerEditable(c.get(0))});d.children().unwrap()}}else{a=e.Selection.rangeObject.getSelectedSiblings(r);u=n?t("<ol></ol>"):t("<ul></ul>");o=t("<li></li>");u.append(o);t(r).contents().appendTo(o);t(r).replaceWith(u);if(e.Selection.rangeObject.startContainer==r){e.Selection.rangeObject.startContainer=o.get(0)}if(e.Selection.rangeObject.endContainer==r){e.Selection.rangeObject.endContainer=o.get(0)}var w=o;if(a){i=false;for(s=0;s<a.length;++s){if(h.Utils.Dom.isBlockLevelElement(a[s])){if(i){i=false}o=e.Markup.transformDomObject(a[s],"li",e.Selection.rangeObject);u.append(o);w=o}else{if(a[s].nodeType==3&&t.trim(a[s].data).length===0){continue}if(!i){i=t("<li></li>");u.append(i);w=i}i.append(a[s])}}}this.mergeAdjacentLists(u);var m=w.get(0);if(h.Utils.Dom.isEmpty(m)){var y=e.createRange();var b=e.getSelection();m.appendChild(document.createTextNode(""));y.selectNodeContents(m.lastChild);b.removeAllRanges();b.addRange(y);e.Selection.updateSelection()}}this.refreshSelection()},indentList:function(){var n=this.getNearestSelectedListItem(),r,i,s,o,u;if(n){u=t(n).prev("li");if(u.length===0){return false}o=t(n).parent();s=e.Selection.rangeObject.getSelectedSiblings(n);i=t(n).parent().clone(false).empty();i.append(n);u.append(i);if(s){for(r=0;r<s.length;++r){i.append(t(s[r]))}}this.mergeAdjacentLists(i,true);this.refreshSelection();return false}return true},outdentList:function(){var n=this.getNearestSelectedListItem(),r,i,s,o,u,a,f,l;if(n){s=t(n);o=s.parent();u=o.parents("ul,ol");a=o.parent("li");if(u.length>0&&h.Utils.Dom.isListElement(u.get(0))){f=e.Selection.rangeObject.getSelectedSiblings(n);if(f&&f.length>0){l=t(f[f.length-1])}else{l=s}if(l.nextAll("li").length>0){i=o.clone(false).empty();i.append(l.nextAll());l.append(i)}if(a.length>0){a.after(s)}else{o.before(s)}if(f&&f.length>0){for(r=f.length-1;r>=0;--r){s.after(t(f[r]))}}if(o.contents("li").length===0){o.remove()}if(a.length>0&&a.contents().length===0){a.remove()}this.refreshSelection()}return false}return true},refreshSelection:function(){e.Selection.rangeObject.update();e.Selection.rangeObject.select();e.Selection.updateSelection()},mergeAdjacentLists:function(e,n){var r=e.get(0),i;while(r.previousSibling&&r.previousSibling.nodeType===1&&this.isMergable(r.previousSibling,r,n)){r=r.previousSibling}e=t(r);while(r.nextSibling&&(r.nextSibling.nodeType===1&&this.isMergable(r.nextSibling,r,n)||r.nextSibling.nodeType===3&&t.trim(r.nextSibling.data).length===0)){i=t(r.nextSibling);if(r.nextSibling.nodeType==1){i.contents().appendTo(e)}i.remove()}},isMergable:function(e,t,n){if(n){return e.nodeName.toLowerCase()=="ul"||e.nodeName.toLowerCase()=="ol"}else{return e.nodeName==t.nodeName}}});l.commands["insertorderedlist"]={action:function(t,n){m.transformList(true);if(n&&e.Selection.rangeObject){n.startContainer=e.Selection.rangeObject.startContainer;n.startOffset=e.Selection.rangeObject.startOffset;n.endContainer=e.Selection.rangeObject.endContainer;n.endOffset=e.Selection.rangeObject.endOffset}},indeterm:function(){},state:function(){for(i=0;i<rangeObject.markupEffectiveAtStart.length;i++){effectiveMarkup=rangeObject.markupEffectiveAtStart[i];if(e.Selection.standardTagNameComparator(effectiveMarkup,t("<ul></ul>"))){return false}if(e.Selection.standardTagNameComparator(effectiveMarkup,t("<ol></ol>"))){return true}}return false}};l.commands["insertunorderedlist"]={action:function(t,n){m.transformList(false);if(n&&e.Selection.rangeObject){n.startContainer=e.Selection.rangeObject.startContainer;n.startOffset=e.Selection.rangeObject.startOffset;n.endContainer=e.Selection.rangeObject.endContainer;n.endOffset=e.Selection.rangeObject.endOffset}},indeterm:function(){},state:function(){for(i=0;i<rangeObject.markupEffectiveAtStart.length;i++){effectiveMarkup=rangeObject.markupEffectiveAtStart[i];if(e.Selection.standardTagNameComparator(effectiveMarkup,t("<ul></ul>"))){return true}if(e.Selection.standardTagNameComparator(effectiveMarkup,t("<ol></ol>"))){return false}}return false}};l.commands["indent"]={action:function(t,n){m.indentList();if(n&&e.Selection.rangeObject){n.startContainer=e.Selection.rangeObject.startContainer;n.startOffset=e.Selection.rangeObject.startOffset;n.endContainer=e.Selection.rangeObject.endContainer;n.endOffset=e.Selection.rangeObject.endOffset}},indeterm:function(){},state:function(){return false}};l.commands["outdent"]={action:function(t,n){m.outdentList();if(n&&e.Selection.rangeObject){n.startContainer=e.Selection.rangeObject.startContainer;n.startOffset=e.Selection.rangeObject.startOffset;n.endContainer=e.Selection.rangeObject.endContainer;n.endOffset=e.Selection.rangeObject.endOffset}},indeterm:function(){},state:function(){return false}};return m});define("image/nls/i18n",{root:{"size.natural":"Original size","button.addimg.tooltip":"add image ref","floatingmenu.tab.img":"Image","floatingmenu.tab.formatting":"Formatting","floatingmenu.tab.resize":"Resize","floatingmenu.tab.crop":"Crop","button.uploadimg.tooltip":"Upload img","button.uploadimg.label":"Upload","button.img.align.left.tooltip":"Left align","button.img.align.right.tooltip":"Right Align","button.img.align.none.tooltip":"No alignment","field.img.title.label":"Title","field.img.title.tooltip":"Title","field.img.label":"URL","field.img.tooltip":"Source","border ":"Add Border to Image","padding.increase ":"Increase Padding","padding.decrease ":"Decrease Padding","size.increase ":"Increase Size","size.decrease ":"Decrease Size",Resize:"Resize",Crop:"Crop",Reset:"Reset",Accept:"Accept",Cancel:"Cancel",height:"Height",width:"Width","button.toggle.tooltip":"Toggle keep aspect ratio","field.img.src.label":"Source","field.img.src.tooltip":"Source"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("image/image-floatingMenu",["jquery","util/class","i18n!image/nls/i18n","i18n!aloha/nls/i18n","ui/ui","ui/scopes","ui/button","ui/toggleButton","ui/port-helper-attribute-field"],function(e,t,n,r,i,s,o,u,a){var f=e;var l=window.GENTICS;var c=window.Aloha;return t.extend({_constructor:function(){},init:function(e){e.floatingMenuControl=this;this.plugin=e;s.createScope(e.name,"Aloha.empty");this._addUIInsertButton();this._addUIMetaButtons();this._addUIResetButton();this._addUIAlignButtons();this._addUIMarginButtons();this._addUICropButtons();this._addUIResizeButtons();this._addUIAspectRatioToggleButton()},_addUIAspectRatioToggleButton:function(){var e=this.plugin;this._imageCnrRatioButton=i.adopt("imageCnrRatio",u,{tooltip:n.t("button.toggle.tooltip"),icon:"aloha-icon-cnr-ratio",scope:e.name,click:function(){e.toggleKeepAspectRatio()}});if(e.settings.fixedAspectRatio!==false){this._imageCnrRatioButton.setState(true);e.keepAspectRatio=true}},_addUIResetButton:function(){var e=this.plugin;this._imageCnrResetButton=i.adopt("imageCnrReset",o,{tooltip:n.t("Reset"),icon:"aloha-icon-cnr-reset",scope:e.name,click:function(){e.reset()}})},_addUIInsertButton:function(){var e=this.plugin;this._insertImageButton=i.adopt("insertImage",o,{tooltip:n.t("button.addimg.tooltip"),icon:"aloha-button aloha-image-insert",scope:"Aloha.continuoustext",click:function(){e.insertImg()}})},_addUIMetaButtons:function(){var e=this.plugin;this.imgSrcField=a({label:n.t("field.img.src.label"),labelClass:"aloha-image-input-label",tooltip:n.t("field.img.src.tooltip"),name:"imageSource",scope:e.name});this.imgSrcField.setTemplate("<span><b>{name}</b><br/>{url}</span>");this.imgSrcField.setObjectTypeFilter(e.objectTypeFilter);this.imgTitleField=a({label:n.t("field.img.title.label"),labelClass:"aloha-image-input-label",tooltip:n.t("field.img.title.tooltip"),name:"imageTitle",scope:e.name});this.imgTitleField.setObjectTypeFilter()},_addUIAlignButtons:function(){var t=this.plugin;this._imageAlignLeftButton=i.adopt("imageAlignLeft",o,{tooltip:n.t("button.img.align.left.tooltip"),icon:"aloha-img aloha-image-align-left",scope:t.name,click:function(){var n=e(t.getPluginFocus());n.add(n.parent()).css("float","left")}});this._imageAlignRightButton=i.adopt("imageAlignRight",o,{tooltip:n.t("button.img.align.right.tooltip"),icon:"aloha-img aloha-image-align-right",scope:t.name,click:function(){var n=e(t.getPluginFocus());n.add(n.parent()).css("float","right")}});this._imageAlignNoneButton=i.adopt("imageAlignNone",o,{tooltip:n.t("button.img.align.none.tooltip"),icon:"aloha-img aloha-image-align-none",scope:t.name,click:function(){var n=e(t.getPluginFocus());n.add(n.parent()).css({"float":"none",display:"inline-block"})}})},_addUIMarginButtons:function(){var t=this.plugin;this._imageIncPaddingButton=i.adopt("imageIncPadding",o,{tooltip:n.t("padding.increase"),icon:"aloha-img aloha-image-padding-increase",scope:t.name,click:function(){e(t.getPluginFocus()).increase("padding")}});this._imageDecPaddingButton=i.adopt("imageDecPadding",o,{tooltip:n.t("padding.decrease"),icon:"aloha-img aloha-image-padding-decrease",scope:t.name,click:function(){e(t.getPluginFocus()).decrease("padding")}})},_addUICropButtons:function(){var e=this.plugin;s.createScope("Aloha.img",["Aloha.global"]);this._imageCropButton=i.adopt("imageCropButton",u,{tooltip:n.t("Crop"),icon:"aloha-icon-cnr-crop",scope:e.name,click:function(){if(this.getState()){e.crop()}else{e.endCrop()}}})},_addUIResizeButtons:function(){var e=this.plugin;this.imgResizeHeightField=a({label:n.t("height"),labelClass:"aloha-image-input-label",name:"imageResizeHeight",width:50,scope:e.name});this.imgResizeHeightField.maxValue=e.settings.maxHeight;this.imgResizeHeightField.minValue=e.settings.minHeight;this.imgResizeWidthField=a({label:n.t("width"),labelClass:"aloha-image-input-label",name:"imageResizeWidth",width:50,scope:e.name});this.imgResizeWidthField.maxValue=e.settings.maxWidth;this.imgResizeWidthField.minValue=e.settings.minWidth},setScope:function(){s.setScope(this.plugin.name)},doLayout:function(){}})});define("image/vendor/jcrop/jquery.jcrop.min",["jquery"],function(e){(function(e){e.Jcrop=function(t,n){function B(e){return""+parseInt(e)+"px"}function j(e){return""+parseInt(e)+"%"}function F(e){return s.baseClass+"-"+e}function I(t){var n=e(t).offset();return[n.left,n.top]}function q(e){return[e.pageX-C[0],e.pageY-C[1]]}function R(e){if(e!=L){P.setCursor(e);L=e}}function U(e,t){C=I(u);P.setCursor(e=="move"?e:e+"-resize");if(e=="move")return P.activateHandlers(W(t),Q);var n=_.getFixed();var r=X(e);var i=_.getCorner(X(r));_.setPressed(_.getCorner(r));_.setCurrent(i);P.activateHandlers(z(e,n),Q)}function z(e,t){return function(n){if(!s.aspectRatio)switch(e){case"e":n[1]=t.y2;break;case"w":n[1]=t.y2;break;case"n":n[0]=t.x2;break;case"s":n[0]=t.x2;break}else switch(e){case"e":n[1]=t.y+1;break;case"w":n[1]=t.y+1;break;case"n":n[0]=t.x+1;break;case"s":n[0]=t.x+1;break}_.setCurrent(n);D.update()}}function W(e){var t=e;H.watchKeys();return function(e){_.moveOffset([e[0]-t[0],e[1]-t[1]]);t=e;D.update()}}function X(e){switch(e){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function V(e){return function(t){if(s.disabled)return false;if(e=="move"&&!s.allowMove)return false;k=true;U(e,q(t));t.stopPropagation();t.preventDefault();return false}}function J(e,t,n){var r=e.width(),i=e.height();if(r>t&&t>0){r=t;i=t/e.width()*e.height()}if(i>n&&n>0){i=n;r=n/e.height()*e.width()}x=e.width()/r;T=e.height()/i;e.width(r).height(i)}function K(e){return{x:parseInt(e.x*x),y:parseInt(e.y*T),x2:parseInt(e.x2*x),y2:parseInt(e.y2*T),w:parseInt(e.w*x),h:parseInt(e.h*T)}}function Q(e){var t=_.getFixed();if(t.w>s.minSelect[0]&&t.h>s.minSelect[1]){D.enableHandles();D.done()}else{D.release()}P.setCursor(s.allowSelect?"crosshair":"default")}function G(e){if(s.disabled)return false;if(!s.allowSelect)return false;k=true;C=I(u);D.disableHandles();R("crosshair");var t=q(e);_.setPressed(t);P.activateHandlers(Y,Q);H.watchKeys();D.update();e.stopPropagation();e.preventDefault();return false}function Y(e){_.setCurrent(e);D.update()}function Z(){var t=e("<div></div>").addClass(F("tracker"));e.browser.msie&&t.css({opacity:0,backgroundColor:"white"});return t}function et(e){function b(){window.setTimeout(y,f)}var t=e[0]/x,n=e[1]/T,r=e[2]/x,i=e[3]/T;if(O)return;var o=_.flipCoords(t,n,r,i);var u=_.getFixed();var a=initcr=[u.x,u.y,u.x2,u.y2];var f=s.animationDelay;var l=a[0];var c=a[1];var r=a[2];var i=a[3];var h=o[0]-initcr[0];var p=o[1]-initcr[1];var d=o[2]-initcr[2];var v=o[3]-initcr[3];var m=0;var g=s.swingSpeed;D.animMode(true);var y=function(){return function(){m+=(100-m)/g;a[0]=l+m/100*h;a[1]=c+m/100*p;a[2]=r+m/100*d;a[3]=i+m/100*v;if(m<100)b();else D.done();if(m>=99.8)m=100;nt(a)}}();b()}function tt(e){nt([e[0]/x,e[1]/T,e[2]/x,e[3]/T])}function nt(e){_.setPressed([e[0],e[1]]);_.setCurrent([e[2],e[3]]);D.update()}function rt(t){if(typeof t!="object")t={};s=e.extend(s,t);if(typeof s.onChange!=="function")s.onChange=function(){};if(typeof s.onSelect!=="function")s.onSelect=function(){}}function it(){return K(_.getFixed())}function st(){return _.getFixed()}function ot(e){rt(e);ct()}function ut(){s.disabled=true;D.disableHandles();D.setCursor("default");P.setCursor("default")}function at(){s.disabled=false;ct()}function ft(){D.done();P.activateHandlers(null,null)}function lt(){l.remove();o.show()}function ct(e){s.allowResize?e?D.enableOnly():D.enableHandles():D.disableHandles();P.setCursor(s.allowSelect?"crosshair":"default");D.setCursor(s.allowMove?"move":"default");l.css("backgroundColor",s.bgColor);if("setSelect"in s){tt(n.setSelect);D.done();delete s.setSelect}if("trueSize"in s){x=s.trueSize[0]/a;T=s.trueSize[1]/f}y=s.maxSize[0]||0;b=s.maxSize[1]||0;E=s.minSize[0]||0;S=s.minSize[1]||0;if("outerImage"in s){u.attr("src",s.outerImage);delete s.outerImage}D.refresh()}var t=t,n=n;if(typeof t!=="object")t=e(t)[0];if(typeof n!=="object")n={};if(!("trackDocument"in n)){n.trackDocument=e.browser.msie?false:true;if(e.browser.msie&&e.browser.version.split(".")[0]=="8")n.trackDocument=true}if(!("keySupport"in n))n.keySupport=e.browser.msie?false:true;var r={trackDocument:false,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,borderOpacity:.4,handleOpacity:.5,handlePad:5,handleSize:9,handleOffset:5,edgeMargin:14,aspectRatio:0,keySupport:true,cornerHandles:true,sideHandles:true,drawBorders:true,dragEdges:true,boxWidth:0,boxHeight:0,boundary:8,animationDelay:20,swingSpeed:3,allowSelect:true,allowMove:true,allowResize:true,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){}};var s=r;rt(n);var o=e(t);var u=o.clone().removeAttr("id").css({position:"absolute"});u.width(o.width());u.height(o.height());o.after(u).hide();J(u,s.boxWidth,s.boxHeight);var a=u.width(),f=u.height(),l=e("<div />").width(a).height(f).addClass(F("holder")).css({position:"relative",backgroundColor:s.bgColor}).insertAfter(o).append(u);if(s.addClass)l.addClass(s.addClass);var c=e("<img />").attr("src",u.attr("src")).css("position","absolute").width(a).height(f);var p=e("<div />").width(j(100)).height(j(100)).css({zIndex:310,position:"absolute",overflow:"hidden"}).append(c);var d=e("<div />").width(j(100)).height(j(100)).css("zIndex",320);var v=e("<div />").css({position:"absolute",zIndex:300}).insertBefore(u).append(p,d);var m=s.boundary;var g=Z().width(a+m*2).height(f+m*2).css({position:"absolute",top:B(-m),left:B(-m),zIndex:290}).mousedown(G);var y,b,E,S;var x,T,N=true;var C=I(u),k,L,A,O,M;var _=function(){function u(i){var i=m(i);n=e=i[0];r=t=i[1]}function l(e){var e=m(e);i=e[0]-n;o=e[1]-r;n=e[0];r=e[1]}function c(){return[i,o]}function p(i){var s=i[0],o=i[1];if(0>e+s)s-=s+e;if(0>t+o)o-=o+t;if(f<r+o)o+=f-(r+o);if(a<n+s)s+=a-(n+s);e+=s;n+=s;t+=o;r+=o}function d(e){var t=v();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function v(){if(!s.aspectRatio)return N();var i=s.aspectRatio,o=s.minSize[0]/x,u=s.minSize[1]/T,l=s.maxSize[0]/x,c=s.maxSize[1]/T,p=n-e,d=r-t,v=Math.abs(p),m=Math.abs(d),y=v/m,b,E;if(l==0){l=a*10}if(c==0){c=f*10}if(y<i){E=r;w=m*i;b=p<0?e-w:w+e;if(b<0){b=0;h=Math.abs((b-e)/i);E=d<0?t-h:h+t}else if(b>a){b=a;h=Math.abs((b-e)/i);E=d<0?t-h:h+t}}else{b=n;h=v/i;E=d<0?t-h:t+h;if(E<0){E=0;w=Math.abs((E-t)*i);b=p<0?e-w:w+e}else if(E>f){E=f;w=Math.abs(E-t)*i;b=p<0?e-w:w+e}}if(b>e){if(b-e<o){b=e+o}else if(b-e>l){b=e+l}if(E>t){E=t+(b-e)/i}else{E=t-(b-e)/i}}else if(b<e){if(e-b<o){b=e-o}else if(e-b>l){b=e-l}if(E>t){E=t+(e-b)/i}else{E=t-(e-b)/i}}if(b<0){e-=b;b=0}else if(b>a){e-=b-a;b=a}if(E<0){t-=E;E=0}else if(E>f){t-=E-f;E=f}return last=C(g(e,t,b,E))}function m(e){if(e[0]<0)e[0]=0;if(e[1]<0)e[1]=0;if(e[0]>a)e[0]=a;if(e[1]>f)e[1]=f;return[e[0],e[1]]}function g(e,t,n,r){var i=e,s=n,o=t,u=r;if(n<e){i=n;s=e}if(r<t){o=r;u=t}return[Math.round(i),Math.round(o),Math.round(s),Math.round(u)]}function N(){var i=n-e;var s=r-t;if(y&&Math.abs(i)>y)n=i>0?e+y:e-y;if(b&&Math.abs(s)>b)r=s>0?t+b:t-b;if(S&&Math.abs(s)<S)r=s>0?t+S:t-S;if(E&&Math.abs(i)<E)n=i>0?e+E:e-E;if(e<0){n-=e;e-=e}if(t<0){r-=t;t-=t}if(n<0){e-=n;n-=n}if(r<0){t-=r;r-=r}if(n>a){var o=n-a;e-=o;n-=o}if(r>f){var o=r-f;t-=o;r-=o}if(e>a){var o=e-f;r-=o;t-=o}if(t>f){var o=t-f;r-=o;t-=o}return C(g(e,t,n,r))}function C(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var e=0,t=0,n=0,r=0,i,o;return{flipCoords:g,setPressed:u,setCurrent:l,getOffset:c,moveOffset:p,getCorner:d,getFixed:v}}();var D=function(){function g(t){var n=e("<div />").css({position:"absolute",opacity:s.borderOpacity}).addClass(F(t));p.append(n);return n}function y(t,n){var r=e("<div />").mousedown(V(t)).css({cursor:t+"-resize",position:"absolute",zIndex:n});d.append(r);return r}function b(e){return y(e,a++).css({top:B(-m+1),left:B(-m+1),opacity:s.handleOpacity}).addClass(F("handle"))}function w(e){var t=s.handleSize,n=m,r=t,i=t,o=n,u=n;switch(e){case"n":case"s":i=j(100);break;case"e":case"w":r=j(100);break}return y(e,a++).width(i).height(r).css({top:B(-o+1),left:B(-u+1)})}function E(e){for(i in e)l[e[i]]=b(e[i])}function S(e){var t=Math.round(e.h/2-m),n=Math.round(e.w/2-m),r=west=-m+1,i=e.w-m,s=e.h-m,o,u;"e"in l&&l.e.css({top:B(t),left:B(i)})&&l.w.css({top:B(t)})&&l.s.css({top:B(s),left:B(n)})&&l.n.css({left:B(n)});"ne"in l&&l.ne.css({left:B(i)})&&l.se.css({top:B(s),left:B(i)})&&l.sw.css({top:B(s)});"b"in l&&l.b.css({top:B(s)})&&l.r.css({left:B(i)})}function x(e,t){c.css({top:B(-t),left:B(-e)});v.css({top:B(t),left:B(e)})}function T(e,t){v.width(e).height(t)}function N(){var e=_.getFixed();_.setPressed([e.x,e.y]);_.setCurrent([e.x2,e.y2]);C()}function C(){if(o)return k()}function k(){var e=_.getFixed();T(e.w,e.h);x(e.x,e.y);s.drawBorders&&f["right"].css({left:B(e.w-1)})&&f["bottom"].css({top:B(e.h-1)});h&&S(e);o||L();s.onChange(K(e))}function L(){v.show();u.css("opacity",s.bgOpacity);o=true}function A(){P();v.hide();u.css("opacity",1);o=false}function M(){if(h){S(_.getFixed());d.show()}}function D(){h=true;if(s.allowResize){S(_.getFixed());d.show();return true}}function P(){h=false;d.hide()}function H(e){(O=e)?P():D()}function I(){H(false);N()}var t,n,r,o,a=370;var f={};var l={};var h=false;var m=s.handleOffset;if(s.drawBorders){f={top:g("hline").css("top",e.browser.msie?B(-1):B(0)),bottom:g("hline"),left:g("vline"),right:g("vline")}}if(s.dragEdges){l.t=w("n");l.b=w("s");l.r=w("e");l.l=w("w")}s.sideHandles&&E(["n","s","e","w"]);s.cornerHandles&&E(["sw","nw","ne","se"]);var q=Z().mousedown(V("move")).css({cursor:"move",position:"absolute",zIndex:360});p.append(q);P();return{updateVisible:C,update:k,release:A,refresh:N,setCursor:function(e){q.css("cursor",e)},enableHandles:D,enableOnly:function(){h=true},showHandles:M,disableHandles:P,animMode:H,done:I}}();var P=function(){function i(){g.css({zIndex:450});if(r){e(document).mousemove(a).mouseup(f)}}function o(){g.css({zIndex:290});if(r){e(document).unbind("mousemove",a).unbind("mouseup",f)}}function a(e){t(q(e))}function f(e){e.preventDefault();e.stopPropagation();if(k){k=false;n(q(e));s.onSelect(K(_.getFixed()));o();t=function(){};n=function(){}}return false}function l(e,r){k=true;t=e;n=r;i();return false}function c(e){g.css("cursor",e)}var t=function(){},n=function(){},r=s.trackDocument;if(!r){g.mousemove(a).mouseup(f).mouseout(f)}u.before(g);return{activateHandlers:l,setCursor:c}}();var H=function(){function r(){if(s.keySupport){t.show();t.focus()}}function i(e){t.hide()}function o(e,t,n){if(s.allowMove){_.moveOffset([t,n]);D.updateVisible()}e.preventDefault();e.stopPropagation()}function a(e){if(e.ctrlKey)return true;M=e.shiftKey?true:false;var t=M?10:1;switch(e.keyCode){case 37:o(e,-t,0);break;case 39:o(e,t,0);break;case 38:o(e,0,-t);break;case 40:o(e,0,t);break;case 27:D.release();break;case 9:return true}return nothing(e)}var t=e('<input type="radio" />').css({position:"absolute",left:"-30px"}).keypress(a).blur(i),n=e("<div />").css({position:"absolute",overflow:"hidden"}).append(t);if(s.keySupport)n.insertBefore(u);return{watchKeys:r}}();d.hide();ct(true);var ht={animateTo:et,setSelect:tt,setOptions:ot,tellSelect:it,tellScaled:st,disable:ut,enable:at,cancel:ft,focus:H.watchKeys,getBounds:function(){return[a*x,f*T]},getWidgetSize:function(){return[a,f]},release:D.release,destroy:lt};o.data("Jcrop",ht);return ht};e.fn.Jcrop=function(t){function n(n){var r=t.useImg||n.src;var i=new Image;i.onload=function(){e.Jcrop(n,t)};i.src=r}if(typeof t!=="object")t={};this.each(function(){if(e(this).data("Jcrop")){if(t=="api")return e(this).data("Jcrop");else e(this).data("Jcrop").setOptions(t)}else n(this)});return this}})(e)});define("image/vendor/mousewheel/mousewheel",["jquery"],function(e){(function(e){function r(t){var n=t||window.event,r=[].slice.call(arguments,1),i=0,s=true,o=0,u=0;t=e.event.fix(n);t.type="mousewheel";if(n.wheelDelta){i=n.wheelDelta/120}if(n.detail){i=-n.detail/3}u=i;if(n.axis!==undefined&&n.axis===n.HORIZONTAL_AXIS){u=0;o=-1*i}if(n.wheelDeltaY!==undefined){u=n.wheelDeltaY/120}if(n.wheelDeltaX!==undefined){o=-1*n.wheelDeltaX/120}r.unshift(t,i,o,u);return(e.event.dispatch||e.event.handle).apply(this,r)}var t=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks){for(var n=t.length;n;){e.event.fixHooks[t[--n]]=e.event.mouseHooks}}e.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var e=t.length;e;){this.addEventListener(t[--e],r,false)}}else{this.onmousewheel=r}},teardown:function(){if(this.removeEventListener){for(var e=t.length;e;){this.removeEventListener(t[--e],r,false)}}else{this.onmousewheel=null}}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})})(e)});define("image/image-plugin",["jquery","aloha/plugin","image/image-floatingMenu","i18n!aloha/nls/i18n","i18n!image/nls/i18n","jqueryui","image/vendor/jcrop/jquery.jcrop.min","image/vendor/mousewheel/mousewheel"],function(t,n,r,i,s){var o=t;var u=t;var a=window.GENTICS;var f=window.Aloha;var l=false;String.prototype.toInteger=String.prototype.toInteger||function(){return parseInt(String(this).replace(/px$/,"")||0,10)};String.prototype.toFloat=String.prototype.toInteger||function(){return parseFloat(String(this).replace(/px$/,"")||0,10)};Number.prototype.toInteger=Number.prototype.toInteger||String.prototype.toInteger;Number.prototype.toFloat=Number.prototype.toFloat||String.prototype.toFloat;o.extend(true,o.fn,{increase:o.fn.increase||function(e){var t=o(this),n,r;if(!t.length){return t}n=t.css(e).toFloat();r=Math.round((n||1)*1.2);if(n===r){r++}t.css(e,r);return t},decrease:o.fn.decrease||function(e){var t=o(this),n,r;if(!t.length){return t}n=t.css(e).toFloat();r=Math.round((n||0)*.8);if(n===r&&r>0){r--}t.css(e,r);return t}});return n.create("image",{defaultSettings:{maxWidth:1600,minWidth:3,maxHeight:1200,minHeight:3,autoCorrectManualInput:true,fixedAspectRatio:false,autoResize:false,ui:{meta:true,crop:true,resizable:true},handles:"ne, se, sw, nw",onCropped:function(e,t){f.Log.info("Default onCropped invoked",e,t)},onReset:function(e){f.Log.info("Default onReset invoked",e);return false},onResize:function(e){f.Log.info("Default onResize invoked",e)},onResized:function(e){f.Log.info("Default onResized invoked",e)}},_onCropped:function(e,t){u("body").trigger("aloha-image-cropped",[e,t]);if(this.keepAspectRatio){this.aspectRatioValue=this.imageObj.width()/this.imageObj.height()}this.onCropped(e,t)},_onReset:function(e){u("body").trigger("aloha-image-reset",e);u("#"+this.ui.imgResizeHeightField.getInputId()).val(e.height());u("#"+this.ui.imgResizeWidthField.getInputId()).val(e.width());return this.onReset(e)},_onResize:function(e){u("body").trigger("aloha-image-resize",e);u("#"+this.ui.imgResizeHeightField.getInputId()).val(e.height());u("#"+this.ui.imgResizeWidthField.getInputId()).val(e.width());this.onResize(e)},_onResized:function(e){u("body").trigger("aloha-image-resized",e);u("#"+this.ui.imgResizeHeightField.getInputId()).val(e.height());u("#"+this.ui.imgResizeWidthField.getInputId()).val(e.width());this.onResized(e)},imageObj:null,jcAPI:null,keepAspectRatio:false,aspectRatioValue:false,restoreProps:[],objectTypeFilter:[],init:function(){var e=this;var t=f.getPluginUrl("image");if(typeof this.settings.objectTypeFilter!="undefined"){this.objectTypeFilter=this.settings.objectTypeFilter}e.config=e.defaultSettings;e.settings=o.extend(true,e.defaultSettings,e.settings);if(typeof this.settings.fixedAspectRatio==="number"){this.aspectRatioValue=this.settings.fixedAspectRatio;e.keepAspectRatio=true}else{if(e.settings.fixedAspectRatio===true){e.keepAspectRatio=true}else{e.keepAspectRatio=false}}e.initializeUI();e.bindInteractions();e.subscribeEvents()},initializeUI:function(){var e=this;this.ui=new r;this.ui.init(this)},bindInteractions:function(){var e=this;if(e.settings.ui.resizable){try{document.execCommand("enableObjectResizing",false,false)}catch(t){f.Log.info(t,"Could not disable enableObjectResizing")}}if(e.settings.ui.meta){e.ui.imgSrcField.addListener("keyup",function(t){e.srcChange()});e.ui.imgSrcField.addListener("blur",function(t){var n=o(e.ui.imgSrcField.getTargetObject());if(n.attr("src")===""){n.remove()}})}if(e.settings.onCropped&&typeof e.settings.onCropped==="function"){e.onCropped=e.settings.onCropped}if(e.settings.onReset&&typeof e.settings.onReset==="function"){e.onReset=e.settings.onReset}if(e.settings.onResized&&typeof e.settings.onResized==="function"){e.onResized=e.settings.onResized}if(e.settings.onResize&&typeof e.settings.onResize==="function"){e.onResize=this.settings.onResize}},subscribeEvents:function(){var e=this;var t=this.settings;o("img").filter(t.globalselector).unbind();o("img").filter(t.globalselector).click(function(t){e.clickImage(t)});f.bind("aloha-drop-files-in-editable",function(t,n){var r,i=n.filesObjs.length,s,u;while(--i>=0){s=n.filesObjs[i];if(s.file.type.match(/image\//)){u=e.getEditableConfig(n.editable);r=o("<img/>");r.css({"max-width":that.maxWidth,"max-height":that.maxHeight});r.attr("id",s.id);if(typeof s.src==="undefined"){r.attr("src",s.data)}else{r.attr("src",s.src)}a.Utils.Dom.insertIntoDOM(r,n.range,o(f.activeEditable.obj))}}});f.bind("aloha-selection-changed",function(t,n,r){var i,s;if(r&&r.target){if(e.settings.ui.resizable&&!o(r.target).hasClass("ui-resizable-handle")){e.endResize();e.imageObj=null;f.trigger("aloha-image-unselected")}}if(f.activeEditable!==null){s=e.findImgMarkup(n);i=e.getEditableConfig(f.activeEditable.obj);if(typeof i!=="undefined"){e.ui._insertImageButton.show()}else{e.ui._insertImageButton.hide();return}if(s){e.ui._insertImageButton.show();e.ui.setScope();if(e.settings.ui.meta){e.ui.imgSrcField.setTargetObject(s,"src");e.ui.imgTitleField.setTargetObject(s,"title")}e.ui.imgSrcField.foreground();e.ui.imgSrcField.focus()}else{if(e.settings.ui.meta){e.ui.imgSrcField.setTargetObject(null)}}e.ui.doLayout()}});f.bind("aloha-editable-created",function(t,n){try{document.execCommand("enableObjectResizing",false,false)}catch(r){f.Log.info(r,"Could not disable enableObjectResizing")}n.obj.delegate("img","mouseup",function(t){if(!l){e.clickImage(t);t.stopPropagation()}})});e._subscribeToResizeFieldEvents()},autoResize:function(e){var t=this;var n=o("#"+t.ui.imgResizeWidthField.getInputId());var r=o("#"+t.ui.imgResizeHeightField.getInputId());var i=t.imageObj.width();var s=t.imageObj.height();var u=false;if(i<t.settings.minWidth||i>t.settings.maxWidth||s<t.settings.minHeight||s>t.settings.maxHeight){u=true}var a=i/s;if(u){if(i>t.settings.maxWidth){i=t.settings.maxWidth;s=i/a}if(s>t.settings.maxHeight){s=t.settings.maxHeight;i=s*a}if(i<t.settings.minWidth&&e){i=t.settings.minWidth;s=i/a}if(s<t.settings.minHeight&&e){s=t.settings.minHeight;i=i*a}n.val(i);r.val(s);t.setSizeByFieldValue();return true}return false},toggleKeepAspectRatio:function(){this.keepAspectRatio=!this.keepAspectRatio;if(typeof this.jcAPI!=="undefined"&&this.jcAPI!==null){}else{this.endResize();if(!this.keepAspectRatio){this.aspectRatioValue=false}else{if(typeof this.settings.fixedAspectRatio!=="number"){this.aspectRatioValue=this.imageObj.width()/this.imageObj.height()}else{this.aspectRatioValue=this.settings.fixedAspectRatio}}this.startResize()}},_subscribeToResizeFieldEvents:function(){function t(t){var n=t.data.minValue;var r=t.data.maxValue;var i=t.data.fieldName;if(t.keyCode===8||t.keyCode===46){if(e._updateFields(i,u(this).val(),false)){if(typeof e.jcAPI!=="undefined"&&e.jcAPI!==null){e.setCropAreaByFieldValue()}else{e.setSizeByFieldValue()}}}else if(t.keyCode<=57&&t.keyCode>=48||t.keyCode<=105&&t.keyCode>=96){if(e._updateFields(i,u(this).val(),false)){if(typeof e.jcAPI!=="undefined"&&e.jcAPI!==null){e.setCropAreaByFieldValue()}else{e.setSizeByFieldValue()}}}else{var s=0;if(t.keyCode===38||t.keyCode===107){s=+1}else if(t.keyCode===40||t.keyCode===109){s=-1}if(t.shiftKey||t.metaKey||t.ctrlKey){s=s*10}var o=false;if(s<0){o=true}var a=parseInt(u(this).val(),10)+s;if(e._updateFields(i,a,o)){if(typeof e.jcAPI!=="undefined"&&e.jcAPI!==null){e.setCropAreaByFieldValue()}else{e.setSizeByFieldValue()}}}t.preventDefault();return false}function n(t,n){var r=t.data.minValue;var i=t.data.maxValue;var s=t.data.fieldName;if(t.shiftKey||t.metaKey||t.ctrlKey){n=n*10}var o=parseInt(u(this).val(),10)+n;var a=false;if(n<0){a=true}if(e._updateFields(s,o,a)){if(typeof e.jcAPI!=="undefined"&&e.jcAPI!==null){e.setCropAreaByFieldValue()}else{e.setSizeByFieldValue()}}return false}var e=this;var r=u("#"+e.ui.imgResizeHeightField.getInputId());var i={fieldName:"height",maxValue:e.ui.imgResizeHeightField.maxValue,minValue:e.ui.imgResizeHeightField.minValue};r.live("keyup",i,t);r.live("mousewheel",i,n);var s=u("#"+e.ui.imgResizeWidthField.getInputId());var o={fieldName:"width",maxValue:e.ui.imgResizeWidthField.maxValue,minValue:e.ui.imgResizeWidthField.minValue};s.live("keyup",o,t);s.live("mousewheel",o,n)},setSize:function(e,t){var n=this;n.imageObj.width(e);n.imageObj.height(t);var r=n.imageObj.closest(".Aloha_Image_Resize");r.height(t);r.width(e);n._onResize(n.imageObj);n._onResized(n.imageObj)},clickImage:function(e){var t=this;t.endResize();t.imageObj=o(e.target);var n=t.imageObj;if(n.hasClass("aloha-ui")){return}t.ui.setScope();var r=n.closest(".aloha-editable");this.ui._imageCnrRatioButton.setState(this.keepAspectRatio);this.restoreProps.push({obj:e.srcElement,src:t.imageObj.attr("src"),width:t.imageObj.width(),height:t.imageObj.height()});var i=u("#"+t.ui.imgResizeHeightField.getInputId());i.val(t.imageObj.height());i.css("background-color","");var s=u("#"+t.ui.imgResizeWidthField.getInputId());s.val(t.imageObj.width());s.css("background-color","");if(t.settings.ui.meta){t.ui.imgSrcField.setTargetObject(t.imageObj,"src");t.ui.imgTitleField.setTargetObject(t.imageObj,"title")}f.Selection.preventSelectionChanged();try{t.ui.imgSrcField.focus()}catch(e){}t.aspectRatioValue=t.imageObj.width()/t.imageObj.height();if(t.settings.ui.resizable){t.startResize()}if(t.settings.autoResize){t.autoResize(true)}f.Selection.preventSelectionChangedFlag=false;f.trigger("aloha-image-selected")},findImgMarkup:function(e){var t=this;var n=this.config;var r,i;if(typeof e==="undefined"){e=f.Selection.getRangeObject()}i=o(e.startContainer);try{if(f.activeEditable){if(typeof e.startContainer!=="undefined"&&typeof e.startContainer.childNodes!=="undefined"&&typeof e.startOffset!=="undefined"&&typeof e.startContainer.childNodes[e.startOffset]!=="undefined"&&e.startContainer.childNodes[e.startOffset].nodeName.toLowerCase()==="img"&&e.startOffset+1===e.endOffset||i.hasClass("Aloha_Image_Resize")){r=i.find("img")[0];if(!r.css){r.css=""}if(!r.title){r.title=""}if(!r.src){r.src=""}return r}else{return null}}}catch(s){f.Log.debug(s,"Error finding img markup.")}return null},getPluginFocus:function(){return this.imageObj},_updateFields:function(e,t,n){var r=this;var i=null;var s=null;var u=null;var a=null;var f=null;var l=null;var c=null;if(e=="width"){i=o("#"+r.ui.imgResizeWidthField.getInputId());s=o("#"+r.ui.imgResizeHeightField.getInputId());u=1/r.aspectRatioValue;a=r.settings.minWidth;f=r.settings.maxWidth;l=r.settings.minHeight;c=r.settings.maxHeight}else if(e=="height"){i=o("#"+r.ui.imgResizeHeightField.getInputId());s=o("#"+r.ui.imgResizeWidthField.getInputId());u=r.aspectRatioValue;a=r.settings.minHeight;f=r.settings.maxHeight;l=r.settings.minWidth;c=r.settings.maxWidth}else{return false}if(isNaN(t)){i.css("background-color","red");return false}else{i.val(t)}var h=true;if(t>f){if(r.settings.autoCorrectManualInput){i.val(f);t=i.val();i.css("background-color","");h=true}else{i.css("background-color","red");h=false}}else if(t<a){if(n){i.val(a);t=i.val();h=true}else if(r.settings.autoCorrectManualInput){i.css("background-color","wheat");h=false}else{i.css("background-color","red");h=false}}else{i.css("background-color","");h=true}var p=true;if(r.keepAspectRatio){var d=Math.round(t*u);if(d>c){if(r.settings.autoCorrectManualInput){s.val(c);i.val(s.val()/u);t=i.val();i.css("background-color","");s.css("background-color","");p=true}else{d.css("background-color","red");p=false}}else if(d<l){if(n){s.val(l);i.val(s.val()/u);t=i.val();h=true}else if(r.settings.autoCorrectManualInput){s.val(d);s.css("background-color","wheat");p=false}else{s.css("background-color","red");p=false}}else{s.val(d);s.css("background-color","");p=true}}if(h&&p){return true}return false},setSizeByFieldValue:function(){var e=this;var t=u("#"+e.ui.imgResizeWidthField.getInputId()).val();var n=u("#"+e.ui.imgResizeHeightField.getInputId()).val();e.setSize(t,n)},setCropAreaByFieldValue:function(){var e=this;var t=e.jcAPI.tellSelect();var n=u("#"+e.ui.imgResizeWidthField.getInputId()).val();n=parseInt(n,10);var r=u("#"+e.ui.imgResizeHeightField.getInputId()).val();r=parseInt(r,10);var i=[t["x"],t["y"],t["x"]+n,t["y"]+r];e.jcAPI.setSelect(i)},insertImg:function(){var e=f.Selection.getRangeObject(),t=this.getEditableConfig(f.activeEditable.obj),n=f.getPluginUrl("image"),r,i,s;if(e.isCollapsed()){r="max-width: "+t.maxWidth+"; max-height: "+t.maxHeight;i='<img style="'+r+'" src="'+n+'/img/blank.jpg" title="" />';s=o(i);a.Utils.Dom.insertIntoDOM(s,e,o(f.activeEditable.obj))}else{f.Log.error("img cannot markup a selection")}},srcChange:function(){this.imageObj.attr("src",this.ui.imgSrcField.getValue())},positionCropButtons:function(){var e=o(".jcrop-tracker:first"),t=e.offset(),n=t.top,r=t.left,i=e.height(),s=e.width();var u=0,a=0;var f=o("#aloha-CropNResize-btns");if(n===0&&r===0){f.hide()}n=parseInt(n+i+3,10);r=parseInt(r+s/2-f.width()/2+10,10);if(u!=r||a!=n){f.offset({top:n,left:r})}u=r;a=n},initCropButtons:function(){var e=this,t;o("body").append('<div id="aloha-CropNResize-btns" display="none">'+'<button class="cnr-crop-apply" title="'+s.t("Accept")+'"></button>'+'<button class="cnr-crop-cancel" title="'+s.t("Cancel")+'"></button>'+"</div>");t=o("#aloha-CropNResize-btns");t.find(".cnr-crop-apply").click(function(){e.acceptCrop()});t.find(".cnr-crop-cancel").click(function(){e.endCrop()});this.interval=setInterval(function(){e.positionCropButtons()},10)},destroyCropButtons:function(){o("#aloha-CropNResize-btns").remove();clearInterval(this.interval)},_disableSelection:function(e){e.find("*").attr("unselectable","on").css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none"})},crop:function(){var e=this;var t=this.config;e.initCropButtons();if(e.settings.ui.resizable){e.endResize()}e.jcAPI=o.Jcrop(e.imageObj,{onSelect:function(){e._onCropSelect();window.setTimeout(function(){e.ui.setScope()},10)}});e._disableSelection(u(".jcrop-holder"));e._disableSelection(u("#imageContainer"));e._disableSelection(u("#aloha-CropNResize-btns"));u("body").trigger("aloha-image-crop-start",[e.imageObj])},_onCropSelect:function(){var e=this;o("#aloha-CropNResize-btns").fadeIn("slow");o(".jcrop-handle").mousedown(function(){o("#aloha-CropNResize-btns").hide()});o(".jcrop-tracker").mousedown(function(){o("#aloha-CropNResize-btns").hide()});if(typeof e.jcAPI!=="undefined"&&e.jcAPI!==null){e.positionCropButtons();var t=e.jcAPI.tellSelect();var n=o("#"+e.ui.imgResizeWidthField.getInputId()).val(t["w"]);var r=o("#"+e.ui.imgResizeHeightField.getInputId()).val(t["h"])}},endCrop:function(){if(this.jcAPI){this.jcAPI.destroy();this.jcAPI=null}this.destroyCropButtons();this.ui._imageCropButton.setState(false);if(this.settings.ui.resizable){this.startResize()}u("body").trigger("aloha-image-crop-stop",[this.imageObj]);u("#"+this.ui.imgResizeHeightField.getInputId()).val(this.imageObj.height());u("#"+this.ui.imgResizeWidthField.getInputId()).val(this.imageObj.width())},acceptCrop:function(){this._onCropped(this.imageObj,this.jcAPI.tellSelect());this.endCrop()},startResize:function(){var e=this;var t=this.imageObj;var n=e.keepAspectRatio?e.aspectRatioValue:false;t=this.imageObj.css({height:this.imageObj.height(),width:this.imageObj.width(),position:"relative","max-height":"","max-width":""});t.resizable({maxHeight:e.settings.maxHeight,minHeight:e.settings.minHeight,maxWidth:e.settings.maxWidth,minWidth:e.settings.minWidth,aspectRatio:n,handles:e.settings.handles,grid:e.settings.grid,resize:function(t,n){l=true;e._onResize(e.imageObj)},stop:function(t,n){l=false;e._onResized(e.imageObj);if(this.enableCrop){window.setTimeout(function(){e.ui.setScope();that.done(t)},10)}}});t.css("display","inline-block");o(".ui-wrapper").attr("contentEditable",false).addClass("aloha-image-box-active Aloha_Image_Resize aloha").css({position:"relative",display:"inline-block","float":e.imageObj.css("float")}).bind("resizestart",function(e){e.preventDefault()}).bind("mouseup",function(e){e.originalEvent.stopSelectionUpdate=true})},endResize:function(){if(this.imageObj){var e=this.imageObj.closest(".aloha-editable")}if(this.imageObj&&this.imageObj.is(":ui-resizable")){this.imageObj.resizable("destroy").css({top:0,left:0})}},resetSize:function(){var e=this,t=new Image;t.onload=function(){var n=e.getPluginFocus();if(e.settings.ui.resizable){e.endResize()}o(n).add(n.parent()).css({width:t.width+"px",height:t.height+"px","max-width":"","max-height":""});if(e.settings.ui.resizable){e.resize()}};t.src=e.getPluginFocus().attr("src")},reset:function(){if(this.settings.ui.crop){this.endCrop()}if(this.settings.ui.resizable){this.endResize()}if(this._onReset(this.imageObj)){return}for(var e=0;e<this.restoreProps.length;e++){if(this.imageObj.get(0)===this.restoreProps[e].obj){this.imageObj.attr("src",this.restoreProps[e].src);this.imageObj.width(this.restoreProps[e].width);this.imageObj.height(this.restoreProps[e].height);return}}}})});define("highlighteditables/highlighteditables-plugin",["aloha","jquery","aloha/plugin"],function(e,t,n){var r=window.GENTICS;return n.create("highlighteditables",{config:["highlight"],init:function(){var t=this,n;r.Utils.Position.addMouseMoveCallback(function(){var r,i;for(r=0;r<e.editables.length;r++){i=e.editables[r];n=t.getEditableConfig(i.obj);if(!e.activeEditable&&!i.isDisabled()&&n=="highlight"){i.obj.addClass("aloha-editable-highlight")}}});r.Utils.Position.addMouseStopCallback(function(){t.fade()});e.bind("aloha-editable-activated",function(e,n){t.fade()})},fade:function(){var n,r,i=function(){t(this).css("outline","")};for(n=0;n<e.editables.length;n++){r=e.editables[n].obj;if(r.hasClass("aloha-editable-highlight")){r.css("outline",r.css("outlineColor")+" "+r.css("outlineStyle")+" 5px").removeClass("aloha-editable-highlight").animate({outlineWidth:"0px"},300,"swing",i)}}}})});define("dom-to-xhtml/dom-to-xhtml",["jquery","util/dom2","util/misc","util/browser","aloha/ephemera","aloha/console"],function(e,t,n,r,i,s){function f(e){return e.replace(/&/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function l(e){return f(e).replace(/"/g,"&quot;")}function c(e,n){var s=t.attrs(e);var o="";var a,f;if(r.ie7){for(var c in u){if(u.hasOwnProperty(c)&&e[c]){for(a=0,f=s.length;a<f;a++){if(c===s[a][0].toLowerCase()){s.splice(a,1);break}}s.push([c,c])}}}for(a=0,f=s.length;a<f;a++){var h=s[a];var p=h[0].toLowerCase();var d=h[1];if(n&&i.isAttrEphemeral(e,p,n.attrMap||{},n.attrRxs||{})){continue}var v=u[p];if(!v&&""===d){continue}o+=" "+p+'="'+l(v?p:d)+'"'}return o}function h(e){var t=e.nodeName;var n=a[t];if(null!=n){return n}var r="/"+e.nodeName;var i=e.nextSibling;n=false;while(null!=i){if(r==i.nodeName){n=true;break}i=i.nextSibling}a[t]=n;return n}function p(e,t,n,r,i){while(null!=t){if(1===t.nodeType&&n&&"/"+e.nodeName==t.nodeName){t=t.nextSibling;break}else if(1===t.nodeType&&h(t)){t=d(t,t.nextSibling,true,r,i)}else{v(t,r,i);t=t.nextSibling}}return t}function d(e,t,n,r,i){var s=e.nodeName.toLowerCase();if(e.scopeName&&"HTML"!=e.scopeName&&-1===s.indexOf(":")){s=e.scopeName.toLowerCase()+":"+s}if(!n&&null==t&&o[s]){i.push("<"+s+c(e,r)+"/>")}else{i.push("<"+s+c(e,r)+">");t=p(e,t,n,r,i);i.push("</"+s+">")}return t}function v(e,t,n){var r=e.nodeType;if(1===r){d(e,e.firstChild,h(e),t,n)}else if(3===e.nodeType){n.push(f(e.nodeValue))}else if(8===e.nodeType){n.push("<"+"!--"+e.nodeValue+"-->")}else{s.warn("Unknown node type encountered during serialization, ignoring it:"+" type="+e.nodeType+" name="+e.nodeName+" value="+e.nodeValue)}}var o={area:true,base:true,basefont:true,br:true,col:true,frame:true,hr:true,img:true,input:true,isindex:true,link:true,meta:true,param:true,embed:true};var u={checked:true,compact:true,declare:true,defer:true,disabled:true,ismap:true,multiple:true,nohref:true,noresize:true,noshade:true,nowrap:true,readonly:true,selected:true};var a={DIV:false,SPAN:false,UL:false,OL:false,LI:false,TABLE:false,TR:false,TD:false,TH:false,I:false,B:false,EM:false,STRONG:false,A:false,P:false};return{contentsToXhtml:function(e,t){var n=[];p(e,e.firstChild,false,t,n);return n.join("")},nodeToXhtml:function(e,t){var n=[];v(e,t,n);return n.join("")}}});define("dom-to-xhtml/dom-to-xhtml-plugin",["aloha","jquery","aloha/plugin","aloha/ephemera","dom-to-xhtml/dom-to-xhtml"],function(e,t,n,r,i){return n.create("dom-to-xhtml",{init:function(){var n=this;e.Editable.setContentSerializer(function(e){if(!n.settings.editables&&!n.settings.config){return i.contentsToXhtml(e)}if(n.settings.editables&&n.settings.editables["#"+t(e).attr("id")]=="dom-to-xhtml"){return i.contentsToXhtml(e,r.ephemera())}else if(n.settings.config&&n.settings.config=="dom-to-xhtml"&&!n.settings.editables["#"+t(e).attr("id")]){return i.contentsToXhtml(e,r.ephemera())}else{return t(e).html()}})}})});define("contenthandler/contenthandler-utils",["jquery"],function(e){function t(t){var n=e.trim(t);if(!n){return false}var r=e("<div>"+n+"</div>")[0];var i=r.firstChild===r.lastChild&&"p"===r.firstChild.nodeName.toLowerCase();if(i){var s=r.firstChild.children;return s&&1===s.length&&"br"===s[0].nodeName.toLowerCase()}return false}function n(t){if(typeof t==="string"){return e("<div>"+t+"</div>")}if(t instanceof e){return e("<div>").append(t)}return null}return{wrapContent:n,isProppedParagraph:t}});define("contenthandler/wordcontenthandler",["jquery","aloha","aloha/contenthandlermanager","contenthandler/contenthandler-utils","util/dom"],function(e,t,n,r,i){function a(t){switch(t[0].nodeName.toLowerCase()){case"table":return 0===t.find("tbody,tr").length;case"tbody":return 0===t.find("tr").length;case"tr":return 0===t.find("td,th").length;default:return""===e.trim(t.text())}}function f(e){if(0===e.length||!o.test(e[0].outerHTML)){return false}var t=e.find("*");var n;var r;var i;for(n=0;n<t.length;n++){r=t.eq(n).attr("style");if(r&&r.toLowerCase().indexOf("mso")>=0){return true}i=t.eq(n).attr("class");if(i&&i.toLowerCase().indexOf("mso")>=0){return true}}return false}function l(t){var n=t.find("*");var r;var i;var s;var o;for(o=0;o<n.length;o++){i=n.eq(o);r=i[0].nodeName.toLowerCase();if("a"===r){s=i.attr("href");if(s&&u.test(e.trim(s))){i.contents().unwrap()}}else if("div"===r||"span"===r){i.contents().unwrap()}else if("td"!==r&&a(i)){i.contents().unwrap()}}}function c(n){n.find("p.MsoTitle").each(function(){t.Markup.transformDomObject(e(this),"h1")});n.find("p.MsoSubtitle").each(function(){t.Markup.transformDomObject(e(this),"h2")})}var s=e;var o=/mso/;var u=/^#(.*)/;var h=n.createHandler({handleContent:function(e){var t=r.wrapContent(e);if(!t){return e}if(f(t)){this.transformWordContent(t)}return t.html()},isOrderedList:function(e){if(e.css("fontFamily")=="Wingdings"||e.css("fontFamily")=="Symbol"){return false}return e.text().match(/^([0-9]{1,3}\.)|([0-9]{1,3}\)|([a-zA-Z]{1,5}\.)|([a-zA-Z]{1,5}\)))$/)?true:false},transformListsFromWord:function(e){var t=this,n,r,i,o,u,a;a="aloha-list-element";u="aloha-list-bullet";r="p.MsoListParagraphCxSpFirst,p.MsoListParagraphCxSpMiddle,p.MsoListParagraphCxSpLast,p.MsoListParagraph,p span";o=e.find(r);o.each(function(){var e=s(this),t=e.css("font-family")||"",n=e.css("mso-list")||"",r=e.attr("style")||"";if(e.hasClass("MsoListParagraphCxSpFirst")||e.hasClass("MsoListParagraph")){e.addClass(a)}else if(t.indexOf("Symbol")>=0){e.closest("p").addClass(a)}else if(t.indexOf("Wingdings")>=0){e.closest("p").addClass(a)}else if(n!==""){e.closest("p").addClass(a)}else if(r.indexOf("mso-list")>=0){e.closest("p").addClass(a)}});r="p span span span";i=e.find(r);i.each(function(){var e=s(this),t=s.trim(e.text()).replace(/&nbsp;/g,""),n;if(t.length===0){n=s.trim(e.parent().parent().text()).replace(/&nbsp;/g,"");if(n.match(/^([0-9]{1,3}\.)|([0-9]{1,3}\))|([a-zA-Z]{1,5}\.)|([a-zA-Z]{1,5}\))|(.)$/)){e.closest("p").addClass(a);e.parent().parent().addClass(u)}}});r="p."+a;n=":not("+r+", font)";o=e.find(r);if(o.length>0){o.each(function(){var e=s(this),r,i,o,f,l,c,h,p;e.removeClass(a);e.find("font").each(function(){s(this).contents().unwrap()});p=[];h=parseFloat(e.css("marginLeft"));if(isNaN(h)){h=0}c=[];l=e.nextUntil(n);f=s(e.find("span."+u));if(f.length===0){f=e.find("span").eq(0)}o=t.isOrderedList(f);f.remove();i=s(o?"<ol></ol>":"<ul></ul>");c.push(i);r=s("<li></li>");i.append(r);e.contents().appendTo(r);e.replaceWith(i);l.each(function(){var e=s(this),n,a;if(e.is("font")){return}e.find("font").each(function(){s(this).contents().unwrap()});n=parseFloat(e.css("marginLeft"));if(isNaN(n)){n=0}f=s(e.find("span."+u));if(f.length===0){f=e.find("span").eq(0)}o=t.isOrderedList(f);f.remove();if(n>h){a=s(o?"<ol></ol>":"<ul></ul>");i.children(":last").append(a);i=a;c.push(i);p.push(n);h=n}else if(n<h&&p.length>0){while(p.length>0&&p[p.length-1]>n){p.pop();c.pop()}i=c[c.length-1];h=n}r=s("<li></li>");i.append(r);e.contents().appendTo(r);e.remove()})})}},removeParagraphNumbering:function(e){var t="h1,h2,h3,h4,h5,h6",n=e.find(t);if(n.length>0){n.each(function(){var e=s(this),t=e.find("span"),n=e.find("a");t.each(function(){if(s.trim(s(this).text()).match(/^([\.\(]?[\d\D][\.\(]?){1,4}$/)){s(this).remove()}});n.each(function(){if(typeof s(this).attr("href")==="undefined"){s(this).contents().unwrap()}})})}},transformToc:function(e){var t="[class*=MsoToc]",n=e.find(t);n.each(function(){var e=s(this),t=e.find("span"),n=e.find("a");t.each(function(){if(s(this).attr("style")&&s(this).attr("style").search("mso-hide")>-1){s(this).remove()}s(this).contents().unwrap()});n.each(function(){s(this).contents().unwrap()})})},transformWordContent:function(e){this.transformToc(e);this.removeParagraphNumbering(e);this.transformListsFromWord(e);c(e);l(e)}});return h});define("contenthandler/genericcontenthandler",["jquery","aloha","aloha/contenthandlermanager","contenthandler/contenthandler-utils"],function(e,t,n,r){function s(t){var n=e.trim(t);if(!n){return false}var r=e("<div>"+n+"</div>")[0];var i=r.firstChild===r.lastChild&&"p"===r.firstChild.nodeName.toLowerCase();if(i){var s=r.firstChild.children;return s&&1===s.length&&"br"===s[0].nodeName.toLowerCase()}return false}function o(t){t.find("table").removeAttr("cellpadding").removeAttr("cellspacing").removeAttr("border").removeAttr("border-top").removeAttr("border-bottom").removeAttr("border-left").removeAttr("border-right");t.find("td").each(function(){var t=this;if(s(t.innerHTML)){t.innerHTML="&nbsp;"}var n=e(">p",t);if(1===n.length){n.contents().unwrap()}});t.find("td,tr").removeAttr("width").removeAttr("height").removeAttr("valign");t.find("colgroup").remove()}function u(n){return!!(t.settings.contentHandler&&t.settings.contentHandler.allows&&t.settings.contentHandler.allows.elements&&e.inArray(n.toLowerCase(),t.settings.contentHandler.allows.elements)!==-1)}var i=["strong","em","s","u","strike"];var a=n.createHandler({handleContent:function(e){var n=r.wrapContent(e);if(!n){return e}if(n.find(".aloha-block").length){return n.html()}o(n);this.cleanLists(n);this.removeComments(n);this.unwrapTags(n);this.removeStyles(n);this.removeNamespacedElements(n);var i=true;if(t.settings.contentHandler&&t.settings.contentHandler.handler&&t.settings.contentHandler.handler.generic&&typeof t.settings.contentHandler.handler.generic.transformFormattings!=="undefinded"&&!t.settings.contentHandler.handler.generic.transformFormattings){i=false}if(i){this.transformFormattings(n)}return n.html()},cleanLists:function(e){e.find("ul,ol").find(">:not(li)").remove()},transformFormattings:function(n){var r=[],s;for(s=0;s<i.length;s++){if(!u(i[s])){r.push(i[s])}}n.find(r.join(",")).each(function(){if(this.nodeName==="STRONG"){t.Markup.transformDomObject(e(this),"b")}else if(this.nodeName==="EM"){t.Markup.transformDomObject(e(this),"i")}else if(this.nodeName==="S"||this.nodeName=="STRIKE"){t.Markup.transformDomObject(e(this),"del")}else if(this.nodeName==="U"){e(this).contents().unwrap()}})},transformLinks:function(t){t.find("a").each(function(){if(typeof e(this).attr("href")==="undefined"){e(this).contents().unwrap()}})},removeComments:function(t){var n=this;t.contents().each(function(){if(this.nodeType===8){e(this).remove()}else{n.removeComments(e(this))}})},unwrapTags:function(n){var r=this;n.find("span,font,div").not(".aloha-wai-lang").each(function(){if(this.nodeName=="DIV"){if(this.innerHTML==="<br>"){e(this).contents().unwrap()}else{e(t.Markup.transformDomObject(e(this),"p").append("<br>")).contents().unwrap()}}else{e(this).contents().unwrap()}})},removeStyles:function(t){var n=this;t.children("style").filter(function(){return this.contentEditable!=="false"}).remove();t.children().filter(function(){return this.contentEditable!=="false"}).each(function(){e(this).removeAttr("style").removeClass();n.removeStyles(e(this))})},removeNamespacedElements:function(t){t.find("*").each(function(){var t=this.prefix?this.prefix:this.scopeName?this.scopeName:undefined;if(t&&t!=="HTML"||this.nodeName.indexOf(":")>=0){var n=e(this),r=n.contents();if(r.length){r.unwrap()}else{n.remove()}}})}});return a});Sanitize.REGEX_PROTOCOL=/^([A-Za-z0-9\+\-\.\&\;\*\s]*?)(?:\:|&*0*58|&*x0*3a)/i;Sanitize.RELATIVE="__relative__";Sanitize.prototype.clean_node=function(e){function n(e,t){var n;for(n=0;n<t.length;n++){if(t[n]==e)return n}return-1}function r(){var e=[];var t={};var n,r;for(n=0;n<arguments.length;n++){if(!arguments[n]||!arguments[n].length)continue;for(r=0;r<arguments[n].length;r++){if(t[arguments[n][r]])continue;t[arguments[n][r]]=true;e.push(arguments[n][r])}}return e}function s(e){var t;for(var n=0;n<this.filters.length;n++){if(!this.filters[n](e)){t=e.cloneNode(true);this.current_element.appendChild(t);return}}switch(e.nodeType){case 1:o.call(this,e);break;case 3:var t=e.cloneNode(false);this.current_element.appendChild(t);break;case 5:var t=e.cloneNode(false);this.current_element.appendChild(t);break;case 8:if(this.config.allow_comments){var t=e.cloneNode(false);this.current_element.appendChild(t)};default:}}function o(e){var t,i,o,a,f,l,c,h,p,d,v,m;var g=u.call(this,e);var y=this.jQuery;var b=y.browser.msie&&y.browser.version==="7.0";e=g.node;f=e.nodeName.toLowerCase();a=this.current_element;if(this.allowed_elements[f]||g.whitelist){this.current_element=this.dom.createElement(e.nodeName);a.appendChild(this.current_element);l=r(this.config.attributes[f],this.config.attributes["__ALL__"],g.attr_whitelist);for(t=0;t<l.length;t++){h=l[t];c=e.attributes[h];if(c){m=true;if(this.config.protocols[f]&&this.config.protocols[f][h]){d=this.config.protocols[f][h];v=c.nodeValue.toLowerCase().match(Sanitize.REGEX_PROTOCOL);if(v){m=n(v[1],d)!=-1}else{m=n(Sanitize.RELATIVE,d)!=-1}}if(m){if(!b||b&&"style"!==h){p=document.createAttribute(h);p.value=c.nodeValue;this.current_element.setAttributeNode(p)}}}}if(this.config.add_attributes[f]){for(h in this.config.add_attributes[f]){if(!b||b&&"style"!==h){p=document.createAttribute(h);p.value=this.config.add_attributes[f][h];this.current_element.setAttributeNode(p)}}}}else if(n(e,this.whitelist_nodes)!=-1){this.current_element=e.cloneNode(true);while(this.current_element.childNodes.length>0){this.current_element.removeChild(this.current_element.firstChild)}a.appendChild(this.current_element)}if(!this.config.remove_all_contents&&!this.config.remove_element_contents[f]){for(t=0;t<e.childNodes.length;t++){s.call(this,e.childNodes[t])}}if(this.current_element.normalize){this.current_element.normalize()}this.current_element=a}function u(e){var t={attr_whitelist:[],node:e,whitelist:false};var i,s,o;for(i=0;i<this.transformers.length;i++){o=this.transformers[i]({allowed_elements:this.allowed_elements,config:this.config,node:e,node_name:e.nodeName.toLowerCase(),whitelist_nodes:this.whitelist_nodes,dom:this.dom});if(o==null)continue;else if(typeof o=="object"){if(o.whitelist_nodes&&o.whitelist_nodes instanceof Array){for(s=0;s<o.whitelist_nodes.length;s++){if(n(o.whitelist_nodes[s],this.whitelist_nodes)==-1){this.whitelist_nodes.push(o.whitelist_nodes[s])}}}t.whitelist=o.whitelist?true:false;if(o.attr_whitelist){t.attr_whitelist=r(t.attr_whitelist,o.attr_whitelist)}t.node=o.node?o.node:t.node}else{throw new Error("transformer output must be an object or null")}}return t}var t=this.dom.createDocumentFragment();this.current_element=t;this.whitelist_nodes=[];for(i=0;i<e.childNodes.length;i++){s.call(this,e.childNodes[i])}if(t.normalize){t.normalize()}return t};define("vendor/sanitize",function(){});define("contenthandler/sanitizecontenthandler",["aloha/core","jquery","aloha/contenthandlermanager","aloha/plugin","aloha/console","vendor/sanitize"],function(e,t,n,r,i){function o(n){var r=["restricted","basic","relaxed"],i=e.defaults.supports;if(e.settings.contentHandler.sanitize&&t.inArray(e.settings.contentHandler.sanitize,r)>-1){i=e.defaults.sanitize[e.settings.contentHandler.sanitize]}else{i=e.defaults.sanitize.relaxed}if(e.settings.contentHandler.allows){i=e.settings.contentHandler.allows}if(n){i=n}i.filters=[function(e){return e.contentEditable!="false"}];s=new Sanitize(i,t)}var s;if(!e.defaults.sanitize){e.defaults.sanitize={}}e.defaults.sanitize.restricted={elements:["b","em","i","strong","u","del","p","span","div","br"]};e.defaults.sanitize.basic={elements:["a","abbr","b","blockquote","br","cite","code","dd","del","dl","dt","em","i","li","ol","p","pre","q","small","strike","strong","sub","sup","u","ul"],attributes:{a:["href"],blockquote:["cite"],q:["cite"],abbr:["title"]},protocols:{a:{href:["ftp","http","https","mailto","__relative__"]},blockquote:{cite:["http","https","__relative__"]},q:{cite:["http","https","__relative__"]}}};e.defaults.sanitize.relaxed={elements:["a","abbr","b","blockquote","br","caption","cite","code","col","colgroup","dd","del","dl","dt","em","h1","h2","h3","h4","h5","h6","i","img","li","ol","p","pre","q","small","strike","strong","sub","sup","table","tbody","td","tfoot","th","thead","tr","u","ul","span","hr","object","div"],attributes:{a:["href","title","id","class","target","data-gentics-aloha-repository","data-gentics-aloha-object-id"],div:["id","class","style"],abbr:["title"],blockquote:["cite"],br:["class"],col:["span","width"],colgroup:["span","width"],img:["align","alt","height","src","title","width","class","data-caption","data-align","data-width","data-original-image"],ol:["start","type"],p:["class","style","id"],q:["cite"],table:["summary","width"],td:["abbr","axis","colspan","rowspan","width"],th:["abbr","axis","colspan","rowspan","scope","width"],ul:["type"],span:["class","style","lang","xml:lang","role"]},protocols:{a:{href:["ftp","http","https","mailto","__relative__"]},blockquote:{cite:["http","https","__relative__"]},img:{src:["http","https","__relative__"]},q:{cite:["http","https","__relative__"]}}};var u=n.createHandler({handleContent:function(n){var r,i;if(e.activeEditable&&e.settings.contentHandler&&e.settings.contentHandler.handler&&e.settings.contentHandler.handler.sanitize){if(e.settings.contentHandler.handler.sanitize){i=e.settings.contentHandler.handler.sanitize}var u=i["#"+e.activeEditable.getId()];if(typeof u!=="undefined"){r=i}else{var a=e.activeEditable.obj.attr("class").split(" ");for(var f=0;f<a.length;f++){if(typeof i["."+a[f]]!=="undefined"){r=i["."+a[f]]}}}}if(typeof s==="undefined"||typeof r!=="undefined"){o(r)}if(typeof n==="string"){n=t("<div>"+n+"</div>").get(0)}else if(n instanceof t){n=t("<div>").append(n).get(0)}return t("<div>").append(s.clean_node(n)).html()}});return u});define("contenthandler/blockelementcontenthandler",["jquery","aloha/core","aloha/contenthandlermanager","contenthandler/contenthandler-utils","util/functions","util/html"],function(e,t,n,r,i,s){function l(t,n){var r=s.findNodeRight(n.lastChild,f);if(r&&"br"===r.nodeName.toLowerCase()){e(r).remove()}}function c(t,n){var r=e(n);r.filter(u).remove();if(e.browser.msie){r.filter("br.aloha-end-br").remove();r.filter(o).each(l)}r.children(a).each(c)}function h(t,n){var r=e(n);r.filter(u).append("");r.children(a).each(h)}function p(t,n){var r=e(n);r.filter(u).append("<br/>");r.children(a).each(p)}var o=s.BLOCKLEVEL_ELEMENTS.join();var u=s.BLOCKLEVEL_ELEMENTS.join(":empty,")+":empty";var a=":not(.aloha-block)";var f=i.complement(s.isIgnorableWhitespace);return n.createHandler({handleContent:function(n,i){if(!i){return n}var s=r.wrapContent(n);if(!s){return n}switch(i.command){case"initEditable":s.children(a).each(c);if(e.browser.msie&&e.browser.version<=7){s.children(a).each(h)}break;case"getContents":s.children(a).each(p);break}return s.html()}})});define("contenthandler/contenthandler-plugin",["jquery","aloha/plugin","aloha/contenthandlermanager","contenthandler/wordcontenthandler","contenthandler/genericcontenthandler","contenthandler/sanitizecontenthandler","contenthandler/blockelementcontenthandler"],function(e,t,n,r,i,s,o){var u={word:r,generic:i,sanitize:s,blockelement:o};var a=t.create("contenthandler",{init:function(){var e;for(e in u){if(u.hasOwnProperty(e)){n.register(e,u[e])}}}});return a});define("characterpicker/nls/i18n",{root:{"button.addcharacter.tooltip":"pick special characters"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("characterpicker/characterpicker-plugin",["aloha","jquery","aloha/plugin","ui/ui","ui/button","ui/floating","PubSub","i18n!characterpicker/nls/i18n"],function(e,t,n,r,i,s,o,u){function h(e){return e.$element.css("display")==="table"}function p(e){e.$element.click(function(e){e.stopPropagation()});t("body").click(function(n){if(!e._overlayActive||n.target===e.$element[0]||t(n.target).is(".aloha-icon-characterpicker")||t(n.target).find(".aloha-icon-characterpicker").length){return}e.hide()})}function d(e){a.keyup(function(t){if(27===t.keyCode&&h(e)){e.hide()}})}function v(e,t,n){var r=function(e){return e.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()})};var i;if(e.currentStyle){i=e.currentStyle[r(n)]}else if(document.defaultView&&document.defaultView.getComputedStyle){i=document.defaultView.getComputedStyle(e,null).getPropertyValue(n)}else{i=e.style[r(n)]}if(i){t.css(n,i)}}function m(e,n){var r={13:function(r){e.hide();n(r.text())},37:function(t){var n=t.prev();if(n.length){n.addClass("focused");t.removeClass("focused")}},38:function(n){var r=n.parent().prev();if(r.length){var i=t(r.children()[n.index()]).addClass("focused");if(i.length){n.removeClass("focused")}}},39:function(t){var n=t.next().addClass("focused");if(n.length){t.removeClass("focused")}},40:function(n){var r=n.parent().next();if(r.length){var i=t(r.children()[n.index()]).addClass("focused");if(i.length){n.removeClass("focused")}}}};a.keydown(function(t){t.stopPropagation();if(r[t.keyCode]&&h(e)){r[t.keyCode](e.$element.find(".focused"));return false}})}function g(e,n){var r=document.createElement("textarea");r.innerHTML=n;var i=t.grep(r.value.split(" "),function(e){return""!==e});var s=["<tr>"];var o=0;var u;while(u=i[o]){if(0!==o&&0===o%15){s.push("</tr><tr>")}s.push('<td unselectable="on">'+u+"</td>");o++}s.push("</tr>");e.$tbody.empty().append(s.join(""));e.$element.delegate("td","mouseover",function(){e.$element.find(".focused").removeClass("focused");t(this).addClass("focused")}).delegate("td","mouseout",function(){t(this).removeClass("focused")}).delegate("td","click",function(){e.$element.hide();e.onSelect(t(this).text())})}function y(e){var t=e.offset();if("fixed"===s.POSITION_STYLE){t.top-=f.scrollTop();t.left-=f.scrollLeft()}return t}function b(t){if(e.activeEditable){l.select();e.execCommand("insertHTML",false,t);l.endContainer=l.startContainer;l.endOffset=++l.startOffset;l.select()}}function w(n){var r=this;r.$element=t('<table class="aloha-character-picker-overlay" '+'unselectable="on" role="dialog"><tbody></tbody></table>');r.$element.mousedown(function(e){return false});r.onSelect=n;r.$tbody=r.$element.find("tbody");r.$element.appendTo(t("body"));p(r);d(r);m(r,n);e.bind("aloha-editable-deactivated",function(){r.hide()})}function E(e,n){var r=e.getEditableConfig(n.obj);if(!r){return null}var i=t.isArray(r)?r.join(" "):r;var s=c[i];if(!s){s=new w(b);g(s,i);c[i]=s}return s}var a=t(document);var f=t(window);var l;var c={};w.prototype={show:function(e){var t=this;t.$element.css(y(e)).css("position",s.POSITION_STYLE).show().find(".focused").removeClass("focused");t.$element.find("td").eq(0).addClass("focused");t._overlayActive=true},hide:function(){this.$element.hide();this._overlayActive=false}};var S=n.create("characterpicker",{settings:{},config:"&#38; &#34; &#162; &#8364; &#163; &#165; &#169; &#174; &#8482; &#8240; &#181; &#183; &#8226; &#8230; &#8242; &#8243; &#167; &#182; &#223; &#8249; &#8250; &#171; &#187; &#8216; &#8217; &#8220; &#8221; &#8218; &#8222; &#60; &#62; &#8804; &#8805; &#8211; &#8212; &#175; &#8254; &#164; &#166; &#168; &#161; &#191; &#710; &#732; &#176; &#8722; &#177; &#247; &#8260; &#215; &#185; &#178; &#179; &#188; &#189; &#190; &#402; &#8747; &#8721; &#8734; &#8730; &#8764; &#8773; &#8776; &#8800; &#8801; &#8712; &#8713; &#8715; &#8719; &#8743; &#8744; &#172; &#8745; &#8746; &#8706; &#8704; &#8707; &#8709; &#8711; &#8727; &#8733; &#8736; &#180; &#184; &#170; &#186; &#8224; &#8225; &#192; &#193; &#194; &#195; &#196; &#197; &#198; &#199; &#200; &#201; &#202; &#203; &#204; &#205; &#206; &#207; &#208; &#209; &#210; &#211; &#212; &#213; &#214; &#216; &#338; &#352; &#217; &#218; &#219; &#220; &#221; &#376; &#222; &#224; &#225; &#226; &#227; &#228; &#229; &#230; &#231; &#232; &#233; &#234; &#235; &#236; &#237; &#238; &#239; &#240; &#241; &#242; &#243; &#244; &#245; &#246; &#248; &#339; &#353; &#249; &#250; &#251; &#252; &#253; &#254; &#255; &#913; &#914; &#915; &#916; &#917; &#918; &#919; &#920; &#921; &#922; &#923; &#924; &#925; &#926; &#927; &#928; &#929; &#931; &#932; &#933; &#934; &#935; &#936; &#937; &#945; &#946; &#947; &#948; &#949; &#950; &#951; &#952; &#953; &#954; &#955; &#956; &#957; &#958; &#959; &#960; &#961; &#962; &#963; &#964; &#965; &#966; &#967; &#968; &#969; &#8501; &#982; &#8476; &#977; &#978; &#8472; &#8465; &#8592; &#8593; &#8594; &#8595; &#8596; &#8629; &#8656; &#8657; &#8658; &#8659; &#8660; &#8756; &#8834; &#8835; &#8836; &#8838; &#8839; &#8853; &#8855; &#8869; &#8901; &#8968; &#8969; &#8970; &#8971; &#9001; &#9002; &#9674; &#9824; &#9827; &#9829; &#9830;",_constructor:function(){this._super("characterpicker")},init:function(){function s(n){if(n<e.editables.length){E(t,e.editables[n]);setTimeout(function(){s(n+1)},100)}}var t=this;if(e.settings.plugins&&e.settings.plugins.characterpicker){t.settings=e.settings.plugins.characterpicker}var n=r.adopt("characterPicker",i,{tooltip:u.t("button.addcharacter.tooltip"),icon:"aloha-icon-characterpicker",scope:"Aloha.continuoustext",click:function(){if(t.overlay){l=e.Selection.rangeObject;var n=l.startContainer.parentNode;var r=t.overlay.$element;v(n,r,"font-family");v(n,r,"font-weight");v(n,r,"font-style");t.overlay.show(this.element)}}});setTimeout(function(){s(0)},100);e.bind("aloha-editable-activated",function(e,r){t.overlay=E(t,r.editable);if(t.overlay){n.show()}else{n.hide()}});o.sub("aloha.floating.changed",function(e){if(t.overlay){t.overlay.$element.css(y(n.element))}})}});return S});define("commands/inserthtml",["aloha/core","jquery","aloha/command","aloha/selection","util/dom","aloha/contenthandlermanager","aloha/console"],function(e,t,n,r,i,s,o){n.register("inserthtml",{action:function(n,r){function h(e){var n=t(e),s;if(!i.insertIntoDOM(n,r,u,false)){s=n.contents();if(i.isBlockLevelElement(e)||i.isListElement(e)){h(t("<br/>").get(0))}for(f=s.length-1;f>=0;--f){h(s[f])}}}var u=t(i.getEditingHostOf(r.startContainer)),a=r.commonAncestorContainer,f,l,c=[];n=s.handleContent(n,{contenthandler:e.settings.contentHandler.insertHtml});if(typeof n==="string"){n=t("<div>"+n+"</div>")}else if(n instanceof t){n=t("<div>").append(n)}else{throw"INVALID_VALUE_ERR"}c=n.contents();i.removeRange(r);for(f=c.length-1;f>=0;--f){h(c[f])}if(c.length>0){r=i.setCursorAfter(c.get(c.length-1))}else{r.select()}i.doCleanup({merge:true,removeempty:true},r,a);try{r.select()}catch(p){o.warn("Error:",p)}}})});define("commands/commands-plugin",["aloha/command","./inserthtml"],function(e,t){});define("block/blockmanager",["aloha","jquery","ui/scopes","aloha/observable","aloha/registry","util/class","util/strings","util/maps"],function(e,t,n,r,i,s,o,u){var a=t;var f=window.GENTICS;var l=new(s.extend(r,{defaults:{"aloha-block-type":"DefaultBlock"},blockTypes:null,blocks:null,_highlightedBlocks:null,_activeBlock:null,_dragdropEnabled:true,_constructor:function(){n.createScope("Aloha.Block");this.blockTypes=new i;this.blocks=new i;this._highlightedBlocks={}},registerEventHandlers:function(){var t=this;this._registerEventHandlersForDeactivatingAlohaBlock();this._registerEventHandlersForDeterminingCurrentlyActiveBlock();this._registerEventHandlersForBlockDeletion();this._registerEventHandlersForCutCopyPaste();this._registerEventHandlersForEditableActivated();e.bind("aloha-selection-changed",function(e,n,r){if(n&&a(n.getCommonAncestorContainer()).parents(".aloha-block").length>0){return}t._deactivateHighlightedBlocks()})},_registerEventHandlersForDeactivatingAlohaBlock:function(){var e=this;a(document).bind("click",function(t){if(u.isEmpty(e._highlightedBlocks)){return}if(a(t.target).closest(".aloha-ui,.aloha-block-do-not-deactivate,.aloha-block").length>0){return}e._deactivateHighlightedBlocks()})},_registerEventHandlersForDeterminingCurrentlyActiveBlock:function(){var e=this;this.bind("block-selection-change",function(t){if(t.length>0){e._activeBlock=t[0]}else{e._activeBlock=null}})},_registerEventHandlersForBlockDeletion:function(){var n=this;e.bind("aloha-command-will-execute",function(t,r){var i=r.commandId;var s=e.getSelection().getRangeCount()===0||e.getSelection().getRangeCount()===1&&e.getSelection().getRangeAt(0).endContainer===e.getSelection().getRangeAt(0).startContainer&&e.getSelection().getRangeAt(0).endContainer===a("body")[0]||e.getSelection().getRangeCount()===1&&e.getSelection().getRangeAt(0).endContainer===e.getSelection().getRangeAt(0).startContainer&&e.getSelection().getRangeAt(0).startOffset+1===e.getSelection().getRangeAt(0).endOffset;if(n._activeBlock&&(i==="delete"||i==="forwarddelete")&&s){r.preventDefault=true;n._activeBlock.destroy()}else if(!n._activeBlock&&(i==="delete"||i==="forwarddelete")&&e.getSelection().getRangeCount()===1&&e.getSelection().getRangeAt(0).collapsed===false){var o;o=function(e){var t;for(var n=0,r=e.length;n<r;n++){t=e[n];if(t.domobj.nodeType===1){var i=a(t.domobj);if(t.selection==="full"&&i.is(".aloha-block")){i.remove()}else{o(t.children)}}}};o(e.Selection.getSelectionTree())}});a(window.document).keydown(function(e){if(t(e.target).closest(".aloha-ui").length>0){return true}if(n._activeBlock&&(e.which===46||e.which===8)&&n._activeBlock._isInsideNestedEditable===false){if(a.browser.msie&&parseInt(a.browser.version,10)<=8&&n._activeBlock.$element.parents(".aloha-editable,.aloha-block").first().hasClass("aloha-editable")){n._activeBlock.destroy();e.preventDefault();return false}else if(n._activeBlock.shouldDestroy()){n._activeBlock.destroy();e.preventDefault();return false}}})},_registerEventHandlersForCutCopyPaste:function(){var t=this,n=false,r=false,i=null;a(window.document).keydown(function(i){if(e.activeEditable&&t._activeBlock){if(a.contains(t._activeBlock.$element.get(0),e.activeEditable.obj.get(0))){return}}if(t._activeBlock&&(i.ctrlKey||i.metaKey)&&i.which===67){n=true;t._activeBlock.$element.attr("data-aloha-block-copy-only-block","true");f.Utils.Dom.selectDomNode(t._activeBlock.$element[0])}if(t._activeBlock&&(i.ctrlKey||i.metaKey)&&i.which===88){r=true;t._activeBlock.$element.attr("data-aloha-block-copy-only-block","true");f.Utils.Dom.selectDomNode(t._activeBlock.$element[0])}});a(window.document).keyup(function(e){if(!r&&n&&(e.which===67||e.which===18||e.which===91)){n=false;t._activeBlock.$element.removeAttr("data-aloha-block-copy-only-block");if(i){i=null}}if(r&&(e.which===67||e.which===18||e.which===88)){r=false}})},_registerEventHandlersForEditableActivated:function(){var t=this;e.bind("aloha-editable-activated",function(e,n){if(n.editable){var r=t.getBlock(n.editable.obj.closest(".aloha-block"));if(r){r.activate()}}})},initializeBlockLevelDragDrop:function(){var t=this;a.each(e.editables,function(e,n){n.obj.data("block-dragdrop",t._dragdropEnabled);t.createBlockLevelSortableForEditableOrBlockCollection(n.obj)});e.bind("aloha-editable-created",function(e,n){n.obj.data("block-dragdrop",t._dragdropEnabled);t.createBlockLevelSortableForEditableOrBlockCollection(n.obj)})},createBlockLevelSortableForEditableOrBlockCollection:function(e){var t=this;if(!e.hasClass("aloha-block-blocklevel-sortable")){e.addClass("aloha-block-blocklevel-sortable").sortable({revert:100,handle:".aloha-block-draghandle-blocklevel",connectWith:".aloha-block-blocklevel-sortable.aloha-block-dropzone",disabled:!t._dragdropEnabled,start:function(e,t){t.item.data("block-sort-allowed",t.item.parents(".aloha-block-dropzone").length>0)},change:function(e,t){t.item.data("block-sort-allowed",t.placeholder.parents(".aloha-block-dropzone").length>0)},stop:function(e,t){if(!t.item.data("block-sort-allowed")){a(this).sortable("cancel")}t.item.removeData("block-sort-allowed")}});e.get(0).ondragstart=function(e,t){if(!t||!t.helper||!t.helper.is(".aloha-block")){return false}}}},setDragDropState:function(e){this._dragdropEnabled=e},getDragDropState:function(){return this._dragdropEnabled},registerBlockType:function(e,t){n.createScope("Aloha.Block."+e,"Aloha.Block");this.blockTypes.register(e,t)},_blockify:function(t,n){var r=this,i=a(t),s=e.require("block/block-plugin"),o=i[0].tagName.toLowerCase(),u,f;if(a.inArray(o,s.settings.rootTags)===-1){e.Log.error("block/blockmanager","Blocks can only be created from ["+s.settings.rootTags.join(", ")+"] element. You passed "+o+".");return}u=this.getConfig(i,n);if(!this.blockTypes.has(u["aloha-block-type"])){e.Log.error("block/blockmanager","Block Type "+u["aloha-block-type"]+" not found!");return}f=new(this.blockTypes.get(u["aloha-block-type"]))(i,u);f.$element.addClass("aloha-block-"+u["aloha-block-type"]);this.blocks.register(f.getId(),f)},_unblockify:function(e){var t=this.getBlock(e);if(t){t.unblock()}},getConfig:function(e,t){var n=e.clone(true);var r=n.data();var i={};n.removeData();for(var s in r){if(r.hasOwnProperty(s)){i[o.camelCaseToDashes(s)]=r[s]}}return a.extend({},this.defaults,t,i)},getBlock:function(e){var t,n;if(typeof e==="object"){n=a(e);if(n.hasClass("aloha-block-inner")){n=n.parent()}t=n.attr("id")}else{t=e}return this.blocks.get(t)},_unregisterBlock:function(e){var t;if(typeof e==="object"){t=e.getId()}else{t=e}this.blocks.unregister(t)},_deactivateHighlightedBlocks:function(){a.each(a.extend({},this._highlightedBlocks),function(e){var t=l.getBlock(e);if(t){t.deactivate()}})},_getHighlightedBlocks:function(){var e={};a.each(this.blocks.getEntries(),function(t,n){if(n.isActive()){e[t]=n}});return e},_setHighlighted:function(e){this._highlightedBlocks[e.id]=true},_setUnhighlighted:function(e){delete this._highlightedBlocks[e.id]}}));e.Block=e.Block||{};e.Block.BlockManager=l;return l});define("block/editormanager",["aloha/registry"],function(e){return new(e.extend({createEditor:function(e){if(!this.has(e.type)){throw'Editor for type "'+e.type+'" not found.'}var t=this.get(e.type);return new t(e)}}))});define("block/sidebarattributeeditor",["jquery","block/blockmanager","aloha/sidebar","block/editormanager","util/class"],function(e,t,n,r,i){return new(i.extend({_sidebar:null,init:function(){this._sidebar=n.right.show();t.bind("block-selection-change",this._onBlockSelectionChange,this)},_onBlockSelectionChange:function(t){var n=this;if(!this._sidebar){return}e.each(t,function(){var t=this.getSchema(),i=this,s=[];if(!t){return}n._sidebar.addPanel({title:i.getTitle(),expanded:true,onInit:function(){var n=e("<form />");n.submit(function(){return false});e.each(t,function(e,t){var o=r.createEditor(t);o.bind("change",function(t){i.attr(e,t)});i.bind("change",function(){o.setValue(i.attr(e))});n.append(o.render());o.setValue(i.attr(e));s.push(o)});this.setContent(n)},deactivate:function(){e.each(s,function(e,t){t._deactivate()});this.isActive=false;this.effectiveElement=null}})})}}))});define("block/block",["aloha","jquery","block/blockmanager","aloha/observable","ui/scopes","util/class","PubSub"],function(e,t,n,r,i,s,o){function h(e){var t=e.closest(".aloha-editable");if(t.length){return!!t.data("block-dragdrop")}else{return true}}var u=window.GENTICS;var a=s.extend(r,{title:null,id:null,$element:null,_currentlyRendering:false,_initialized:false,_isInsideNestedEditable:false,_constructor:function(e,n){var r=this;this.$element=e;if(e.attr("id")){this.id=e.attr("id")}else{this.id=u.Utils.guid();e.attr("id",this.id)}e.contentEditable(false);e.addClass("aloha-block");if(this.isDraggable()){e.find("img").attr("draggable","false");e.find("a").attr("draggable","false")}t.each(n,function(e,t){r._setAttribute(e,t)});this._onElementClickHandler=function(e){if(t(e.target).closest(".aloha-block").get(0)===r.$element.get(0)){r._fixScrollPositionBugsInIE();r.activate(e.target,e)}};this._connectThisBlockToDomElement(e,function(){o.pub("aloha.block.initialized",{block:r})});this._initialized=true},_onElementClickHandler:null,_preventSelectionChangedEventHandler:function(n){if("dblclick"!==n.type&&!t(n.target).is(".aloha-editable")){e.Selection.preventSelectionChanged()}},_connectThisBlockToDomElement:function(e,n){var r=this;var i=t(e);this._disconnectFromDomElement();this.$element=i;this.$element.bind("click",this._onElementClickHandler);this.$element.bind("mousedown",this._preventSelectionChangedEventHandler);this.$element.bind("focus",this._preventSelectionChangedEventHandler);this.$element.bind("dblclick",this._preventSelectionChangedEventHandler);this.init(this.$element,function(){window.setTimeout(function(){r._postProcessElementIfNeeded();if(n){n()}},5)})},_disconnectFromDomElement:function(){if(this.$element){this.$element.unbind("click",this._onElementClickHandler);this.$element.unbind("mousedown",this._preventSelectionChangedEventHandler);this.$element.unbind("focus",this._preventSelectionChangedEventHandler);this.$element.unbind("dblclick",this._preventSelectionChangedEventHandler)}},_fixScrollPositionBugsInIE:function(){var e=t(window).scrollTop();window.setTimeout(function(){if(t(window).scrollTop()!==e){t(window).scrollTop(e)}},10)},init:function(e,t){t()},shouldDestroy:function(){var e=this.$element.parent().closest(".aloha-block,.aloha-editable,.aloha-block-collection");if(e.hasClass("aloha-block-collection")&&this.$element[0].tagName.toLowerCase()==="div"){return true}else{return e.hasClass("aloha-editable")}},destroy:function(e){if(!this.shouldDestroy()&&e!==true)return;var t=this;var r=new u.Utils.RangeObject;r.startContainer=r.endContainer=this.$element.parent()[0];r.startOffset=r.endOffset=u.Utils.Dom.getIndexInParent(this.$element[0]);n.trigger("block-delete",this);this.free();var i=this.$element[0].tagName.toLowerCase()==="span";this.$element.fadeOut("fast",function(){t.$element.remove();n.trigger("block-selection-change",[]);window.setTimeout(function(){if(i){r.select()}},5)})},unblock:function(){this.deactivate();this._disconnectFromDomElement();this.$element.removeClass("aloha-block");this.$element.children(".aloha-block-handle").remove();this.free()},free:function(){n._unregisterBlock(this);this.unbindAll()},getId:function(){return this.id},getSchema:function(){return null},getTitle:function(){return this.title},isDraggable:function(){if(this.$element[0].tagName.toLowerCase()==="div"&&this.$element.parents(".aloha-editable,.aloha-block,.aloha-block-collection").first().hasClass("aloha-block-collection")){return true}return this.$element.parents(".aloha-editable,.aloha-block").first().hasClass("aloha-editable")},activate:function(r,s){var o=[];t.each(n._getHighlightedBlocks(),function(){this.deactivate()});if(this.$element.attr("data-block-skip-scope")!=="true"){i.setScope("Aloha.Block."+this.attr("aloha-block-type"))}this.$element.addClass("aloha-block-active");this._highlight();o.push(this);this.$element.parents(".aloha-block").each(function(){var e=n.getBlock(this);if(e){e._highlight();o.push(e)}});if(t(r).closest(".aloha-editable,.aloha-block,.aloha-table-cell-editable,.aloha-table-cell_active").first().hasClass("aloha-block")){this._isInsideNestedEditable=false;e.getSelection().removeAllRanges()}else{this._isInsideNestedEditable=true;if(s){e.Selection.updateSelection(s)}}n.trigger("block-activate",o);n.trigger("block-selection-change",o)},deactivate:function(){var e=this;var t=[this];this._unhighlight();this.$element.parents(".aloha-block").each(function(){t.push(this);e._unhighlight()});this.$element.removeClass("aloha-block-active");n.trigger("block-deactivate",t);n.trigger("block-selection-change",[])},isActive:function(){return this.$element.hasClass("aloha-block-active")},_highlight:function(){this.$element.addClass("aloha-block-highlighted");n._setHighlighted(this)},_unhighlight:function(){this.$element.removeClass("aloha-block-highlighted");n._setUnhighlighted(this)},_update:function(){var e=this;if(this._currentlyRendering)return;if(!this._initialized)return;this._currentlyRendering=true;this.update(this.$element,function(){e._postProcessElementIfNeeded()});this._currentlyRendering=false},update:function(e,t){t()},_postProcessElementIfNeeded:function(){this.createEditablesIfNeeded();this._checkThatNestedBlocksAreStillConsistent();this._makeNestedBlockCollectionsSortable();this.renderBlockHandlesIfNeeded();if(this.isDraggable()&&this.$element[0].tagName.toLowerCase()==="span"){this._setupDragDropForInlineElements();this._disableUglyInternetExplorerDragHandles()}else if(this.isDraggable()&&this.$element[0].tagName.toLowerCase()==="div"){this._setupDragDropForBlockElements();this._disableUglyInternetExplorerDragHandles()}this._hideDragHandlesIfDragDropDisabled();this._attachDropzoneHighlightEvents()},_checkThatNestedBlocksAreStillConsistent:function(){this.$element.find(".aloha-block").each(function(){var e=n.getBlock(this);if(e&&e.$element[0]!==this){e._connectThisBlockToDomElement(this)}})},_makeNestedBlockCollectionsSortable:function(){var e=this;this.$element.find(".aloha-block-collection").each(function(){var r=t(this);if(r.closest(".aloha-block").get(0)===e.$element.get(0)){n.createBlockLevelSortableForEditableOrBlockCollection(r)}})},_disableUglyInternetExplorerDragHandles:function(){if(t.browser.msie){this.$element.get(0).onresizestart=function(e){return false};this.$element.get(0).oncontrolselect=function(e){return false};this.$element.get(0).onmovestart=function(e){return false}}},_hideDragHandlesIfDragDropDisabled:function(){if(!this._dd_isDragdropEnabled()){this.$element.find(".aloha-block-draghandle").each(function(){var e=t(this);if(!h(e)){e.removeClass("aloha-block-draghandle")}})}},_attachDropzoneHighlightEvents:function(){var e=this;this.$element.delegate(".aloha-block-draghandle","mousedown",function(){var n=e.$element.parents(".aloha-editable").first().data("block-dropzones")||[];t.each(n,function(e,n){var r=t(n);t(r).each(function(){if(t(this).data("block-dragdrop")){t(this).addClass("aloha-block-dropzone")}})});t(document).one("mouseup.aloha-block-dropzone",function(n){var r=e.$element.parents(".aloha-editable").first().data("block-dropzones")||[];t.each(r,function(e,n){t(n).removeClass("aloha-block-dropzone")})})})},_setupDragDropForInlineElements:function(){var e=this;var n=null;var r=false;var i=null;var s=null;var o=function(){if(n){var o=t(n);if(o.is(".aloha-block-dropInlineElementIntoEmptyBlock")){o.children().remove();o.append(i)}else if(o.is(".aloha-block-droppable-right")){o.html(o.html()+" ");o.after(i)}else{if(o.prev("[data-i]").length>0){o.prev("[data-i]").html(o.prev("[data-i]").html()+" ")}o.html(" "+o.html());o.before(i)}i.removeClass("ui-draggable").css({left:0,top:0});e._fixScrollPositionBugsInIE()}t(".aloha-block-dropInlineElementIntoEmptyBlock").removeClass("aloha-block-dropInlineElementIntoEmptyBlock");s.droppable("destroy");s=null;r=true};var u=[];this.$element.draggable({handle:".aloha-block-draghandle",scope:"aloha-block-inlinedragdrop",disabled:!this._dd_isDragdropEnabled(),revert:function(){return n===null||!r},revertDuration:250,stop:function(){if(t.browser.msie&&7===parseInt(t.browser.version,10)){o()}t.each(u,function(){e._dd_traverseDomTreeAndRemoveSpans(this)});i=null;u=[]},start:function(){r=false;u=[];t(".aloha-editable").children("p:empty").html("&nbsp;");var a={tolerance:"pointer",addClasses:false,scope:"aloha-block-inlinedragdrop",over:function(r,s){if(t.inArray(this,u)===-1){u.push(this)}var o=1===t(this).contents().length&&1===t(this).children("br").length;i=s.draggable;if(t(this).is(":empty")||o||t(this).html()==="&nbsp;"){t(this).addClass("aloha-block-dropInlineElementIntoEmptyBlock");n=this;return}e._dd_traverseDomTreeAndWrapCharactersWithSpans(this);t("span[data-i]",this).droppable({tolerance:"pointer",addClasses:false,scope:"aloha-block-inlinedragdrop",over:function(){if(n){t(n).removeClass("aloha-block-droppable")}n=this;t(this).addClass("aloha-block-droppable")},out:function(){t(this).removeClass("aloha-block-droppable");if(n===this){n=null}}});t.ui.ddmanager.prepareOffsets(s.draggable.data("draggable"),r)},out:function(){t(this).removeClass("aloha-block-dropInlineElementIntoEmptyBlock")},drop:function(){if(!(t.browser.msie&&7===parseInt(t.browser.version,10))){o()}}};s=t(".aloha-editable.aloha-block-dropzone").children(":not(.aloha-block)");s.droppable(a);t(".aloha-table-cell-editable").droppable(a)}})},_dd_traverseDomTreeAndWrapCharactersWithSpans:function(e){var t;for(var n=0,r=e.childNodes.length;n<r;n++){t=e.childNodes[n];if(t.nodeType===1){if(!~t.className.indexOf("aloha-block")&&t.attributes["data-i"]===undefined){this._dd_traverseDomTreeAndWrapCharactersWithSpans(t)}else if(t.attributes["data-i"]){return}}else if(t.nodeType===3){var i=this._dd_insertSpans(t);n+=i;r+=i}}},_dd_splitText:function(e){var t=e.split(/(?=\b)/);var n=[];var r=false;for(var i=0,s=t.length;i<s;i++){if(!/[^\t\n\r ]/.test(t[i])){r=true}else{if(r){n.push(" "+t[i]);r=false}else{n.push(t[i])}}}if(r){n[n.length-1]+=" "}return n},_dd_insertSpans:function(e){var n=e.nodeValue;if(!/[^\t\n\r ]/.test(n)){return 0}var r=document.createDocumentFragment();var i=this._dd_splitText(n);var s=i.length;var o,u,a,f;var l=0;for(var c=0;c<s;c++){u=i[c];if(u.length===0)continue;a=Math.floor(u.length/2);var h=parseInt(t.browser.version,10);if(t.browser.msie&&(7===h||8===h)){a=0}if(a>0){o=document.createElement("span");o.appendChild(document.createTextNode(u.substr(0,a)));o.setAttribute("data-i",c);r.appendChild(o);l++}o=document.createElement("span");f=u.substr(a);o.appendChild(document.createTextNode(f));o.setAttribute("data-i",c);o.setAttribute("class","aloha-block-droppable-right");r.appendChild(o);l++}e.parentNode.replaceChild(r,e);return l-1},_dd_traverseDomTreeAndRemoveSpans:function(e){var t=[],n;n=function(e){var r=false,i,s;var o;for(var u=0,a=e.childNodes.length;u<a;u++){o=e.childNodes[u];if(o.nodeType===1){if(o.attributes["data-i"]!==undefined){if(!r){r=true;i="";s=undefined}if(r){i+=o.firstChild.nodeValue;if(s){t.push(s)}s=o}}else{if(r){r=false;s.parentNode.replaceChild(document.createTextNode(i),s)}if(!~o.className.indexOf("aloha-block")){n(o)}}}}if(r){s.parentNode.replaceChild(document.createTextNode(i),s)}};n(e);for(var r=0,i=t.length;r<i;r++){t[r].parentNode.removeChild(t[r])}},_dd_isDragdropEnabled:function(){return h(this.$element.parent())},_setupDragDropForBlockElements:function(){this.$element.find(".aloha-block-draghandle").addClass("aloha-block-draghandle-blocklevel")},createEditablesIfNeeded:function(){this.$element.find(".aloha-editable").aloha()},renderBlockHandlesIfNeeded:function(){if(this.isDraggable()){if(this.$element.children(".aloha-block-draghandle").length===0){this.$element.prepend('<span class="aloha-block-handle aloha-block-draghandle aloha-cleanme"></span>')}}},attr:function(n,r,i){var s=this,o=false;if(arguments.length>=2){if(n.substr(0,12)==="aloha-block-"){e.Log.error("block/block","It is not allowed to set internal block attributes (starting with aloha-block-) through Block.attr() (You tried to set "+n+")");return}if(this._getAttribute(n)!==r){o=true}this._setAttribute(n,r)}else if(typeof n==="object"){t.each(n,function(t,n){if(t.substr(0,12)==="aloha-block-"){e.Log.error("block/block","It is not allowed to set internal block attributes (starting with aloha-block-) through Block.attr() (You tried to set "+t+")");return}if(s._getAttribute(t)!==n){o=true}s._setAttribute(t,n)})}else if(typeof n==="string"){return this._getAttribute(n)}else{return this._getAttributes()}if(o&&!i){this._update();this.trigger("change");if(e.activeEditable){e.activeEditable.smartContentChange({type:"block-change"})}}return null},_setAttribute:function(e,t){this.$element.attr("data-"+e.toLowerCase(),t)},_getAttribute:function(e){return this.$element.attr("data-"+e.toLowerCase())},_getAttributes:function(){var e={};t.each(this.$element[0].attributes,function(t,n){if(n.name.substr(0,5)==="data-"){e[n.name.substr(5).toLowerCase()]=n.value}});return e}});var f=a.extend({update:function(e,t){t()}});var l=a.extend({title:"Debugging",init:function(e,t){this.update(e,t)},update:function(e,n){e.css({display:"block"});var r='<table class="debug-block">';t.each(this.attr(),function(e,t){r+="<tr><th>"+e+"</th><td>"+t+"</td></tr>"});r+="</table>";e.html(r);n()}});var c=a.extend({title:"EmptyBlock",init:function(){},activate:function(){},deactivate:function(){},renderBlockHandlesIfNeeded:function(){}});return{AbstractBlock:a,DefaultBlock:f,DebugBlock:l,EmptyBlock:c}});define("block/blockcontenthandler",["jquery","aloha/contenthandlermanager","block/blockmanager"],function(e,t,n){var r=t.createHandler({handleContent:function(t){if(typeof t==="string"){t=e("<div>"+t+"</div>")}else if(t instanceof e){t=e("<div>").append(t)}if(t.find('.aloha-block[data-aloha-block-copy-only-block="true"]').length>0){t.find(".aloha-block:not([id])").remove();t.find(".aloha-block + span:empty").remove();t.find("div:empty").remove();t.find("br.Apple-interchange-newline").remove();t.find(".aloha-block").prev("br").remove();t.find("div > br:only-child").parent().remove()}t.find(".aloha-block").each(function(){var t=e(this);var r={};var i={};e.each(t[0].attributes,function(e,t){if(t.nodeName==="id")return;if(t.nodeName.match(/^data-/)){i[t.nodeName.substr(5)]=t.nodeValue}else{r[t.nodeName]=t.nodeValue}});var s=GENTICS.Utils.guid();var o=e("<"+this.tagName+"/>").attr(r).attr("id",s).removeClass("aloha-block-active").removeClass("aloha-block").html(t.html());t.replaceWith(o);window.setTimeout(function(){n._blockify(e("#"+s),i)},50)});return t.html()}});return r});define("block/editor",["jquery","aloha/observable","util/class"],function(e,t,n){var r=n.extend(t,{schema:null,_constructor:function(e){this.schema=e},render:function(){},getValue:function(){},setValue:function(e){},destroy:function(){},_deactivate:function(){this.trigger("change",this.getValue());this.destroy()}});var i=r.extend({formInputElementDefinition:null,_$formInputElement:null,render:function(){var t=e('<div class="aloha-block-editor" />');var n=GENTICS.Utils.guid();t.append(this.renderLabel().attr("id",n));t.append(this.renderFormElement().attr("id",n));return t},renderLabel:function(){var t=e("<label />");t.html(this.schema.label);return t},renderFormElement:function(){var t=this;this._$formInputElement=e(this.formInputElementDefinition);this.afterRenderFormElement(this._$formInputElement);this._$formInputElement.change(function(){t.trigger("change",t.getValue())});return this._$formInputElement},afterRenderFormElement:function(e){},getValue:function(){return this._$formInputElement.val()},setValue:function(e){this._$formInputElement.val(e)},destroy:function(){this._$formInputElement.remove()}});var s=i.extend({formInputElementDefinition:'<input type="text" />'});var o=i.extend({formInputElementDefinition:'<input type="range" />',afterRenderFormElement:function(e){if(!this.schema.range)return;if(this.schema.range.min){e.attr("min",this.schema.range.min)}if(this.schema.range.max){e.attr("max",this.schema.range.max)}if(this.schema.range.step){e.attr("step",this.schema.range.step)}}});var u=i.extend({formInputElementDefinition:'<input type="url" />'});var a=i.extend({formInputElementDefinition:'<input type="email" />'});var f=i.extend({formInputElementDefinition:"<select />",afterRenderFormElement:function(t){e.each(this.schema.values,function(){var n=this;t.append(e("<option />").attr("value",n.key).html(n.label))})}});var l=i.extend({formInputElementDefinition:"<button />",afterRenderFormElement:function(e){var t=this;e.html(this.schema.buttonLabel);e.click(function(){t.schema.callback()})}});return{AbstractEditor:r,AbstractFormElementEditor:i,StringEditor:s,NumberEditor:o,UrlEditor:u,EmailEditor:a,SelectEditor:f,ButtonEditor:l}});define("block/nls/i18n",{root:{"button.toggledragdrop.tooltip":"Toggle Drag & Drop"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("block/block-plugin",["aloha","aloha/plugin","jquery","aloha/contenthandlermanager","block/blockmanager","block/sidebarattributeeditor","block/block","block/editormanager","block/blockcontenthandler","block/editor","ui/ui","ui/toggleButton","i18n!block/nls/i18n","i18n!aloha/nls/i18n","jqueryui"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=["div","span"];var v=t.create("block",{config:[],settings:{},init:function(){var t=this;if(!this.settings.rootTags){this.settings.rootTags=d}i.registerBlockType("DebugBlock",o.DebugBlock);i.registerBlockType("DefaultBlock",o.DefaultBlock);i.registerBlockType("EmptyBlock",o.EmptyBlock);u.register("string",f.StringEditor);u.register("number",f.NumberEditor);u.register("url",f.UrlEditor);u.register("email",f.EmailEditor);u.register("select",f.SelectEditor);u.register("button",f.ButtonEditor);r.register("block",a);i.setDragDropState(t.isDragDropEnabled());i.registerEventHandlers();i.initializeBlockLevelDragDrop();e.bind("aloha-plugins-loaded",function(){t._createBlocks();if(false!==t.settings["sidebarAttributeEditor"]){s.init()}});this.createButtons();e.bind("aloha-editable-created",function(e,n){t.setDropzones(n.obj)});e.bind("aloha-editable-activated",function(e,n){t.applyButtonConfig(n.editable)})},applyButtonConfig:function(e){if(this._isDragdropToggleEnabled(e)){this._toggleDragDropButton.show();this._toggleDragDropButton.setState(this._getDragdropState(e))}else{this._toggleDragDropButton.hide()}},_isDragdropToggleEnabled:function(e){var t=this.getEditableConfig(e.obj);var n=function(){return t[0]==="toggleDragdrop"||t.toggleDragdrop==true||t.toggleDragdrop=="true"||t.toggleDragdrop==1||t.toggleDragdrop=="1"};var r=this.settings&&this.settings.config&&this.settings.config.toggleDragdropGlobal||n();return r&&this.isDragDropEnabled()},_getDragdropState:function(e){return this.settings&&this.settings.config&&this.settings.config.toggleDragdropGlobal?i.getDragDropState():e.obj.data("block-dragdrop")},_toggleDragdropState:function(t){if(this.settings&&this.settings.config&&this.settings.config.toggleDragdropGlobal){var n=!i.getDragDropState();i.setDragDropState(n);for(var r=0;r<e.editables.length;r++){var t=e.editables[r];this._setDragDropStateForEditable(t.obj,n)}}else{var s=!t.obj.data("block-dragdrop");this._setDragDropStateForEditable(t.obj,s)}},createButtons:function(){var t=this;this._toggleDragDropButton=l.adopt("toggleDragDrop",c,{tooltip:h.t("button.toggledragdrop.tooltip"),icon:"aloha-icon aloha-icon-toggledragdrop",scope:"Aloha.continuoustext",click:function(){t._toggleDragdropState(e.activeEditable)}})},setDropzones:function(e){var t=this;var n=t.getEditableConfig(e);var r=n&&n.dropzones||t.settings.dropzones;if(r){e.data("block-dropzones",r)}else{e.data("block-dropzones",[".aloha-editable"])}},isDragDropEnabled:function(){if(this.settings&&typeof this.settings.dragdrop!=="undefined"){return this.settings.dragdrop===true||this.settings.dragdrop==="true"||this.settings.dragdrop===1||this.settings.dragdrop==="1"}else{return true}},_createBlocks:function(){if(!this.settings.defaults){this.settings.defaults={}}n.each(this.settings.defaults,function(e,t){n(e).alohaBlock(t)})},_setDragDropStateForEditable:function(e,t){e.data("block-dragdrop",t);if(e.hasClass("ui-sortable")){e.sortable("option","disabled",!t)}e.find(".aloha-block.ui-draggable").each(function(){n(this).draggable("option","disabled",!t)});e.find(".aloha-block-handle").each(function(){if(t){n(this).addClass("aloha-block-draghandle")}else{n(this).removeClass("aloha-block-draghandle")}})}});n.fn.alohaBlock=function(e){e=e||{};n(this).each(function(t,n){i._blockify(n,e)});return n(this)};n.fn.mahaloBlock=function(){n(this).each(function(e,t){i._unblockify(t)})};return v});define("align/nls/i18n",{root:{"button.alignright.tooltip":"Align to the right","button.alignleft.tooltip":"Align to the left","button.aligncenter.tooltip":"Center","button.alignjustify.tooltip":"Justify","button.aligntop.tooltip":"Align to the top","button.alignmiddle.tooltip":"Align to the middle","button.alignbottom.tooltip":"Align to the bottom"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("align/align-plugin",["aloha","aloha/plugin","ui/ui","ui/toggleButton","i18n!align/nls/i18n","i18n!aloha/nls/i18n","jquery","PubSub"],function(e,t,n,r,i,s,o,u){var a=window.GENTICS;return t.create("align",{_constructor:function(){this._super("align")},config:{alignment:["right","left","center","justify","top","middle","bottom"]},alignment:"",verticalAlignment:"",lastAlignment:"",lastVerticalAlignment:"",init:function(){this.createButtons();var t=this;e.bind("aloha-editable-activated",function(e,n){t.applyButtonConfig(n.editable.obj)});u.sub("aloha.selection.context-change",function(n){var r=n.range;if(e.activeEditable){t.buttonPressed(r)}})},buttonPressed:function(e){this.horizontalButtonPressed(e);this.verticalButtonPressed(e)},horizontalButtonPressed:function(t){var n=this;this.lastAlignment=this.alignment;this.alignment="";t.findMarkup(function(){if(this.style.textAlign!==""){n.alignment=this.style.textAlign;return true}n.alignment=o(this).css("text-align")},e.activeEditable.obj);if(this.alignment!=this.lastAlignment){this._alignRightButton.setState(false);this._alignLeftButton.setState(false);this._alignCenterButton.setState(false);this._alignJustifyButton.setState(false);switch(this.alignment){case"right":this._alignRightButton.setState(true);break;case"center":this._alignCenterButton.setState(true);break;case"justify":this._alignJustifyButton.setState(true);break;default:this._alignLeftButton.setState(true);this.alignment="left";break}}},verticalButtonPressed:function(t){var n=this;this.lastVerticalAlignment=this.verticalAlignment;this.verticalAlignment="";t.findMarkup(function(){if(this.style.verticalAlign!==""){n.verticalAlignment=this.style.verticalAlign;return true}n.verticalAlignment=o(this).css("vertical-align")},e.activeEditable.obj);if(this.verticalAlignment!=this.lastVerticalAlignment){this._alignTopButton.setState(false);this._alignMiddleButton.setState(false);this._alignBottomButton.setState(false);switch(this.verticalAlignment){case"top":this._alignTopButton.setState(true);break;case"middle":this._alignMiddleButton.setState(true);break;case"bottom":this._alignBottomButton.setState(true);break;default:this._alignTopButton.setState(true);this.verticalAlignment="top";break}}},applyButtonConfig:function(e){var t=this.getEditableConfig(e);if(t&&t.alignment&&!this.settings.alignment){t=t}else if(t[0]&&t[0].alignment){t=t[0]}else if(this.settings.alignment){t.alignment=this.settings.alignment}if(typeof t.alignment==="undefined"){t=this.config}if(o.inArray("right",t.alignment)!=-1){this._alignRightButton.show(true)}else{this._alignRightButton.show(false)}if(o.inArray("left",t.alignment)!=-1){this._alignLeftButton.show(true)}else{this._alignLeftButton.show(false)}if(o.inArray("center",t.alignment)!=-1){this._alignCenterButton.show(true)}else{this._alignCenterButton.show(false)}if(o.inArray("justify",t.alignment)!=-1){this._alignJustifyButton.show(true)}else{this._alignJustifyButton.show(false)}if(o.inArray("top",t.alignment)!=-1){this._alignTopButton.show(true)}else{this._alignTopButton.show(false)}if(o.inArray("middle",t.alignment)!=-1){this._alignMiddleButton.show(true)}else{this._alignMiddleButton.show(false)}if(o.inArray("bottom",t.alignment)!=-1){this._alignBottomButton.show(true)}else{this._alignBottomButton.show(false)}},createButtons:function(){var e=this;this._alignLeftButton=n.adopt("alignLeft",r,{tooltip:i.t("button.alignleft.tooltip"),icon:"aloha-icon aloha-icon-align aloha-icon-align-left",scope:"Aloha.continuoustext",click:function(){e.align("left")}});this._alignCenterButton=n.adopt("alignCenter",r,{tooltip:i.t("button.aligncenter.tooltip"),icon:"aloha-icon aloha-icon-align aloha-icon-align-center",scope:"Aloha.continuoustext",click:function(){e.align("center")}});this._alignRightButton=n.adopt("alignRight",r,{tooltip:i.t("button.alignright.tooltip"),icon:"aloha-icon aloha-icon-align aloha-icon-align-right",scope:"Aloha.continuoustext",click:function(){e.align("right")}});this._alignJustifyButton=n.adopt("alignJustify",r,{tooltip:i.t("button.alignjustify.tooltip"),icon:"aloha-icon aloha-icon-align aloha-icon-align-justify",scope:"Aloha.continuoustext",click:function(){e.align("justify")}});this._alignTopButton=n.adopt("alignTop",r,{tooltip:i.t("button.aligntop.tooltip"),icon:"aloha-icon aloha-icon-align aloha-icon-align-top",scope:"table.cell",click:function(){e.verticalAlign("top")}});this._alignMiddleButton=n.adopt("alignMiddle",r,{tooltip:i.t("button.alignmiddle.tooltip"),icon:"aloha-icon aloha-icon-align aloha-icon-align-middle",scope:"table.cell",click:function(){e.verticalAlign("middle")}});this._alignBottomButton=n.adopt("alignBottom",r,{tooltip:i.t("button.alignbottom.tooltip"),icon:"aloha-icon aloha-icon-align aloha-icon-align-bottom",scope:"table.cell",click:function(){e.verticalAlign("bottom")}})},verticalAlign:function(t){var n=this;var r=e.Selection.getRangeObject();this.lastVerticalAlignment=this.verticalAlignment;this.verticalAlignment=t;var i=this.getSelectedCells(r);if(i){n.toggleAlign(i,"vertical-align")}if(this.verticalAlignment!=this.lastVerticalAlignment){switch(this.lastVerticalAlignment){case"top":this._alignTopButton.setState(false);break;case"middle":this._alignMiddleButton.setState(false);break;case"bottom":this._alignBottomButton.setState(false);break}}r.select()},align:function(t){var n=this;var r=e.Selection.getRangeObject();this.lastAlignment=this.alignment;this.alignment=t;var i=r.getCommonAncestorContainer();var s=this.getSelectedCells(r);if(s){n.toggleAlign(s)}else if(!a.Utils.Dom.isEditingHost(i)){n.toggleAlign(i)}else{var u=[];o.each(e.Selection.getRangeObject().getSelectionTree(),function(){if(this.selection!=="none"&&this.domobj.nodeType!==3){u.push(this.domobj)}});n.toggleAlign(u)}if(this.alignment!=this.lastAlignment){switch(this.lastAlignment){case"right":this._alignRightButton.setState(false);break;case"left":this._alignLeftButton.setState(false);break;case"center":this._alignCenterButton.setState(false);break;case"justify":this._alignJustifyButton.setState(false);break}}r.select()},getSelectedCells:function(t){var n;var r=t.findMarkup(function(){if(o(this).is("td,th")){n=this}return o(this).is("table.aloha-table")},e.activeEditable.obj);var i=o(r).find(".aloha-cell-selected");return i.length?i:n},toggleAlign:function(e,t){var n=this;t=t||"text-align";var r=t==="vertical-align"?n.verticalAlignment:n.alignment;var i=true;o(e).each(function(){var e=o(this).css(t);if(e!=r){i=false;return false}});o(e).each(function(){var e=o(this).css(t);if(e==r&&i){o(this).css(t,"")}else{o(this).css(t,r)}})}})});define("abbr/nls/i18n",{root:{"floatingmenu.tab.abbr":"Abbreviation","button.addabbr.tooltip":"insert abbreviation","button.abbr.tooltip":"format as abbreviation","newabbr.defaulttext":"Abbr"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("abbr/abbr-plugin",["aloha","jquery","aloha/plugin","ui/ui","ui/toggleButton","ui/button","ui/scopes","ui/port-helper-attribute-field","i18n!abbr/nls/i18n","i18n!aloha/nls/i18n"],function(e,t,n,r,i,s,o,u,a,f){var l=window.GENTICS;return n.create("abbr",{config:["abbr"],init:function(){this.createButtons();this.subscribeEvents();this.bindInteractions()},createButtons:function(){var e=this;this._formatAbbrButton=r.adopt("formatAbbr",i,{tooltip:a.t("button.abbr.tooltip"),icon:"aloha-icon aloha-icon-abbr",scope:"Aloha.continuoustext",click:function(){e.formatAbbr()}});this._insertAbbrButton=r.adopt("insertAbbr",s,{tooltip:a.t("button.addabbr.tooltip"),icon:"aloha-icon aloha-icon-abbr",scope:"Aloha.continuoustext",click:function(){e.insertAbbr(false)}});o.createScope("abbr","Aloha.continuoustext");this.abbrField=u({width:320,name:"abbrText",scope:"abbr"});this.remAbbrButton=r.adopt("removeAbbr",s,{tooltip:a.t("button.remabbr.tooltip"),icon:"aloha-icon aloha-icon-abbr-rem",scope:"abbr",click:function(){e.removeAbbr()}})},bindInteractions:function(){var t=this;this.abbrField.addListener("blur",function(e,n){if(this.getValue()==""){t.removeAbbr()}});for(var n=0;n<e.editables.length;n++){e.editables[n].obj.keydown(function(e){if(e.metaKey&&e.which==71){if(t.findAbbrMarkup()){t.abbrField.foreground();t.abbrField.focus()}else{t.insertAbbr()}e.stopPropagation();e.preventDefault();return false}})}},subscribeEvents:function(){var n=this;var r={};e.bind("aloha-editable-activated",function(){if(!e.activeEditable||!e.activeEditable.obj){return}var i=n.getEditableConfig(e.activeEditable.obj);r[e.activeEditable.getId()]=t.inArray("abbr",i)!==-1});e.bind("aloha-editable-destroyed",function(){if(e.activeEditable&&e.activeEditable.obj){delete r[e.activeEditable.getId()]}});e.bind("aloha-selection-changed",function(t,i){if(!e.activeEditable){return}if(r[e.activeEditable.getId()]){n._formatAbbrButton.show();n._insertAbbrButton.show()}else{n._formatAbbrButton.hide();n._insertAbbrButton.hide();return}var s=n.findAbbrMarkup(i);if(s){n._insertAbbrButton.hide();n._formatAbbrButton.setState(true);o.setScope("abbr");n.abbrField.setTargetObject(s,"title")}else{n._formatAbbrButton.setState(false);n.abbrField.setTargetObject(null)}})},findAbbrMarkup:function(t){if(typeof t=="undefined"){var t=e.Selection.getRangeObject()}if(e.activeEditable){return t.findMarkup(function(){return this.nodeName.toLowerCase()=="abbr"},e.activeEditable.obj)}else{return null}},formatAbbr:function(){var t=e.Selection.getRangeObject();if(e.activeEditable){if(this.findAbbrMarkup(t)){this.removeAbbr()}else{this.insertAbbr()}}},insertAbbr:function(n){var r=e.Selection.getRangeObject();if(this.findAbbrMarkup(r)){return}if(r.isCollapsed()&&n!=false){l.Utils.Dom.extendToWord(r)}if(r.isCollapsed()){var i=a.t("newabbr.defaulttext");var s=t('<abbr title="">'+i+"</abbr>");l.Utils.Dom.insertIntoDOM(s,r,t(e.activeEditable.obj));r.startContainer=r.endContainer=s.contents().get(0);r.startOffset=0;r.endOffset=i.length}else{var s=t('<abbr title=""></abbr>');l.Utils.Dom.addMarkup(r,s,false)}r.select();this.abbrField.foreground();this.abbrField.focus()},removeAbbr:function(){var t=e.Selection.getRangeObject();var n=this.findAbbrMarkup();if(n){l.Utils.Dom.removeFromDOM(n,t,true);t.select()}},makeClean:function(e){},toString:function(){return"abbr"}})});define("horizontalruler/nls/i18n",{root:{"button.addhr.tooltip":"Add a horizontal ruler"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("horizontalruler/horizontalruler-plugin",["aloha","jquery","aloha/plugin","ui/ui","ui/button","i18n!horizontalruler/nls/i18n","i18n!aloha/nls/i18n"],function(e,t,n,r,i,s,o){var u=window.GENTICS;return n.create("horizontalruler",{_constructor:function(){this._super("horizontalruler")},config:["hr"],init:function(){var n=this;this._insertHorizontalRuleButton=r.adopt("insertHorizontalRule",i,{tooltip:s.t("button.addhr.tooltip"),iconOnly:true,icon:"aloha-icon-horizontalruler",scope:"Aloha.continuoustext",click:function(){n.insertHR()}});e.bind("aloha-editable-activated",function(r,i){if(e.activeEditable){n.cfg=n.getEditableConfig(e.activeEditable.obj);if(t.inArray("hr",n.cfg)!=-1){n._insertHorizontalRuleButton.show(true)}else{n._insertHorizontalRuleButton.show(false);return}}})},insertHR:function(n){var r=this;var i=e.Selection.getRangeObject();if(e.activeEditable){var s=t("<hr>");u.Utils.Dom.insertIntoDOM(s,i,t(e.activeEditable.obj),true);i.select()}}})});define("paste/paste-plugin",["jquery","aloha/core","aloha/plugin","aloha/command","contenthandler/contenthandler-utils","aloha/console","aloha/copypaste","util/dom"],function(e,t,n,r,i,s,o,u){function v(e){var t=o.getEditableAt(e);if(t){t.obj.focus()}o.setSelectionAt(e);window.scrollTo(d.x,d.y)}function m(t){var n=e("<p>");t.contents().remove();t.append(n);return n}function g(e,t){var n=200;t=m(t);var r=o.getEditableAt(e);if(r){r.obj.blur()}o.setSelectionAt({startContainer:t[0],endContainer:t[0],startOffset:0,endOffset:0});t.focus()}function y(e){var t=e.startContainer;if(1===t.nodeType){return"p"===t.nodeName.toLowerCase()&&i.isProppedParagraph(t.outerHTML)}return 3===t.nodeType&&"p"===t.parentNode.nodeName.toLowerCase()&&1===t.parentNode.childNodes.length&&l.test(window.escape(t.data))}function b(e){if(y(e)){if(3===e.startContainer.nodeType){e.startContainer.data=""}else{e.startContainer.innerHTML=" "}e.startOffset=0;if(e.endContainer===e.startContainer){e.endOffset=0}}}function w(n,r,i){if(r){if(e.browser.mozilla){e("br",n).each(function(){if(this.parentNode&&this.previousSibling&&this.previousSibling.nodeType===3&&this.nextSibling&&this.nextSibling.nodeType===1&&this.nextSibling.nodeName==="BR"){var t=document.createElement(this.parentNode.nodeName);t.appendChild(this.previousSibling);e(this.parentNode).before(t);e([this,this.nextSibling]).remove()}});e(">span",n).each(function(){var t=e(this),n=e("<p>").append(t.contents());t.replaceWith(n)})}e("p",n).each(function(){var t=e(this),n=t.contents();if(u.isEmpty(this)||n.length===1&&n[0].nodeName==="BR"){t.remove()}});var o=n.html();if(f&&/^&nbsp;/.test(o)){o=o.substring(6)}v(r);b(r);if(t.queryCommandSupported("insertHTML")){t.execCommand("insertHTML",false,o)}else{s.error("Common.Paste",'Command "insertHTML" not '+"available. Enable the plugin "+'"common/commands".')}}m(n);if(typeof i==="function"){i()}}function E(e,n,r){e.metaKey=null;e.stopPropagation();window.setTimeout(function(){w(h,n,r);t.activeEditable.smartContentChange(e)},10)}function S(e,t){if(f){e.bind("beforepaste",function(e){d.x=window.scrollX||document.documentElement.scrollLeft;d.y=window.scrollY||document.documentElement.scrollTop;p=o.getRange();g(p,h);e.stopPropagation()})}else{e.bind("paste",function(e){d.x=window.scrollX||document.documentElement.scrollLeft;d.y=window.scrollY||document.documentElement.scrollTop;var t=o.getRange();g(t,h);if(f){var n=document.selection.createRange();n.execCommand("paste")}E(e,t)})}}var a=e(window);var f=!!e.browser.msie;var l=/^(\s|%A0)$/;var c=e('<div class="aloha-paste-handler" style="position:absolute; '+"clip:rect(0px,0px,0px,0px); width:1px; height:1px;"+'"><div class="aloha-metaview"></div></div>');var h=e("div",c).contentEditable(true);var p=null;var d={x:0,y:0};var x=n.create("paste",{settings:{},init:function(){e("body").append(c);var n=!this.settings.noclipboardaccess;t.bind("aloha-editable-created",function(e,t){S(t.obj,n)});if(f){h.bind("paste",function(e){E(e,p,function(){p=null})})}},register:function(e){s.deprecated("Plugins.Paste","register() for pasteHandler"+" is deprecated.  Use the "+"ContentHandler Plugin "+"instead.")}});return x});define("toc/nls/i18n",{root:{"button.addtoc.tooltip":"Table of contents"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("toc/toc-plugin",["aloha","aloha/plugin","jquery","ui/ui","ui/button","i18n!toc/nls/i18n","i18n!aloha/nls/i18n","aloha/console"],function(e,t,n,r,i,s,o,u){function h(e){return e[e.length-1]}function p(e){return e[0]}function d(e){return e.slice(1)}function v(e,t){return m(e,function(e){return e===t})}function m(e,t){for(var n=0;n<e.length;n++){if(t(e[n])){return e[n]}}return null}function g(e,t){var n=[];for(var r=0;r<e.length;r++){n.push(t(e[r]))}return n}function y(e,t){g(e,t)}function b(){return n(g(e.editables,function(e){return document.getElementById(e.getId())}))}function w(e,t){return t?e.find('a[href $= "#'+t+'"]'):n()}function E(e){var t=e.attr("href");return t?t.match(/#(.*?)$/)[1]:null}function S(e){var t;if(typeof e=="object"){t=n(e).text().replace(/[^a-zA-Z-]+/g,"-").replace(/^[^a-zA-Z]+/,"")}else if(e){t=e}for(var r=0;;r++){var i=t;if(r){i+="-"+r}var s=document.getElementById(i);if(!s||typeof e=="object"&&s===e){return i}}}var a=window.GENTICS,f="toc",l=null,c=[];return t.create(f,{minEntries:0,updateInterval:5e3,config:["toc"],init:function(){var t=this;if(typeof this.settings.minEntries==="undefined"){this.settings.minEntries=this.minEntries}if(typeof this.settings.updateInterval==="undefined"){this.settings.updateInterval=this.updateInterval}e.bind("aloha-editable-activated",function(r,i){if(e.activeEditable){t.cfg=t.getEditableConfig(e.activeEditable.obj);if(n.inArray("toc",t.cfg)!=-1){t._insertTocButton.show(true)}else{t._insertTocButton.show(false);return}}});this.initButtons();n(document).ready(function(){t.spawn()})},initButtons:function(){var e=this;this._insertTocButton=r.adopt("insertToc",i,{tooltip:s.t("button.addtoc.tooltip"),icon:"aloha-icon aloha-icon-orderedlist",scope:"Aloha.continuoustext",click:function(){e.insertAtSelection(l)}})},register:function(e){l=e},insertAtSelection:function(t){t=t||b();var r=S("toc");var i=n("<ol class='toc_root'></ol>").attr("id",r).attr("contentEditable","false");var s=e.Selection.getRangeObject();var o=e.activeEditable;var u=n(document.getElementById(o.getId()));a.Utils.Dom.insertIntoDOM(i,s,u);this.create(r).register(t).update().tickTock()},spawn:function(e,t){e=e||n("body");t=t||b();e.find("ol.toc_root").each(function(){var e=n(this).attr("id");if(!e){e=S("toc");n(this).attr("id",e)}that.create(e).register(t).tickTock()})},create:function(e){c.push(this);return{id:e,$containers:n(),settings:this.settings,root:function(){return n(document.getElementById(this.id))},register:function(e){var t=this;t.$containers=t.$containers.add(e);t.$containers.filter(function(){return!n(this).data(f+"."+t.id+".listening")}).each(function(){var e=n(this);e.data(f+"."+t.id+".listening",true);e.bind("blur",function(){t.cleanupIds(e.get(0));t.update(e)})});return t},tickTock:function(e){var t=this;e=e||this.settings.updateInterval;if(!e){return}window.setInterval(function(){t.register(b());t.update()},e);return t},cleanupIds:function(e){var t=[],r=this;this.headings(this.$containers).each(function(){var r=n(this).attr("id");if(r&&-1!=n.inArray(r,t)||e&&(n.contains(e,this)||e===this)){n(this).attr("id",S(this))}t.push(r)});return this},update:function(e){var t=this;e=e||t.$containers;var n=this.outline(t.$containers);var r=[t.root()];var i=[];h(r).empty();(function o(e){var n=[];y(e,function(e){var i=p(e);var s=t.linkSection(i,r,n);r.push(s);o(d(e));r.pop();n.push(s)})})(d(n));var s=t.root().attr("data-TOC-minEntries")||this.settings.minEntries;if(t.root().find("li").length>=s){t.root().show()}else{t.root().hide()}return this},linkSection:function(e,t,r){var i=e.eq(0).attr("id");if(!i){i=S(e.get(0));e.eq(0).attr("id",i)}var s=this.root();var o=w(s,i);if(!o.length){o=n("<li><a/></li>")}o.find("a").attr("href","#"+i).text(e.eq(0).text());if(h(r)){h(r).after(o)}else{if(h(t).get(0)==s.get(0)){s.append(o)}else{var u=n("<ol/>").append(o);h(t).append(u)}}return o},outline:function(e){var t=[n()];var r=[t];this.headings(e).each(function(){var e=n(this);var t=this.nodeName.toLowerCase();var i=["h6","h5","h4","h3","h2","h1"];var s=n.inArray(t,i);var o=i.slice(s).join(",");var u=e.nextUntil(o).andSelf();var a=[u];var f=m(r,function(t){var r=t[0];return!r.length||m(r,function(t){return e.get(0)===t||n.contains(t,e.get(0))})});f.push(a);r.splice(0,v(r,f),a)});return t},headings:function(e){return e.find(":header").add(e.filter(":header"))}}}})});define("cite/nls/i18n",{root:{"cite.button.add.quote":"Format selection as quote","cite.button.add.blockquote":"Format selection as blockquote"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("cite/cite-plugin",["aloha","jquery","aloha/plugin","ui/ui","ui/toggleButton","format/format-plugin","util/dom","PubSub","i18n!cite/nls/i18n","i18n!aloha/nls/i18n"],function(e,t,n,r,i,s,o,u,a,f){function d(e,t){return e.replace(/\{([a-z0-9\-\_]+)\}/ig,function(e,n,r,i){var s=t[n]||e;return typeof s==="function"?s():s})}function v(e){return typeof e==="string"?d(e,p):e}function m(){var e=[],n=c;t.each(arguments,function(){e.push("."+(""===this?n:n+"-"+this))});return t.trim(e.join(" "))}function g(){var e=[],n=c;t.each(arguments,function(){e.push(""===this?n:n+"-"+this)});return t.trim(e.join(" "))}function y(e){e=e.replace("#","").split("");if(3===e.length){e[5]=e[4]=e[2];e[3]=e[2]=e[1];e[1]=e[0]}var t=[];var n;for(n=0;n<3;++n){t[n]=parseInt("0x"+e[n*2]+e[n*2+1],16)}return t}var l=t,c="aloha-cite",h=(new Date).getTime();var p={quote:g("quote"),blockquote:g("blockquote"),"panel-label":g("panel-label"),"panel-field":g("panel-field"),"panel-btns":g("panel-btns"),"link-field":g("link-field"),"note-field":g("note-field"),references:g("references")};return n.create("cite",{citations:[],referenceContainer:null,settings:null,sidebar:null,config:["quote","blockquote"],init:function(){var n=this;if(e.settings&&e.settings.plugins&&e.settings.plugins.cite){var o=t(e.settings.plugins.cite.referenceContainer);if(o.length){n.referenceContainer=o}if(typeof e.settings.plugins.cite!=="undefined"){n.settings=e.settings.plugins.cite}if(typeof n.settings.sidebar==="undefined"){n.settings.sidebar={}}if(typeof n.settings.sidebar.open==="undefined"){n.settings.sidebar.open=true}if(typeof n.settings.sidebar.open==="string"){n.settings.sidebar.open=n.settings.sidebar.open.toLowerCase();if(n.settings.sidebar.open==="false"||n.settings.sidebar.open==="0"){n.settings.sidebar.open=false}else{n.settings.sidebar.open=true}}}this._quoteButton=r.adopt("quote",i,{tooltip:a.t("cite.button.add.quote"),icon:g("button","inline-button"),scope:"Aloha.continuoustext",click:function(){n.addInlineQuote()}});s.multiSplitButton.pushItem({name:"blockquote",tooltip:a.t("cite.button.add.blockquote"),icon:g("button","block-button"),click:function(){n.addBlockQuote()}});var f=this;e.ready(function(t){f.sidebar=e.Sidebar.right.show();f.sidebar.addPanel({id:g("sidebar-panel"),title:"Citation",content:"",expanded:true,activeOn:"q, blockquote",onInit:function(){var e=this;var t="";if(f.referenceContainer){t='<label class="{panel-label}" for="{note-field}-textarea">Note</label> '+'<div class="{panel-field} {note-field}" '+'style="margin: 5px;">'+'<textarea id="{note-field}-textarea"></textarea></div>'}var n=this.setContent(v('<label class="{panel-label}" for="{link-field}-input">Link</label>'+'<div class="{panel-field} {link-field}" '+'style="margin: 5px;"><input type="text" id="{link-field}-input" /></div>'+t)).content;n.find("input, textarea").bind("keypress change",function(){f.addCiteDetails(e.content.attr("data-cite-id"),e.content.find(m("link-field input")).val(),e.content.find(m("note-field textarea")).val())})},onActivate:function(e){var t=e.attr("data-cite-id");if(!t){t=++h;var r=[g("wrapper")].join(" ");e.addClass(r);e.attr("data-cite-id",t)}var i=n.getIndexOfCitation(t);if(-1===i){i=n.citations.push({uid:t,link:null,notes:null})-1}this.content.attr("data-cite-id",t);this.content.find(m("link-field input")).val(e.attr("cite"));this.content.find(m("note-field textarea")).val(n.citations[i].note)}})});e.bind("aloha-editable-activated",function(e,r){var i=n.getEditableConfig(r.editable.obj);if(!i){return}if(t.inArray("quote",i)!==-1){n._quoteButton.show(true)}else{n._quoteButton.show(false)}if(t.inArray("blockquote",i)!==-1){s.multiSplitButton.showItem("blockquote")}else{s.multiSplitButton.hideItem("blockquote")}});u.sub("aloha.selection.context-change",function(r){var i=r.range;var o=t("button.aloha-cite-button");var u=false;var a;var f=i.markupEffectiveAtStart;var l=f.length;while(l){a=f[--l].nodeName;if(a==="Q"||a==="BLOCKQUOTE"){u=true;break}}o.filter(".aloha-cite-block-button").removeClass("aloha-cite-pressed");n._quoteButton.setState(false);if(u){if("Q"===a){n._quoteButton.setState(true)}else{o.filter(".aloha-cite-block-button").addClass("aloha-cite-pressed")}return false}var c=[];if(e.activeEditable){c=n.getEditableConfig(e.activeEditable.obj)}if(t.inArray("quote",c)!=-1){n._quoteButton.show(true)}else{n._quoteButton.show(false)}if(t.inArray("blockquote",c)!=-1){s.multiSplitButton.showItem("blockquote")}else{s.multiSplitButton.hideItem("blockquote")}})},getIndexOfCitation:function(e){var t=this.citations;var n=t.length;var r=0;var i;var s;while(r<n){i=r+n>>1;s=t[i].uid;if(s==e){return i}if(s>e){n=i}else if(s<e){r=i+1}}return-1},addBlockQuote:function(){var n=[g("wrapper"),g(++h)].join(" ");var r=t(d('<blockquote class="{classes}" data-cite-id="{uid}"></blockquote>',{uid:h,classes:n}));if(e.activeEditable){t(e.activeEditable.obj[0]).click()}e.Selection.changeMarkupOnSelection(r);if(this.referenceContainer){this.addCiteToReferences(h)}if(this.sidebar&&this.settings&&this.settings.sidebar&&this.settings.sidebar.open){this.sidebar.open()}},addInlineQuote:function(){var n=[g("wrapper"),g(++h)].join(" ");var r=t(d('<q class="{classes}" data-cite-id="{uid}"></q>',{uid:h,classes:n}));var i=e.Selection.rangeObject;var s;if(e.activeEditable){t(e.activeEditable.obj[0]).click()}s=i.findMarkup(function(){if(this.nodeName&&r.length&&typeof this.nodeName==="string"&&typeof r[0].nodeName==="string"){return this.nodeName.toLowerCase()===r[0].nodeName.toLowerCase()}return false},e.activeEditable.obj);if(s){if(i.isCollapsed()){o.removeFromDOM(s,i,true)}else{o.removeMarkup(i,r,e.activeEditable.obj)}}else{if(i.isCollapsed()){o.extendToWord(i)}o.addMarkup(i,r)}i.select();if(this.referenceContainer){this.addCiteToReferences(h)}if(this.sidebar&&this.settings&&this.settings.sidebar&&this.settings.sidebar.open){this.sidebar.open()}return false},addCiteToReferences:function(e){var n=this.getIndexOfCitation(e);if(-1===n){return}var r=t(".aloha-editable-active "+m(e));var i="cite-note-"+e;var s="cite-ref-"+e;r.append(d('<sup id="{ref}" contenteditable="false"><a href="#{note}">[{count}]</a></sup>',{ref:s,note:i,count:n+1}));if(0===this.referenceContainer.find("ol.references").length){this.referenceContainer.append("<h2>References</h2>").append('<ol class="references"></ol>')}this.referenceContainer.find("ol.references").append(d('<li id="{note}"><a href="#{ref}">^</a> &nbsp; <span></span></li>',{ref:s,note:i}))},addCiteDetails:function(e,n,r){this.citations[this.getIndexOfCitation(e)]={uid:e,link:n,note:r};if(n){var i=t(m(e)).attr("cite",n)}if(this.referenceContainer){t("li#cite-note-"+e+" span").html(d(n?'<a class="external" target="_blank" href="{url}">{url}</a>':"",{url:n})+(r?". "+r:""))}},toString:function(){return"aloha-citiation-plugin"},makeClean:function(e){e.find("q, blockquote").each(function(){if(t.trim(t(this).attr("class"))===""){t(this).removeAttr("class")}if(!this.referenceContainer){t(this).removeClass("aloha-cite-"+t(this).attr("data-cite-id"));if(t(this).attr("data-cite-id")!=null){t(this).removeAttr("data-cite-id")}}t(this).removeClass("aloha-cite-wrapper")})}})});define("flag-icons/flag-icons-plugin",[],function(){"use strict";return{path:Aloha.getPluginUrl("flag-icons")}});define("numerated-headers/nls/i18n",{root:{"headerids.label.target":"Target","headerids.button.reset":"Reset","headerids.button.set":"Set","button.numeratedHeaders.tooltip":"Toggle header numeration"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("numerated-headers/numerated-headers-plugin",["aloha/core","jquery","aloha/plugin","ui/ui","ui/toggleButton","i18n!numerated-headers/nls/i18n","i18n!aloha/nls/i18n"],function(e,t,n,r,i,s,o){var u={};e.bind("aloha-editable-destroyed",function(e,t){delete u[t.getId()]});return n.create("numerated-headers",{config:{numeratedactive:true,headingselector:"h1, h2, h3, h4, h5, h6",trailingdot:false},init:function(){var t=this;this._formatNumeratedHeadersButton=r.adopt("formatNumeratedHeaders",i,{tooltip:s.t("button.numeratedHeaders.tooltip"),icon:"aloha-icon aloha-icon-numerated-headers",scope:"Aloha.continuoustext",click:function(){var e=t._formatNumeratedHeadersButton.getState();if(!e){t.removeNumerations()}else{t.createNumeratedHeaders()}}});e.bind("aloha-smart-content-changed",function(e){t.cleanNumerations();if(t.showNumbers()){t.createNumeratedHeaders()}});e.bind("aloha-format-block",function(){t.cleanNumerations();if(t.showNumbers()){t.createNumeratedHeaders()}});e.bind("aloha-editable-activated",function(n){if(t.isNumeratingOn()){t._formatNumeratedHeadersButton.show();t.initForEditable(e.activeEditable.obj)}else{t._formatNumeratedHeadersButton.hide()}})},initForEditable:function(e){var t=e.attr("aloha-numerated-headers");if(t!=="true"&&t!=="false"){t=true===this.getCurrentConfig().numeratedactive?"true":"false";e.attr("aloha-numerated-headers",t)}if(t==="true"){this.createNumeratedHeaders();this._formatNumeratedHeadersButton.setState(true)}else{this._formatNumeratedHeadersButton.setState(false)}},getCurrentConfig:function(){var n=this.getEditableConfig(e.activeEditable.obj);if(n.numeratedactive===true||n.numeratedactive==="true"||n.numeratedactive==="1"){n.numeratedactive=true}else{n.numeratedactive=false}if(typeof n.headingselector!=="string"){n.headingselector="h1, h2, h3, h4, h5, h6"}n.headingselector=t.trim(n.headingselector);if(n.trailingdot===true||n.trailingdot==="true"||n.trailingdot==="1"){n.trailingdot=true}else{n.trailingdot=false}return n},isNumeratingOn:function(){return this.getCurrentConfig().headingselector!==""},showNumbers:function(){return e.activeEditable&&this.isNumeratingOn()&&e.activeEditable.obj.attr("aloha-numerated-headers")==="true"},cleanNumerations:function(){var e=this;var n=this.getBaseElement();if(!n){return}this._saveRemoveAnnotations(t(n).find("span[role=annotation]"))},_saveRemoveAnnotations:function(n){var r=this;var i=e.Selection.getRangeObject();var s=false;n.each(function(){if(i.startContainer===this||t.inArray(this,t(i.startContainer).parents())>-1){i.startContainer=r._prevNode(this);i.startOffset=0;s=true}if(i.startContainer===this.parentNode&&i.startOffset>=t(this).index()&&i.startOffset>0){i.startOffset--;s=true}if(i.endContainer===this||t.inArray(this,t(i.endContainer).parents())>-1){i.endContainer=r._prevNode(this);i.endOffset=0;s=true}if(i.endContainer===this.parentNode&&i.endOffset>=t(this).index()&&i.endOffset>0){i.endOffset--;s=true}t(this).remove()});if(s===true){i.update();i.select()}},_prependAnnotation:function(n,r){var i=e.Selection.getRangeObject();var s=false;if(i.startContainer===r){i.startOffset++;s=true}if(i.endContainer===r){i.endOffset++;s=true}t(r).prepend('<span role="annotation">'+n+"</span>");if(s===true){i.update();i.select()}},_prevNode:function(e){var t=e.previousSibling;if(!t){return e.parentNode}while(t.lastChild){t=t.lastChild}return t},removeNumerations:function(){t(e.activeEditable.obj).attr("aloha-numerated-headers","false");this.cleanNumerations()},getBaseElement:function(){if(typeof this.baseobjectSelector!=="undefined"){return t(this.baseobjectSelector).length>0?t(this.baseobjectSelector):null}return e.activeEditable?e.activeEditable.obj:null},hasNote:function(e){if(!e||t(e).length<=0){return false}return t(e).find("span[role=annotation]").length>0},hasContent:function(e){if(!e||0===t(e).length){return false}var n=t(e).clone().find("span[role=annotation]").remove().end();return t.trim(n.text()).length>0},createNumeratedHeaders:function(){var n=this.getBaseElement();if(!n){return}var r=this.getCurrentConfig();var i=r.headingselector;var s=n.find(i);e.activeEditable.obj.attr("aloha-numerated-headers","true");if(typeof s==="undefined"||s.length===0){return}var o=7;var u=this;s.each(function(){if(u.hasContent(this)){var e=parseInt(this.nodeName.substr(1),10);if(e<o){o=e}}});if(o>6){return}var a=null,f=[],l=0,c;for(c=0;c<6-o+1;c++){f[c]=0}s.each(function(){if(u.hasContent(this)){var e=parseInt(this.nodeName.substr(1),10);if(a===null&&e!==o){u._saveRemoveAnnotations(t(this).find("span[role=annotation]"));return}else if(a===null){f[l]++}else if(e>a){f[++l]++}else if(e===a){f[l]++}else if(e<a){var n=e-o;var i;for(i=l;i>n;i--){f[i]=0}l=n;f[l]++}a=e;var s="",c;if(r.trailingdot===true){s="";for(c=0;c<f.length;c++){if(f[c]!==0){s+=f[c]+"."}}}else{s=f[0];for(c=1;c<f.length;c++){if(f[c]!==0){s+="."+f[c]}}}s+="&nbsp;";if(u.hasNote(this)){t(this).find("span[role=annotation]").html(s)}else{u._prependAnnotation(s,this)}}else{if(u.hasNote(this)){u._saveRemoveAnnotations(t(this).find("span[role=annotation]"))}}})}})});define("formatlesspaste/formatlesshandler",["aloha","jquery","aloha/contenthandlermanager"],function(e,t,n){function r(e,n){e.find(n.join(",")).each(function(){t(this).contents().unwrap()})}var i=n.createHandler({enabled:false,handleContent:function(e){var n;if(typeof e==="string"){n=t("<div>"+e+"</div>")}else if(e instanceof t){n=t("<div>").append(e)}if(n.find(".aloha-block").length){return}if(this.enabled){r(n,this.strippedElements)}return n.html()}});return i});define("formatlesspaste/nls/i18n",{root:{"button.formatlessPaste.tooltip":"Toggle Formatless Pasting"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("formatlesspaste/formatlesspaste-plugin",["aloha/core","aloha/plugin","jquery","ui/ui","ui/toggleButton","formatlesspaste/formatlesshandler","aloha/contenthandlermanager","i18n!formatlesspaste/nls/i18n"],function(e,t,n,r,i,s,o,u){function a(e){if(!e){return false}if(typeof e==="string"){return"0"!==e&&"false"!==e.toLowerCase()}return true}function f(e){var t={};if(typeof e.formatlessPasteOption!=="undefined"){t.formatlessPasteOption=a(e.formatlessPasteOption)}if(typeof e.strippedElements!=="undefined"){t.strippedElements=e.strippedElements}if(typeof e.button!=="undefined"){t.button=a(e.button)}return t}function l(e,t){n.extend(e,t)}function c(e){o.register("formatless",s);s.strippedElements=e.strippedElements;e._toggleFormatlessPasteButton=r.adopt("toggleFormatlessPaste",i,{tooltip:u.t("button.formatlessPaste.tooltip"),icon:"aloha-icon aloha-icon-formatless-paste",scope:"Aloha.continuoustext",click:function(){s.enabled=!s.enabled}});e._toggleFormatlessPasteButton.show(e.button);if(true===e.formatlessPasteOption){e._toggleFormatlessPasteButton.setState(true);s.enabled=true}else if(false===e.formatlessPasteOption){e._toggleFormatlessPasteButton.setState(false);s.enabled=false}}function p(e,t){var n=t.getId();if(!n){return null}if(h[n]){return h[n]}var r=e.getEditableConfig(t.obj);if(!r){return null}h[n]=f(r);return h[n]}function d(e){var t=e.getId();if(t&&h[t]){delete h[t]}}var h={};e.bind("aloha-editable-destroyed",function(e,t){d(t)});return t.create("formatlesspaste",{formatlessPasteOption:false,button:true,strippedElements:["a","abbr","b","bdi","bdo","cite","code","del","dfn","em","i","ins","kbd","mark","q","rp","rt","ruby","s","samp","small","strong","sub","sup","time","u","var"],init:function(){var t=this;var n=t.settings.config||t.settings;l(t,f(n));c(t);e.bind("aloha-editable-activated",function(e,n){var r=p(t,n.editable);if(!r){return}var i=t._toggleFormatlessPasteButton;if(true===r.formatlessPasteOption){i.setState(true);s.enabled=true}else if(false===r.formatlessPasteOption){i.setState(false);s.enabled=false}i.show(false!==r.button)})}})});(function(){var e=false,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(){function u(){if(!e&&this.init)this.init.apply(this,arguments)}var n=this.prototype;e=true;var r=new this;e=false;for(var i=0;i<arguments.length;i++){var s=arguments[i];for(var o in s){r[o]=typeof s[o]=="function"&&typeof n[o]=="function"&&t.test(s[o])?function(e,t){return function(){var r=this._super;this._super=n[e];var i=t.apply(this,arguments);this._super=r;return i}}(o,s[o]):s[o]}}u.prototype=r;u.constructor=u;u.extend=arguments.callee;return u}})();if(typeof define==="function"){define("Class",[],function(){return Class})}define("jstree",["jquery"],function(e){var t=e;(function(){if(e&&e.jstree){return}var t=false,n=false,r=false;(function(e){e.vakata={};e.vakata.css={get_css:function(e,t,n){e=e.toLowerCase();var r=n.cssRules||n.rules,i=0;do{if(r.length&&i>r.length+5){return false}if(r[i].selectorText&&r[i].selectorText.toLowerCase()==e){if(t===true){if(n.removeRule){n.removeRule(i)}if(n.deleteRule){n.deleteRule(i)}return true}else{return r[i]}}}while(r[++i]);return false},add_css:function(t,n){if(e.jstree.css.get_css(t,false,n)){return false}if(n.insertRule){n.insertRule(t+" { }",0)}else{n.addRule(t,null,0)}return e.vakata.css.get_css(t)},remove_css:function(t,n){return e.vakata.css.get_css(t,true,n)},add_sheet:function(t){var n=false,r=true;if(t.str){if(t.title){n=e("style[id='"+t.title+"-stylesheet']")[0]}if(n){r=false}else{n=document.createElement("style");n.setAttribute("type","text/css");if(t.title){n.setAttribute("id",t.title+"-stylesheet")}}if(n.styleSheet){if(r){document.getElementsByTagName("head")[0].appendChild(n);n.styleSheet.cssText=t.str}else{n.styleSheet.cssText=n.styleSheet.cssText+" "+t.str}}else{n.appendChild(document.createTextNode(t.str));document.getElementsByTagName("head")[0].appendChild(n)}return n.sheet||n.styleSheet}if(t.url){if(document.createStyleSheet){try{n=document.createStyleSheet(t.url)}catch(i){}}else{n=document.createElement("link");n.rel="stylesheet";n.type="text/css";n.media="all";n.href=t.url;document.getElementsByTagName("head")[0].appendChild(n);return n.styleSheet}}}};var i=[],s=-1,o={},u={};e.fn.jstree=function(t){var n=typeof t=="string",r=Array.prototype.slice.call(arguments,1),s=this;if(n){if(t.substring(0,1)=="_"){return s}this.each(function(){var n=i[e.data(this,"jstree-instance-id")],o=n&&e.isFunction(n[t])?n[t].apply(n,r):n;if(typeof o!=="undefined"&&(t.indexOf("is_")===0||o!==true&&o!==false)){s=o;return false}})}else{this.each(function(){var n=e.data(this,"jstree-instance-id"),s=[],u=t?e.extend({},true,t):{},a=e(this),f=false,l=[];s=s.concat(r);if(a.data("jstree")){s.push(a.data("jstree"))}u=s.length?e.extend.apply(null,[true,u].concat(s)):u;if(typeof n!=="undefined"&&i[n]){i[n].destroy()}n=parseInt(i.push({}),10)-1;e.data(this,"jstree-instance-id",n);u.plugins=e.isArray(u.plugins)?u.plugins:e.jstree.defaults.plugins.slice();u.plugins.unshift("core");u.plugins=u.plugins.sort().join(",,").replace(/(,|^)([^,]+)(,,\2)+(,|$)/g,"$1$2$4").replace(/,,+/g,",").replace(/,$/,"").split(",");f=e.extend(true,{},e.jstree.defaults,u);f.plugins=u.plugins;e.each(o,function(t,n){if(e.inArray(t,f.plugins)===-1){f[t]=null;delete f[t]}else{l.push(t)}});f.plugins=l;i[n]=new e.jstree._instance(n,e(this).addClass("jstree jstree-"+n),f);e.each(i[n]._get_settings().plugins,function(e,t){i[n].data[t]={}});e.each(i[n]._get_settings().plugins,function(e,t){if(o[t]){o[t].__init.apply(i[n])}});setTimeout(function(){i[n].init()},0)})}return s};e.jstree={defaults:{plugins:[]},_focused:function(){return i[s]||null},_reference:function(t){if(i[t]){return i[t]}var n=e(t);if(!n.length&&typeof t==="string"){n=e("#"+t)}if(!n.length){return null}return i[n.closest(".jstree").data("jstree-instance-id")]||null},_instance:function(t,n,r){this.data={core:{}};this.get_settings=function(){return e.extend(true,{},r)};this._get_settings=function(){return r};this.get_index=function(){return t};this.get_container=function(){return n};this.get_container_ul=function(){return n.children("ul:eq(0)")};this._set_settings=function(t){r=e.extend(true,{},r,t)}},_fn:{},plugin:function(t,n){n=e.extend({},{__init:e.noop,__destroy:e.noop,_fn:{},defaults:false},n);o[t]=n;e.jstree.defaults[t]=n.defaults;e.each(n._fn,function(n,r){r.plugin=t;r.old=e.jstree._fn[n];e.jstree._fn[n]=function(){var t,i=r,s=Array.prototype.slice.call(arguments),o=new e.Event("before.jstree"),u=false;if(this.data.core.locked===true&&n!=="unlock"&&n!=="is_locked"){return}do{if(i&&i.plugin&&e.inArray(i.plugin,this._get_settings().plugins)!==-1){break}i=i.old}while(i);if(!i){return}if(n.indexOf("_")===0){t=i.apply(this,s)}else{t=this.get_container().triggerHandler(o,{func:n,inst:this,args:s,plugin:i.plugin});if(t===false){return}if(typeof t!=="undefined"){s=t}t=i.apply(e.extend({},this,{__callback:function(e){this.get_container().triggerHandler(n+".jstree",{inst:this,args:s,rslt:e,rlbk:u})},__rollback:function(){u=this.get_rollback();return u},__call_old:function(e){return i.old.apply(this,e?Array.prototype.slice.call(arguments,1):s)}}),s)}return t};e.jstree._fn[n].old=r.old;e.jstree._fn[n].plugin=t})},rollback:function(t){if(t){if(!e.isArray(t)){t=[t]}e.each(t,function(e,t){i[t.i].set_rollback(t.h,t.d)})}}};e.jstree._fn=e.jstree._instance.prototype={};e(function(){var i=navigator.userAgent.toLowerCase(),s=(i.match(/.+?(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],o=""+".jstree ul, .jstree li { display:block; margin:0 0 0 0; padding:0 0 0 0; list-style-type:none; } "+".jstree li { display:block; min-height:18px; line-height:18px; white-space:nowrap; margin-left:18px; min-width:18px; } "+".jstree-rtl li { margin-left:0; margin-right:18px; } "+".jstree > ul > li { margin-left:0px; } "+".jstree-rtl > ul > li { margin-right:0px; } "+".jstree ins { display:inline-block; text-decoration:none; width:18px; height:18px; margin:0 0 0 0; padding:0; } "+".jstree a { display:inline-block; line-height:16px; height:16px; color:black; white-space:nowrap; text-decoration:none; padding:1px 2px; margin:0; } "+".jstree a:focus { outline: none; } "+".jstree a > ins { height:16px; width:16px; } "+".jstree a > .jstree-icon { margin-right:3px; } "+".jstree-rtl a > .jstree-icon { margin-left:3px; margin-right:0; } "+"li.jstree-open > ul { display:block; } "+"li.jstree-closed > ul { display:none; } ";if(/msie/.test(i)&&parseInt(s,10)==6){t=true;try{document.execCommand("BackgroundImageCache",false,true)}catch(u){}o+=""+".jstree li { height:18px; margin-left:0; margin-right:0; } "+".jstree li li { margin-left:18px; } "+".jstree-rtl li li { margin-left:0px; margin-right:18px; } "+"li.jstree-open ul { display:block; } "+"li.jstree-closed ul { display:none !important; } "+".jstree li a { display:inline; border-width:0 !important; padding:0px 2px !important; } "+".jstree li a ins { height:16px; width:16px; margin-right:3px; } "+".jstree-rtl li a ins { margin-right:0px; margin-left:3px; } "}if(/msie/.test(i)&&parseInt(s,10)==7){n=true;o+=".jstree li a { border-width:0 !important; padding:0px 2px !important; } "}if(!/compatible/.test(i)&&/mozilla/.test(i)&&parseFloat(s,10)<1.9){r=true;o+=""+".jstree ins { display:-moz-inline-box; } "+".jstree li { line-height:12px; } "+".jstree a { display:-moz-inline-box; } "+".jstree .jstree-no-icons .jstree-checkbox { display:-moz-inline-stack !important; } "}e.vakata.css.add_sheet({str:o,title:"jstree"})});e.jstree.plugin("core",{__init:function(){this.data.core.locked=false;this.data.core.to_open=this.get_settings().core.initially_open;this.data.core.to_load=this.get_settings().core.initially_load},defaults:{html_titles:false,animation:500,initially_open:[],initially_load:[],open_parents:true,notify_plugins:true,rtl:false,load_open:false,strings:{loading:"Loading ...",new_node:"New node",multiple_selection:"Multiple selection"}},_fn:{init:function(){this.set_focus();if(this._get_settings().core.rtl){this.get_container().addClass("jstree-rtl").css("direction","rtl")}this.get_container().html("<ul><li class='jstree-last jstree-leaf'><ins>&#160;</ins><a class='jstree-loading' href='#'><ins class='jstree-icon'>&#160;</ins>"+this._get_string("loading")+"</a></li></ul>");this.data.core.li_height=this.get_container_ul().find("li.jstree-closed, li.jstree-leaf").eq(0).height()||18;this.get_container().delegate("li > ins","click.jstree",e.proxy(function(t){var n=e(t.target);if(n.is("ins")&&t.pageY-n.offset().top<this.data.core.li_height){this.toggle_node(n)}},this)).bind("mousedown.jstree",e.proxy(function(){this.set_focus()},this)).bind("dblclick.jstree",function(e){var t;if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){t=window.getSelection();try{t.removeAllRanges();t.collapse()}catch(n){}}}});if(this._get_settings().core.notify_plugins){this.get_container().bind("load_node.jstree",e.proxy(function(t,n){var r=this._get_node(n.rslt.obj),i=this;if(r===-1){r=this.get_container_ul()}if(!r.length){return}r.find("li").each(function(){var t=e(this);if(t.data("jstree")){e.each(t.data("jstree"),function(n,r){if(i.data[n]&&e.isFunction(i["_"+n+"_notify"])){i["_"+n+"_notify"].call(i,t,r)}})}})},this))}if(this._get_settings().core.load_open){this.get_container().bind("load_node.jstree",e.proxy(function(t,n){var r=this._get_node(n.rslt.obj),i=this;if(r===-1){r=this.get_container_ul()}if(!r.length){return}r.find("li.jstree-open:not(:has(ul))").each(function(){i.load_node(this,e.noop,e.noop)})},this))}this.__callback();this.load_node(-1,function(){this.loaded();this.reload_nodes()})},destroy:function(){var t,n=this.get_index(),r=this._get_settings(),u=this;e.each(r.plugins,function(e,t){try{o[t].__destroy.apply(u)}catch(n){}});this.__callback();if(this.is_focused()){for(t in i){if(i.hasOwnProperty(t)&&t!=n){i[t].set_focus();break}}}if(n===s){s=-1}this.get_container().unbind(".jstree").undelegate(".jstree").removeData("jstree-instance-id").find("[class^='jstree']").andSelf().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,"")});e(document).unbind(".jstree-"+n).undelegate(".jstree-"+n);i[n]=null;delete i[n]},_core_notify:function(e,t){if(t.opened){this.open_node(e,false,true)}},lock:function(){this.data.core.locked=true;this.get_container().children("ul").addClass("jstree-locked").css("opacity","0.7");this.__callback({})},unlock:function(){this.data.core.locked=false;this.get_container().children("ul").removeClass("jstree-locked").css("opacity","1");this.__callback({})},is_locked:function(){return this.data.core.locked},save_opened:function(){var e=this;this.data.core.to_open=[];this.get_container_ul().find("li.jstree-open").each(function(){if(this.id){e.data.core.to_open.push("#"+this.id.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:"))}});this.__callback(e.data.core.to_open)},save_loaded:function(){},reload_nodes:function(t){var n=this,r=true,i=[],s=[];if(!t){this.data.core.reopen=false;this.data.core.refreshing=true;this.data.core.to_open=e.map(e.makeArray(this.data.core.to_open),function(e){return"#"+e.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")});this.data.core.to_load=e.map(e.makeArray(this.data.core.to_load),function(e){return"#"+e.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")});if(this.data.core.to_open.length){this.data.core.to_load=this.data.core.to_load.concat(this.data.core.to_open)}}if(this.data.core.to_load.length){e.each(this.data.core.to_load,function(t,n){if(n=="#"){return true}if(e(n).length){i.push(n)}else{s.push(n)}});if(i.length){this.data.core.to_load=s;e.each(i,function(e,t){if(!n._is_loaded(t)){n.load_node(t,function(){n.reload_nodes(true)},function(){n.reload_nodes(true)});r=false}})}}if(this.data.core.to_open.length){e.each(this.data.core.to_open,function(e,t){n.open_node(t,false,true)})}if(r){if(this.data.core.reopen){clearTimeout(this.data.core.reopen)}this.data.core.reopen=setTimeout(function(){n.__callback({},n)},50);this.data.core.refreshing=false;this.reopen()}},reopen:function(){var t=this;if(this.data.core.to_open.length){e.each(this.data.core.to_open,function(e,n){t.open_node(n,false,true)})}this.__callback({})},refresh:function(e){var t=this;this.save_opened();if(!e){e=-1}e=this._get_node(e);if(!e){e=-1}if(e!==-1){e.children("UL").remove()}else{this.get_container_ul().empty()}this.load_node(e,function(){t.__callback({obj:e});t.reload_nodes()})},loaded:function(){this.__callback()},set_focus:function(){if(this.is_focused()){return}var t=e.jstree._focused();if(t){t.unset_focus()}this.get_container().addClass("jstree-focused");s=this.get_index();this.__callback()},is_focused:function(){return s==this.get_index()},unset_focus:function(){if(this.is_focused()){this.get_container().removeClass("jstree-focused");s=-1}this.__callback()},_get_node:function(t){var n=e(t,this.get_container());if(n.is(".jstree")||t==-1){return-1}n=n.closest("li",this.get_container());return n.length?n:false},_get_next:function(e,t){e=this._get_node(e);if(e===-1){return this.get_container().find("> ul > li:first-child")}if(!e.length){return false}if(t){return e.nextAll("li").size()>0?e.nextAll("li:eq(0)"):false}if(e.hasClass("jstree-open")){return e.find("li:eq(0)")}else if(e.nextAll("li").size()>0){return e.nextAll("li:eq(0)")}else{return e.parentsUntil(".jstree","li").next("li").eq(0)}},_get_prev:function(e,t){e=this._get_node(e);if(e===-1){return this.get_container().find("> ul > li:last-child")}if(!e.length){return false}if(t){return e.prevAll("li").length>0?e.prevAll("li:eq(0)"):false}if(e.prev("li").length){e=e.prev("li").eq(0);while(e.hasClass("jstree-open")){e=e.children("ul:eq(0)").children("li:last")}return e}else{var n=e.parentsUntil(".jstree","li:eq(0)");return n.length?n:false}},_get_parent:function(e){e=this._get_node(e);if(e==-1||!e.length){return false}var t=e.parentsUntil(".jstree","li:eq(0)");return t.length?t:-1},_get_children:function(e){e=this._get_node(e);if(e===-1){return this.get_container().children("ul:eq(0)").children("li")}if(!e.length){return false}return e.children("ul:eq(0)").children("li")},get_path:function(e,t){var n=[],r=this;e=this._get_node(e);if(e===-1||!e||!e.length){return false}e.parentsUntil(".jstree","li").each(function(){n.push(t?this.id:r.get_text(this))});n.reverse();n.push(t?e.attr("id"):this.get_text(e));return n},_get_string:function(e){return this._get_settings().core.strings[e]||e},is_open:function(e){e=this._get_node(e);return e&&e!==-1&&e.hasClass("jstree-open")},is_closed:function(e){e=this._get_node(e);return e&&e!==-1&&e.hasClass("jstree-closed")},is_leaf:function(e){e=this._get_node(e);return e&&e!==-1&&e.hasClass("jstree-leaf")},correct_state:function(e){e=this._get_node(e);if(!e||e===-1){return false}e.removeClass("jstree-closed jstree-open").addClass("jstree-leaf").children("ul").remove();this.__callback({obj:e})},open_node:function(e,n,r){e=this._get_node(e);if(!e.length){return false}if(!e.hasClass("jstree-closed")){if(n){n.call()}return false}var i=r||t?0:this._get_settings().core.animation,s=this;if(!this._is_loaded(e)){e.children("a").addClass("jstree-loading");this.load_node(e,function(){s.open_node(e,n,r)},n)}else{if(this._get_settings().core.open_parents){e.parentsUntil(".jstree",".jstree-closed").each(function(){s.open_node(this,false,true)})}if(i){e.children("ul").css("display","none")}e.removeClass("jstree-closed").addClass("jstree-open").children("a").removeClass("jstree-loading");if(i){e.children("ul").stop(true,true).slideDown(i,function(){this.style.display="";s.after_open(e)})}else{s.after_open(e)}this.__callback({obj:e});if(n){n.call()}}},after_open:function(e){this.__callback({obj:e})},close_node:function(e,n){e=this._get_node(e);var r=n||t?0:this._get_settings().core.animation,i=this;if(!e.length||!e.hasClass("jstree-open")){return false}if(r){e.children("ul").attr("style","display:block !important")}e.removeClass("jstree-open").addClass("jstree-closed");if(r){e.children("ul").stop(true,true).slideUp(r,function(){this.style.display="";i.after_close(e)})}else{i.after_close(e)}this.__callback({obj:e})},after_close:function(e){this.__callback({obj:e})},toggle_node:function(e){e=this._get_node(e);if(e.hasClass("jstree-closed")){return this.open_node(e)}if(e.hasClass("jstree-open")){return this.close_node(e)}},open_all:function(e,t,n){e=e?this._get_node(e):-1;if(!e||e===-1){e=this.get_container_ul()}if(n){e=e.find("li.jstree-closed")}else{n=e;if(e.is(".jstree-closed")){e=e.find("li.jstree-closed").andSelf()}else{e=e.find("li.jstree-closed")}}var r=this;e.each(function(){var e=this;if(!r._is_loaded(this)){r.open_node(this,function(){r.open_all(e,t,n)},!t)}else{r.open_node(this,false,!t)}});if(n.find("li.jstree-closed").length===0){this.__callback({obj:n})}},close_all:function(e,t){var n=this;e=e?this._get_node(e):this.get_container();if(!e||e===-1){e=this.get_container_ul()}e.find("li.jstree-open").andSelf().each(function(){n.close_node(this,!t)});this.__callback({obj:e})},clean_node:function(t){t=t&&t!=-1?e(t):this.get_container_ul();t=t.is("li")?t.find("li").andSelf():t.find("li");t.removeClass("jstree-last").filter("li:last-child").addClass("jstree-last").end().filter(":has(li)").not(".jstree-open").removeClass("jstree-leaf").addClass("jstree-closed");t.not(".jstree-open, .jstree-closed").addClass("jstree-leaf").children("ul").remove();this.__callback({obj:t})},get_rollback:function(){this.__callback();return{i:this.get_index(),h:this.get_container().children("ul").clone(true),d:this.data}},set_rollback:function(e,t){this.get_container().empty().append(e);this.data=t;this.__callback()},load_node:function(e,t,n){this.__callback({obj:e})},_is_loaded:function(e){return true},create_node:function(t,n,r,i,s){t=this._get_node(t);n=typeof n==="undefined"?"last":n;var o=e("<li />"),u=this._get_settings().core,a;if(t!==-1&&!t.length){return false}if(!s&&!this._is_loaded(t)){this.load_node(t,function(){this.create_node(t,n,r,i,true)});return false}this.__rollback();if(typeof r==="string"){r={data:r}}if(!r){r={}}if(r.attr){o.attr(r.attr)}if(r.metadata){o.data(r.metadata)}if(r.state){o.addClass("jstree-"+r.state)}if(!r.data){r.data=this._get_string("new_node")}if(!e.isArray(r.data)){a=r.data;r.data=[];r.data.push(a)}e.each(r.data,function(t,n){a=e("<a />");if(e.isFunction(n)){n=n.call(this,r)}if(typeof n=="string"){a.attr("href","#")[u.html_titles?"html":"text"](n)}else{if(!n.attr){n.attr={}}if(!n.attr.href){n.attr.href="#"}a.attr(n.attr)[u.html_titles?"html":"text"](n.title);if(n.language){a.addClass(n.language)}}a.prepend("<ins class='jstree-icon'>&#160;</ins>");if(n.icon){if(n.icon.indexOf("/")===-1){a.children("ins").addClass(n.icon)}else{a.children("ins").css("background","url('"+n.icon+"') center center no-repeat")}}o.append(a)});o.prepend("<ins class='jstree-icon'>&#160;</ins>");if(t===-1){t=this.get_container();if(n==="before"){n="first"}if(n==="after"){n="last"}}switch(n){case"before":t.before(o);a=this._get_parent(t);break;case"after":t.after(o);a=this._get_parent(t);break;case"inside":case"first":if(!t.children("ul").length){t.append("<ul />")}t.children("ul").prepend(o);a=t;break;case"last":if(!t.children("ul").length){t.append("<ul />")}t.children("ul").append(o);a=t;break;default:if(!t.children("ul").length){t.append("<ul />")}if(!n){n=0}a=t.children("ul").children("li").eq(n);if(a.length){a.before(o)}else{t.children("ul").append(o)}a=t;break}if(a===-1||a.get(0)===this.get_container().get(0)){a=-1}this.clean_node(a);this.__callback({obj:o,parent:a});if(i){i.call(this,o)}return o},get_text:function(e){e=this._get_node(e);if(!e.length){return false}var t=this._get_settings().core.html_titles;e=e.children("a:eq(0)");if(t){e=e.clone();e.children("INS").remove();return e.html()}else{e=e.contents().filter(function(){return this.nodeType==3})[0];return e.nodeValue}},set_text:function(e,t){e=this._get_node(e);if(!e.length){return false}e=e.children("a:eq(0)");if(this._get_settings().core.html_titles){var n=e.children("INS").clone();e.html(t).prepend(n);this.__callback({obj:e,name:t});return true}else{e=e.contents().filter(function(){return this.nodeType==3})[0];this.__callback({obj:e,name:t});return e.nodeValue=t}},rename_node:function(e,t){e=this._get_node(e);this.__rollback();if(e&&e.length&&this.set_text.apply(this,Array.prototype.slice.call(arguments))){this.__callback({obj:e,name:t})}},delete_node:function(t){t=this._get_node(t);if(!t.length){return false}this.__rollback();var n=this._get_parent(t),r=e([]),i=this;t.each(function(){r=r.add(i._get_prev(this))});t=t.detach();if(n!==-1&&n.find("> ul > li").length===0){n.removeClass("jstree-open jstree-closed").addClass("jstree-leaf")}this.clean_node(n);this.__callback({obj:t,prev:r,parent:n});return t},prepare_move:function(t,n,r,i,s){var o={};o.ot=e.jstree._reference(t)||this;o.o=o.ot._get_node(t);o.r=n===-1?-1:this._get_node(n);o.p=typeof r==="undefined"||r===false?"last":r;if(!s&&u.o&&u.o[0]===o.o[0]&&u.r[0]===o.r[0]&&u.p===o.p){this.__callback(u);if(i){i.call(this,u)}return}o.ot=e.jstree._reference(o.o)||this;o.rt=e.jstree._reference(o.r)||this;if(o.r===-1||!o.r){o.cr=-1;switch(o.p){case"first":case"before":case"inside":o.cp=0;break;case"after":case"last":o.cp=o.rt.get_container().find(" > ul > li").length;break;default:o.cp=o.p;break}}else{if(!/^(before|after)$/.test(o.p)&&!this._is_loaded(o.r)){return this.load_node(o.r,function(){this.prepare_move(t,n,r,i,true)})}switch(o.p){case"before":o.cp=o.r.index();o.cr=o.rt._get_parent(o.r);break;case"after":o.cp=o.r.index()+1;o.cr=o.rt._get_parent(o.r);break;case"inside":case"first":o.cp=0;o.cr=o.r;break;case"last":o.cp=o.r.find(" > ul > li").length;o.cr=o.r;break;default:o.cp=o.p;o.cr=o.r;break}}o.np=o.cr==-1?o.rt.get_container():o.cr;o.op=o.ot._get_parent(o.o);o.cop=o.o.index();if(o.op===-1){o.op=o.ot?o.ot.get_container():this.get_container()}if(!/^(before|after)$/.test(o.p)&&o.op&&o.np&&o.op[0]===o.np[0]&&o.o.index()<o.cp){o.cp++}o.or=o.np.find(" > ul > li:nth-child("+(o.cp+1)+")");u=o;this.__callback(u);if(i){i.call(this,u)}},check_move:function(){var e=u,t=true,n=e.r===-1?this.get_container():e.r;if(!e||!e.o||e.or[0]===e.o[0]){return false}if(e.op&&e.np&&e.op[0]===e.np[0]&&e.cp-1===e.o.index()){return false}e.o.each(function(){if(n.parentsUntil(".jstree","li").andSelf().index(this)!==-1){t=false;return false}});return t},move_node:function(t,n,r,i,s,o){if(!s){return this.prepare_move(t,n,r,function(e){this.move_node(e,false,false,i,true,o)})}if(i){u.cy=true}if(!o&&!this.check_move()){return false}this.__rollback();var a=false;if(i){a=t.o.clone(true);a.find("*[id]").andSelf().each(function(){if(this.id){this.id="copy_"+this.id}})}else{a=t.o}if(t.or.length){t.or.before(a)}else{if(!t.np.children("ul").length){e("<ul />").appendTo(t.np)}t.np.children("ul:eq(0)").append(a)}try{t.ot.clean_node(t.op);t.rt.clean_node(t.np);if(!t.op.find("> ul > li").length){t.op.removeClass("jstree-open jstree-closed").addClass("jstree-leaf").children("ul").remove()}}catch(f){}if(i){u.cy=true;u.oc=a}this.__callback(u);return u},_get_move:function(){return u}}})})(e);(function(e){var t,n,r;e(function(){if(/msie/.test(navigator.userAgent.toLowerCase())){n=e('<textarea cols="10" rows="2"></textarea>').css({position:"absolute",top:-1e3,left:0}).appendTo("body");r=e('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>').css({position:"absolute",top:-1e3,left:0}).appendTo("body");t=n.width()-r.width();n.add(r).remove()}else{n=e("<div />").css({width:100,height:100,overflow:"auto",position:"absolute",top:-1e3,left:0}).prependTo("body").append("<div />").find("div").css({width:"100%",height:200});t=100-n.width();n.parent().remove()}});e.jstree.plugin("ui",{__init:function(){this.data.ui.selected=e();this.data.ui.last_selected=false;this.data.ui.hovered=null;this.data.ui.to_select=this.get_settings().ui.initially_select;this.get_container().delegate("a","click.jstree",e.proxy(function(t){t.preventDefault();t.currentTarget.blur();if(!e(t.currentTarget).hasClass("jstree-loading")){this.select_node(t.currentTarget,true,t)}},this)).delegate("a","mouseenter.jstree",e.proxy(function(t){if(!e(t.currentTarget).hasClass("jstree-loading")){this.hover_node(t.target)}},this)).delegate("a","mouseleave.jstree",e.proxy(function(t){if(!e(t.currentTarget).hasClass("jstree-loading")){this.dehover_node(t.target)}},this)).bind("reopen.jstree",e.proxy(function(){this.reselect()},this)).bind("get_rollback.jstree",e.proxy(function(){this.dehover_node();this.save_selected()},this)).bind("set_rollback.jstree",e.proxy(function(){this.reselect()},this)).bind("close_node.jstree",e.proxy(function(t,n){var r=this._get_settings().ui,i=this._get_node(n.rslt.obj),s=i&&i.length?i.children("ul").find("a.jstree-clicked"):e(),o=this;if(r.selected_parent_close===false||!s.length){return}s.each(function(){o.deselect_node(this);if(r.selected_parent_close==="select_parent"){o.select_node(i)}})},this)).bind("delete_node.jstree",e.proxy(function(e,t){var n=this._get_settings().ui.select_prev_on_delete,r=this._get_node(t.rslt.obj),i=r&&r.length?r.find("a.jstree-clicked"):[],s=this;i.each(function(){s.deselect_node(this)});if(n&&i.length){t.rslt.prev.each(function(){if(this.parentNode){s.select_node(this);return false}})}},this)).bind("move_node.jstree",e.proxy(function(e,t){if(t.rslt.cy){t.rslt.oc.find("a.jstree-clicked").removeClass("jstree-clicked")}},this))},defaults:{select_limit:-1,select_multiple_modifier:"ctrl",select_range_modifier:"shift",selected_parent_close:"select_parent",selected_parent_open:true,select_prev_on_delete:true,disable_selecting_children:false,initially_select:[]},_fn:{_get_node:function(t,n){if(typeof t==="undefined"||t===null){return n?this.data.ui.selected:this.data.ui.last_selected}var r=e(t,this.get_container());if(r.is(".jstree")||t==-1){return-1}r=r.closest("li",this.get_container());return r.length?r:false},_ui_notify:function(e,t){if(t.selected){this.select_node(e,false)}},save_selected:function(){var e=this;this.data.ui.to_select=[];this.data.ui.selected.each(function(){if(this.id){e.data.ui.to_select.push("#"+this.id.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:"))}});this.__callback(this.data.ui.to_select)},reselect:function(){var t=this,n=this.data.ui.to_select;n=e.map(e.makeArray(n),function(e){return"#"+e.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")});e.each(n,function(e,n){if(n&&n!=="#"){t.select_node(n)}});this.data.ui.selected=this.data.ui.selected.filter(function(){return this.parentNode});this.__callback()},refresh:function(e){this.save_selected();return this.__call_old()},hover_node:function(e){e=this._get_node(e);if(!e.length){return false}if(!e.hasClass("jstree-hovered")){this.dehover_node()}this.data.ui.hovered=e.children("a").addClass("jstree-hovered").parent();this._fix_scroll(e);this.__callback({obj:e})},dehover_node:function(){var e=this.data.ui.hovered,t;if(!e||!e.length){return false}t=e.children("a").removeClass("jstree-hovered").parent();if(this.data.ui.hovered[0]===t[0]){this.data.ui.hovered=null}this.__callback({obj:e})},select_node:function(e,t,n){e=this._get_node(e);if(e==-1||!e||!e.length){return false}var r=this._get_settings().ui,i=r.select_multiple_modifier=="on"||r.select_multiple_modifier!==false&&n&&n[r.select_multiple_modifier+"Key"],s=r.select_range_modifier!==false&&n&&n[r.select_range_modifier+"Key"]&&this.data.ui.last_selected&&this.data.ui.last_selected[0]!==e[0]&&this.data.ui.last_selected.parent()[0]===e.parent()[0],o=this.is_selected(e),u=true,a=this;if(t){if(r.disable_selecting_children&&i&&(e.parentsUntil(".jstree","li").children("a.jstree-clicked").length||e.children("ul").find("a.jstree-clicked:eq(0)").length)){return false}u=false;switch(!0){case s:this.data.ui.last_selected.addClass("jstree-last-selected");e=e[e.index()<this.data.ui.last_selected.index()?"nextUntil":"prevUntil"](".jstree-last-selected").andSelf();if(r.select_limit==-1||e.length<r.select_limit){this.data.ui.last_selected.removeClass("jstree-last-selected");this.data.ui.selected.each(function(){if(this!==a.data.ui.last_selected[0]){a.deselect_node(this)}});o=false;u=true}else{u=false}break;case o&&!i:this.deselect_all();o=false;u=true;break;case!o&&!i:if(r.select_limit==-1||r.select_limit>0){this.deselect_all();u=true}break;case o&&i:this.deselect_node(e);break;case!o&&i:if(r.select_limit==-1||this.data.ui.selected.length+1<=r.select_limit){u=true}break}}if(u&&!o){if(!s){this.data.ui.last_selected=e}e.children("a").addClass("jstree-clicked");if(r.selected_parent_open){e.parents(".jstree-closed").each(function(){a.open_node(this,false,true)})}this.data.ui.selected=this.data.ui.selected.add(e);this._fix_scroll(e.eq(0));this.__callback({obj:e,e:n})}},_fix_scroll:function(e){var n=this.get_container()[0],r;if(n.scrollHeight>n.offsetHeight){e=this._get_node(e);if(!e||e===-1||!e.length||!e.is(":visible")){return}r=e.offset().top-this.get_container().offset().top;if(r<0){n.scrollTop=n.scrollTop+r-1}if(r+this.data.core.li_height+(n.scrollWidth>n.offsetWidth?t:0)>n.offsetHeight){n.scrollTop=n.scrollTop+(r-n.offsetHeight+this.data.core.li_height+1+(n.scrollWidth>n.offsetWidth?t:0))}}},deselect_node:function(e){e=this._get_node(e);if(!e.length){return false}if(this.is_selected(e)){e.children("a").removeClass("jstree-clicked");this.data.ui.selected=this.data.ui.selected.not(e);if(this.data.ui.last_selected.get(0)===e.get(0)){this.data.ui.last_selected=this.data.ui.selected.eq(0)}this.__callback({obj:e})}},toggle_select:function(e){e=this._get_node(e);if(!e.length){return false}if(this.is_selected(e)){this.deselect_node(e)}else{this.select_node(e)}},is_selected:function(e){return this.data.ui.selected.index(this._get_node(e))>=0},get_selected:function(t){return t?e(t).find("a.jstree-clicked").parent():this.data.ui.selected},deselect_all:function(t){var n=t?e(t).find("a.jstree-clicked").parent():this.get_container().find("a.jstree-clicked").parent();n.children("a.jstree-clicked").removeClass("jstree-clicked");this.data.ui.selected=e([]);this.data.ui.last_selected=false;this.__callback({obj:n})}}});e.jstree.defaults.plugins.push("ui")})(e);(function(e){e.jstree.plugin("crrm",{__init:function(){this.get_container().bind("move_node.jstree",e.proxy(function(e,t){if(this._get_settings().crrm.move.open_onmove){var n=this;t.rslt.np.parentsUntil(".jstree").andSelf().filter(".jstree-closed").each(function(){n.open_node(this,false,true)})}},this))},defaults:{input_width_limit:200,move:{always_copy:false,open_onmove:true,default_position:"last",check_move:function(e){return true}}},_fn:{_show_input:function(t,n){t=this._get_node(t);var r=this._get_settings().core.rtl,i=this._get_settings().crrm.input_width_limit,s=t.children("ins").width(),o=t.find("> a:visible > ins").width()*t.find("> a:visible > ins").length,u=this.get_text(t),a=e("<div />",{css:{position:"absolute",top:"-200px",left:r?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),f=t.css("position","relative").append(e("<input />",{value:u,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver",position:"absolute",left:r?"auto":s+o+4+"px",right:r?s+o+4+"px":"auto",top:"0px",height:this.data.core.li_height-2+"px",lineHeight:this.data.core.li_height-2+"px",width:"150px"},blur:e.proxy(function(){var e=t.children(".jstree-rename-input"),r=e.val();if(r===""){r=u}a.remove();e.remove();this.set_text(t,u);this.rename_node(t,r);n.call(this,t,r,u);t.css("position","")},this),keyup:function(e){var t=e.keyCode||e.which;if(t==27){this.value=u;this.blur();return}else if(t==13){this.blur();return}else{f.width(Math.min(a.text("pW"+this.value).width(),i))}},keypress:function(e){var t=e.keyCode||e.which;if(t==13){return false}}})).children(".jstree-rename-input");this.set_text(t,"");a.css({fontFamily:f.css("fontFamily")||"",fontSize:f.css("fontSize")||"",fontWeight:f.css("fontWeight")||"",fontStyle:f.css("fontStyle")||"",fontStretch:f.css("fontStretch")||"",fontVariant:f.css("fontVariant")||"",letterSpacing:f.css("letterSpacing")||"",wordSpacing:f.css("wordSpacing")||""});f.width(Math.min(a.text("pW"+f[0].value).width(),i))[0].select()},rename:function(e){e=this._get_node(e);this.__rollback();var t=this.__callback;this._show_input(e,function(e,n,r){t.call(this,{obj:e,new_name:n,old_name:r})})},create:function(t,n,r,i,s){var o,u=this;t=this._get_node(t);if(!t){t=-1}this.__rollback();o=this.create_node(t,n,r,function(t){var n=this._get_parent(t),r=e(t).index();if(i){i.call(this,t)}if(n.length&&n.hasClass("jstree-closed")){this.open_node(n,false,true)}if(!s){this._show_input(t,function(e,t,i){u.__callback({obj:e,name:t,parent:n,position:r})})}else{u.__callback({obj:t,name:this.get_text(t),parent:n,position:r})}});return o},remove:function(e){e=this._get_node(e,true);var t=this._get_parent(e),n=this._get_prev(e);this.__rollback();e=this.delete_node(e);if(e!==false){this.__callback({obj:e,prev:n,parent:t})}},check_move:function(){if(!this.__call_old()){return false}var e=this._get_settings().crrm.move;if(!e.check_move.call(this,this._get_move())){return false}return true},move_node:function(e,t,n,r,i,s){var o=this._get_settings().crrm.move;if(!i){if(typeof n==="undefined"){n=o.default_position}if(n==="inside"&&!o.default_position.match(/^(before|after)$/)){n=o.default_position}return this.__call_old(true,e,t,n,r,false,s)}if(o.always_copy===true||o.always_copy==="multitree"&&e.rt.get_index()!==e.ot.get_index()){r=true}this.__call_old(true,e,t,n,r,true,s)},cut:function(e){e=this._get_node(e,true);if(!e||!e.length){return false}this.data.crrm.cp_nodes=false;this.data.crrm.ct_nodes=e;this.__callback({obj:e})},copy:function(e){e=this._get_node(e,true);if(!e||!e.length){return false}this.data.crrm.ct_nodes=false;this.data.crrm.cp_nodes=e;this.__callback({obj:e})},paste:function(e){e=this._get_node(e);if(!e||!e.length){return false}var t=this.data.crrm.ct_nodes?this.data.crrm.ct_nodes:this.data.crrm.cp_nodes;if(!this.data.crrm.ct_nodes&&!this.data.crrm.cp_nodes){return false}if(this.data.crrm.ct_nodes){this.move_node(this.data.crrm.ct_nodes,e);this.data.crrm.ct_nodes=false}if(this.data.crrm.cp_nodes){this.move_node(this.data.crrm.cp_nodes,e,false,true)}this.__callback({obj:e,nodes:t})}}})})(e);(function(e){var t=[];e.jstree._themes=false;e.jstree.plugin("themes",{__init:function(){this.get_container().bind("init.jstree",e.proxy(function(){var e=this._get_settings().themes;this.data.themes.dots=e.dots;this.data.themes.icons=e.icons;this.set_theme(e.theme,e.url)},this)).bind("loaded.jstree",e.proxy(function(){if(!this.data.themes.dots){this.hide_dots()}else{this.show_dots()}if(!this.data.themes.icons){this.hide_icons()}else{this.show_icons()}},this))},defaults:{theme:"default",url:false,dots:true,icons:true},_fn:{set_theme:function(n,r){if(!n){return false}if(!r){r=e.jstree._themes+n+"/style.css"}if(e.inArray(r,t)==-1){e.vakata.css.add_sheet({url:r});t.push(r)}if(this.data.themes.theme!=n){this.get_container().removeClass("jstree-"+this.data.themes.theme);this.data.themes.theme=n}this.get_container().addClass("jstree-"+n);if(!this.data.themes.dots){this.hide_dots()}else{this.show_dots()}if(!this.data.themes.icons){this.hide_icons()}else{this.show_icons()}this.__callback()},get_theme:function(){return this.data.themes.theme},show_dots:function(){this.data.themes.dots=true;this.get_container().children("ul").removeClass("jstree-no-dots")},hide_dots:function(){this.data.themes.dots=false;this.get_container().children("ul").addClass("jstree-no-dots")},toggle_dots:function(){if(this.data.themes.dots){this.hide_dots()}else{this.show_dots()}},show_icons:function(){this.data.themes.icons=true;this.get_container().children("ul").removeClass("jstree-no-icons")},hide_icons:function(){this.data.themes.icons=false;this.get_container().children("ul").addClass("jstree-no-icons")},toggle_icons:function(){if(this.data.themes.icons){this.hide_icons()}else{this.show_icons()}}}});e(function(){if(e.jstree._themes===false){e("script").each(function(){if(this.src.toString().match(/jquery\.jstree[^\/]*?\.js(\?.*)?$/)){e.jstree._themes=this.src.toString().replace(/jquery\.jstree[^\/]*?\.js(\?.*)?$/,"")+"themes/";return false}})}if(e.jstree._themes===false){e.jstree._themes="themes/"}});e.jstree.defaults.plugins.push("themes")})(e);(function(e){function n(t,n){var r=e.jstree._focused(),i;if(r&&r.data&&r.data.hotkeys&&r.data.hotkeys.enabled){i=r._get_settings().hotkeys[t];if(i){return i.call(r,n)}}}var t=[];e.jstree.plugin("hotkeys",{__init:function(){if(typeof e.hotkeys==="undefined"){throw"jsTree hotkeys: jQuery hotkeys plugin not included."}if(!this.data.ui){throw"jsTree hotkeys: jsTree UI plugin not included."}e.each(this._get_settings().hotkeys,function(r,i){if(i!==false&&e.inArray(r,t)==-1){e(document).bind("keydown",r,function(e){return n(r,e)});t.push(r)}});this.get_container().bind("lock.jstree",e.proxy(function(){if(this.data.hotkeys.enabled){this.data.hotkeys.enabled=false;this.data.hotkeys.revert=true}},this)).bind("unlock.jstree",e.proxy(function(){if(this.data.hotkeys.revert){this.data.hotkeys.enabled=true}},this));this.enable_hotkeys()},defaults:{up:function(){var e=this.data.ui.hovered||this.data.ui.last_selected||-1;this.hover_node(this._get_prev(e));return false},"ctrl+up":function(){var e=this.data.ui.hovered||this.data.ui.last_selected||-1;this.hover_node(this._get_prev(e));return false},"shift+up":function(){var e=this.data.ui.hovered||this.data.ui.last_selected||-1;this.hover_node(this._get_prev(e));return false},down:function(){var e=this.data.ui.hovered||this.data.ui.last_selected||-1;this.hover_node(this._get_next(e));return false},"ctrl+down":function(){var e=this.data.ui.hovered||this.data.ui.last_selected||-1;this.hover_node(this._get_next(e));return false},"shift+down":function(){var e=this.data.ui.hovered||this.data.ui.last_selected||-1;this.hover_node(this._get_next(e));return false},left:function(){var e=this.data.ui.hovered||this.data.ui.last_selected;if(e){if(e.hasClass("jstree-open")){this.close_node(e)}else{this.hover_node(this._get_prev(e))}}return false},"ctrl+left":function(){var e=this.data.ui.hovered||this.data.ui.last_selected;if(e){if(e.hasClass("jstree-open")){this.close_node(e)}else{this.hover_node(this._get_prev(e))}}return false},"shift+left":function(){var e=this.data.ui.hovered||this.data.ui.last_selected;if(e){if(e.hasClass("jstree-open")){this.close_node(e)}else{this.hover_node(this._get_prev(e))}}return false},right:function(){var e=this.data.ui.hovered||this.data.ui.last_selected;if(e&&e.length){if(e.hasClass("jstree-closed")){this.open_node(e)}else{this.hover_node(this._get_next(e))}}return false},"ctrl+right":function(){var e=this.data.ui.hovered||this.data.ui.last_selected;if(e&&e.length){if(e.hasClass("jstree-closed")){this.open_node(e)}else{this.hover_node(this._get_next(e))}}return false},"shift+right":function(){var e=this.data.ui.hovered||this.data.ui.last_selected;if(e&&e.length){if(e.hasClass("jstree-closed")){this.open_node(e)}else{this.hover_node(this._get_next(e))}}return false},space:function(){if(this.data.ui.hovered){this.data.ui.hovered.children("a:eq(0)").click()}return false},"ctrl+space":function(e){e.type="click";if(this.data.ui.hovered){this.data.ui.hovered.children("a:eq(0)").trigger(e)}return false},"shift+space":function(e){e.type="click";if(this.data.ui.hovered){this.data.ui.hovered.children("a:eq(0)").trigger(e)}return false},f2:function(){this.rename(this.data.ui.hovered||this.data.ui.last_selected)},del:function(){this.remove(this.data.ui.hovered||this._get_node(null))}},_fn:{enable_hotkeys:function(){this.data.hotkeys.enabled=true},disable_hotkeys:function(){this.data.hotkeys.enabled=false}}})})(e);(function(e){e.jstree.plugin("json_data",{__init:function(){var e=this._get_settings().json_data;if(e.progressive_unload){this.get_container().bind("after_close.jstree",function(e,t){t.rslt.obj.children("ul").remove()})}},defaults:{data:false,ajax:false,correct_state:true,progressive_render:false,progressive_unload:false},_fn:{load_node:function(e,t,n){var r=this;this.load_node_json(e,function(){r.__callback({obj:r._get_node(e)});t.call(this)},n)},_is_loaded:function(t){var n=this._get_settings().json_data;t=this._get_node(t);return t==-1||!t||!n.ajax&&!n.progressive_render&&!e.isFunction(n.data)||t.is(".jstree-open, .jstree-leaf")||t.children("ul").children("li").length>0},refresh:function(t){t=this._get_node(t);var n=this._get_settings().json_data;if(t&&t!==-1&&n.progressive_unload&&(e.isFunction(n.data)||!!n.ajax)){t.removeData("jstree-children")}return this.__call_old()},load_node_json:function(t,n,r){var i=this.get_settings().json_data,s,o=function(){},u=function(){};t=this._get_node(t);if(t&&t!==-1&&(i.progressive_render||i.progressive_unload)&&!t.is(".jstree-open, .jstree-leaf")&&t.children("ul").children("li").length===0&&t.data("jstree-children")){s=this._parse_json(t.data("jstree-children"),t);if(s){t.append(s);if(!i.progressive_unload){t.removeData("jstree-children")}}this.clean_node(t);if(n){n.call(this)}return}if(t&&t!==-1){if(t.data("jstree-is-loading")){return}else{t.data("jstree-is-loading",true)}}switch(!0){case!i.data&&!i.ajax:throw"Neither data nor ajax settings supplied.";case e.isFunction(i.data):i.data.call(this,t,e.proxy(function(e){e=this._parse_json(e,t);if(!e){if(t===-1||!t){if(i.correct_state){this.get_container().children("ul").empty()}}else{t.children("a.jstree-loading").removeClass("jstree-loading");t.removeData("jstree-is-loading");if(i.correct_state){this.correct_state(t)}}if(r){r.call(this)}}else{if(t===-1||!t){this.get_container().children("ul").empty().append(e.children())}else{t.append(e).children("a.jstree-loading").removeClass("jstree-loading");t.removeData("jstree-is-loading")}this.clean_node(t);if(n){n.call(this)}}},this));break;case!!i.data&&!i.ajax||!!i.data&&!!i.ajax&&(!t||t===-1):if(!t||t==-1){s=this._parse_json(i.data,t);if(s){this.get_container().children("ul").empty().append(s.children());this.clean_node()}else{if(i.correct_state){this.get_container().children("ul").empty()}}}if(n){n.call(this)}break;case!i.data&&!!i.ajax||!!i.data&&!!i.ajax&&t&&t!==-1:o=function(e,n,s){var o=this.get_settings().json_data.ajax.error;if(o){o.call(this,e,n,s)}if(t!=-1&&t.length){t.children("a.jstree-loading").removeClass("jstree-loading");t.removeData("jstree-is-loading");if(n==="success"&&i.correct_state){this.correct_state(t)}}else{if(n==="success"&&i.correct_state){this.get_container().children("ul").empty()}}if(r){r.call(this)}};u=function(r,s,u){var a=this.get_settings().json_data.ajax.success;if(a){r=a.call(this,r,s,u)||r}if(r===""||r&&r.toString&&r.toString().replace(/^[\s\n]+$/,"")===""||!e.isArray(r)&&!e.isPlainObject(r)){return o.call(this,u,s,"")}r=this._parse_json(r,t);if(r){if(t===-1||!t){this.get_container().children("ul").empty().append(r.children())}else{t.append(r).children("a.jstree-loading").removeClass("jstree-loading");t.removeData("jstree-is-loading")}this.clean_node(t);if(n){n.call(this)}}else{if(t===-1||!t){if(i.correct_state){this.get_container().children("ul").empty();if(n){n.call(this)}}}else{t.children("a.jstree-loading").removeClass("jstree-loading");t.removeData("jstree-is-loading");if(i.correct_state){this.correct_state(t);if(n){n.call(this)}}}}};i.ajax.context=this;i.ajax.error=o;i.ajax.success=u;if(!i.ajax.dataType){i.ajax.dataType="json"}if(e.isFunction(i.ajax.url)){i.ajax.url=i.ajax.url.call(this,t)}if(e.isFunction(i.ajax.data)){i.ajax.data=i.ajax.data.call(this,t)}e.ajax(i.ajax);break}},_parse_json:function(t,n,r){var i=false,s=this._get_settings(),o=s.json_data,u=s.core.html_titles,a,f,l,c,h;if(!t){return i}if(o.progressive_unload&&n&&n!==-1){n.data("jstree-children",i)}if(e.isArray(t)){i=e();if(!t.length){return false}for(f=0,l=t.length;f<l;f++){a=this._parse_json(t[f],n,true);if(a.length){i=i.add(a)}}}else{if(typeof t=="string"){t={data:t}}if(!t.data&&t.data!==""){return i}i=e("<li />");if(t.attr){i.attr(t.attr)}if(t.metadata){i.data(t.metadata)}if(t.state){i.addClass("jstree-"+t.state)}if(!e.isArray(t.data)){a=t.data;t.data=[];t.data.push(a)}e.each(t.data,function(n,r){a=e("<a />");if(e.isFunction(r)){r=r.call(this,t)}if(typeof r=="string"){a.attr("href","#")[u?"html":"text"](r)}else{if(!r.attr){r.attr={}}if(!r.attr.href){r.attr.href="#"}a.attr(r.attr)[u?"html":"text"](r.title);if(r.language){a.addClass(r.language)}}a.prepend("<ins class='jstree-icon'>&#160;</ins>");if(!r.icon&&t.icon){r.icon=t.icon}if(r.icon){if(r.icon.indexOf("/")===-1){a.children("ins").addClass(r.icon)}else{a.children("ins").css("background","url('"+r.icon+"') center center no-repeat")}}i.append(a)});i.prepend("<ins class='jstree-icon'>&#160;</ins>");if(t.children){if(o.progressive_render&&t.state!=="open"){i.addClass("jstree-closed").data("jstree-children",t.children)}else{if(o.progressive_unload){i.data("jstree-children",t.children)}if(e.isArray(t.children)&&t.children.length){a=this._parse_json(t.children,n,true);if(a.length){h=e("<ul />");h.append(a);i.append(h)}}}}}if(!r){c=e("<ul />");c.append(i);i=c}return i},get_json:function(t,n,r,i){var s=[],o=this._get_settings(),u=this,a,f,l,c,h,p;t=this._get_node(t);if(!t||t===-1){t=this.get_container().find("> ul > li")}n=e.isArray(n)?n:["id","class"];if(!i&&this.data.types){n.push(o.types.type_attr)}r=e.isArray(r)?r:[];t.each(function(){l=e(this);a={data:[]};if(n.length){a.attr={}}e.each(n,function(e,t){f=l.attr(t);if(f&&f.length&&f.replace(/jstree[^ ]*/ig,"").length){a.attr[t]=(" "+f).replace(/ jstree[^ ]*/ig,"").replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,"")}});if(l.hasClass("jstree-open")){a.state="open"}if(l.hasClass("jstree-closed")){a.state="closed"}if(l.data()){a.metadata=l.data()}c=l.children("a");c.each(function(){h=e(this);if(r.length||e.inArray("languages",o.plugins)!==-1||h.children("ins").get(0).style.backgroundImage.length||h.children("ins").get(0).className&&h.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,"").length){p=false;if(e.inArray("languages",o.plugins)!==-1&&e.isArray(o.languages)&&o.languages.length){e.each(o.languages,function(e,t){if(h.hasClass(t)){p=t;return false}})}f={attr:{},title:u.get_text(h,p)};e.each(r,function(e,t){f.attr[t]=(" "+(h.attr(t)||"")).replace(/ jstree[^ ]*/ig,"").replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,"")});if(e.inArray("languages",o.plugins)!==-1&&e.isArray(o.languages)&&o.languages.length){e.each(o.languages,function(e,t){if(h.hasClass(t)){f.language=t;return true}})}if(h.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,"").replace(/^\s+$/ig,"").length){f.icon=h.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,"").replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,"")}if(h.children("ins").get(0).style.backgroundImage.length){f.icon=h.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","")}}else{f=u.get_text(h)}if(c.length>1){a.data.push(f)}else{a.data=f}});l=l.find("> ul > li");if(l.length){a.children=u.get_json(l,n,r,true)}s.push(a)});return s}}})})(e);(function(e){e.jstree.plugin("languages",{__init:function(){this._load_css()},defaults:[],_fn:{set_lang:function(t){var n=this._get_settings().languages,r=false,i=".jstree-"+this.get_index()+" a";if(!e.isArray(n)||n.length===0){return false}if(e.inArray(t,n)==-1){if(!!n[t]){t=n[t]}else{return false}}if(t==this.data.languages.current_language){return true}r=e.vakata.css.get_css(i+"."+this.data.languages.current_language,false,this.data.languages.language_css);if(r!==false){r.style.display="none"}r=e.vakata.css.get_css(i+"."+t,false,this.data.languages.language_css);if(r!==false){r.style.display=""}this.data.languages.current_language=t;this.__callback(t);return true},get_lang:function(){return this.data.languages.current_language},_get_string:function(t,n){var r=this._get_settings().languages,i=this._get_settings().core.strings;if(e.isArray(r)&&r.length){n=n&&e.inArray(n,r)!=-1?n:this.data.languages.current_language}if(i[n]&&i[n][t]){return i[n][t]}if(i[t]){return i[t]}return t},get_text:function(t,n){t=this._get_node(t)||this.data.ui.last_selected;if(!t.size()){return false}var r=this._get_settings().languages,i=this._get_settings().core.html_titles;if(e.isArray(r)&&r.length){n=n&&e.inArray(n,r)!=-1?n:this.data.languages.current_language;t=t.children("a."+n)}else{t=t.children("a:eq(0)")}if(i){t=t.clone();t.children("INS").remove();return t.html()}else{t=t.contents().filter(function(){return this.nodeType==3})[0];return t.nodeValue}},set_text:function(t,n,r){t=this._get_node(t)||this.data.ui.last_selected;if(!t.size()){return false}var i=this._get_settings().languages,s=this._get_settings().core.html_titles,o;if(e.isArray(i)&&i.length){r=r&&e.inArray(r,i)!=-1?r:this.data.languages.current_language;t=t.children("a."+r)}else{t=t.children("a:eq(0)")}if(s){o=t.children("INS").clone();t.html(n).prepend(o);this.__callback({obj:t,name:n,lang:r});return true}else{t=t.contents().filter(function(){return this.nodeType==3})[0];this.__callback({obj:t,name:n,lang:r});return t.nodeValue=n}},_load_css:function(){var t=this._get_settings().languages,n="/* languages css */",r=".jstree-"+this.get_index()+" a",i;if(e.isArray(t)&&t.length){this.data.languages.current_language=t[0];for(i=0;i<t.length;i++){n+=r+"."+t[i]+" {";if(t[i]!=this.data.languages.current_language){n+=" display:none; "}n+=" } "}this.data.languages.language_css=e.vakata.css.add_sheet({str:n,title:"jstree-languages"})}},create_node:function(t,n,r,i){var s=this.__call_old(true,t,n,r,function(t){var n=this._get_settings().languages,r=t.children("a"),s;if(e.isArray(n)&&n.length){for(s=0;s<n.length;s++){if(!r.is("."+n[s])){t.append(r.eq(0).clone().removeClass(n.join(" ")).addClass(n[s]))}}r.not("."+n.join(", .")).remove()}if(i){i.call(this,t)}});return s}}})})(e);(function(e){e.jstree.plugin("cookies",{__init:function(){if(typeof e.cookie==="undefined"){throw"jsTree cookie: jQuery cookie plugin not included."}var t=this._get_settings().cookies,n;if(!!t.save_loaded){n=e.cookie(t.save_loaded);if(n&&n.length){this.data.core.to_load=n.split(",")}}if(!!t.save_opened){n=e.cookie(t.save_opened);if(n&&n.length){this.data.core.to_open=n.split(",")}}if(!!t.save_selected){n=e.cookie(t.save_selected);if(n&&n.length&&this.data.ui){this.data.ui.to_select=n.split(",")}}this.get_container().one((this.data.ui?"reselect":"reopen")+".jstree",e.proxy(function(){this.get_container().bind("open_node.jstree close_node.jstree select_node.jstree deselect_node.jstree",e.proxy(function(e){if(this._get_settings().cookies.auto_save){this.save_cookie((e.handleObj.namespace+e.handleObj.type).replace("jstree",""))}},this))},this))},defaults:{save_loaded:"jstree_load",save_opened:"jstree_open",save_selected:"jstree_select",auto_save:true,cookie_options:{}},_fn:{save_cookie:function(t){if(this.data.core.refreshing){return}var n=this._get_settings().cookies;if(!t){if(n.save_loaded){this.save_loaded();e.cookie(n.save_loaded,this.data.core.to_load.join(","),n.cookie_options)}if(n.save_opened){this.save_opened();e.cookie(n.save_opened,this.data.core.to_open.join(","),n.cookie_options)}if(n.save_selected&&this.data.ui){this.save_selected();e.cookie(n.save_selected,this.data.ui.to_select.join(","),n.cookie_options)}return}switch(t){case"open_node":case"close_node":if(!!n.save_opened){this.save_opened();e.cookie(n.save_opened,this.data.core.to_open.join(","),n.cookie_options)}if(!!n.save_loaded){this.save_loaded();e.cookie(n.save_loaded,this.data.core.to_load.join(","),n.cookie_options)}break;case"select_node":case"deselect_node":if(!!n.save_selected&&this.data.ui){this.save_selected();e.cookie(n.save_selected,this.data.ui.to_select.join(","),n.cookie_options)}break}}}})})(e);(function(e){e.jstree.plugin("sort",{__init:function(){this.get_container().bind("load_node.jstree",e.proxy(function(e,t){var n=this._get_node(t.rslt.obj);n=n===-1?this.get_container().children("ul"):n.children("ul");this.sort(n)},this)).bind("rename_node.jstree create_node.jstree create.jstree",e.proxy(function(e,t){this.sort(t.rslt.obj.parent())},this)).bind("move_node.jstree",e.proxy(function(e,t){var n=t.rslt.np==-1?this.get_container():t.rslt.np;this.sort(n.children("ul"))},this))},defaults:function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},_fn:{sort:function(t){var n=this._get_settings().sort,r=this;t.append(e.makeArray(t.children("li")).sort(e.proxy(n,r)));t.find("> li > ul").each(function(){r.sort(e(this))});this.clean_node(t)}}})})(e);(function(e){var t=false,n=false,r=false,i=false,s=false,o=false,u=false,a=false,f=false;e.vakata.dnd={is_down:false,is_drag:false,helper:false,scroll_spd:10,init_x:0,init_y:0,threshold:5,helper_left:5,helper_top:10,user_data:{},drag_start:function(t,n,r){if(e.vakata.dnd.is_drag){e.vakata.drag_stop({})}try{t.currentTarget.unselectable="on";t.currentTarget.onselectstart=function(){return false};if(t.currentTarget.style){t.currentTarget.style.MozUserSelect="none"}}catch(i){}e.vakata.dnd.init_x=t.pageX;e.vakata.dnd.init_y=t.pageY;e.vakata.dnd.user_data=n;e.vakata.dnd.is_down=true;e.vakata.dnd.helper=e("<div id='vakata-dragged' />").html(r);e(document).bind("mousemove",e.vakata.dnd.drag);e(document).bind("mouseup",e.vakata.dnd.drag_stop);return false},drag:function(t){if(!e.vakata.dnd.is_down){return}if(!e.vakata.dnd.is_drag){if(Math.abs(t.pageX-e.vakata.dnd.init_x)>5||Math.abs(t.pageY-e.vakata.dnd.init_y)>5){e.vakata.dnd.helper.appendTo("body");e.vakata.dnd.is_drag=true;e(document).triggerHandler("drag_start.vakata",{event:t,data:e.vakata.dnd.user_data})}else{return}}if(t.type==="mousemove"){var n=e(document),r=n.scrollTop(),i=n.scrollLeft();if(t.pageY-r<20){if(o&&u==="down"){clearInterval(o);o=false}if(!o){u="up";o=setInterval(function(){e(document).scrollTop(e(document).scrollTop()-e.vakata.dnd.scroll_spd)},150)}}else{if(o&&u==="up"){clearInterval(o);o=false}}if(e(window).height()-(t.pageY-r)<20){if(o&&u==="up"){clearInterval(o);o=false}if(!o){u="down";o=setInterval(function(){e(document).scrollTop(e(document).scrollTop()+e.vakata.dnd.scroll_spd)},150)}}else{if(o&&u==="down"){clearInterval(o);o=false}}if(t.pageX-i<20){if(s&&a==="right"){clearInterval(s);s=false}if(!s){a="left";s=setInterval(function(){e(document).scrollLeft(e(document).scrollLeft()-e.vakata.dnd.scroll_spd)},150)}}else{if(s&&a==="left"){clearInterval(s);s=false}}if(e(window).width()-(t.pageX-i)<20){if(s&&a==="left"){clearInterval(s);s=false}if(!s){a="right";s=setInterval(function(){e(document).scrollLeft(e(document).scrollLeft()+e.vakata.dnd.scroll_spd)},150)}}else{if(s&&a==="right"){clearInterval(s);s=false}}}e.vakata.dnd.helper.css({left:t.pageX+e.vakata.dnd.helper_left+"px",top:t.pageY+e.vakata.dnd.helper_top+"px"});e(document).triggerHandler("drag.vakata",{event:t,data:e.vakata.dnd.user_data})},drag_stop:function(t){if(s){clearInterval(s)}if(o){clearInterval(o)}e(document).unbind("mousemove",e.vakata.dnd.drag);e(document).unbind("mouseup",e.vakata.dnd.drag_stop);e(document).triggerHandler("drag_stop.vakata",{event:t,data:e.vakata.dnd.user_data});e.vakata.dnd.helper.remove();e.vakata.dnd.init_x=0;e.vakata.dnd.init_y=0;e.vakata.dnd.user_data={};e.vakata.dnd.is_down=false;e.vakata.dnd.is_drag=false}};e(function(){var t="#vakata-dragged { display:block; margin:0 0 0 0; padding:4px 4px 4px 24px; position:absolute; top:-2000px; line-height:16px; z-index:10000; } ";e.vakata.css.add_sheet({str:t,title:"vakata"})});e.jstree.plugin("dnd",{__init:function(){this.data.dnd={active:false,after:false,inside:false,before:false,off:false,prepared:false,w:0,to1:false,to2:false,cof:false,cw:false,ch:false,i1:false,i2:false,mto:false};this.get_container().bind("mouseenter.jstree",e.proxy(function(n){if(e.vakata.dnd.is_drag&&e.vakata.dnd.user_data.jstree){if(this.data.themes){r.attr("class","jstree-"+this.data.themes.theme);if(i){i.attr("class","jstree-"+this.data.themes.theme)}e.vakata.dnd.helper.attr("class","jstree-dnd-helper jstree-"+this.data.themes.theme)}if(n.currentTarget===n.target&&e.vakata.dnd.user_data.obj&&e(e.vakata.dnd.user_data.obj).length&&e(e.vakata.dnd.user_data.obj).parents(".jstree:eq(0)")[0]!==n.target){var s=e.jstree._reference(n.target),o;if(s.data.dnd.foreign){o=s._get_settings().dnd.drag_check.call(this,{o:t,r:s.get_container(),is_root:true});if(o===true||o.inside===true||o.before===true||o.after===true){e.vakata.dnd.helper.children("ins").attr("class","jstree-ok")}}else{s.prepare_move(t,s.get_container(),"last");if(s.check_move()){e.vakata.dnd.helper.children("ins").attr("class","jstree-ok")}}}}},this)).bind("mouseup.jstree",e.proxy(function(n){if(e.vakata.dnd.is_drag&&e.vakata.dnd.user_data.jstree&&n.currentTarget===n.target&&e.vakata.dnd.user_data.obj&&e(e.vakata.dnd.user_data.obj).length&&e(e.vakata.dnd.user_data.obj).parents(".jstree:eq(0)")[0]!==n.target){var r=e.jstree._reference(n.currentTarget),i;if(r.data.dnd.foreign){i=r._get_settings().dnd.drag_check.call(this,{o:t,r:r.get_container(),is_root:true});if(i===true||i.inside===true||i.before===true||i.after===true){r._get_settings().dnd.drag_finish.call(this,{o:t,r:r.get_container(),is_root:true})}}else{r.move_node(t,r.get_container(),"last",n[r._get_settings().dnd.copy_modifier+"Key"])}}},this)).bind("mouseleave.jstree",e.proxy(function(t){if(t.relatedTarget&&t.relatedTarget.id&&t.relatedTarget.id==="jstree-marker-line"){return false}if(e.vakata.dnd.is_drag&&e.vakata.dnd.user_data.jstree){if(this.data.dnd.i1){clearInterval(this.data.dnd.i1)}if(this.data.dnd.i2){clearInterval(this.data.dnd.i2)}if(this.data.dnd.to1){clearTimeout(this.data.dnd.to1)}if(this.data.dnd.to2){clearTimeout(this.data.dnd.to2)}if(e.vakata.dnd.helper.children("ins").hasClass("jstree-ok")){e.vakata.dnd.helper.children("ins").attr("class","jstree-invalid")}}},this)).bind("mousemove.jstree",e.proxy(function(t){if(e.vakata.dnd.is_drag&&e.vakata.dnd.user_data.jstree){var n=this.get_container()[0];if(t.pageX+24>this.data.dnd.cof.left+this.data.dnd.cw){if(this.data.dnd.i1){clearInterval(this.data.dnd.i1)}this.data.dnd.i1=setInterval(e.proxy(function(){this.scrollLeft+=e.vakata.dnd.scroll_spd},n),100)}else if(t.pageX-24<this.data.dnd.cof.left){if(this.data.dnd.i1){clearInterval(this.data.dnd.i1)}this.data.dnd.i1=setInterval(e.proxy(function(){this.scrollLeft-=e.vakata.dnd.scroll_spd},n),100)}else{if(this.data.dnd.i1){clearInterval(this.data.dnd.i1)}}if(t.pageY+24>this.data.dnd.cof.top+this.data.dnd.ch){if(this.data.dnd.i2){clearInterval(this.data.dnd.i2)}this.data.dnd.i2=setInterval(e.proxy(function(){this.scrollTop+=e.vakata.dnd.scroll_spd},n),100)}else if(t.pageY-24<this.data.dnd.cof.top){if(this.data.dnd.i2){clearInterval(this.data.dnd.i2)}this.data.dnd.i2=setInterval(e.proxy(function(){this.scrollTop-=e.vakata.dnd.scroll_spd},n),100)}else{if(this.data.dnd.i2){clearInterval(this.data.dnd.i2)}}}},this)).bind("scroll.jstree",e.proxy(function(t){if(e.vakata.dnd.is_drag&&e.vakata.dnd.user_data.jstree&&r&&i){r.hide();i.hide()}},this)).delegate("a","mousedown.jstree",e.proxy(function(e){if(e.which===1){this.start_drag(e.currentTarget,e);return false}},this)).delegate("a","mouseenter.jstree",e.proxy(function(t){if(e.vakata.dnd.is_drag&&e.vakata.dnd.user_data.jstree){this.dnd_enter(t.currentTarget)}},this)).delegate("a","mousemove.jstree",e.proxy(function(t){if(e.vakata.dnd.is_drag&&e.vakata.dnd.user_data.jstree){if(!n||!n.length||n.children("a")[0]!==t.currentTarget){this.dnd_enter(t.currentTarget)}if(typeof this.data.dnd.off.top==="undefined"){this.data.dnd.off=e(t.target).offset()}this.data.dnd.w=(t.pageY-(this.data.dnd.off.top||0))%this.data.core.li_height;if(this.data.dnd.w<0){this.data.dnd.w+=this.data.core.li_height}this.dnd_show()}},this)).delegate("a","mouseleave.jstree",e.proxy(function(t){if(e.vakata.dnd.is_drag&&e.vakata.dnd.user_data.jstree){if(t.relatedTarget&&t.relatedTarget.id&&t.relatedTarget.id==="jstree-marker-line"){return false}if(r){r.hide()}if(i){i.hide()}this.data.dnd.mto=setTimeout(function(e){return function(){e.dnd_leave(t)}}(this),0)}},this)).delegate("a","mouseup.jstree",e.proxy(function(t){if(e.vakata.dnd.is_drag&&e.vakata.dnd.user_data.jstree){this.dnd_finish(t)}},this));e(document).bind("drag_stop.vakata",e.proxy(function(){if(this.data.dnd.to1){clearTimeout(this.data.dnd.to1)}if(this.data.dnd.to2){clearTimeout(this.data.dnd.to2)}if(this.data.dnd.i1){clearInterval(this.data.dnd.i1)}if(this.data.dnd.i2){clearInterval(this.data.dnd.i2)}this.data.dnd.after=false;this.data.dnd.before=false;this.data.dnd.inside=false;this.data.dnd.off=false;this.data.dnd.prepared=false;this.data.dnd.w=false;this.data.dnd.to1=false;this.data.dnd.to2=false;this.data.dnd.i1=false;this.data.dnd.i2=false;this.data.dnd.active=false;this.data.dnd.foreign=false;if(r){r.css({top:"-2000px"})}if(i){i.css({top:"-2000px"})}},this)).bind("drag_start.vakata",e.proxy(function(t,n){if(n.data.jstree){var r=e(n.event.target);if(r.closest(".jstree").hasClass("jstree-"+this.get_index())){this.dnd_enter(r)}}},this));var s=this._get_settings().dnd;if(s.drag_target){e(document).delegate(s.drag_target,"mousedown.jstree-"+this.get_index(),e.proxy(function(n){t=n.target;e.vakata.dnd.drag_start(n,{jstree:true,obj:n.target},"<ins class='jstree-icon'></ins>"+e(n.target).text());if(this.data.themes){if(r){r.attr("class","jstree-"+this.data.themes.theme)}if(i){i.attr("class","jstree-"+this.data.themes.theme)}e.vakata.dnd.helper.attr("class","jstree-dnd-helper jstree-"+this.data.themes.theme)}e.vakata.dnd.helper.children("ins").attr("class","jstree-invalid");var s=this.get_container();this.data.dnd.cof=s.offset();this.data.dnd.cw=parseInt(s.width(),10);this.data.dnd.ch=parseInt(s.height(),10);this.data.dnd.foreign=true;n.preventDefault()},this))}if(s.drop_target){e(document).delegate(s.drop_target,"mouseenter.jstree-"+this.get_index(),e.proxy(function(n){if(this.data.dnd.active&&this._get_settings().dnd.drop_check.call(this,{o:t,r:e(n.target),e:n})){e.vakata.dnd.helper.children("ins").attr("class","jstree-ok")}},this)).delegate(s.drop_target,"mouseleave.jstree-"+this.get_index(),e.proxy(function(t){if(this.data.dnd.active){e.vakata.dnd.helper.children("ins").attr("class","jstree-invalid")}},this)).delegate(s.drop_target,"mouseup.jstree-"+this.get_index(),e.proxy(function(n){if(this.data.dnd.active&&e.vakata.dnd.helper.children("ins").hasClass("jstree-ok")){this._get_settings().dnd.drop_finish.call(this,{o:t,r:e(n.target),e:n})}},this))}},defaults:{copy_modifier:"ctrl",check_timeout:100,open_timeout:500,drop_target:".jstree-drop",drop_check:function(e){return true},drop_finish:e.noop,drag_target:".jstree-draggable",drag_finish:e.noop,drag_check:function(e){return{after:false,before:false,inside:true}}},_fn:{dnd_prepare:function(){if(!n||!n.length){return}this.data.dnd.off=n.offset();if(this._get_settings().core.rtl){this.data.dnd.off.right=this.data.dnd.off.left+n.width()}if(this.data.dnd.foreign){var e=this._get_settings().dnd.drag_check.call(this,{o:t,r:n});this.data.dnd.after=e.after;this.data.dnd.before=e.before;this.data.dnd.inside=e.inside;this.data.dnd.prepared=true;return this.dnd_show()}this.prepare_move(t,n,"before");this.data.dnd.before=this.check_move();this.prepare_move(t,n,"after");this.data.dnd.after=this.check_move();if(this._is_loaded(n)){this.prepare_move(t,n,"inside");this.data.dnd.inside=this.check_move()}else{this.data.dnd.inside=false}this.data.dnd.prepared=true;return this.dnd_show()},dnd_show:function(){if(!this.data.dnd.prepared){return}var t=["before","inside","after"],n=false,s=this._get_settings().core.rtl,o;if(this.data.dnd.w<this.data.core.li_height/3){t=["before","inside","after"]}else if(this.data.dnd.w<=this.data.core.li_height*2/3){t=this.data.dnd.w<this.data.core.li_height/2?["inside","before","after"]:["inside","after","before"]}else{t=["after","inside","before"]}e.each(t,e.proxy(function(t,r){if(this.data.dnd[r]){e.vakata.dnd.helper.children("ins").attr("class","jstree-ok");n=r;return false}},this));if(n===false){e.vakata.dnd.helper.children("ins").attr("class","jstree-invalid")}o=s?this.data.dnd.off.right-18:this.data.dnd.off.left+10;switch(n){case"before":r.css({left:o+"px",top:this.data.dnd.off.top-6+"px"}).show();if(i){i.css({left:o+8+"px",top:this.data.dnd.off.top-1+"px"}).show()}break;case"after":r.css({left:o+"px",top:this.data.dnd.off.top+this.data.core.li_height-6+"px"}).show();if(i){i.css({left:o+8+"px",top:this.data.dnd.off.top+this.data.core.li_height-1+"px"}).show()}break;case"inside":r.css({left:o+(s?-4:4)+"px",top:this.data.dnd.off.top+this.data.core.li_height/2-5+"px"}).show();if(i){i.hide()}break;default:r.hide();if(i){i.hide()}break}f=n;return n},dnd_open:function(){this.data.dnd.to2=false;this.open_node(n,e.proxy(this.dnd_prepare,this),true)},dnd_finish:function(e){if(this.data.dnd.foreign){if(this.data.dnd.after||this.data.dnd.before||this.data.dnd.inside){this._get_settings().dnd.drag_finish.call(this,{o:t,r:n,p:f})}}else{this.dnd_prepare();this.move_node(t,n,f,e[this._get_settings().dnd.copy_modifier+"Key"])}t=false;n=false;r.hide();if(i){i.hide()}},dnd_enter:function(t){if(this.data.dnd.mto){clearTimeout(this.data.dnd.mto);this.data.dnd.mto=false}var r=this._get_settings().dnd;this.data.dnd.prepared=false;n=this._get_node(t);if(r.check_timeout){if(this.data.dnd.to1){clearTimeout(this.data.dnd.to1)}this.data.dnd.to1=setTimeout(e.proxy(this.dnd_prepare,this),r.check_timeout)}else{this.dnd_prepare()}if(r.open_timeout){if(this.data.dnd.to2){clearTimeout(this.data.dnd.to2)}if(n&&n.length&&n.hasClass("jstree-closed")){this.data.dnd.to2=setTimeout(e.proxy(this.dnd_open,this),r.open_timeout)}}else{if(n&&n.length&&n.hasClass("jstree-closed")){this.dnd_open()}}},dnd_leave:function(t){this.data.dnd.after=false;this.data.dnd.before=false;this.data.dnd.inside=false;e.vakata.dnd.helper.children("ins").attr("class","jstree-invalid");r.hide();if(i){i.hide()}if(n&&n[0]===t.target.parentNode){if(this.data.dnd.to1){clearTimeout(this.data.dnd.to1);this.data.dnd.to1=false}if(this.data.dnd.to2){clearTimeout(this.data.dnd.to2);this.data.dnd.to2=false}}},start_drag:function(n,s){t=this._get_node(n);if(this.data.ui&&this.is_selected(t)){t=this._get_node(null,true)}var o=t.length>1?this._get_string("multiple_selection"):this.get_text(t),u=this.get_container();if(!this._get_settings().core.html_titles){o=o.replace(/</ig,"&lt;").replace(/>/ig,"&gt;")}e.vakata.dnd.drag_start(s,{jstree:true,obj:t},"<ins class='jstree-icon'></ins>"+o);if(this.data.themes){if(r){r.attr("class","jstree-"+this.data.themes.theme)}if(i){i.attr("class","jstree-"+this.data.themes.theme)}e.vakata.dnd.helper.attr("class","jstree-dnd-helper jstree-"+this.data.themes.theme)}this.data.dnd.cof=u.offset();this.data.dnd.cw=parseInt(u.width(),10);this.data.dnd.ch=parseInt(u.height(),10);this.data.dnd.active=true}}});e(function(){var t=""+"#vakata-dragged ins { display:block; text-decoration:none; width:16px; height:16px; margin:0 0 0 0; padding:0; position:absolute; top:4px; left:4px; "+" -moz-border-radius:4px; border-radius:4px; -webkit-border-radius:4px; "+"} "+"#vakata-dragged .jstree-ok { background:green; } "+"#vakata-dragged .jstree-invalid { background:red; } "+"#jstree-marker { padding:0; margin:0; font-size:12px; overflow:hidden; height:12px; width:8px; position:absolute; top:-30px; z-index:10001; background-repeat:no-repeat; display:none; background-color:transparent; text-shadow:1px 1px 1px white; color:black; line-height:10px; } "+"#jstree-marker-line { padding:0; margin:0; line-height:0%; font-size:1px; overflow:hidden; height:1px; width:100px; position:absolute; top:-30px; z-index:10000; background-repeat:no-repeat; display:none; background-color:#456c43; "+" cursor:pointer; border:1px solid #eeeeee; border-left:0; -moz-box-shadow: 0px 0px 2px #666; -webkit-box-shadow: 0px 0px 2px #666; box-shadow: 0px 0px 2px #666; "+" -moz-border-radius:1px; border-radius:1px; -webkit-border-radius:1px; "+"}"+"";e.vakata.css.add_sheet({str:t,title:"jstree"});r=e("<div />").attr({id:"jstree-marker"}).hide().html("&raquo;").bind("mouseleave mouseenter",function(e){r.hide();i.hide();e.preventDefault();e.stopImmediatePropagation();return false}).appendTo("body");i=e("<div />").attr({id:"jstree-marker-line"}).hide().bind("mouseup",function(e){if(n&&n.length){n.children("a").trigger(e);e.preventDefault();e.stopImmediatePropagation();return false}}).bind("mouseleave",function(t){var s=e(t.relatedTarget);if(s.is(".jstree")||s.closest(".jstree").length===0){if(n&&n.length){n.children("a").trigger(t);r.hide();i.hide();t.preventDefault();t.stopImmediatePropagation();return false}}}).appendTo("body");e(document).bind("drag_start.vakata",function(e,t){if(t.data.jstree){r.show();if(i){i.show()}}});e(document).bind("drag_stop.vakata",function(e,t){if(t.data.jstree){r.hide();if(i){i.hide()}}})})})(e);(function(e){e.jstree.plugin("checkbox",{__init:function(){this.data.checkbox.noui=this._get_settings().checkbox.override_ui;if(this.data.ui&&this.data.checkbox.noui){this.select_node=this.deselect_node=this.deselect_all=e.noop;this.get_selected=this.get_checked}this.get_container().bind("open_node.jstree create_node.jstree clean_node.jstree refresh.jstree",e.proxy(function(e,t){this._prepare_checkboxes(t.rslt.obj)},this)).bind("loaded.jstree",e.proxy(function(e){this._prepare_checkboxes()},this)).delegate(this.data.ui&&this.data.checkbox.noui?"a":"ins.jstree-checkbox","click.jstree",e.proxy(function(e){e.preventDefault();if(this._get_node(e.target).hasClass("jstree-checked")){this.uncheck_node(e.target)}else{this.check_node(e.target)}if(this.data.ui&&this.data.checkbox.noui){this.save_selected();if(this.data.cookies){this.save_cookie("select_node")}}else{e.stopImmediatePropagation();return false}},this))},defaults:{override_ui:false,two_state:false,real_checkboxes:false,checked_parent_open:true,real_checkboxes_names:function(e){return["check_"+(e[0].id||Math.ceil(Math.random()*1e4)),1]}},__destroy:function(){this.get_container().find("input.jstree-real-checkbox").removeClass("jstree-real-checkbox").end().find("ins.jstree-checkbox").remove()},_fn:{_checkbox_notify:function(e,t){if(t.checked){this.check_node(e,false)}},_prepare_checkboxes:function(t){t=!t||t==-1?this.get_container().find("> ul > li"):this._get_node(t);if(t===false){return}var n,r=this,i,s=this._get_settings().checkbox.two_state,o=this._get_settings().checkbox.real_checkboxes,u=this._get_settings().checkbox.real_checkboxes_names;t.each(function(){i=e(this);n=i.is("li")&&(i.hasClass("jstree-checked")||o&&i.children(":checked").length)?"jstree-checked":"jstree-unchecked";i.find("li").andSelf().each(function(){var t=e(this),i;t.children("a"+(r.data.languages?"":":eq(0)")).not(":has(.jstree-checkbox)").prepend("<ins class='jstree-checkbox'>&#160;</ins>").parent().not(".jstree-checked, .jstree-unchecked").addClass(s?"jstree-unchecked":n);if(o){if(!t.children(":checkbox").length){i=u.call(r,t);t.prepend("<input type='checkbox' class='jstree-real-checkbox' id='"+i[0]+"' name='"+i[0]+"' value='"+i[1]+"' />")}else{t.children(":checkbox").addClass("jstree-real-checkbox")}if(n==="jstree-checked"){t.children(":checkbox").attr("checked","checked")}}if(n==="jstree-checked"&&!s){t.find("li").addClass("jstree-checked")}})});if(!s){if(t.length===1&&t.is("li")){this._repair_state(t)}if(t.is("li")){t.each(function(){r._repair_state(this)})}else{t.find("> ul > li").each(function(){r._repair_state(this)})}t.find(".jstree-checked").parent().parent().each(function(){r._repair_state(this)})}},change_state:function(t,n){t=this._get_node(t);var r=false,i=this._get_settings().checkbox.real_checkboxes;if(!t||t===-1){return false}n=n===false||n===true?n:t.hasClass("jstree-checked");if(this._get_settings().checkbox.two_state){if(n){t.removeClass("jstree-checked").addClass("jstree-unchecked");if(i){t.children(":checkbox").removeAttr("checked")}}else{t.removeClass("jstree-unchecked").addClass("jstree-checked");if(i){t.children(":checkbox").attr("checked","checked")}}}else{if(n){r=t.find("li").andSelf();if(!r.filter(".jstree-checked, .jstree-undetermined").length){return false}r.removeClass("jstree-checked jstree-undetermined").addClass("jstree-unchecked");if(i){r.children(":checkbox").removeAttr("checked")}}else{r=t.find("li").andSelf();if(!r.filter(".jstree-unchecked, .jstree-undetermined").length){return false}r.removeClass("jstree-unchecked jstree-undetermined").addClass("jstree-checked");if(i){r.children(":checkbox").attr("checked","checked")}if(this.data.ui){this.data.ui.last_selected=t}this.data.checkbox.last_selected=t}t.parentsUntil(".jstree","li").each(function(){var t=e(this);if(n){if(t.children("ul").children("li.jstree-checked, li.jstree-undetermined").length){t.parentsUntil(".jstree","li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined");if(i){t.parentsUntil(".jstree","li").andSelf().children(":checkbox").removeAttr("checked")}return false}else{t.removeClass("jstree-checked jstree-undetermined").addClass("jstree-unchecked");if(i){t.children(":checkbox").removeAttr("checked")}}}else{if(t.children("ul").children("li.jstree-unchecked, li.jstree-undetermined").length){t.parentsUntil(".jstree","li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined");if(i){t.parentsUntil(".jstree","li").andSelf().children(":checkbox").removeAttr("checked")}return false}else{t.removeClass("jstree-unchecked jstree-undetermined").addClass("jstree-checked");if(i){t.children(":checkbox").attr("checked","checked")}}}})}if(this.data.ui&&this.data.checkbox.noui){this.data.ui.selected=this.get_checked()}this.__callback(t);return true},check_node:function(e){if(this.change_state(e,false)){e=this._get_node(e);if(this._get_settings().checkbox.checked_parent_open){var t=this;e.parents(".jstree-closed").each(function(){t.open_node(this,false,true)})}this.__callback({obj:e})}},uncheck_node:function(e){if(this.change_state(e,true)){this.__callback({obj:this._get_node(e)})}},check_all:function(){var e=this,t=this._get_settings().checkbox.two_state?this.get_container_ul().find("li"):this.get_container_ul().children("li");t.each(function(){e.change_state(this,false)});this.__callback()},uncheck_all:function(){var e=this,t=this._get_settings().checkbox.two_state?this.get_container_ul().find("li"):this.get_container_ul().children("li");t.each(function(){e.change_state(this,true)});this.__callback()},is_checked:function(e){e=this._get_node(e);return e.length?e.is(".jstree-checked"):false},get_checked:function(e,t){e=!e||e===-1?this.get_container():this._get_node(e);return t||this._get_settings().checkbox.two_state?e.find(".jstree-checked"):e.find("> ul > .jstree-checked, .jstree-undetermined > ul > .jstree-checked")},get_unchecked:function(e,t){e=!e||e===-1?this.get_container():this._get_node(e);return t||this._get_settings().checkbox.two_state?e.find(".jstree-unchecked"):e.find("> ul > .jstree-unchecked, .jstree-undetermined > ul > .jstree-unchecked")},show_checkboxes:function(){this.get_container().children("ul").removeClass("jstree-no-checkboxes")},hide_checkboxes:function(){this.get_container().children("ul").addClass("jstree-no-checkboxes")},_repair_state:function(e){e=this._get_node(e);if(!e.length){return}var t=this._get_settings().checkbox.real_checkboxes,n=e.find("> ul > .jstree-checked").length,r=e.find("> ul > .jstree-undetermined").length,i=e.find("> ul > li").length;if(i===0){if(e.hasClass("jstree-undetermined")){this.change_state(e,false)}}else if(n===0&&r===0){this.change_state(e,true)}else if(n===i){this.change_state(e,false)}else{e.parentsUntil(".jstree","li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined");if(t){e.parentsUntil(".jstree","li").andSelf().children(":checkbox").removeAttr("checked")}}},reselect:function(){if(this.data.ui&&this.data.checkbox.noui){var t=this,n=this.data.ui.to_select;n=e.map(e.makeArray(n),function(e){return"#"+e.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")});this.deselect_all();e.each(n,function(e,n){t.check_node(n)});this.__callback()}else{this.__call_old()}},save_loaded:function(){var e=this;this.data.core.to_load=[];this.get_container_ul().find("li.jstree-closed.jstree-undetermined").each(function(){if(this.id){e.data.core.to_load.push("#"+this.id)}})}}});e(function(){var t=".jstree .jstree-real-checkbox { display:none; } ";e.vakata.css.add_sheet({str:t,title:"jstree"})})})(e);(function(e){e.vakata.xslt=function(t,n,r){var i="",s,o,u,a;if(document.recalc){s=document.createElement("xml");o=document.createElement("xml");s.innerHTML=t;o.innerHTML=n;e("body").append(s).append(o);setTimeout(function(t,n,r){return function(){r.call(null,t.transformNode(n.XMLDocument));setTimeout(function(t,n){return function(){e(t).remove();e(n).remove()}}(t,n),200)}}(s,o,r),100);return true}if(typeof window.DOMParser!=="undefined"&&typeof window.XMLHttpRequest!=="undefined"&&typeof window.XSLTProcessor==="undefined"){t=(new DOMParser).parseFromString(t,"text/xml");n=(new DOMParser).parseFromString(n,"text/xml")}if(typeof window.DOMParser!=="undefined"&&typeof window.XMLHttpRequest!=="undefined"&&typeof window.XSLTProcessor!=="undefined"){u=new XSLTProcessor;a=e.isFunction(u.transformDocument)?typeof window.XMLSerializer!=="undefined":true;if(!a){return false}t=(new DOMParser).parseFromString(t,"text/xml");n=(new DOMParser).parseFromString(n,"text/xml");if(e.isFunction(u.transformDocument)){i=document.implementation.createDocument("","",null);u.transformDocument(t,n,i,null);r.call(null,(new XMLSerializer).serializeToString(i));return true}else{u.importStylesheet(n);i=u.transformToFragment(t,document);r.call(null,e("<div />").append(i).html());return true}}return false};var t={nest:"<"+'?xml version="1.0" encoding="utf-8" ?>'+'<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" >'+'<xsl:output method="html" encoding="utf-8" omit-xml-declaration="yes" standalone="no" indent="no" media-type="text/html" />'+'<xsl:template match="/">'+'	<xsl:call-template name="nodes">'+'		<xsl:with-param name="node" select="/root" />'+"	</xsl:call-template>"+"</xsl:template>"+'<xsl:template name="nodes">'+'	<xsl:param name="node" />'+"	<ul>"+'	<xsl:for-each select="$node/item">'+'		<xsl:variable name="children" select="count(./item) &gt; 0" />'+"		<li>"+'			<xsl:attribute name="class">'+'				<xsl:if test="position() = last()">jstree-last </xsl:if>'+"				<xsl:choose>"+"					<xsl:when test=\"@state = 'open'\">jstree-open </xsl:when>"+"					<xsl:when test=\"$children or @hasChildren or @state = 'closed'\">jstree-closed </xsl:when>"+"					<xsl:otherwise>jstree-leaf </xsl:otherwise>"+"				</xsl:choose>"+'				<xsl:value-of select="@class" />'+"			</xsl:attribute>"+'			<xsl:for-each select="@*">'+"				<xsl:if test=\"name() != 'class' and name() != 'state' and name() != 'hasChildren'\">"+'					<xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>'+"				</xsl:if>"+"			</xsl:for-each>"+'	<ins class="jstree-icon"><xsl:text>&#xa0;</xsl:text></ins>'+'			<xsl:for-each select="content/name">'+"				<a>"+'				<xsl:attribute name="href">'+"					<xsl:choose>"+'					<xsl:when test="@href"><xsl:value-of select="@href" /></xsl:when>'+"					<xsl:otherwise>#</xsl:otherwise>"+"					</xsl:choose>"+"				</xsl:attribute>"+'				<xsl:attribute name="class"><xsl:value-of select="@lang" /> <xsl:value-of select="@class" /></xsl:attribute>'+'				<xsl:attribute name="style"><xsl:value-of select="@style" /></xsl:attribute>'+'				<xsl:for-each select="@*">'+"					<xsl:if test=\"name() != 'style' and name() != 'class' and name() != 'href'\">"+'						<xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>'+"					</xsl:if>"+"				</xsl:for-each>"+"					<ins>"+'						<xsl:attribute name="class">jstree-icon '+'							<xsl:if test="string-length(attribute::icon) > 0 and not(contains(@icon,\'/\'))"><xsl:value-of select="@icon" /></xsl:if>'+"						</xsl:attribute>"+'						<xsl:if test="string-length(attribute::icon) > 0 and contains(@icon,\'/\')"><xsl:attribute name="style">background:url(<xsl:value-of select="@icon" />) center center no-repeat;</xsl:attribute></xsl:if>'+"						<xsl:text>&#xa0;</xsl:text>"+"					</ins>"+'					<xsl:copy-of select="./child::node()" />'+"				</a>"+"			</xsl:for-each>"+'			<xsl:if test="$children or @hasChildren"><xsl:call-template name="nodes"><xsl:with-param name="node" select="current()" /></xsl:call-template></xsl:if>'+"		</li>"+"	</xsl:for-each>"+"	</ul>"+"</xsl:template>"+"</xsl:stylesheet>",flat:"<"+'?xml version="1.0" encoding="utf-8" ?>'+'<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" >'+'<xsl:output method="html" encoding="utf-8" omit-xml-declaration="yes" standalone="no" indent="no" media-type="text/xml" />'+'<xsl:template match="/">'+"	<ul>"+'	<xsl:for-each select="//item[not(@parent_id) or @parent_id=0 or not(@parent_id = //item/@id)]">'+'		<xsl:call-template name="nodes">'+'			<xsl:with-param name="node" select="." />'+'			<xsl:with-param name="is_last" select="number(position() = last())" />'+"		</xsl:call-template>"+"	</xsl:for-each>"+"	</ul>"+"</xsl:template>"+'<xsl:template name="nodes">'+'	<xsl:param name="node" />'+'	<xsl:param name="is_last" />'+'	<xsl:variable name="children" select="count(//item[@parent_id=$node/attribute::id]) &gt; 0" />'+"	<li>"+'	<xsl:attribute name="class">'+'		<xsl:if test="$is_last = true()">jstree-last </xsl:if>'+"		<xsl:choose>"+"			<xsl:when test=\"@state = 'open'\">jstree-open </xsl:when>"+"			<xsl:when test=\"$children or @hasChildren or @state = 'closed'\">jstree-closed </xsl:when>"+"			<xsl:otherwise>jstree-leaf </xsl:otherwise>"+"		</xsl:choose>"+'		<xsl:value-of select="@class" />'+"	</xsl:attribute>"+'	<xsl:for-each select="@*">'+"		<xsl:if test=\"name() != 'parent_id' and name() != 'hasChildren' and name() != 'class' and name() != 'state'\">"+'		<xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>'+"		</xsl:if>"+"	</xsl:for-each>"+'	<ins class="jstree-icon"><xsl:text>&#xa0;</xsl:text></ins>'+'	<xsl:for-each select="content/name">'+"		<a>"+'		<xsl:attribute name="href">'+"			<xsl:choose>"+'			<xsl:when test="@href"><xsl:value-of select="@href" /></xsl:when>'+"			<xsl:otherwise>#</xsl:otherwise>"+"			</xsl:choose>"+"		</xsl:attribute>"+'		<xsl:attribute name="class"><xsl:value-of select="@lang" /> <xsl:value-of select="@class" /></xsl:attribute>'+'		<xsl:attribute name="style"><xsl:value-of select="@style" /></xsl:attribute>'+'		<xsl:for-each select="@*">'+"			<xsl:if test=\"name() != 'style' and name() != 'class' and name() != 'href'\">"+'				<xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>'+"			</xsl:if>"+"		</xsl:for-each>"+"			<ins>"+'				<xsl:attribute name="class">jstree-icon '+'					<xsl:if test="string-length(attribute::icon) > 0 and not(contains(@icon,\'/\'))"><xsl:value-of select="@icon" /></xsl:if>'+"				</xsl:attribute>"+'				<xsl:if test="string-length(attribute::icon) > 0 and contains(@icon,\'/\')"><xsl:attribute name="style">background:url(<xsl:value-of select="@icon" />) center center no-repeat;</xsl:attribute></xsl:if>'+"				<xsl:text>&#xa0;</xsl:text>"+"			</ins>"+'			<xsl:copy-of select="./child::node()" />'+"		</a>"+"	</xsl:for-each>"+'	<xsl:if test="$children">'+"		<ul>"+'		<xsl:for-each select="//item[@parent_id=$node/attribute::id]">'+'			<xsl:call-template name="nodes">'+'				<xsl:with-param name="node" select="." />'+'				<xsl:with-param name="is_last" select="number(position() = last())" />'+"			</xsl:call-template>"+"		</xsl:for-each>"+"		</ul>"+"	</xsl:if>"+"	</li>"+"</xsl:template>"+"</xsl:stylesheet>"},n=function(e){return e.toString().replace(/&/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")};e.jstree.plugin("xml_data",{defaults:{data:false,ajax:false,xsl:"flat",clean_node:false,correct_state:true,get_skip_empty:false,get_include_preamble:true},_fn:{load_node:function(e,t,n){var r=this;this.load_node_xml(e,function(){r.__callback({obj:r._get_node(e)});t.call(this)},n)},_is_loaded:function(t){var n=this._get_settings().xml_data;t=this._get_node(t);return t==-1||!t||!n.ajax&&!e.isFunction(n.data)||t.is(".jstree-open, .jstree-leaf")||t.children("ul").children("li").size()>0},load_node_xml:function(t,n,r){var i=this.get_settings().xml_data,s=function(){},o=function(){};t=this._get_node(t);if(t&&t!==-1){if(t.data("jstree-is-loading")){return}else{t.data("jstree-is-loading",true)}}switch(!0){case!i.data&&!i.ajax:throw"Neither data nor ajax settings supplied.";case e.isFunction(i.data):i.data.call(this,t,e.proxy(function(r){this.parse_xml(r,e.proxy(function(r){if(r){r=r.replace(/ ?xmlns="[^"]*"/ig,"");if(r.length>10){r=e(r);if(t===-1||!t){this.get_container().children("ul").empty().append(r.children())}else{t.children("a.jstree-loading").removeClass("jstree-loading");t.append(r);t.removeData("jstree-is-loading")}if(i.clean_node){this.clean_node(t)}if(n){n.call(this)}}else{if(t&&t!==-1){t.children("a.jstree-loading").removeClass("jstree-loading");t.removeData("jstree-is-loading");if(i.correct_state){this.correct_state(t);if(n){n.call(this)}}}else{if(i.correct_state){this.get_container().children("ul").empty();if(n){n.call(this)}}}}}},this))},this));break;case!!i.data&&!i.ajax||!!i.data&&!!i.ajax&&(!t||t===-1):if(!t||t==-1){this.parse_xml(i.data,e.proxy(function(r){if(r){r=r.replace(/ ?xmlns="[^"]*"/ig,"");if(r.length>10){r=e(r);this.get_container().children("ul").empty().append(r.children());if(i.clean_node){this.clean_node(t)}if(n){n.call(this)}}}else{if(i.correct_state){this.get_container().children("ul").empty();if(n){n.call(this)}}}},this))}break;case!i.data&&!!i.ajax||!!i.data&&!!i.ajax&&t&&t!==-1:s=function(e,n,s){var o=this.get_settings().xml_data.ajax.error;if(o){o.call(this,e,n,s)}if(t!==-1&&t.length){t.children("a.jstree-loading").removeClass("jstree-loading");t.removeData("jstree-is-loading");if(n==="success"&&i.correct_state){this.correct_state(t)}}else{if(n==="success"&&i.correct_state){this.get_container().children("ul").empty()}}if(r){r.call(this)}};o=function(r,o,u){r=u.responseText;var a=this.get_settings().xml_data.ajax.success;if(a){r=a.call(this,r,o,u)||r}if(r===""||r&&r.toString&&r.toString().replace(/^[\s\n]+$/,"")===""){return s.call(this,u,o,"")}this.parse_xml(r,e.proxy(function(r){if(r){r=r.replace(/ ?xmlns="[^"]*"/ig,"");if(r.length>10){r=e(r);if(t===-1||!t){this.get_container().children("ul").empty().append(r.children())}else{t.children("a.jstree-loading").removeClass("jstree-loading");t.append(r);t.removeData("jstree-is-loading")}if(i.clean_node){this.clean_node(t)}if(n){n.call(this)}}else{if(t&&t!==-1){t.children("a.jstree-loading").removeClass("jstree-loading");t.removeData("jstree-is-loading");if(i.correct_state){this.correct_state(t);if(n){n.call(this)}}}else{if(i.correct_state){this.get_container().children("ul").empty();if(n){n.call(this)}}}}}},this))};i.ajax.context=this;i.ajax.error=s;i.ajax.success=o;if(!i.ajax.dataType){i.ajax.dataType="xml"}if(e.isFunction(i.ajax.url)){i.ajax.url=i.ajax.url.call(this,t)}if(e.isFunction(i.ajax.data)){i.ajax.data=i.ajax.data.call(this,t)}e.ajax(i.ajax);break}},parse_xml:function(n,r){var i=this._get_settings().xml_data;e.vakata.xslt(n,t[i.xsl],r)},get_xml:function(t,r,i,s,o){var u="",a=this._get_settings(),f=this,l,c,h,p,d;if(!t){t="flat"}if(!o){o=0}r=this._get_node(r);if(!r||r===-1){r=this.get_container().find("> ul > li")}i=e.isArray(i)?i:["id","class"];if(!o&&this.data.types&&e.inArray(a.types.type_attr,i)===-1){i.push(a.types.type_attr)}s=e.isArray(s)?s:[];if(!o){if(a.xml_data.get_include_preamble){u+="<"+'?xml version="1.0" encoding="UTF-8"?'+">"}u+="<root>"}r.each(function(){u+="<item";h=e(this);e.each(i,function(e,t){var r=h.attr(t);if(!a.xml_data.get_skip_empty||typeof r!=="undefined"){u+=" "+t+'="'+n((" "+(r||"")).replace(/ jstree[^ ]*/ig,"").replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,""))+'"'}});if(h.hasClass("jstree-open")){u+=' state="open"'}if(h.hasClass("jstree-closed")){u+=' state="closed"'}if(t==="flat"){u+=' parent_id="'+n(o)+'"'}u+=">";u+="<content>";p=h.children("a");p.each(function(){l=e(this);d=false;u+="<name";if(e.inArray("languages",a.plugins)!==-1){e.each(a.languages,function(e,t){if(l.hasClass(t)){u+=' lang="'+n(t)+'"';d=t;return false}})}if(s.length){e.each(s,function(e,t){var r=l.attr(t);if(!a.xml_data.get_skip_empty||typeof r!=="undefined"){u+=" "+t+'="'+n((" "+r||"").replace(/ jstree[^ ]*/ig,"").replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,""))+'"'}})}if(l.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,"").replace(/^\s+$/ig,"").length){u+=' icon="'+n(l.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,"").replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,""))+'"'}if(l.children("ins").get(0).style.backgroundImage.length){u+=' icon="'+n(l.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","").replace(/'/ig,"").replace(/"/ig,""))+'"'}u+=">";u+="<![CDATA["+f.get_text(l,d)+"]]>";u+="</name>"});u+="</content>";c=h[0].id||true;h=h.find("> ul > li");if(h.length){c=f.get_xml(t,h,i,s,c)}else{c=""}if(t=="nest"){u+=c}u+="</item>";if(t=="flat"){u+=c}});if(!o){u+="</root>"}return u}}})})(e);(function(e){e.expr[":"].jstree_contains=function(e,t,n){return(e.textContent||e.innerText||"").toLowerCase().indexOf(n[3].toLowerCase())>=0};e.expr[":"].jstree_title_contains=function(e,t,n){return(e.getAttribute("title")||"").toLowerCase().indexOf(n[3].toLowerCase())>=0};e.jstree.plugin("search",{__init:function(){this.data.search.str="";this.data.search.result=e();if(this._get_settings().search.show_only_matches){this.get_container().bind("search.jstree",function(t,n){e(this).children("ul").find("li").hide().removeClass("jstree-last");n.rslt.nodes.parentsUntil(".jstree").andSelf().show().filter("ul").each(function(){e(this).children("li:visible").eq(-1).addClass("jstree-last")})}).bind("clear_search.jstree",function(){e(this).children("ul").find("li").css("display","").end().end().jstree("clean_node",-1)})}},defaults:{ajax:false,search_method:"jstree_contains",show_only_matches:false},_fn:{search:function(t,n){if(e.trim(t)===""){this.clear_search();return}var r=this.get_settings().search,i=this,s=function(){},o=function(){};this.data.search.str=t;if(!n&&r.ajax!==false&&this.get_container_ul().find("li.jstree-closed:not(:has(ul)):eq(0)").length>0){this.search.supress_callback=true;s=function(){};o=function(e,t,n){var r=this.get_settings().search.ajax.success;if(r){e=r.call(this,e,t,n)||e}this.data.search.to_open=e;this._search_open()};r.ajax.context=this;r.ajax.error=s;r.ajax.success=o;if(e.isFunction(r.ajax.url)){r.ajax.url=r.ajax.url.call(this,t)}if(e.isFunction(r.ajax.data)){r.ajax.data=r.ajax.data.call(this,t)}if(!r.ajax.data){r.ajax.data={search_string:t}}if(!r.ajax.dataType||/^json/.exec(r.ajax.dataType)){r.ajax.dataType="json"}e.ajax(r.ajax);return}if(this.data.search.result.length){this.clear_search()}this.data.search.result=this.get_container().find("a"+(this.data.languages?"."+this.get_lang():"")+":"+r.search_method+"("+this.data.search.str+")");this.data.search.result.addClass("jstree-search").parent().parents(".jstree-closed").each(function(){i.open_node(this,false,true)});this.__callback({nodes:this.data.search.result,str:t})},clear_search:function(t){this.data.search.result.removeClass("jstree-search");this.__callback(this.data.search.result);this.data.search.result=e()},_search_open:function(t){var n=this,r=true,i=[],s=[];if(this.data.search.to_open.length){e.each(this.data.search.to_open,function(t,n){if(n=="#"){return true}if(e(n).length&&e(n).is(".jstree-closed")){i.push(n)}else{s.push(n)}});if(i.length){this.data.search.to_open=s;e.each(i,function(e,t){n.open_node(t,function(){n._search_open(true)})});r=false}}if(r){this.search(this.data.search.str,true)}}}})})(e);(function(e){e.vakata.context={hide_on_mouseleave:false,cnt:e("<div id='vakata-contextmenu' />"),vis:false,tgt:false,par:false,func:false,data:false,rtl:false,show:function(t,n,r,i,s,o,u){e.vakata.context.rtl=!!u;var a=e.vakata.context.parse(t),f,l;if(!a){return}e.vakata.context.vis=true;e.vakata.context.tgt=n;e.vakata.context.par=o||n||null;e.vakata.context.data=s||null;e.vakata.context.cnt.html(a).css({visibility:"hidden",display:"block",left:0,top:0});if(e.vakata.context.hide_on_mouseleave){e.vakata.context.cnt.one("mouseleave",function(t){e.vakata.context.hide()})}f=e.vakata.context.cnt.height();l=e.vakata.context.cnt.width();if(r+l>e(document).width()){r=e(document).width()-(l+5);e.vakata.context.cnt.find("li > ul").addClass("right")}if(i+f>e(document).height()){i=i-(f+n[0].offsetHeight);e.vakata.context.cnt.find("li > ul").addClass("bottom")}e.vakata.context.cnt.css({left:r,top:i}).find("li:has(ul)").bind("mouseenter",function(t){var n=e(document).width(),r=e(document).height(),i=e(this).children("ul").show();if(n!==e(document).width()){i.toggleClass("right")}if(r!==e(document).height()){i.toggleClass("bottom")}}).bind("mouseleave",function(t){e(this).children("ul").hide()}).end().css({visibility:"visible"}).show();e(document).triggerHandler("context_show.vakata")},hide:function(){e.vakata.context.vis=false;e.vakata.context.cnt.attr("class","").css({visibility:"hidden"});e(document).triggerHandler("context_hide.vakata")},parse:function(t,n){if(!t){return false}var r="",i=false,s=true;if(!n){e.vakata.context.func={}}r+="<ul>";e.each(t,function(t,n){if(!n){return true}e.vakata.context.func[t]=n.action;if(!s&&n.separator_before){r+="<li class='vakata-separator vakata-separator-before'></li>"}s=false;r+="<li class='"+(n._class||"")+(n._disabled?" jstree-contextmenu-disabled ":"")+"'><ins ";if(n.icon&&n.icon.indexOf("/")===-1){r+=" class='"+n.icon+"' "}if(n.icon&&n.icon.indexOf("/")!==-1){r+=" style='background:url("+n.icon+") center center no-repeat;' "}r+=">&#160;</ins><a href='#' rel='"+t+"'>";if(n.submenu){r+="<span style='float:"+(e.vakata.context.rtl?"left":"right")+";'>&raquo;</span>"}r+=n.label+"</a>";if(n.submenu){i=e.vakata.context.parse(n.submenu,true);if(i){r+=i}}r+="</li>";if(n.separator_after){r+="<li class='vakata-separator vakata-separator-after'></li>";s=true}});r=r.replace(/<li class\='vakata-separator vakata-separator-after'\><\/li\>$/,"");r+="</ul>";e(document).triggerHandler("context_parse.vakata");return r.length>10?r:false},exec:function(t){if(e.isFunction(e.vakata.context.func[t])){e.vakata.context.func[t].call(e.vakata.context.data,e.vakata.context.par);return true}else{return false}}};e(function(){var t=""+"#vakata-contextmenu { display:block; visibility:hidden; left:0; top:-200px; position:absolute; margin:0; padding:0; min-width:180px; background:#ebebeb; border:1px solid silver; z-index:10000; *width:180px; } "+"#vakata-contextmenu ul { min-width:180px; *width:180px; } "+"#vakata-contextmenu ul, #vakata-contextmenu li { margin:0; padding:0; list-style-type:none; display:block; } "+"#vakata-contextmenu li { line-height:20px; min-height:20px; position:relative; padding:0px; } "+"#vakata-contextmenu li a { padding:1px 6px; line-height:17px; display:block; text-decoration:none; margin:1px 1px 0 1px; } "+"#vakata-contextmenu li ins { float:left; width:16px; height:16px; text-decoration:none; margin-right:2px; } "+"#vakata-contextmenu li a:hover, #vakata-contextmenu li.vakata-hover > a { background:gray; color:white; } "+"#vakata-contextmenu li ul { display:none; position:absolute; top:-2px; left:100%; background:#ebebeb; border:1px solid gray; } "+"#vakata-contextmenu .right { right:100%; left:auto; } "+"#vakata-contextmenu .bottom { bottom:-1px; top:auto; } "+"#vakata-contextmenu li.vakata-separator { min-height:0; height:1px; line-height:1px; font-size:1px; overflow:hidden; margin:0 2px; background:silver; /* border-top:1px solid #fefefe; */ padding:0; } ";e.vakata.css.add_sheet({str:t,title:"vakata"});e.vakata.context.cnt.delegate("a","click",function(e){e.preventDefault()}).delegate("a","mouseup",function(t){if(!e(this).parent().hasClass("jstree-contextmenu-disabled")&&e.vakata.context.exec(e(this).attr("rel"))){e.vakata.context.hide()}else{e(this).blur()}}).delegate("a","mouseover",function(){e.vakata.context.cnt.find(".vakata-hover").removeClass("vakata-hover")}).appendTo("body");e(document).bind("mousedown",function(t){if(e.vakata.context.vis&&!e.contains(e.vakata.context.cnt[0],t.target)){e.vakata.context.hide()}});if(typeof e.hotkeys!=="undefined"){e(document).bind("keydown","up",function(t){if(e.vakata.context.vis){var n=e.vakata.context.cnt.find("ul:visible").last().children(".vakata-hover").removeClass("vakata-hover").prevAll("li:not(.vakata-separator)").first();if(!n.length){n=e.vakata.context.cnt.find("ul:visible").last().children("li:not(.vakata-separator)").last()}n.addClass("vakata-hover");t.stopImmediatePropagation();t.preventDefault()}}).bind("keydown","down",function(t){if(e.vakata.context.vis){var n=e.vakata.context.cnt.find("ul:visible").last().children(".vakata-hover").removeClass("vakata-hover").nextAll("li:not(.vakata-separator)").first();if(!n.length){n=e.vakata.context.cnt.find("ul:visible").last().children("li:not(.vakata-separator)").first()}n.addClass("vakata-hover");t.stopImmediatePropagation();t.preventDefault()}}).bind("keydown","right",function(t){if(e.vakata.context.vis){e.vakata.context.cnt.find(".vakata-hover").children("ul").show().children("li:not(.vakata-separator)").removeClass("vakata-hover").first().addClass("vakata-hover");t.stopImmediatePropagation();t.preventDefault()}}).bind("keydown","left",function(t){if(e.vakata.context.vis){e.vakata.context.cnt.find(".vakata-hover").children("ul").hide().children(".vakata-separator").removeClass("vakata-hover");t.stopImmediatePropagation();t.preventDefault()}}).bind("keydown","esc",function(t){e.vakata.context.hide();t.preventDefault()}).bind("keydown","space",function(t){e.vakata.context.cnt.find(".vakata-hover").last().children("a").click();t.preventDefault()})}});e.jstree.plugin("contextmenu",{__init:function(){this.get_container().delegate("a","contextmenu.jstree",e.proxy(function(t){t.preventDefault();if(!e(t.currentTarget).hasClass("jstree-loading")){this.show_contextmenu(t.currentTarget,t.pageX,t.pageY)}},this)).delegate("a","click.jstree",e.proxy(function(t){if(this.data.contextmenu){e.vakata.context.hide()}},this)).bind("destroy.jstree",e.proxy(function(){if(this.data.contextmenu){e.vakata.context.hide()}},this));e(document).bind("context_hide.vakata",e.proxy(function(){this.data.contextmenu=false},this))},defaults:{select_node:false,show_at_node:true,items:{create:{separator_before:false,separator_after:true,label:"Create",action:function(e){this.create(e)}},rename:{separator_before:false,separator_after:false,label:"Rename",action:function(e){this.rename(e)}},remove:{separator_before:false,icon:false,separator_after:false,label:"Delete",action:function(e){if(this.is_selected(e)){this.remove()}else{this.remove(e)}}},ccp:{separator_before:true,icon:false,separator_after:false,label:"Edit",action:false,submenu:{cut:{separator_before:false,separator_after:false,label:"Cut",action:function(e){this.cut(e)}},copy:{separator_before:false,icon:false,separator_after:false,label:"Copy",action:function(e){this.copy(e)}},paste:{separator_before:false,icon:false,separator_after:false,label:"Paste",action:function(e){this.paste(e)}}}}}},_fn:{show_contextmenu:function(t,n,r){t=this._get_node(t);var i=this.get_settings().contextmenu,s=t.children("a:visible:eq(0)"),o=false,u=false;if(i.select_node&&this.data.ui&&!this.is_selected(t)){this.deselect_all();this.select_node(t,true)}if(i.show_at_node||typeof n==="undefined"||typeof r==="undefined"){o=s.offset();n=o.left;r=o.top+this.data.core.li_height}u=t.data("jstree")&&t.data("jstree").contextmenu?t.data("jstree").contextmenu:i.items;if(e.isFunction(u)){u=u.call(this,t)}this.data.contextmenu=true;e.vakata.context.show(u,s,n,r,this,t,this._get_settings().core.rtl);if(this.data.themes){e.vakata.context.cnt.attr("class","jstree-"+this.data.themes.theme+"-context")}}}})})(e);(function(e){e.jstree.plugin("types",{__init:function(){var n=this._get_settings().types;this.data.types.attach_to=[];this.get_container().bind("init.jstree",e.proxy(function(){var t=n.types,r=n.type_attr,i="",o=this;e.each(t,function(t,n){e.each(n,function(e,t){if(!/^(max_depth|max_children|icon|valid_children)$/.test(e)){o.data.types.attach_to.push(e)}});if(!n.icon){return true}if(n.icon.image||n.icon.position){if(t=="default"){i+=".jstree-"+o.get_index()+" a > .jstree-icon { "}else{i+=".jstree-"+o.get_index()+" li["+r+'="'+t+'"] > a > .jstree-icon { '}if(n.icon.image){i+=" background-image:url("+n.icon.image+"); "}if(n.icon.position){i+=" background-position:"+n.icon.position+"; "}else{i+=" background-position:0 0; "}i+="} "}});if(i!==""){e.vakata.css.add_sheet({str:i,title:"jstree-types"})}},this)).bind("before.jstree",e.proxy(function(t,n){var r,i,s=this._get_settings().types.use_data?this._get_node(n.args[0]):false,o=s&&s!==-1&&s.length?s.data("jstree"):false;if(o&&o.types&&o.types[n.func]===false){t.stopImmediatePropagation();return false}if(e.inArray(n.func,this.data.types.attach_to)!==-1){if(!n.args[0]||!n.args[0].tagName&&!n.args[0].jquery){return}r=this._get_settings().types.types;i=this._get_type(n.args[0]);if((r[i]&&typeof r[i][n.func]!=="undefined"||r["default"]&&typeof r["default"][n.func]!=="undefined")&&this._check(n.func,n.args[0])===false){t.stopImmediatePropagation();return false}}},this));if(t){this.get_container().bind("load_node.jstree set_type.jstree",e.proxy(function(t,n){var r=n&&n.rslt&&n.rslt.obj&&n.rslt.obj!==-1?this._get_node(n.rslt.obj).parent():this.get_container_ul(),i=false,s=this._get_settings().types;e.each(s.types,function(e,t){if(t.icon&&(t.icon.image||t.icon.position)){i=e==="default"?r.find("li > a > .jstree-icon"):r.find("li["+s.type_attr+"='"+e+"'] > a > .jstree-icon");if(t.icon.image){i.css("backgroundImage","url("+t.icon.image+")")}i.css("backgroundPosition",t.icon.position||"0 0")}})},this))}},defaults:{max_children:-1,max_depth:-1,valid_children:"all",use_data:false,type_attr:"rel",types:{"default":{max_children:-1,max_depth:-1,valid_children:"all"}}},_fn:{_types_notify:function(e,t){if(t.type&&this._get_settings().types.use_data){this.set_type(t.type,e)}},_get_type:function(e){e=this._get_node(e);return!e||!e.length?false:e.attr(this._get_settings().types.type_attr)||"default"},set_type:function(e,t){t=this._get_node(t);var n=!t.length||!e?false:t.attr(this._get_settings().types.type_attr,e);if(n){this.__callback({obj:t,type:e})}return n},_check:function(t,n,r){n=this._get_node(n);var i=false,s=this._get_type(n),o=0,u=this,a=this._get_settings().types,f=false;if(n===-1){if(!!a[t]){i=a[t]}else{return}}else{if(s===false){return}f=a.use_data?n.data("jstree"):false;if(f&&f.types&&typeof f.types[t]!=="undefined"){i=f.types[t]}else if(!!a.types[s]&&typeof a.types[s][t]!=="undefined"){i=a.types[s][t]}else if(!!a.types["default"]&&typeof a.types["default"][t]!=="undefined"){i=a.types["default"][t]}}if(e.isFunction(i)){i=i.call(this,n)}if(t==="max_depth"&&n!==-1&&r!==false&&a.max_depth!==-2&&i!==0){n.children("a:eq(0)").parentsUntil(".jstree","li").each(function(e){if(a.max_depth!==-1&&a.max_depth-(e+1)<=0){i=0;return false}o=e===0?i:u._check(t,this,false);if(o!==-1&&o-(e+1)<=0){i=0;return false}if(o>=0&&(o-(e+1)<i||i<0)){i=o-(e+1)}if(a.max_depth>=0&&(a.max_depth-(e+1)<i||i<0)){i=a.max_depth-(e+1)}})}return i},check_move:function(){if(!this.__call_old()){return false}var t=this._get_move(),n=t.rt._get_settings().types,r=t.rt._check("max_children",t.cr),i=t.rt._check("max_depth",t.cr),s=t.rt._check("valid_children",t.cr),o=0,u=1,a;if(s==="none"){return false}if(e.isArray(s)&&t.ot&&t.ot._get_type){t.o.each(function(){if(e.inArray(t.ot._get_type(this),s)===-1){u=false;return false}});if(u===false){return false}}if(n.max_children!==-2&&r!==-1){o=t.cr===-1?this.get_container().find("> ul > li").not(t.o).length:t.cr.find("> ul > li").not(t.o).length;if(o+t.o.length>r){return false}}if(n.max_depth!==-2&&i!==-1){u=0;if(i===0){return false}if(typeof t.o.d==="undefined"){a=t.o;while(a.length>0){a=a.find("> ul > li");u++}t.o.d=u}if(i-t.o.d<0){return false}}return true},create_node:function(t,n,r,i,s,o){if(!o&&(s||this._is_loaded(t))){var u=typeof n=="string"&&n.match(/^before|after$/i)&&t!==-1?this._get_parent(t):this._get_node(t),a=this._get_settings().types,f=this._check("max_children",u),l=this._check("max_depth",u),c=this._check("valid_children",u),h;if(typeof r==="string"){r={data:r}}if(!r){r={}}if(c==="none"){return false}if(e.isArray(c)){if(!r.attr||!r.attr[a.type_attr]){if(!r.attr){r.attr={}}r.attr[a.type_attr]=c[0]}else{if(e.inArray(r.attr[a.type_attr],c)===-1){return false}}}if(a.max_children!==-2&&f!==-1){h=u===-1?this.get_container().find("> ul > li").length:u.find("> ul > li").length;if(h+1>f){return false}}if(a.max_depth!==-2&&l!==-1&&l-1<0){return false}}return this.__call_old(true,t,n,r,i,s,o)}}})})(e);(function(e){e.jstree.plugin("html_data",{__init:function(){this.data.html_data.original_container_html=this.get_container().find(" > ul > li").clone(true);this.data.html_data.original_container_html.find("li").andSelf().contents().filter(function(){return this.nodeType==3}).remove()},defaults:{data:false,ajax:false,correct_state:true},_fn:{load_node:function(e,t,n){var r=this;this.load_node_html(e,function(){r.__callback({obj:r._get_node(e)});t.call(this)},n)},_is_loaded:function(t){t=this._get_node(t);return t==-1||!t||!this._get_settings().html_data.ajax&&!e.isFunction(this._get_settings().html_data.data)||t.is(".jstree-open, .jstree-leaf")||t.children("ul").children("li").size()>0},load_node_html:function(t,n,r){var i,s=this.get_settings().html_data,o=function(){},u=function(){};t=this._get_node(t);if(t&&t!==-1){if(t.data("jstree-is-loading")){return}else{t.data("jstree-is-loading",true)}}switch(!0){case e.isFunction(s.data):s.data.call(this,t,e.proxy(function(r){if(r&&r!==""&&r.toString&&r.toString().replace(/^[\s\n]+$/,"")!==""){r=e(r);if(!r.is("ul")){r=e("<ul />").append(r)}if(t==-1||!t){this.get_container().children("ul").empty().append(r.children()).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||this.firstChild.tagName!=="INS"}).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon")}else{t.children("a.jstree-loading").removeClass("jstree-loading");t.append(r).children("ul").find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||this.firstChild.tagName!=="INS"}).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon");t.removeData("jstree-is-loading")}this.clean_node(t);if(n){n.call(this)}}else{if(t&&t!==-1){t.children("a.jstree-loading").removeClass("jstree-loading");t.removeData("jstree-is-loading");if(s.correct_state){this.correct_state(t);if(n){n.call(this)}}}else{if(s.correct_state){this.get_container().children("ul").empty();if(n){n.call(this)}}}}},this));break;case!s.data&&!s.ajax:if(!t||t==-1){this.get_container().children("ul").empty().append(this.data.html_data.original_container_html).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||this.firstChild.tagName!=="INS"}).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon");this.clean_node()}if(n){n.call(this)}break;case!!s.data&&!s.ajax||!!s.data&&!!s.ajax&&(!t||t===-1):if(!t||t==-1){i=e(s.data);if(!i.is("ul")){i=e("<ul />").append(i)}this.get_container().children("ul").empty().append(i.children()).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||this.firstChild.tagName!=="INS"}).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon");this.clean_node()}if(n){n.call(this)}break;case!s.data&&!!s.ajax||!!s.data&&!!s.ajax&&t&&t!==-1:t=this._get_node(t);o=function(e,n,i){var o=this.get_settings().html_data.ajax.error;if(o){o.call(this,e,n,i)}if(t!=-1&&t.length){t.children("a.jstree-loading").removeClass("jstree-loading");t.removeData("jstree-is-loading");if(n==="success"&&s.correct_state){this.correct_state(t)}}else{if(n==="success"&&s.correct_state){this.get_container().children("ul").empty()}}if(r){r.call(this)}};u=function(r,i,u){var a=this.get_settings().html_data.ajax.success;if(a){r=a.call(this,r,i,u)||r}if(r===""||r&&r.toString&&r.toString().replace(/^[\s\n]+$/,"")===""){return o.call(this,u,i,"")}if(r){r=e(r);if(!r.is("ul")){r=e("<ul />").append(r)}if(t==-1||!t){this.get_container().children("ul").empty().append(r.children()).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||this.firstChild.tagName!=="INS"}).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon")}else{t.children("a.jstree-loading").removeClass("jstree-loading");t.append(r).children("ul").find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||this.firstChild.tagName!=="INS"}).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon");t.removeData("jstree-is-loading")}this.clean_node(t);if(n){n.call(this)}}else{if(t&&t!==-1){t.children("a.jstree-loading").removeClass("jstree-loading");t.removeData("jstree-is-loading");if(s.correct_state){this.correct_state(t);if(n){n.call(this)}}}else{if(s.correct_state){this.get_container().children("ul").empty();if(n){n.call(this)}}}}};s.ajax.context=this;s.ajax.error=o;s.ajax.success=u;if(!s.ajax.dataType){s.ajax.dataType="html"}if(e.isFunction(s.ajax.url)){s.ajax.url=s.ajax.url.call(this,t)}if(e.isFunction(s.ajax.data)){s.ajax.data=s.ajax.data.call(this,t)}e.ajax(s.ajax);break}}}});e.jstree.defaults.plugins.push("html_data")})(e);(function(e){e.jstree.plugin("themeroller",{__init:function(){var t=this._get_settings().themeroller;this.get_container().addClass("ui-widget-content").addClass("jstree-themeroller").delegate("a","mouseenter.jstree",function(n){if(!e(n.currentTarget).hasClass("jstree-loading")){e(this).addClass(t.item_h)}}).delegate("a","mouseleave.jstree",function(){e(this).removeClass(t.item_h)}).bind("init.jstree",e.proxy(function(e,t){t.inst.get_container().find("> ul > li > .jstree-loading > ins").addClass("ui-icon-refresh");this._themeroller(t.inst.get_container().find("> ul > li"))},this)).bind("open_node.jstree create_node.jstree",e.proxy(function(e,t){this._themeroller(t.rslt.obj)},this)).bind("loaded.jstree refresh.jstree",e.proxy(function(e){this._themeroller()},this)).bind("close_node.jstree",e.proxy(function(e,t){this._themeroller(t.rslt.obj)},this)).bind("delete_node.jstree",e.proxy(function(e,t){this._themeroller(t.rslt.parent)},this)).bind("correct_state.jstree",e.proxy(function(e,n){n.rslt.obj.children("ins.jstree-icon").removeClass(t.opened+" "+t.closed+" ui-icon").end().find("> a > ins.ui-icon").filter(function(){return this.className.toString().replace(t.item_clsd,"").replace(t.item_open,"").replace(t.item_leaf,"").indexOf("ui-icon-")===-1}).removeClass(t.item_open+" "+t.item_clsd).addClass(t.item_leaf||"jstree-no-icon")},this)).bind("select_node.jstree",e.proxy(function(e,n){n.rslt.obj.children("a").addClass(t.item_a)},this)).bind("deselect_node.jstree deselect_all.jstree",e.proxy(function(e,n){this.get_container().find("a."+t.item_a).removeClass(t.item_a).end().find("a.jstree-clicked").addClass(t.item_a)},this)).bind("dehover_node.jstree",e.proxy(function(e,n){n.rslt.obj.children("a").removeClass(t.item_h)},this)).bind("hover_node.jstree",e.proxy(function(e,n){this.get_container().find("a."+t.item_h).not(n.rslt.obj).removeClass(t.item_h);n.rslt.obj.children("a").addClass(t.item_h)},this)).bind("move_node.jstree",e.proxy(function(e,t){this._themeroller(t.rslt.o);this._themeroller(t.rslt.op)},this))},__destroy:function(){var t=this._get_settings().themeroller,n=["ui-icon"];e.each(t,function(e,t){t=t.split(" ");if(t.length){n=n.concat(t)}});this.get_container().removeClass("ui-widget-content").find("."+n.join(", .")).removeClass(n.join(" "))},_fn:{_themeroller:function(e){var t=this._get_settings().themeroller;e=!e||e==-1?this.get_container_ul():this._get_node(e).parent();e.find("li.jstree-closed").children("ins.jstree-icon").removeClass(t.opened).addClass("ui-icon "+t.closed).end().children("a").addClass(t.item).children("ins.jstree-icon").addClass("ui-icon").filter(function(){return this.className.toString().replace(t.item_clsd,"").replace(t.item_open,"").replace(t.item_leaf,"").indexOf("ui-icon-")===-1}).removeClass(t.item_leaf+" "+t.item_open).addClass(t.item_clsd||"jstree-no-icon").end().end().end().end().find("li.jstree-open").children("ins.jstree-icon").removeClass(t.closed).addClass("ui-icon "+t.opened).end().children("a").addClass(t.item).children("ins.jstree-icon").addClass("ui-icon").filter(function(){return this.className.toString().replace(t.item_clsd,"").replace(t.item_open,"").replace(t.item_leaf,"").indexOf("ui-icon-")===-1}).removeClass(t.item_leaf+" "+t.item_clsd).addClass(t.item_open||"jstree-no-icon").end().end().end().end().find("li.jstree-leaf").children("ins.jstree-icon").removeClass(t.closed+" ui-icon "+t.opened).end().children("a").addClass(t.item).children("ins.jstree-icon").addClass("ui-icon").filter(function(){return this.className.toString().replace(t.item_clsd,"").replace(t.item_open,"").replace(t.item_leaf,"").indexOf("ui-icon-")===-1}).removeClass(t.item_clsd+" "+t.item_open).addClass(t.item_leaf||"jstree-no-icon")}},defaults:{opened:"ui-icon-triangle-1-se",closed:"ui-icon-triangle-1-e",item:"ui-state-default",item_h:"ui-state-hover",item_a:"ui-state-active",item_open:"ui-icon-folder-open",item_clsd:"ui-icon-folder-collapsed",item_leaf:"ui-icon-document"}});e(function(){var t=""+".jstree-themeroller .ui-icon { overflow:visible; } "+".jstree-themeroller a { padding:0 2px; } "+".jstree-themeroller .jstree-no-icon { display:none; }";e.vakata.css.add_sheet({str:t,title:"jstree"})})})(e);(function(e){e.jstree.plugin("unique",{__init:function(){this.get_container().bind("before.jstree",e.proxy(function(t,n){var r=[],i=true,s,o;if(n.func=="move_node"){if(n.args[4]===true){if(n.args[0].o&&n.args[0].o.length){n.args[0].o.children("a").each(function(){r.push(e(this).text().replace(/^\s+/g,""))});i=this._check_unique(r,n.args[0].np.find("> ul > li").not(n.args[0].o),"move_node")}}}if(n.func=="create_node"){if(n.args[4]||this._is_loaded(n.args[0])){s=this._get_node(n.args[0]);if(n.args[1]&&(n.args[1]==="before"||n.args[1]==="after")){s=this._get_parent(n.args[0]);if(!s||s===-1){s=this.get_container()}}if(typeof n.args[2]==="string"){r.push(n.args[2])}else if(!n.args[2]||!n.args[2].data){r.push(this._get_string("new_node"))}else{r.push(n.args[2].data)}i=this._check_unique(r,s.find("> ul > li"),"create_node")}}if(n.func=="rename_node"){r.push(n.args[1]);o=this._get_node(n.args[0]);s=this._get_parent(o);if(!s||s===-1){s=this.get_container()}i=this._check_unique(r,s.find("> ul > li").not(o),"rename_node")}if(!i){t.stopPropagation();return false}},this))},defaults:{error_callback:e.noop},_fn:{_check_unique:function(t,n,r){var i=[];n.children("a").each(function(){i.push(e(this).text().replace(/^\s+/g,""))});if(!i.length||!t.length){return true}i=i.sort().join(",,").replace(/(,|^)([^,]+)(,,\2)+(,|$)/g,"$1$2$4").replace(/,,+/g,",").replace(/,$/,"").split(",");if(i.length+t.length!=i.concat(t).sort().join(",,").replace(/(,|^)([^,]+)(,,\2)+(,|$)/g,"$1$2$4").replace(/,,+/g,",").replace(/,$/,"").split(",").length){this._get_settings().unique.error_callback.call(null,t,n,r);return false}return true},check_move:function(){if(!this.__call_old()){return false}var t=this._get_move(),n=[];if(t.o&&t.o.length){t.o.children("a").each(function(){n.push(e(this).text().replace(/^\s+/g,""))});return this._check_unique(n,t.np.find("> ul > li").not(t.o),"check_move")}return true}}})})(e);(function(e){e.jstree.plugin("wholerow",{__init:function(){if(!this.data.ui){throw"jsTree wholerow: jsTree UI plugin not included."}this.data.wholerow.html=false;this.data.wholerow.to=false;this.get_container().bind("init.jstree",e.proxy(function(e,t){this._get_settings().core.animation=0},this)).bind("open_node.jstree create_node.jstree clean_node.jstree loaded.jstree",e.proxy(function(e,t){this._prepare_wholerow_span(t&&t.rslt&&t.rslt.obj?t.rslt.obj:-1)},this)).bind("search.jstree clear_search.jstree reopen.jstree after_open.jstree after_close.jstree create_node.jstree delete_node.jstree clean_node.jstree",e.proxy(function(e,t){if(this.data.to){clearTimeout(this.data.to)}this.data.to=setTimeout(function(e,t){return function(){e._prepare_wholerow_ul(t)}}(this,t&&t.rslt&&t.rslt.obj?t.rslt.obj:-1),0)},this)).bind("deselect_all.jstree",e.proxy(function(e,t){this.get_container().find(" > .jstree-wholerow .jstree-clicked").removeClass("jstree-clicked "+(this.data.themeroller?this._get_settings().themeroller.item_a:""))},this)).bind("select_node.jstree deselect_node.jstree ",e.proxy(function(t,n){n.rslt.obj.each(function(){var t=n.inst.get_container().find(" > .jstree-wholerow li:visible:eq("+parseInt((e(this).offset().top-n.inst.get_container().offset().top+n.inst.get_container()[0].scrollTop)/n.inst.data.core.li_height,10)+")");t.children("a").attr("class",n.rslt.obj.children("a").attr("class"))})},this)).bind("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){this.get_container().find(" > .jstree-wholerow .jstree-hovered").removeClass("jstree-hovered "+(this.data.themeroller?this._get_settings().themeroller.item_h:""));if(e.type==="hover_node"){var n=this.get_container().find(" > .jstree-wholerow li:visible:eq("+parseInt((t.rslt.obj.offset().top-this.get_container().offset().top+this.get_container()[0].scrollTop)/this.data.core.li_height,10)+")");n.children("a").attr("class",t.rslt.obj.children(".jstree-hovered").attr("class"))}},this)).delegate(".jstree-wholerow-span, ins.jstree-icon, li","click.jstree",function(t){var n=e(t.currentTarget);if(t.target.tagName==="A"||t.target.tagName==="INS"&&n.closest("li").is(".jstree-open, .jstree-closed")){return}n.closest("li").children("a:visible:eq(0)").click();t.stopImmediatePropagation()}).delegate("li","mouseover.jstree",e.proxy(function(t){t.stopImmediatePropagation();if(e(t.currentTarget).children(".jstree-hovered, .jstree-clicked").length){return false}this.hover_node(t.currentTarget);return false},this)).delegate("li","mouseleave.jstree",e.proxy(function(t){if(e(t.currentTarget).children("a").hasClass("jstree-hovered").length){return}this.dehover_node(t.currentTarget)},this));if(n||t){e.vakata.css.add_sheet({str:".jstree-"+this.get_index()+" { position:relative; } ",title:"jstree"})}},defaults:{},__destroy:function(){this.get_container().children(".jstree-wholerow").remove();this.get_container().find(".jstree-wholerow-span").remove()},_fn:{_prepare_wholerow_span:function(t){t=!t||t==-1?this.get_container().find("> ul > li"):this._get_node(t);if(t===false){return}t.each(function(){e(this).find("li").andSelf().each(function(){var t=e(this);if(t.children(".jstree-wholerow-span").length){return true}t.prepend("<span class='jstree-wholerow-span' style='width:"+t.parentsUntil(".jstree","li").length*18+"px;'>&#160;</span>")})})},_prepare_wholerow_ul:function(){var e=this.get_container().children("ul").eq(0),t=e.html();e.addClass("jstree-wholerow-real");if(this.data.wholerow.last_html!==t){this.data.wholerow.last_html=t;this.get_container().children(".jstree-wholerow").remove();this.get_container().append(e.clone().removeClass("jstree-wholerow-real").wrapAll("<div class='jstree-wholerow' />").parent().width(e.parent()[0].scrollWidth).css("top",(e.height()+(n?5:0))*-1).find("li[id]").each(function(){this.removeAttribute("id")}).end())}}}});e(function(){var i=""+".jstree .jstree-wholerow-real { position:relative; z-index:1; } "+".jstree .jstree-wholerow-real li { cursor:pointer; } "+".jstree .jstree-wholerow-real a { border-left-color:transparent !important; border-right-color:transparent !important; } "+".jstree .jstree-wholerow { position:relative; z-index:0; height:0; } "+".jstree .jstree-wholerow ul, .jstree .jstree-wholerow li { width:100%; } "+".jstree .jstree-wholerow, .jstree .jstree-wholerow ul, .jstree .jstree-wholerow li, .jstree .jstree-wholerow a { margin:0 !important; padding:0 !important; } "+".jstree .jstree-wholerow, .jstree .jstree-wholerow ul, .jstree .jstree-wholerow li { background:transparent !important; }"+".jstree .jstree-wholerow ins, .jstree .jstree-wholerow span, .jstree .jstree-wholerow input { display:none !important; }"+".jstree .jstree-wholerow a, .jstree .jstree-wholerow a:hover { text-indent:-9999px; !important; width:100%; padding:0 !important; border-right-width:0px !important; border-left-width:0px !important; } "+".jstree .jstree-wholerow-span { position:absolute; left:0; margin:0px; padding:0; height:18px; border-width:0; padding:0; z-index:0; }";if(r){i+=""+".jstree .jstree-wholerow a { display:block; height:18px; margin:0; padding:0; border:0; } "+".jstree .jstree-wholerow-real a { border-color:transparent !important; } "}if(n||t){i+=""+".jstree .jstree-wholerow, .jstree .jstree-wholerow li, .jstree .jstree-wholerow ul, .jstree .jstree-wholerow a { margin:0; padding:0; line-height:18px; } "+".jstree .jstree-wholerow a { display:block; height:18px; line-height:18px; overflow:hidden; } "}e.vakata.css.add_sheet({str:i,title:"jstree"})})})(e);(function(e){var t=["getChildren","getChildrenCount","getAttr","getName","getProps"],n=function(t,n){var r=true;t=t||{};n=[].concat(n);e.each(n,function(n,i){if(!e.isFunction(t[i])){r=false;return false}});return r};e.jstree.plugin("model",{__init:function(){if(!this.data.json_data){throw"jsTree model: jsTree json_data plugin not included."}this._get_settings().json_data.data=function(r,i){var s=r==-1?this._get_settings().model.object:r.data("jstree_model");if(!n(s,t)){return i.call(null,false)}if(this._get_settings().model.async){s.getChildren(e.proxy(function(e){this.model_done(e,i)},this))}else{this.model_done(s.getChildren(),i)}}},defaults:{object:false,id_prefix:false,async:false},_fn:{model_done:function(t,n){var r=[],i=this._get_settings(),s=this;if(!e.isArray(t)){t=[t]}e.each(t,function(t,n){var o=n.getProps()||{};o.attr=n.getAttr()||{};if(n.getChildrenCount()){o.state="closed"}o.data=n.getName();if(!e.isArray(o.data)){o.data=[o.data]}if(s.data.types&&e.isFunction(n.getType)){o.attr[i.types.type_attr]=n.getType()}if(o.attr.id&&i.model.id_prefix){o.attr.id=i.model.id_prefix+o.attr.id}if(!o.metadata){o.metadata={}}o.metadata.jstree_model=n;r.push(o)});n.call(null,r)}}})})(e)})()});define("jqgrid",["jquery","jqgrid-locale-"+(window&&window.__DEPS__&&window.__DEPS__.lang||"en"),"jqueryui"],function(jQuery){function tableToGrid(e,t){jQuery(e).each(function(){if(!this.grid){jQuery(this).width("99%");var e=jQuery(this).width(),n=jQuery("input[type=checkbox]:first",jQuery(this)),r=jQuery("input[type=radio]:first",jQuery(this));n=n.length>0;r=!n&&r.length>0;var i=n||r,s=[],u=[];jQuery("th",jQuery(this)).each(function(){if(s.length===0&&i){s.push({name:"__selection__",index:"__selection__",width:0,hidden:true});u.push("__selection__")}else{s.push({name:jQuery(this).attr("id")||jQuery.trim(jQuery.jgrid.stripHtml(jQuery(this).html())).split(" ").join("_"),index:jQuery(this).attr("id")||jQuery.trim(jQuery.jgrid.stripHtml(jQuery(this).html())).split(" ").join("_"),width:jQuery(this).width()||150});u.push(jQuery(this).html())}});var a=[],f=[],l=[];jQuery("tbody > tr",jQuery(this)).each(function(){var e={},t=0;jQuery("td",jQuery(this)).each(function(){if(t===0&&i){var n=jQuery("input",jQuery(this)),r=n.attr("value");f.push(r||a.length);n.attr("checked")&&l.push(r);e[s[t].name]=n.attr("value")}else e[s[t].name]=jQuery(this).html();t++});t>0&&a.push(e)});jQuery(this).empty();jQuery(this).addClass("scroll");jQuery(this).jqGrid(jQuery.extend({datatype:"local",width:e,colNames:u,colModel:s,multiselect:n},t||{}));for(e=0;e<a.length;e++){r=null;if(f.length>0)if((r=f[e])&&r.replace)r=encodeURIComponent(r).replace(/[.\-%]/g,"_");if(r===null)r=e+1;jQuery(this).jqGrid("addRowData",r,a[e])}for(e=0;e<l.length;e++)jQuery(this).jqGrid("setSelection",l[e])}})}var $=jQuery;(function(b){b.jgrid=b.jgrid||{};b.extend(b.jgrid,{htmlDecode:function(e){if(e&&(e=="&nbsp;"||e=="&#160;"||e.length==1&&e.charCodeAt(0)==160))return"";return!e?e:String(e).replace(/&/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"')},htmlEncode:function(e){return!e?e:String(e).replace(/&/g,"&").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\"/g,"&quot;")},format:function(e){var t=b.makeArray(arguments).slice(1);if(e===undefined)e="";return e.replace(/\{(\d+)\}/g,function(e,n){return t[n]})},getCellIndex:function(e){e=b(e);if(e.is("tr"))return-1;e=(!e.is("td")&&!e.is("th")?e.closest("td,th"):e)[0];if(b.browser.msie)return b.inArray(e,e.parentNode.cells);return e.cellIndex},stripHtml:function(e){e+="";var t=/<("[^"]*"|'[^']*'|[^'">])*>/gi;if(e)return(e=e.replace(t,""))&&e!=="&nbsp;"&&e!=="&#160;"?e.replace(/\"/g,"'"):"";else return e},stringToDoc:function(e){var t;if(typeof e!=="string")return e;try{t=(new DOMParser).parseFromString(e,"text/xml")}catch(n){t=new ActiveXObject("Microsoft.XMLDOM");t.async=false;t.loadXML(e)}return t&&t.documentElement&&t.documentElement.tagName!="parsererror"?t:null},parse:function(f){if(f.substr(0,9)=="while(1);")f=f.substr(9);if(f.substr(0,2)=="/*")f=f.substr(2,f.length-4);f||(f="{}");return b.jgrid.useJSON===true&&typeof JSON==="object"&&typeof JSON.parse==="function"?JSON.parse(f):eval("("+f+")")},parseDate:function(e,t){var n={m:1,d:1,y:1970,h:0,i:0,s:0},r,i,s;r=/[\\\/:_;.,\t\T\s-]/;if(t&&t!==null&&t!==undefined){t=b.trim(t);t=t.split(r);e=e.split(r);var o=b.jgrid.formatter.date.monthNames,u=b.jgrid.formatter.date.AmPm,a=function(e,t){if(e===0){if(t==12)t=0}else if(t!=12)t+=12;return t};r=0;for(i=e.length;r<i;r++){if(e[r]=="M"){s=b.inArray(t[r],o);if(s!==-1&&s<12)t[r]=s+1}if(e[r]=="F"){s=b.inArray(t[r],o);if(s!==-1&&s>11)t[r]=s+1-12}if(e[r]=="a"){s=b.inArray(t[r],u);if(s!==-1&&s<2&&t[r]==u[s]){t[r]=s;n.h=a(t[r],n.h)}}if(e[r]=="A"){s=b.inArray(t[r],u);if(s!==-1&&s>1&&t[r]==u[s]){t[r]=s-2;n.h=a(t[r],n.h)}}if(t[r]!==undefined)n[e[r].toLowerCase()]=parseInt(t[r],10)}n.m=parseInt(n.m,10)-1;r=n.y;if(r>=70&&r<=99)n.y=1900+n.y;else if(r>=0&&r<=69)n.y=2e3+n.y}return new Date(n.y,n.m,n.d,n.h,n.i,n.s,0)},jqID:function(e){e+="";return e.replace(/([\.\:\[\]])/g,"\\$1")},guid:1,uidPref:"jqg",randId:function(e){return(e?e:b.jgrid.uidPref)+b.jgrid.guid++},getAccessor:function(e,t){var n,r,i=[],s;if(typeof t==="function")return t(e);n=e[t];if(n===undefined)try{if(typeof t==="string")i=t.split(".");if(s=i.length)for(n=e;n&&s--;){r=i.shift();n=n[r]}}catch(o){}return n},ajaxOptions:{},from:function(f){return new function(j,h){if(typeof j=="string")j=b.data(j);var c=this,g=j,k=true,l=false,a=h,r=/[\$,%]/g,v=null,z=null,E=false,P="",K=[],O=true;if(typeof j=="object"&&j.push){if(j.length>0)O=typeof j[0]!="object"?false:true}else throw"data provides is not an array";this._hasData=function(){return g===null?false:g.length===0?false:true};this._getStr=function(e){var t=[];l&&t.push("jQuery.trim(");t.push("String("+e+")");l&&t.push(")");k||t.push(".toLowerCase()");return t.join("")};this._strComp=function(e){return typeof e=="string"?".toString()":""};this._group=function(e,t){return{field:e.toString(),unique:t,items:[]}};this._toStr=function(e){if(l)e=b.trim(e);k||(e=e.toLowerCase());return e=e.toString().replace(/\\/g,"\\\\").replace(/\"/g,'\\"')};this._funcLoop=function(e){var t=[];b.each(g,function(n,r){t.push(e(r))});return t};this._append=function(e){if(a===null)a="";else a+=P===""?" && ":P;if(E)a+="!";a+="("+e+")";E=false;P=""};this._setCommand=function(e,t){v=e;z=t};this._resetNegate=function(){E=false};this._repeatCommand=function(e,t){if(v===null)return c;if(e!==null&&t!==null)return v(e,t);if(z===null)return v(e);if(!O)return v(e);return v(z,e)};this._equals=function(e,t){return c._compare(e,t,1)===0};this._compare=function(e,t,n){if(n===undefined)n=1;if(e===undefined)e=null;if(t===undefined)t=null;if(e===null&&t===null)return 0;if(e===null&&t!==null)return 1;if(e!==null&&t===null)return-1;if(!k&&typeof e!=="number"&&typeof t!=="number"){e=String(e).toLowerCase();t=String(t).toLowerCase()}if(e<t)return-n;if(e>t)return n;return 0};this._performSort=function(){if(K.length!==0)g=c._doSort(g,0)};this._doSort=function(e,t){var n=K[t].by,r=K[t].dir,i=K[t].type,s=K[t].datefmt;if(t==K.length-1)return c._getOrder(e,n,r,i,s);t++;n=c._getGroup(e,n,r,i,s);r=[];for(i=0;i<n.length;i++){s=c._doSort(n[i].items,t);for(var o=0;o<s.length;o++)r.push(s[o])}return r};this._getOrder=function(e,t,n,i,s){var o=[],u=[],a=n=="a"?1:-1,f,l;if(i===undefined)i="text";l=i=="float"||i=="number"||i=="currency"||i=="numeric"?function(e){e=parseFloat(String(e).replace(r,""));return isNaN(e)?0:e}:i=="int"||i=="integer"?function(e){return e?parseFloat(String(e).replace(r,"")):0}:i=="date"||i=="datetime"?function(e){return b.jgrid.parseDate(s,e).getTime()}:b.isFunction(i)?i:function(e){e||(e="");return b.trim(String(e).toUpperCase())};b.each(e,function(e,n){f=t!==""?b.jgrid.getAccessor(n,t):n;if(f===undefined)f="";f=l(f,n);u.push({vSort:f,index:e})});u.sort(function(e,t){e=e.vSort;t=t.vSort;return c._compare(e,t,a)});i=0;for(var h=e.length;i<h;){n=u[i].index;o.push(e[n]);i++}return o};this._getGroup=function(e,t,n,r,i){var s=[],o=null,u=null,a;b.each(c._getOrder(e,t,n,r,i),function(e,n){a=b.jgrid.getAccessor(n,t);if(a===undefined)a="";if(!c._equals(u,a)){u=a;o!==null&&s.push(o);o=c._group(t,a)}o.items.push(n)});o!==null&&s.push(o);return s};this.ignoreCase=function(){k=false;return c};this.useCase=function(){k=true;return c};this.trim=function(){l=true;return c};this.noTrim=function(){l=false;return c};this.execute=function(){var m=a,o=[];if(m===null)return c;b.each(g,function(){eval(m)&&o.push(this)});g=o;return c};this.data=function(){return g};this.select=function(e){c._performSort();if(!c._hasData())return[];c.execute();if(b.isFunction(e)){var t=[];b.each(g,function(n,r){t.push(e(r))});return t}return g};this.hasMatch=function(){if(!c._hasData())return false;c.execute();return g.length>0};this.andNot=function(e,t,n){E=!E;return c.and(e,t,n)};this.orNot=function(e,t,n){E=!E;return c.or(e,t,n)};this.not=function(e,t,n){return c.andNot(e,t,n)};this.and=function(e,t,n){P=" && ";if(e===undefined)return c;return c._repeatCommand(e,t,n)};this.or=function(e,t,n){P=" || ";if(e===undefined)return c;return c._repeatCommand(e,t,n)};this.isNot=function(e){E=!E;return c.is(e)};this.is=function(e){c._append("this."+e);c._resetNegate();return c};this._compareValues=function(e,t,n,i,s){var o;o=O?"jQuery.jgrid.getAccessor(this,'"+t+"')":"this";if(n===undefined)n=null;var u=n,a=s.stype===undefined?"text":s.stype;if(n!==null)switch(a){case"int":case"integer":u=isNaN(Number(u))||u===""?"0":u;o="parseInt("+o+",10)";u="parseInt("+u+",10)";break;case"float":case"number":case"numeric":u=String(u).replace(r,"");u=isNaN(Number(u))||u===""?"0":u;o="parseFloat("+o+")";u="parseFloat("+u+")";break;case"date":case"datetime":u=String(b.jgrid.parseDate(s.newfmt||"Y-m-d",u).getTime());o='jQuery.jgrid.parseDate("'+s.srcfmt+'",'+o+").getTime()";break;default:o=c._getStr(o);u=c._getStr('"'+c._toStr(u)+'"')}c._append(o+" "+i+" "+u);c._setCommand(e,t);c._resetNegate();return c};this.equals=function(e,t,n){return c._compareValues(c.equals,e,t,"==",n)};this.notEquals=function(e,t,n){return c._compareValues(c.equals,e,t,"!==",n)};this.isNull=function(e,t,n){return c._compareValues(c.equals,e,null,"===",n)};this.greater=function(e,t,n){return c._compareValues(c.greater,e,t,">",n)};this.less=function(e,t,n){return c._compareValues(c.less,e,t,"<",n)};this.greaterOrEquals=function(e,t,n){return c._compareValues(c.greaterOrEquals,e,t,">=",n)};this.lessOrEquals=function(e,t,n){return c._compareValues(c.lessOrEquals,e,t,"<=",n)};this.startsWith=function(e,t){var n=t===undefined||t===null?e:t;n=l?b.trim(n.toString()).length:n.toString().length;if(O)c._append(c._getStr("jQuery.jgrid.getAccessor(this,'"+e+"')")+".substr(0,"+n+") == "+c._getStr('"'+c._toStr(t)+'"'));else{n=l?b.trim(t.toString()).length:t.toString().length;c._append(c._getStr("this")+".substr(0,"+n+") == "+c._getStr('"'+c._toStr(e)+'"'))}c._setCommand(c.startsWith,e);c._resetNegate();return c};this.endsWith=function(e,t){var n=t===undefined||t===null?e:t;n=l?b.trim(n.toString()).length:n.toString().length;O?c._append(c._getStr("jQuery.jgrid.getAccessor(this,'"+e+"')")+".substr("+c._getStr("jQuery.jgrid.getAccessor(this,'"+e+"')")+".length-"+n+","+n+') == "'+c._toStr(t)+'"'):c._append(c._getStr("this")+".substr("+c._getStr("this")+'.length-"'+c._toStr(e)+'".length,"'+c._toStr(e)+'".length) == "'+c._toStr(e)+'"');c._setCommand(c.endsWith,e);c._resetNegate();return c};this.contains=function(e,t){O?c._append(c._getStr("jQuery.jgrid.getAccessor(this,'"+e+"')")+'.indexOf("'+c._toStr(t)+'",0) > -1'):c._append(c._getStr("this")+'.indexOf("'+c._toStr(e)+'",0) > -1');c._setCommand(c.contains,e);c._resetNegate();return c};this.groupBy=function(e,t,n,r){if(!c._hasData())return null;return c._getGroup(g,e,t,n,r)};this.orderBy=function(e,t,n,r){t=t===undefined||t===null?"a":b.trim(t.toString().toLowerCase());if(n===null||n===undefined)n="text";if(r===null||r===undefined)r="Y-m-d";if(t=="desc"||t=="descending")t="d";if(t=="asc"||t=="ascending")t="a";K.push({by:e,dir:t,type:n,datefmt:r});return c};return c}(f,null)},extend:function(e){b.extend(b.fn.jqGrid,e);this.no_legacy_api||b.fn.extend(e)}});b.fn.jqGrid=function(e){if(typeof e=="string"){var t=b.jgrid.getAccessor(b.fn.jqGrid,e);if(!t)throw"jqGrid - No such method: "+e;var n=b.makeArray(arguments).slice(1);return t.apply(this,n)}return this.each(function(){if(!this.grid){var t=b.extend(true,{url:"",height:150,page:1,rowNum:20,rowTotal:null,records:0,pager:"",pgbuttons:true,pginput:true,colModel:[],rowList:[],colNames:[],sortorder:"asc",sortname:"",datatype:"xml",mtype:"GET",altRows:false,selarrrow:[],savedRow:[],shrinkToFit:true,xmlReader:{},jsonReader:{},subGrid:false,subGridModel:[],reccount:0,lastpage:0,lastsort:0,selrow:null,beforeSelectRow:null,onSelectRow:null,onSortCol:null,ondblClickRow:null,onRightClickRow:null,onPaging:null,onSelectAll:null,loadComplete:null,gridComplete:null,loadError:null,loadBeforeSend:null,afterInsertRow:null,beforeRequest:null,onHeaderClick:null,viewrecords:false,loadonce:false,multiselect:false,multikey:false,editurl:null,search:false,caption:"",hidegrid:true,hiddengrid:false,postData:{},userData:{},treeGrid:false,treeGridModel:"nested",treeReader:{},treeANode:-1,ExpandColumn:null,tree_root_level:0,prmNames:{page:"page",rows:"rows",sort:"sidx",order:"sord",search:"_search",nd:"nd",id:"id",oper:"oper",editoper:"edit",addoper:"add",deloper:"del",subgridid:"id",npage:null,totalrows:"totalrows"},forceFit:false,gridstate:"visible",cellEdit:false,cellsubmit:"remote",nv:0,loadui:"enable",toolbar:[false,""],scroll:false,multiboxonly:false,deselectAfterSort:true,scrollrows:false,autowidth:false,scrollOffset:18,cellLayout:5,subGridWidth:20,multiselectWidth:20,gridview:false,rownumWidth:25,rownumbers:false,pagerpos:"center",recordpos:"right",footerrow:false,userDataOnFooter:false,hoverrows:true,altclass:"ui-priority-secondary",viewsortcols:[false,"vertical",true],resizeclass:"",autoencode:false,remapColumns:[],ajaxGridOptions:{},direction:"ltr",toppager:false,headertitles:false,scrollTimeout:40,data:[],_index:{},grouping:false,groupingView:{groupField:[],groupOrder:[],groupText:[],groupColumnShow:[],groupSummary:[],showSummaryOnHide:false,sortitems:[],sortnames:[],groupDataSorted:false,summary:[],summaryval:[],plusicon:"ui-icon-circlesmall-plus",minusicon:"ui-icon-circlesmall-minus"},ignoreCase:false,cmTemplate:{}},b.jgrid.defaults,e||{}),n={headers:[],cols:[],footers:[],dragStart:function(e,n,r){this.resizing={idx:e,startX:n.clientX,sOL:r[0]};this.hDiv.style.cursor="col-resize";this.curGbox=b("#rs_m"+b.jgrid.jqID(t.id),"#gbox_"+b.jgrid.jqID(t.id));this.curGbox.css({display:"block",left:r[0],top:r[1],height:r[2]});b.isFunction(t.resizeStart)&&t.resizeStart.call(this,n,e);document.onselectstart=function(){return false}},dragMove:function(e){if(this.resizing){var n=e.clientX-this.resizing.startX;e=this.headers[this.resizing.idx];var r=t.direction==="ltr"?e.width+n:e.width-n,i;if(r>33){this.curGbox.css({left:this.resizing.sOL+n});if(t.forceFit===true){i=this.headers[this.resizing.idx+t.nv];n=t.direction==="ltr"?i.width-n:i.width+n;if(n>33){e.newWidth=r;i.newWidth=n}}else{this.newWidth=t.direction==="ltr"?t.tblwidth+n:t.tblwidth-n;e.newWidth=r}}}},dragEnd:function(){this.hDiv.style.cursor="default";if(this.resizing){var e=this.resizing.idx,n=this.headers[e].newWidth||this.headers[e].width;n=parseInt(n,10);this.resizing=false;b("#rs_m"+b.jgrid.jqID(t.id)).css("display","none");t.colModel[e].width=n;this.headers[e].width=n;this.headers[e].el.style.width=n+"px";this.cols[e].style.width=n+"px";if(this.footers.length>0)this.footers[e].style.width=n+"px";if(t.forceFit===true){n=this.headers[e+t.nv].newWidth||this.headers[e+t.nv].width;this.headers[e+t.nv].width=n;this.headers[e+t.nv].el.style.width=n+"px";this.cols[e+t.nv].style.width=n+"px";if(this.footers.length>0)this.footers[e+t.nv].style.width=n+"px";t.colModel[e+t.nv].width=n}else{t.tblwidth=this.newWidth||t.tblwidth;b("table:first",this.bDiv).css("width",t.tblwidth+"px");b("table:first",this.hDiv).css("width",t.tblwidth+"px");this.hDiv.scrollLeft=this.bDiv.scrollLeft;if(t.footerrow){b("table:first",this.sDiv).css("width",t.tblwidth+"px");this.sDiv.scrollLeft=this.bDiv.scrollLeft}}b.isFunction(t.resizeStop)&&t.resizeStop.call(this,n,e)}this.curGbox=null;document.onselectstart=function(){return true}},populateVisible:function(){n.timer&&clearTimeout(n.timer);n.timer=null;var e=b(n.bDiv).height();if(e){var r=b("table:first",n.bDiv),i,s;if(r[0].rows.length)try{s=(i=r[0].rows[1])?b(i).outerHeight()||n.prevRowHeight:n.prevRowHeight}catch(o){s=n.prevRowHeight}if(s){n.prevRowHeight=s;var u=t.rowNum;i=n.scrollTop=n.bDiv.scrollTop;var a=Math.round(r.position().top)-i,f=a+r.height();s*=u;var l,c,h;if(f<e&&a<=0&&(t.lastpage===undefined||parseInt((f+i+s-1)/s,10)<=t.lastpage)){c=parseInt((e-f+s-1)/s,10);if(f>=0||c<2||t.scroll===true){l=Math.round((f+i)/s)+1;a=-1}else a=1}if(a>0){l=parseInt(i/s,10)+1;c=parseInt((i+e)/s,10)+2-l;h=true}if(c)if(!(t.lastpage&&l>t.lastpage||t.lastpage==1||l===t.page&&l===t.lastpage))if(n.hDiv.loading)n.timer=setTimeout(n.populateVisible,t.scrollTimeout);else{t.page=l;if(h){n.selectionPreserver(r[0]);n.emptyRows(n.bDiv,false,false)}n.populate(c)}}}},scrollGrid:function(e){if(t.scroll){var r=n.bDiv.scrollTop;if(n.scrollTop===undefined)n.scrollTop=0;if(r!=n.scrollTop){n.scrollTop=r;n.timer&&clearTimeout(n.timer);n.timer=setTimeout(n.populateVisible,t.scrollTimeout)}}n.hDiv.scrollLeft=n.bDiv.scrollLeft;if(t.footerrow)n.sDiv.scrollLeft=n.bDiv.scrollLeft;e.stopPropagation()},selectionPreserver:function(e){var t=e.p,n=t.selrow,r=t.selarrrow?b.makeArray(t.selarrrow):null,i=e.grid.bDiv.scrollLeft,s=t.gridComplete;t.gridComplete=function(){t.selrow=null;t.selarrrow=[];if(t.multiselect&&r&&r.length>0)for(var o=0;o<r.length;o++)r[o]!=n&&b(e).jqGrid("setSelection",r[o],false);n&&b(e).jqGrid("setSelection",n,false);e.grid.bDiv.scrollLeft=i;t.gridComplete=s;t.gridComplete&&s()}}};if(this.tagName!="TABLE")alert("Element is not a table");else{b(this).empty().attr("tabindex","1");this.p=t;var r,i,s;if(this.p.colNames.length===0)for(r=0;r<this.p.colModel.length;r++)this.p.colNames[r]=this.p.colModel[r].label||this.p.colModel[r].name;if(this.p.colNames.length!==this.p.colModel.length)alert(b.jgrid.errors.model);else{var o=b("<div class='ui-jqgrid-view'></div>"),u,a=b.browser.msie?true:false,l=b.browser.webkit||b.browser.safari?true:false;s=this;s.p.direction=b.trim(s.p.direction.toLowerCase());if(b.inArray(s.p.direction,["ltr","rtl"])==-1)s.p.direction="ltr";i=s.p.direction;b(o).insertBefore(this);b(this).appendTo(o).removeClass("scroll");var c=b("<div class='ui-jqgrid ui-widget ui-widget-content ui-corner-all'></div>");b(c).insertBefore(o).attr({id:"gbox_"+this.id,dir:i});b(o).appendTo(c).attr("id","gview_"+this.id);u=a&&b.browser.version<=6?'<iframe style="display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=\'0\');" src="javascript:false;"></iframe>':"";b("<div class='ui-widget-overlay jqgrid-overlay' id='lui_"+this.id+"'></div>").append(u).insertBefore(o);b("<div class='loading ui-state-default ui-state-active' id='load_"+this.id+"'>"+this.p.loadtext+"</div>").insertBefore(o);b(this).attr({cellspacing:"0",cellpadding:"0",border:"0",role:"grid","aria-multiselectable":!!this.p.multiselect,"aria-labelledby":"gbox_"+this.id});var h=function(e,t){e=parseInt(e,10);return isNaN(e)?t?t:0:e},p=function(e,t,r,i,o,u){var a=s.p.colModel[e],f=a.align,l='style="',c=a.classes,h=a.name,p=[];if(f)l+="text-align:"+f+";";if(a.hidden===true)l+="display:none;";if(t===0)l+="width: "+n.headers[e].width+"px;";else if(a.cellattr&&b.isFunction(a.cellattr))if((e=a.cellattr.call(s,o,r,i,a,u))&&typeof e==="string"){e=e.replace(/style/i,"style").replace(/title/i,"title");if(e.indexOf("title")>-1)a.title=false;if(e.indexOf("class")>-1)c=undefined;p=e.split("style");if(p.length===2){p[1]=b.trim(p[1].replace("=",""));if(p[1].indexOf("'")===0||p[1].indexOf('"')===0)p[1]=p[1].substring(1);l+=p[1].replace(/'/gi,'"')}else l+='"'}if(!p.length){p[0]="";l+='"'}l+=(c!==undefined?' class="'+c+'"':"")+(a.title&&r?' title="'+b.jgrid.stripHtml(r)+'"':"");l+=' aria-describedby="'+s.p.id+"_"+h+'"';return l+p[0]},d=function(e){return e===undefined||e===null||e===""?"&#160;":s.p.autoencode?b.jgrid.htmlEncode(e):e+""},v=function(e,t,n,r,i){var o=s.p.colModel[n];if(typeof o.formatter!=="undefined"){e={rowId:e,colModel:o,gid:s.p.id,pos:n};t=b.isFunction(o.formatter)?o.formatter.call(s,t,e,r,i):b.fmatter?b.fn.fmatter(o.formatter,t,e,r,i):d(t)}else t=d(t);return t},m=function(e,t,n,r,i){t=v(e,t,n,i,"add");return'<td role="gridcell" '+p(n,r,t,i,e,true)+">"+t+"</td>"},g=function(e,t,n){var r='<input role="checkbox" type="checkbox" id="jqg_'+s.p.id+"_"+e+'" class="cbox" name="jqg_'+s.p.id+"_"+e+'"/>';return'<td role="gridcell" '+p(t,n,"",null,e,true)+">"+r+"</td>"},y=function(e,t,n,r){n=(parseInt(n,10)-1)*parseInt(r,10)+1+t;return'<td role="gridcell" class="ui-state-default jqgrid-rownum" '+p(e,t,n,null,t,true)+">"+n+"</td>"},w=function(e){var t,n=[],r=0,i;for(i=0;i<s.p.colModel.length;i++){t=s.p.colModel[i];if(t.name!=="cb"&&t.name!=="subgrid"&&t.name!=="rn"){n[r]=e=="local"?t.name:e=="xml"?t.xmlmap||t.name:t.jsonmap||t.name;r++}}return n},E=function(e){var t=s.p.remapColumns;if(!t||!t.length)t=b.map(s.p.colModel,function(e,t){return t});if(e)t=b.map(t,function(t){return t<e?null:t-e});return t},S=function(e,t,n){if(s.p.deepempty)b("#"+b.jgrid.jqID(s.p.id)+" tbody:first tr:gt(0)").remove();else{var r=b("#"+b.jgrid.jqID(s.p.id)+" tbody:first tr:first")[0];b("#"+b.jgrid.jqID(s.p.id)+" tbody:first").empty().append(r)}if(t&&s.p.scroll){b(">div:first",e).css({height:"auto"}).children("div:first").css({height:0,display:"none"});e.scrollTop=0}if(n===true)if(s.p.treeGrid===true){s.p.data=[];s.p._index={}}},x=function(){var e=s.p.data.length,t,n,r;t=s.p.rownumbers===true?1:0;n=s.p.multiselect===true?1:0;r=s.p.subGrid===true?1:0;t=s.p.keyIndex===false||s.p.loadonce===true?s.p.localReader.id:s.p.colModel[s.p.keyIndex+n+r+t].name;for(n=0;n<e;n++){r=b.jgrid.getAccessor(s.p.data[n],t);s.p._index[r]=n}},T=function(e,t,n,r,i){var o=new Date,u=s.p.datatype!="local"&&s.p.loadonce||s.p.datatype=="xmlstring",a=s.p.datatype=="local"?"local":"xml";if(u){s.p.data=[];s.p._index={};s.p.localReader.id="_id_"}s.p.reccount=0;if(b.isXMLDoc(e)){if(s.p.treeANode===-1&&!s.p.scroll){S(t,false,true);n=1}else n=n>1?n:1;var f,l,c=0,h,p=0,d=0,v=0,x,T=[],N,C={},k,L,A=[],O=s.p.altRows===true?" "+s.p.altclass:"";s.p.xmlReader.repeatitems||(T=w(a));x=s.p.keyIndex===false?s.p.xmlReader.id:s.p.keyIndex;if(T.length>0&&!isNaN(x)){if(s.p.remapColumns&&s.p.remapColumns.length)x=b.inArray(x,s.p.remapColumns);x=T[x]}a=(x+"").indexOf("[")===-1?T.length?function(e,t){return b(x,e).text()||t}:function(e,t){return b(s.p.xmlReader.cell,e).eq(x).text()||t}:function(e,t){return e.getAttribute(x.replace(/[\[\]]/g,""))||t};s.p.userData={};b(s.p.xmlReader.page,e).each(function(){s.p.page=this.textContent||this.text||0});b(s.p.xmlReader.total,e).each(function(){s.p.lastpage=this.textContent||this.text;if(s.p.lastpage===undefined)s.p.lastpage=1});b(s.p.xmlReader.records,e).each(function(){s.p.records=this.textContent||this.text||0});b(s.p.xmlReader.userdata,e).each(function(){s.p.userData[this.getAttribute("name")]=this.textContent||this.text});(e=b(s.p.xmlReader.root+" "+s.p.xmlReader.row,e))||(e=[]);var M=e.length,_=0,D={},P;if(e&&M){P=parseInt(s.p.rowNum,10);var H=s.p.scroll?b.jgrid.randId():1;if(i)P*=i+1;i=b.isFunction(s.p.afterInsertRow);var B="";if(s.p.grouping&&s.p.groupingView.groupCollapse===true)B=' style="display:none;"';for(;_<M;){k=e[_];L=a(k,H+_);f=n===0?0:n+1;f=(f+_)%2==1?O:"";A.push("<tr"+B+' id="'+L+'" tabindex="-1" role="row" class ="ui-widget-content jqgrow ui-row-'+s.p.direction+""+f+'">');if(s.p.rownumbers===true){A.push(y(0,_,s.p.page,s.p.rowNum));v=1}if(s.p.multiselect===true){A.push(g(L,v,_));p=1}if(s.p.subGrid===true){A.push(b(s).jqGrid("addSubGridCell",p+v,_+n));d=1}if(s.p.xmlReader.repeatitems){N||(N=E(p+d+v));var j=b(s.p.xmlReader.cell,k);b.each(N,function(e){var t=j[this];if(!t)return false;h=t.textContent||t.text;C[s.p.colModel[e+p+d+v].name]=h;A.push(m(L,h,e+p+d+v,_+n,k))})}else for(f=0;f<T.length;f++){h=b(T[f],k).text();C[s.p.colModel[f+p+d+v].name]=h;A.push(m(L,h,f+p+d+v,_+n,k))}A.push("</tr>");if(s.p.grouping){f=s.p.groupingView.groupField.length;for(var F=[],I=0;I<f;I++)F.push(C[s.p.groupingView.groupField[I]]);D=b(s).jqGrid("groupingPrepare",A,F,D,C);A=[]}if(u||s.p.treeGrid===true){C._id_=L;s.p.data.push(C);s.p._index[L]=s.p.data.length-1}if(s.p.gridview===false){b("tbody:first",t).append(A.join(""));i&&s.p.afterInsertRow.call(s,L,C,k);A=[]}C={};c++;_++;if(c==P)break}}if(s.p.gridview===true){l=s.p.treeANode>-1?s.p.treeANode:0;if(s.p.grouping){b(s).jqGrid("groupingRender",D,s.p.colModel.length);D=null}else s.p.treeGrid===true&&l>0?b(s.rows[l]).after(A.join("")):b("tbody:first",t).append(A.join(""))}if(s.p.subGrid===true)try{b(s).jqGrid("addSubGrid",p+v)}catch(q){}s.p.totaltime=new Date-o;if(c>0)if(s.p.records===0)s.p.records=M;A=null;if(s.p.treeGrid===true)try{b(s).jqGrid("setTreeNode",l+1,c+l+1)}catch(R){}if(!s.p.treeGrid&&!s.p.scroll)s.grid.bDiv.scrollTop=0;s.p.reccount=c;s.p.treeANode=-1;s.p.userDataOnFooter&&b(s).jqGrid("footerData","set",s.p.userData,true);if(u){s.p.records=M;s.p.lastpage=Math.ceil(M/P)}r||s.updatepager(false,true);if(u)for(;c<M;){k=e[c];L=a(k,c);if(s.p.xmlReader.repeatitems){N||(N=E(p+d+v));var U=b(s.p.xmlReader.cell,k);b.each(N,function(e){var t=U[this];if(!t)return false;h=t.textContent||t.text;C[s.p.colModel[e+p+d+v].name]=h})}else for(f=0;f<T.length;f++){h=b(T[f],k).text();C[s.p.colModel[f+p+d+v].name]=h}C._id_=L;s.p.data.push(C);s.p._index[L]=s.p.data.length-1;C={};c++}}},N=function(e,t,n,r,i){var o=new Date;if(e){if(s.p.treeANode===-1&&!s.p.scroll){S(t,false,true);n=1}else n=n>1?n:1;var u,a=s.p.datatype!="local"&&s.p.loadonce||s.p.datatype=="jsonstring";if(a){s.p.data=[];s.p._index={};s.p.localReader.id="_id_"}s.p.reccount=0;if(s.p.datatype=="local"){t=s.p.localReader;u="local"}else{t=s.p.jsonReader;u="json"}var f=0,l,c,h=[],p,d=0,v=0,x=0,T,N,C={},k,L,A=[],O=s.p.altRows===true?" "+s.p.altclass:"";s.p.page=b.jgrid.getAccessor(e,t.page)||0;T=b.jgrid.getAccessor(e,t.total);s.p.lastpage=T===undefined?1:T;s.p.records=b.jgrid.getAccessor(e,t.records)||0;s.p.userData=b.jgrid.getAccessor(e,t.userdata)||{};t.repeatitems||(p=h=w(u));u=s.p.keyIndex===false?t.id:s.p.keyIndex;if(h.length>0&&!isNaN(u)){if(s.p.remapColumns&&s.p.remapColumns.length)u=b.inArray(u,s.p.remapColumns);u=h[u]}(N=b.jgrid.getAccessor(e,t.root))||(N=[]);T=N.length;e=0;var M=parseInt(s.p.rowNum,10),_=s.p.scroll?b.jgrid.randId():1;if(i)M*=i+1;var D=b.isFunction(s.p.afterInsertRow),P={},H="";if(s.p.grouping&&s.p.groupingView.groupCollapse===true)H=' style="display:none;"';for(;e<T;){i=N[e];L=b.jgrid.getAccessor(i,u);if(L===undefined){L=_+e;if(h.length===0)if(t.cell)L=b.jgrid.getAccessor(i,t.cell)[u]||L}l=n===1?0:n;l=(l+e)%2==1?O:"";A.push("<tr"+H+' id="'+L+'" tabindex="-1" role="row" class= "ui-widget-content jqgrow ui-row-'+s.p.direction+""+l+'">');if(s.p.rownumbers===true){A.push(y(0,e,s.p.page,s.p.rowNum));x=1}if(s.p.multiselect){A.push(g(L,x,e));d=1}if(s.p.subGrid){A.push(b(s).jqGrid("addSubGridCell",d+x,e+n));v=1}if(t.repeatitems){if(t.cell)i=b.jgrid.getAccessor(i,t.cell);p||(p=E(d+v+x))}for(c=0;c<p.length;c++){l=b.jgrid.getAccessor(i,p[c]);A.push(m(L,l,c+d+v+x,e+n,i));C[s.p.colModel[c+d+v+x].name]=l}A.push("</tr>");if(s.p.grouping){l=s.p.groupingView.groupField.length;c=[];for(var B=0;B<l;B++)c.push(C[s.p.groupingView.groupField[B]]);P=b(s).jqGrid("groupingPrepare",A,c,P,C);A=[]}if(a||s.p.treeGrid===true){C._id_=L;s.p.data.push(C);s.p._index[L]=s.p.data.length-1}if(s.p.gridview===false){b("#"+b.jgrid.jqID(s.p.id)+" tbody:first").append(A.join(""));D&&s.p.afterInsertRow.call(s,L,C,i);A=[]}C={};f++;e++;if(f==M)break}if(s.p.gridview===true){k=s.p.treeANode>-1?s.p.treeANode:0;if(s.p.grouping)b(s).jqGrid("groupingRender",P,s.p.colModel.length);else s.p.treeGrid===true&&k>0?b(s.rows[k]).after(A.join("")):b("#"+b.jgrid.jqID(s.p.id)+" tbody:first").append(A.join(""))}if(s.p.subGrid===true)try{b(s).jqGrid("addSubGrid",d+x)}catch(j){}s.p.totaltime=new Date-o;if(f>0)if(s.p.records===0)s.p.records=T;if(s.p.treeGrid===true)try{b(s).jqGrid("setTreeNode",k+1,f+k+1)}catch(F){}if(!s.p.treeGrid&&!s.p.scroll)s.grid.bDiv.scrollTop=0;s.p.reccount=f;s.p.treeANode=-1;s.p.userDataOnFooter&&b(s).jqGrid("footerData","set",s.p.userData,true);if(a){s.p.records=T;s.p.lastpage=Math.ceil(T/M)}r||s.updatepager(false,true);if(a)for(;f<T&&N[f];){i=N[f];L=b.jgrid.getAccessor(i,u);if(L===undefined){L=_+f;if(h.length===0)if(t.cell)L=b.jgrid.getAccessor(i,t.cell)[u]||L}if(i){if(t.repeatitems){if(t.cell)i=b.jgrid.getAccessor(i,t.cell);p||(p=E(d+v+x))}for(c=0;c<p.length;c++){l=b.jgrid.getAccessor(i,p[c]);C[s.p.colModel[c+d+v+x].name]=l}C._id_=L;s.p.data.push(C);s.p._index[L]=s.p.data.length-1;C={}}f++}}},C=function(){function e(t){var n=0,i,s,o;if(t.groups!==undefined)for(i=0;i<t.groups.length;i++){try{e(t.groups[i])}catch(u){alert(u)}n++}if(t.rules!==undefined){if(n>0){var a=h.select();h=b.jgrid.from(a)}try{for(i=0;i<t.rules.length;i++){o=t.rules[i];s=t.groupOp.toString().toUpperCase();if(c[o.op]&&o.field){if(n>0&&s&&s==="OR")h=h.or();h=c[o.op](h,s)(o.field,o.data,r[o.field])}n++}}catch(f){alert(f)}}}var t,n=false,r={},i=[],o=[],u,a,f;if(b.isArray(s.p.data)){var l=s.p.grouping?s.p.groupingView:false;b.each(s.p.colModel,function(){a=this.sorttype||"text";if(a=="date"||a=="datetime"){if(this.formatter&&typeof this.formatter==="string"&&this.formatter=="date"){u=this.formatoptions&&this.formatoptions.srcformat?this.formatoptions.srcformat:b.jgrid.formatter.date.srcformat;f=this.formatoptions&&this.formatoptions.newformat?this.formatoptions.newformat:b.jgrid.formatter.date.newformat}else u=f=this.datefmt||"Y-m-d";r[this.name]={stype:a,srcfmt:u,newfmt:f}}else r[this.name]={stype:a,srcfmt:"",newfmt:""};if(s.p.grouping&&this.name==l.groupField[0]){var e=this.name;if(typeof this.index!="undefined")e=this.index;i[0]=r[e];o.push(e)}if(!n&&(this.index==s.p.sortname||this.name==s.p.sortname)){t=this.name;n=true}});if(s.p.treeGrid)b(s).jqGrid("SortTree",t,s.p.sortorder,r[t].stype,r[t].srcfmt);else{var c={eq:function(e){return e.equals},ne:function(e){return e.notEquals},lt:function(e){return e.less},le:function(e){return e.lessOrEquals},gt:function(e){return e.greater},ge:function(e){return e.greaterOrEquals},cn:function(e){return e.contains},nc:function(e,t){return t==="OR"?e.orNot().contains:e.andNot().contains},bw:function(e){return e.startsWith},bn:function(e,t){return t==="OR"?e.orNot().startsWith:e.andNot().startsWith},en:function(e,t){return t==="OR"?e.orNot().endsWith:e.andNot().endsWith},ew:function(e){return e.endsWith},ni:function(e,t){return t==="OR"?e.orNot().equals:e.andNot().equals},"in":function(e){return e.equals},nu:function(e){return e.isNull},nn:function(e,t){return t==="OR"?e.orNot().isNull:e.andNot().isNull}},h=b.jgrid.from(s.p.data);if(s.p.ignoreCase)h=h.ignoreCase();if(s.p.search===true){var p=s.p.postData.filters;if(p){if(typeof p=="string")p=b.jgrid.parse(p);e(p)}else try{h=c[s.p.postData.searchOper](h)(s.p.postData.searchField,s.p.postData.searchString,r[s.p.postData.searchField])}catch(d){}}if(s.p.grouping){h.orderBy(o,l.groupOrder[0],i[0].stype,i[0].srcfmt);l.groupDataSorted=true}if(t&&s.p.sortorder&&n)s.p.sortorder.toUpperCase()=="DESC"?h.orderBy(s.p.sortname,"d",r[t].stype,r[t].srcfmt):h.orderBy(s.p.sortname,"a",r[t].stype,r[t].srcfmt);p=h.select();var v=parseInt(s.p.rowNum,10),m=p.length,g=parseInt(s.p.page,10),y=Math.ceil(m/v),w={};p=p.slice((g-1)*v,g*v);r=h=null;w[s.p.localReader.total]=y;w[s.p.localReader.page]=g;w[s.p.localReader.records]=m;w[s.p.localReader.root]=p;p=null;return w}}},k=function(){s.grid.hDiv.loading=true;if(!s.p.hiddengrid)switch(s.p.loadui){case"enable":b("#load_"+b.jgrid.jqID(s.p.id)).show();break;case"block":b("#lui_"+b.jgrid.jqID(s.p.id)).show();b("#load_"+b.jgrid.jqID(s.p.id)).show()}},L=function(){s.grid.hDiv.loading=false;switch(s.p.loadui){case"enable":b("#load_"+b.jgrid.jqID(s.p.id)).hide();break;case"block":b("#lui_"+b.jgrid.jqID(s.p.id)).hide();b("#load_"+b.jgrid.jqID(s.p.id)).hide()}},A=function(e){if(!s.grid.hDiv.loading){var t=s.p.scroll&&e===false,n={},r,i=s.p.prmNames;if(s.p.page<=0)s.p.page=1;if(i.search!==null)n[i.search]=s.p.search;if(i.nd!==null)n[i.nd]=(new Date).getTime();if(i.rows!==null)n[i.rows]=s.p.rowNum;if(i.page!==null)n[i.page]=s.p.page;if(i.sort!==null)n[i.sort]=s.p.sortname;if(i.order!==null)n[i.order]=s.p.sortorder;if(s.p.rowTotal!==null&&i.totalrows!==null)n[i.totalrows]=s.p.rowTotal;var o=s.p.loadComplete,u=b.isFunction(o);u||(o=null);var a=0;e=e||1;if(e>1)if(i.npage!==null){n[i.npage]=e;a=e-1;e=1}else o=function(t){s.p.page++;s.grid.hDiv.loading=false;u&&s.p.loadComplete.call(s,t);A(e-1)};else i.npage!==null&&delete s.p.postData[i.npage];if(s.p.grouping){b(s).jqGrid("groupingSetup");if(s.p.groupingView.groupDataSorted===true)n[i.sort]=s.p.groupingView.groupField[0]+" "+s.p.groupingView.groupOrder[0]+", "+n[i.sort]}b.extend(s.p.postData,n);var f=!s.p.scroll?1:s.rows.length-1;if(b.isFunction(s.p.datatype))s.p.datatype.call(s,s.p.postData,"load_"+s.p.id);else{b.isFunction(s.p.beforeRequest)&&s.p.beforeRequest.call(s);r=s.p.datatype.toLowerCase();switch(r){case"json":case"jsonp":case"xml":case"script":b.ajax(b.extend({url:s.p.url,type:s.p.mtype,dataType:r,data:b.isFunction(s.p.serializeGridData)?s.p.serializeGridData.call(s,s.p.postData):s.p.postData,success:function(n){r==="xml"?T(n,s.grid.bDiv,f,e>1,a):N(n,s.grid.bDiv,f,e>1,a);o&&o.call(s,n);t&&s.grid.populateVisible();if(s.p.loadonce||s.p.treeGrid)s.p.datatype="local";L()},error:function(e,t,n){b.isFunction(s.p.loadError)&&s.p.loadError.call(s,e,t,n);L()},beforeSend:function(e){k();b.isFunction(s.p.loadBeforeSend)&&s.p.loadBeforeSend.call(s,e)}},b.jgrid.ajaxOptions,s.p.ajaxGridOptions));break;case"xmlstring":k();n=b.jgrid.stringToDoc(s.p.datastr);T(n,s.grid.bDiv);u&&s.p.loadComplete.call(s,n);s.p.datatype="local";s.p.datastr=null;L();break;case"jsonstring":k();n=typeof s.p.datastr=="string"?b.jgrid.parse(s.p.datastr):s.p.datastr;N(n,s.grid.bDiv);u&&s.p.loadComplete.call(s,n);s.p.datatype="local";s.p.datastr=null;L();break;case"local":case"clientside":k();s.p.datatype="local";n=C();N(n,s.grid.bDiv,f,e>1,a);o&&o.call(s,n);t&&s.grid.populateVisible();L()}}}};u=function(e,t){var n="",r="<table cellspacing='0' cellpadding='0' border='0' style='table-layout:auto;' class='ui-pg-table'><tbody><tr>",o="",u,a,f,l,c=function(e){var t;if(b.isFunction(s.p.onPaging))t=s.p.onPaging.call(s,e);s.p.selrow=null;if(s.p.multiselect){s.p.selarrrow=[];b("#cb_"+b.jgrid.jqID(s.p.id),s.grid.hDiv).attr("checked",false)}s.p.savedRow=[];if(t=="stop")return false;return true};e=e.substr(1);u="pg_"+e;a=e+"_left";f=e+"_center";l=e+"_right";b("#"+b.jgrid.jqID(e)).append("<div id='"+u+"' class='ui-pager-control' role='group'><table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table' style='width:100%;table-layout:fixed;height:100%;' role='row'><tbody><tr><td id='"+a+"' align='left'></td><td id='"+f+"' align='center' style='white-space:pre;'></td><td id='"+l+"' align='right'></td></tr></tbody></table></div>").attr("dir","ltr");if(s.p.rowList.length>0){o="<td dir='"+i+"'>";o+="<select class='ui-pg-selbox' role='listbox'>";for(a=0;a<s.p.rowList.length;a++)o+='<option role="option" value="'+s.p.rowList[a]+'"'+(s.p.rowNum==s.p.rowList[a]?' selected="selected"':"")+">"+s.p.rowList[a]+"</option>";o+="</select></td>"}if(i=="rtl")r+=o;if(s.p.pginput===true)n="<td dir='"+i+"'>"+b.jgrid.format(s.p.pgtext||"","<input class='ui-pg-input' type='text' size='2' maxlength='7' value='0' role='textbox'/>","<span id='sp_1'></span>")+"</td>";if(s.p.pgbuttons===true){a=["first"+t,"prev"+t,"next"+t,"last"+t];i=="rtl"&&a.reverse();r+="<td id='"+a[0]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-first'></span></td>";r+="<td id='"+a[1]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-prev'></span></td>";r+=n!==""?"<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>"+n+"<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>":"";r+="<td id='"+a[2]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-next'></span></td>";r+="<td id='"+a[3]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-end'></span></td>"}else if(n!=="")r+=n;if(i=="ltr")r+=o;r+="</tr></tbody></table>";s.p.viewrecords===true&&b("td#"+e+"_"+s.p.recordpos,"#"+u).append("<div dir='"+i+"' style='text-align:"+s.p.recordpos+"' class='ui-paging-info'></div>");b("td#"+e+"_"+s.p.pagerpos,"#"+u).append(r);o=b(".ui-jqgrid").css("font-size")||"11px";b(document.body).append("<div id='testpg' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:"+o+";visibility:hidden;' ></div>");r=b(r).clone().appendTo("#testpg").width();b("#testpg").remove();if(r>0){if(n!=="")r+=50;b("td#"+e+"_"+s.p.pagerpos,"#"+u).width(r)}s.p._nvtd=[];s.p._nvtd[0]=r?Math.floor((s.p.width-r)/2):Math.floor(s.p.width/3);s.p._nvtd[1]=0;r=null;b(".ui-pg-selbox","#"+u).bind("change",function(){s.p.page=Math.round(s.p.rowNum*(s.p.page-1)/this.value-.5)+1;s.p.rowNum=this.value;if(t)b(".ui-pg-selbox",s.p.pager).val(this.value);else s.p.toppager&&b(".ui-pg-selbox",s.p.toppager).val(this.value);if(!c("records"))return false;A();return false});if(s.p.pgbuttons===true){b(".ui-pg-button","#"+u).hover(function(){if(b(this).hasClass("ui-state-disabled"))this.style.cursor="default";else{b(this).addClass("ui-state-hover");this.style.cursor="pointer"}},function(){if(!b(this).hasClass("ui-state-disabled")){b(this).removeClass("ui-state-hover");this.style.cursor="default"}});b("#first"+t+", #prev"+t+", #next"+t+", #last"+t,"#"+e).click(function(){var e=h(s.p.page,1),n=h(s.p.lastpage,1),r=false,i=true,o=true,u=true,a=true;if(n===0||n===1)a=u=o=i=false;else if(n>1&&e>=1)if(e===1)o=i=false;else{if(!(e>1&&e<n))if(e===n)a=u=false}else if(n>1&&e===0){a=u=false;e=n-1}if(this.id==="first"+t&&i){s.p.page=1;r=true}if(this.id==="prev"+t&&o){s.p.page=e-1;r=true}if(this.id==="next"+t&&u){s.p.page=e+1;r=true}if(this.id==="last"+t&&a){s.p.page=n;r=true}if(r){if(!c(this.id))return false;A()}return false})}s.p.pginput===true&&b("input.ui-pg-input","#"+u).keypress(function(e){if((e.charCode?e.charCode:e.keyCode?e.keyCode:0)==13){s.p.page=b(this).val()>0?b(this).val():s.p.page;if(!c("user"))return false;A();return false}return this})};var O=function(e,t,n,r){if(s.p.colModel[t].sortable)if(!(s.p.savedRow.length>0)){if(!n){if(s.p.lastsort==t)if(s.p.sortorder=="asc")s.p.sortorder="desc";else{if(s.p.sortorder=="desc")s.p.sortorder="asc"}else s.p.sortorder=s.p.colModel[t].firstsortorder||"asc";s.p.page=1}if(r)if(s.p.lastsort==t&&s.p.sortorder==r&&!n)return;else s.p.sortorder=r;n=b("thead:first",s.grid.hDiv).get(0);b("tr th:eq("+s.p.lastsort+") span.ui-grid-ico-sort",n).addClass("ui-state-disabled");b("tr th:eq("+s.p.lastsort+")",n).attr("aria-selected","false");b("tr th:eq("+t+") span.ui-icon-"+s.p.sortorder,n).removeClass("ui-state-disabled");b("tr th:eq("+t+")",n).attr("aria-selected","true");if(!s.p.viewsortcols[0])if(s.p.lastsort!=t){b("tr th:eq("+s.p.lastsort+") span.s-ico",n).hide();b("tr th:eq("+t+") span.s-ico",n).show()}e=e.substring(5);s.p.sortname=s.p.colModel[t].index||e;n=s.p.sortorder;if(b.isFunction(s.p.onSortCol))if(s.p.onSortCol.call(s,e,t,n)=="stop"){s.p.lastsort=t;return}if(s.p.datatype=="local")s.p.deselectAfterSort&&b(s).jqGrid("resetSelection");else{s.p.selrow=null;s.p.multiselect&&b("#cb_"+b.jgrid.jqID(s.p.id),s.grid.hDiv).attr("checked",false);s.p.selarrrow=[];s.p.savedRow=[]}if(s.p.scroll){n=s.grid.bDiv.scrollLeft;S(s.grid.bDiv,true,false);s.grid.hDiv.scrollLeft=n}s.p.subGrid&&s.p.datatype=="local"&&b("td.sgexpanded","#"+b.jgrid.jqID(s.p.id)).each(function(){b(this).trigger("click")});A();s.p.lastsort=t;if(s.p.sortname!=e&&t)s.p.lastsort=t}},M=function(e){var t,n={},r=l?0:s.p.cellLayout;for(t=n[0]=n[1]=n[2]=0;t<=e;t++)if(s.p.colModel[t].hidden===false)n[0]+=s.p.colModel[t].width+r;if(s.p.direction=="rtl")n[0]=s.p.width-n[0];n[0]-=s.grid.bDiv.scrollLeft;if(b(s.grid.cDiv).is(":visible"))n[1]+=b(s.grid.cDiv).height()+parseInt(b(s.grid.cDiv).css("padding-top"),10)+parseInt(b(s.grid.cDiv).css("padding-bottom"),10);if(s.p.toolbar[0]===true&&(s.p.toolbar[1]=="top"||s.p.toolbar[1]=="both"))n[1]+=b(s.grid.uDiv).height()+parseInt(b(s.grid.uDiv).css("border-top-width"),10)+parseInt(b(s.grid.uDiv).css("border-bottom-width"),10);if(s.p.toppager)n[1]+=b(s.grid.topDiv).height()+parseInt(b(s.grid.topDiv).css("border-bottom-width"),10);n[2]+=b(s.grid.bDiv).height()+b(s.grid.hDiv).height();return n};this.p.id=this.id;if(b.inArray(s.p.multikey,["shiftKey","altKey","ctrlKey"])==-1)s.p.multikey=false;s.p.keyIndex=false;for(r=0;r<s.p.colModel.length;r++){s.p.colModel[r]=b.extend(true,{},s.p.cmTemplate,s.p.colModel[r].template||{},s.p.colModel[r]);if(s.p.keyIndex===false&&s.p.colModel[r].key===true)s.p.keyIndex=r}s.p.sortorder=s.p.sortorder.toLowerCase();if(s.p.grouping===true){s.p.scroll=false;s.p.rownumbers=false;s.p.subGrid=false;s.p.treeGrid=false;s.p.gridview=true}if(this.p.treeGrid===true){try{b(this).jqGrid("setTreeGrid")}catch(_){}if(s.p.datatype!="local")s.p.localReader={id:"_id_"}}if(this.p.subGrid)try{b(s).jqGrid("setSubGrid")}catch(D){}if(this.p.multiselect){this.p.colNames.unshift("<input role='checkbox' id='cb_"+this.p.id+"' class='cbox' type='checkbox'/>");this.p.colModel.unshift({name:"cb",width:l?s.p.multiselectWidth+s.p.cellLayout:s.p.multiselectWidth,sortable:false,resizable:false,hidedlg:true,search:false,align:"center",fixed:true})}if(this.p.rownumbers){this.p.colNames.unshift("");this.p.colModel.unshift({name:"rn",width:s.p.rownumWidth,sortable:false,resizable:false,hidedlg:true,search:false,align:"center",fixed:true})}s.p.xmlReader=b.extend(true,{root:"rows",row:"row",page:"rows>page",total:"rows>total",records:"rows>records",repeatitems:true,cell:"cell",id:"[id]",userdata:"userdata",subgrid:{root:"rows",row:"row",repeatitems:true,cell:"cell"}},s.p.xmlReader);s.p.jsonReader=b.extend(true,{root:"rows",page:"page",total:"total",records:"records",repeatitems:true,cell:"cell",id:"id",userdata:"userdata",subgrid:{root:"rows",repeatitems:true,cell:"cell"}},s.p.jsonReader);s.p.localReader=b.extend(true,{root:"rows",page:"page",total:"total",records:"records",repeatitems:false,cell:"cell",id:"id",userdata:"userdata",subgrid:{root:"rows",repeatitems:true,cell:"cell"}},s.p.localReader);if(s.p.scroll){s.p.pgbuttons=false;s.p.pginput=false;s.p.rowList=[]}s.p.data.length&&x();var P="<thead><tr class='ui-jqgrid-labels' role='rowheader'>",H,B,j,F,I,q,R,U;B=U="";if(s.p.shrinkToFit===true&&s.p.forceFit===true)for(r=s.p.colModel.length-1;r>=0;r--)if(!s.p.colModel[r].hidden){s.p.colModel[r].resizable=false;break}if(s.p.viewsortcols[1]=="horizontal"){U=" ui-i-asc";B=" ui-i-desc"}H=a?"class='ui-th-div-ie'":"";U="<span class='s-ico' style='display:none'><span sort='asc' class='ui-grid-ico-sort ui-icon-asc"+U+" ui-state-disabled ui-icon ui-icon-triangle-1-n ui-sort-"+i+"'></span>";U+="<span sort='desc' class='ui-grid-ico-sort ui-icon-desc"+B+" ui-state-disabled ui-icon ui-icon-triangle-1-s ui-sort-"+i+"'></span></span>";for(r=0;r<this.p.colNames.length;r++){B=s.p.headertitles?' title="'+b.jgrid.stripHtml(s.p.colNames[r])+'"':"";P+="<th id='"+s.p.id+"_"+s.p.colModel[r].name+"' role='columnheader' class='ui-state-default ui-th-column ui-th-"+i+"'"+B+">";B=s.p.colModel[r].index||s.p.colModel[r].name;P+="<div id='jqgh_"+s.p.colModel[r].name+"' "+H+">"+s.p.colNames[r];s.p.colModel[r].width=s.p.colModel[r].width?parseInt(s.p.colModel[r].width,10):150;if(typeof s.p.colModel[r].title!=="boolean")s.p.colModel[r].title=true;if(B==s.p.sortname)s.p.lastsort=r;P+=U+"</div></th>"}P+="</tr></thead>";U=null;b(this).append(P);b("thead tr:first th",this).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});if(this.p.multiselect){var z=[],W;b("#cb_"+b.jgrid.jqID(s.p.id),this).bind("click",function(){s.p.selarrrow=[];if(this.checked){b(s.rows).each(function(e){if(e>0)if(!b(this).hasClass("subgrid")&&!b(this).hasClass("jqgroup")&&!b(this).hasClass("ui-state-disabled")){b("#jqg_"+b.jgrid.jqID(s.p.id)+"_"+b.jgrid.jqID(this.id)).attr("checked","checked");b(this).addClass("ui-state-highlight").attr("aria-selected","true");s.p.selarrrow.push(this.id);s.p.selrow=this.id}});W=true;z=[]}else{b(s.rows).each(function(e){if(e>0)if(!b(this).hasClass("subgrid")&&!b(this).hasClass("ui-state-disabled")){b("#jqg_"+b.jgrid.jqID(s.p.id)+"_"+b.jgrid.jqID(this.id)).removeAttr("checked");b(this).removeClass("ui-state-highlight").attr("aria-selected","false");z.push(this.id)}});s.p.selrow=null;W=false}if(b.isFunction(s.p.onSelectAll))s.p.onSelectAll.call(s,W?s.p.selarrrow:z,W)})}if(s.p.autowidth===true){P=b(c).innerWidth();s.p.width=P>0?P:"nw"}(function(){var e=0,t=l?0:s.p.cellLayout,r=0,i,o=s.p.scrollOffset,u,a=false,f,c=0,p=0,d;b.each(s.p.colModel,function(){if(typeof this.hidden==="undefined")this.hidden=false;this.widthOrg=u=h(this.width,0);if(this.hidden===false){e+=u+t;if(this.fixed)c+=u+t;else r++;p++}});if(isNaN(s.p.width))s.p.width=n.width=e;else n.width=s.p.width;s.p.tblwidth=e;if(s.p.shrinkToFit===false&&s.p.forceFit===true)s.p.forceFit=false;if(s.p.shrinkToFit===true&&r>0){f=n.width-t*r-c;if(!isNaN(s.p.height)){f-=o;a=true}e=0;b.each(s.p.colModel,function(n){if(this.hidden===false&&!this.fixed){this.width=u=Math.round(f*this.width/(s.p.tblwidth-t*r-c));e+=u;i=n}});d=0;if(a){if(n.width-c-(e+t*r)!==o)d=n.width-c-(e+t*r)-o}else if(!a&&Math.abs(n.width-c-(e+t*r))!==1)d=n.width-c-(e+t*r);s.p.colModel[i].width+=d;s.p.tblwidth=e+d+t*r+c;if(s.p.tblwidth>s.p.width){s.p.colModel[i].width-=s.p.tblwidth-parseInt(s.p.width,10);s.p.tblwidth=s.p.width}}})();b(c).css("width",n.width+"px").append("<div class='ui-jqgrid-resize-mark' id='rs_m"+s.p.id+"'>&#160;</div>");b(o).css("width",n.width+"px");P=b("thead:first",s).get(0);var X="";if(s.p.footerrow)X+="<table role='grid' style='width:"+s.p.tblwidth+"px' class='ui-jqgrid-ftable' cellspacing='0' cellpadding='0' border='0'><tbody><tr role='row' class='ui-widget-content footrow footrow-"+i+"'>";o=b("tr:first",P);var V="<tr class='jqgfirstrow' role='row' style='height:auto'>";s.p.disableClick=false;b("th",o).each(function(e){j=s.p.colModel[e].width;if(typeof s.p.colModel[e].resizable==="undefined")s.p.colModel[e].resizable=true;if(s.p.colModel[e].resizable){F=document.createElement("span");b(F).html("&#160;").addClass("ui-jqgrid-resize ui-jqgrid-resize-"+i);b.browser.opera||b(F).css("cursor","col-resize");b(this).addClass(s.p.resizeclass)}else F="";b(this).css("width",j+"px").prepend(F);var t="";if(s.p.colModel[e].hidden){b(this).css("display","none");t="display:none;"}V+="<td role='gridcell' style='height:0px;width:"+j+"px;"+t+"'></td>";n.headers[e]={width:j,el:this};I=s.p.colModel[e].sortable;if(typeof I!=="boolean")I=s.p.colModel[e].sortable=true;t=s.p.colModel[e].name;t=="cb"||t=="subgrid"||t=="rn"||s.p.viewsortcols[2]&&b("div",this).addClass("ui-jqgrid-sortable");if(I)if(s.p.viewsortcols[0]){b("div span.s-ico",this).show();e==s.p.lastsort&&b("div span.ui-icon-"+s.p.sortorder,this).removeClass("ui-state-disabled")}else if(e==s.p.lastsort){b("div span.s-ico",this).show();b("div span.ui-icon-"+s.p.sortorder,this).removeClass("ui-state-disabled")}if(s.p.footerrow)X+="<td role='gridcell' "+p(e,0,"",null,"",false)+">&#160;</td>"}).mousedown(function(e){if(b(e.target).closest("th>span.ui-jqgrid-resize").length==1){var t=b.jgrid.getCellIndex(this);if(s.p.forceFit===true){var r=s.p,i=t,o;for(o=t+1;o<s.p.colModel.length;o++)if(s.p.colModel[o].hidden!==true){i=o;break}r.nv=i-t}n.dragStart(t,e,M(t));return false}}).click(function(e){if(s.p.disableClick)return s.p.disableClick=false;var t="th>div.ui-jqgrid-sortable",n,r;s.p.viewsortcols[2]||(t="th>div>span>span.ui-grid-ico-sort");e=b(e.target).closest(t);if(e.length==1){t=b.jgrid.getCellIndex(this);if(!s.p.viewsortcols[2]){n=true;r=e.attr("sort")}O(b("div",this)[0].id,t,n,r);return false}});if(s.p.sortable&&b.fn.sortable)try{b(s).jqGrid("sortableColumns",o)}catch($){}if(s.p.footerrow)X+="</tr></tbody></table>";V+="</tr>";this.appendChild(document.createElement("tbody"));b(this).addClass("ui-jqgrid-btable").append(V);V=null;o=b("<table class='ui-jqgrid-htable' style='width:"+s.p.tblwidth+"px' role='grid' aria-labelledby='gbox_"+this.id+"' cellspacing='0' cellpadding='0' border='0'></table>").append(P);var J=s.p.caption&&s.p.hiddengrid===true?true:false;r=b("<div class='ui-jqgrid-hbox"+(i=="rtl"?"-rtl":"")+"'></div>");P=null;n.hDiv=document.createElement("div");b(n.hDiv).css({width:n.width+"px"}).addClass("ui-state-default ui-jqgrid-hdiv").append(r);b(r).append(o);o=null;J&&b(n.hDiv).hide();if(s.p.pager){if(typeof s.p.pager=="string"){if(s.p.pager.substr(0,1)!="#")s.p.pager="#"+s.p.pager}else s.p.pager="#"+b(s.p.pager).attr("id");b(s.p.pager).css({width:n.width+"px"}).appendTo(c).addClass("ui-state-default ui-jqgrid-pager ui-corner-bottom");J&&b(s.p.pager).hide();u(s.p.pager,"")}s.p.cellEdit===false&&s.p.hoverrows===true&&b(s).bind("mouseover",function(e){R=b(e.target).closest("tr.jqgrow");b(R).attr("class")!=="subgrid"&&b(R).addClass("ui-state-hover");return false}).bind("mouseout",function(e){R=b(e.target).closest("tr.jqgrow");b(R).removeClass("ui-state-hover");return false});var K,Q;b(s).before(n.hDiv).click(function(e){q=e.target;R=b(q,s.rows).closest("tr.jqgrow");if(b(R).length===0||R[0].className.indexOf("ui-state-disabled")>-1)return this;var t=b(q).hasClass("cbox"),n=true;if(b.isFunction(s.p.beforeSelectRow))n=s.p.beforeSelectRow.call(s,R[0].id,e);if(q.tagName=="A"||(q.tagName=="INPUT"||q.tagName=="TEXTAREA"||q.tagName=="OPTION"||q.tagName=="SELECT")&&!t)return this;if(n===true){if(s.p.cellEdit===true)if(s.p.multiselect&&t)b(s).jqGrid("setSelection",R[0].id,true);else{K=R[0].rowIndex;Q=b.jgrid.getCellIndex(q);try{b(s).jqGrid("editCell",K,Q,true)}catch(r){}}else if(s.p.multikey)if(e[s.p.multikey])b(s).jqGrid("setSelection",R[0].id,true);else{if(s.p.multiselect&&t){t=b("[id^=jqg_"+b.jgrid.jqID(s.p.id)+"_]").attr("checked");b("[id^=jqg_"+b.jgrid.jqID(s.p.id)+"_]").attr("checked",!t)}}else{if(s.p.multiselect&&s.p.multiboxonly)if(!t){b(s.p.selarrrow).each(function(e,t){var n=s.rows.namedItem(t);b(n).removeClass("ui-state-highlight");b("#jqg_"+b.jgrid.jqID(s.p.id)+"_"+b.jgrid.jqID(t)).attr("checked",false)});s.p.selarrrow=[];b("#cb_"+b.jgrid.jqID(s.p.id),s.grid.hDiv).attr("checked",false)}b(s).jqGrid("setSelection",R[0].id,true)}if(b.isFunction(s.p.onCellSelect)){K=R[0].id;Q=b.jgrid.getCellIndex(q);s.p.onCellSelect.call(s,K,Q,b(q).html(),e)}e.stopPropagation()}else return this}).bind("reloadGrid",function(e,t){if(s.p.treeGrid===true)s.p.datatype=s.p.treedatatype;t&&t.current&&s.grid.selectionPreserver(s);if(s.p.datatype=="local"){b(s).jqGrid("resetSelection");s.p.data.length&&x()}else if(!s.p.treeGrid){s.p.selrow=null;if(s.p.multiselect){s.p.selarrrow=[];b("#cb_"+b.jgrid.jqID(s.p.id),s.grid.hDiv).attr("checked",false)}s.p.savedRow=[]}s.p.scroll&&S(s.grid.bDiv,true,false);if(t&&t.page){var n=t.page;if(n>s.p.lastpage)n=s.p.lastpage;if(n<1)n=1;s.p.page=n;s.grid.bDiv.scrollTop=s.grid.prevRowHeight?(n-1)*s.grid.prevRowHeight*s.p.rowNum:0}if(s.grid.prevRowHeight&&s.p.scroll){delete s.p.lastpage;s.grid.populateVisible()}else s.grid.populate();return false});b.isFunction(this.p.ondblClickRow)&&b(this).dblclick(function(e){q=e.target;R=b(q,s.rows).closest("tr.jqgrow");if(b(R).length===0)return false;K=R[0].rowIndex;Q=b.jgrid.getCellIndex(q);s.p.ondblClickRow.call(s,b(R).attr("id"),K,Q,e);return false});b.isFunction(this.p.onRightClickRow)&&b(this).bind("contextmenu",function(e){q=e.target;R=b(q,s.rows).closest("tr.jqgrow");if(b(R).length===0)return false;s.p.multiselect||b(s).jqGrid("setSelection",R[0].id,true);K=R[0].rowIndex;Q=b.jgrid.getCellIndex(q);s.p.onRightClickRow.call(s,b(R).attr("id"),K,Q,e);return false});n.bDiv=document.createElement("div");if(a)if(String(s.p.height).toLowerCase()==="auto")s.p.height="100%";b(n.bDiv).append(b('<div style="position:relative;'+(a&&b.browser.version<8?"height:0.01%;":"")+'"></div>').append("<div></div>").append(this)).addClass("ui-jqgrid-bdiv").css({height:s.p.height+(isNaN(s.p.height)?"":"px"),width:n.width+"px"}).scroll(n.scrollGrid);b("table:first",n.bDiv).css({width:s.p.tblwidth+"px"});if(a){b("tbody",this).size()==2&&b("tbody:gt(0)",this).remove();s.p.multikey&&b(n.bDiv).bind("selectstart",function(){return false})}else s.p.multikey&&b(n.bDiv).bind("mousedown",function(){return false});J&&b(n.bDiv).hide();n.cDiv=document.createElement("div");var G=s.p.hidegrid===true?b("<a role='link' href='javascript:void(0)'/>").addClass("ui-jqgrid-titlebar-close HeaderButton").hover(function(){G.addClass("ui-state-hover")},function(){G.removeClass("ui-state-hover")}).append("<span class='ui-icon ui-icon-circle-triangle-n'></span>").css(i=="rtl"?"left":"right","0px"):"";b(n.cDiv).append(G).append("<span class='ui-jqgrid-title"+(i=="rtl"?"-rtl":"")+"'>"+s.p.caption+"</span>").addClass("ui-jqgrid-titlebar ui-widget-header ui-corner-top ui-helper-clearfix");b(n.cDiv).insertBefore(n.hDiv);if(s.p.toolbar[0]){n.uDiv=document.createElement("div");if(s.p.toolbar[1]=="top")b(n.uDiv).insertBefore(n.hDiv);else s.p.toolbar[1]=="bottom"&&b(n.uDiv).insertAfter(n.hDiv);if(s.p.toolbar[1]=="both"){n.ubDiv=document.createElement("div");b(n.uDiv).insertBefore(n.hDiv).addClass("ui-userdata ui-state-default").attr("id","t_"+this.id);b(n.ubDiv).insertAfter(n.hDiv).addClass("ui-userdata ui-state-default").attr("id","tb_"+this.id);J&&b(n.ubDiv).hide()}else b(n.uDiv).width(n.width).addClass("ui-userdata ui-state-default").attr("id","t_"+this.id);J&&b(n.uDiv).hide()}if(s.p.toppager){s.p.toppager=b.jgrid.jqID(s.p.id)+"_toppager";n.topDiv=b("<div id='"+s.p.toppager+"'></div>")[0];s.p.toppager="#"+s.p.toppager;b(n.topDiv).insertBefore(n.hDiv).addClass("ui-state-default ui-jqgrid-toppager").width(n.width);u(s.p.toppager,"_t")}if(s.p.footerrow){n.sDiv=b("<div class='ui-jqgrid-sdiv'></div>")[0];r=b("<div class='ui-jqgrid-hbox"+(i=="rtl"?"-rtl":"")+"'></div>");b(n.sDiv).append(r).insertAfter(n.hDiv).width(n.width);b(r).append(X);n.footers=b(".ui-jqgrid-ftable",n.sDiv)[0].rows[0].cells;if(s.p.rownumbers)n.footers[0].className="ui-state-default jqgrid-rownum";J&&b(n.sDiv).hide()}r=null;if(s.p.caption){var Y=s.p.datatype;if(s.p.hidegrid===true){b(".ui-jqgrid-titlebar-close",n.cDiv).click(function(e){var t=b.isFunction(s.p.onHeaderClick),r=".ui-jqgrid-bdiv, .ui-jqgrid-hdiv, .ui-jqgrid-pager, .ui-jqgrid-sdiv",i,o=this;if(s.p.toolbar[0]===true){if(s.p.toolbar[1]=="both")r+=", #"+b(n.ubDiv).attr("id");r+=", #"+b(n.uDiv).attr("id")}i=b(r,"#gview_"+b.jgrid.jqID(s.p.id)).length;if(s.p.gridstate=="visible")b(r,"#gbox_"+b.jgrid.jqID(s.p.id)).slideUp("fast",function(){i--;if(i===0){b("span",o).removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s");s.p.gridstate="hidden";b("#gbox_"+b.jgrid.jqID(s.p.id)).hasClass("ui-resizable")&&b(".ui-resizable-handle","#gbox_"+b.jgrid.jqID(s.p.id)).hide();if(t)J||s.p.onHeaderClick.call(s,s.p.gridstate,e)}});else s.p.gridstate=="hidden"&&b(r,"#gbox_"+b.jgrid.jqID(s.p.id)).slideDown("fast",function(){i--;if(i===0){b("span",o).removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n");if(J){s.p.datatype=Y;A();J=false}s.p.gridstate="visible";b("#gbox_"+b.jgrid.jqID(s.p.id)).hasClass("ui-resizable")&&b(".ui-resizable-handle","#gbox_"+b.jgrid.jqID(s.p.id)).show();if(t)J||s.p.onHeaderClick.call(s,s.p.gridstate,e)}});return false});if(J){s.p.datatype="local";b(".ui-jqgrid-titlebar-close",n.cDiv).trigger("click")}}}else b(n.cDiv).hide();b(n.hDiv).after(n.bDiv).mousemove(function(e){if(n.resizing){n.dragMove(e);return false}});b(".ui-jqgrid-labels",n.hDiv).bind("selectstart",function(){return false});b(document).mouseup(function(){if(n.resizing){n.dragEnd();return false}return true});s.formatCol=p;s.sortData=O;s.updatepager=function(e,t){var n,r,i,o,u,a,f,l="";i=parseInt(s.p.page,10)-1;if(i<0)i=0;i*=parseInt(s.p.rowNum,10);u=i+s.p.reccount;if(s.p.scroll){n=b("tbody:first > tr:gt(0)",s.grid.bDiv);i=u-n.length;s.p.reccount=n.length;if(r=n.outerHeight()||s.grid.prevRowHeight){n=i*r;r*=parseInt(s.p.records,10);b(">div:first",s.grid.bDiv).css({height:r}).children("div:first").css({height:n,display:n?"":"none"})}s.grid.bDiv.scrollLeft=s.grid.hDiv.scrollLeft}l=s.p.pager?s.p.pager:"";l+=s.p.toppager?l?","+s.p.toppager:s.p.toppager:"";if(l){f=b.jgrid.formatter.integer||{};n=h(s.p.page);r=h(s.p.lastpage);b(".selbox",l).attr("disabled",false);if(s.p.pginput===true){b(".ui-pg-input",l).val(s.p.page);b("#sp_1",l).html(b.fmatter?b.fmatter.util.NumberFormat(s.p.lastpage,f):s.p.lastpage)}if(s.p.viewrecords)if(s.p.reccount===0)b(".ui-paging-info",l).html(s.p.emptyrecords);else{o=i+1;a=s.p.records;if(b.fmatter){o=b.fmatter.util.NumberFormat(o,f);u=b.fmatter.util.NumberFormat(u,f);a=b.fmatter.util.NumberFormat(a,f)}b(".ui-paging-info",l).html(b.jgrid.format(s.p.recordtext,o,u,a))}if(s.p.pgbuttons===true){if(n<=0)n=r=0;if(n==1||n===0){b("#first, #prev",s.p.pager).addClass("ui-state-disabled").removeClass("ui-state-hover");s.p.toppager&&b("#first_t, #prev_t",s.p.toppager).addClass("ui-state-disabled").removeClass("ui-state-hover")}else{b("#first, #prev",s.p.pager).removeClass("ui-state-disabled");s.p.toppager&&b("#first_t, #prev_t",s.p.toppager).removeClass("ui-state-disabled")}if(n==r||n===0){b("#next, #last",s.p.pager).addClass("ui-state-disabled").removeClass("ui-state-hover");s.p.toppager&&b("#next_t, #last_t",s.p.toppager).addClass("ui-state-disabled").removeClass("ui-state-hover")}else{b("#next, #last",s.p.pager).removeClass("ui-state-disabled");s.p.toppager&&b("#next_t, #last_t",s.p.toppager).removeClass("ui-state-disabled")}}}e===true&&s.p.rownumbers===true&&b("td.jqgrid-rownum",s.rows).each(function(e){b(this).html(i+1+e)});t&&s.p.jqgdnd&&b(s).jqGrid("gridDnD","updateDnD");b.isFunction(s.p.gridComplete)&&s.p.gridComplete.call(s)};s.refreshIndex=x;s.formatter=function(e,t,n,r,i){return v(e,t,n,r,i)};b.extend(n,{populate:A,emptyRows:S});this.grid=n;s.addXmlData=function(e){T(e,s.grid.bDiv)};s.addJSONData=function(e){N(e,s.grid.bDiv)};this.grid.cols=this.rows[0].cells;A();s.p.hiddengrid=false;b(window).unload(function(){s=null})}}}})};b.jgrid.extend({getGridParam:function(e){var t=this[0];if(t&&t.grid)return e?typeof t.p[e]!="undefined"?t.p[e]:null:t.p},setGridParam:function(e){return this.each(function(){this.grid&&typeof e==="object"&&b.extend(true,this.p,e)})},getDataIDs:function(){var e=[],t=0,n,r=0;this.each(function(){if((n=this.rows.length)&&n>0)for(;t<n;){if(b(this.rows[t]).hasClass("jqgrow")){e[r]=this.rows[t].id;r++}t++}});return e},setSelection:function(e,t){return this.each(function(){function n(e){var t=b(r.grid.bDiv)[0].clientHeight,n=b(r.grid.bDiv)[0].scrollTop,i=r.rows[e].offsetTop;e=r.rows[e].clientHeight;if(i+e>=t+n)b(r.grid.bDiv)[0].scrollTop=i-(t+n)+e+n;else if(i<t+n)if(i<n)b(r.grid.bDiv)[0].scrollTop=i}var r=this,i,s,o;if(e!==undefined){t=t===false?false:true;s=r.rows.namedItem(e+"");if(!(!s||s.className.indexOf("ui-state-disabled")>-1)){if(r.p.scrollrows===true){i=r.rows.namedItem(e).rowIndex;i>=0&&n(i)}if(r.p.multiselect){r.p.selrow=s.id;o=b.inArray(r.p.selrow,r.p.selarrrow);if(o===-1){s.className!=="ui-subgrid"&&b(s).addClass("ui-state-highlight").attr("aria-selected","true");i=true;b("#jqg_"+b.jgrid.jqID(r.p.id)+"_"+b.jgrid.jqID(r.p.selrow)).attr("checked",i);r.p.selarrrow.push(r.p.selrow)}else{s.className!=="ui-subgrid"&&b(s).removeClass("ui-state-highlight").attr("aria-selected","false");i=false;b("#jqg_"+b.jgrid.jqID(r.p.id)+"_"+b.jgrid.jqID(r.p.selrow)).attr("checked",i);r.p.selarrrow.splice(o,1);o=r.p.selarrrow[0];r.p.selrow=o===undefined?null:o}r.p.onSelectRow&&t&&r.p.onSelectRow.call(r,s.id,i)}else if(s.className!=="ui-subgrid"){if(r.p.selrow!=s.id){b(r.rows.namedItem(r.p.selrow)).removeClass("ui-state-highlight").attr({"aria-selected":"false",tabindex:"-1"});b(s).addClass("ui-state-highlight").attr({"aria-selected":true,tabindex:"0"});i=true}else i=false;r.p.selrow=s.id;r.p.onSelectRow&&t&&r.p.onSelectRow.call(r,s.id,i)}}}})},resetSelection:function(e){return this.each(function(){var t=this,n,r;if(typeof e!=="undefined"){r=e===t.p.selrow?t.p.selrow:e;b("#"+b.jgrid.jqID(t.p.id)+" tbody:first tr#"+b.jgrid.jqID(r)).removeClass("ui-state-highlight").attr("aria-selected","false");if(t.p.multiselect){b("#jqg_"+b.jgrid.jqID(t.p.id)+"_"+b.jgrid.jqID(r)).attr("checked",false);b("#cb_"+b.jgrid.jqID(t.p.id)).attr("checked",false)}r=null}else if(t.p.multiselect){b(t.p.selarrrow).each(function(e,r){n=t.rows.namedItem(r);b(n).removeClass("ui-state-highlight").attr("aria-selected","false");b("#jqg_"+b.jgrid.jqID(t.p.id)+"_"+b.jgrid.jqID(r)).attr("checked",false)});b("#cb_"+b.jgrid.jqID(t.p.id)).attr("checked",false);t.p.selarrrow=[]}else if(t.p.selrow){b("#"+b.jgrid.jqID(t.p.id)+" tbody:first tr#"+b.jgrid.jqID(t.p.selrow)).removeClass("ui-state-highlight").attr("aria-selected","false");t.p.selrow=null}t.p.savedRow=[]})},getRowData:function(e){var t={},n,r=false,i,s=0;this.each(function(){var o=this,u,a;if(typeof e=="undefined"){r=true;n=[];i=o.rows.length}else{a=o.rows.namedItem(e);if(!a)return t;i=2}for(;s<i;){if(r)a=o.rows[s];if(b(a).hasClass("jqgrow")){b("td",a).each(function(e){u=o.p.colModel[e].name;if(u!=="cb"&&u!=="subgrid"&&u!=="rn")if(o.p.treeGrid===true&&u==o.p.ExpandColumn)t[u]=b.jgrid.htmlDecode(b("span:first",this).html());else try{t[u]=b.unformat(this,{rowId:a.id,colModel:o.p.colModel[e]},e)}catch(n){t[u]=b.jgrid.htmlDecode(b(this).html())}});if(r){n.push(t);t={}}}s++}});return n?n:t},delRowData:function(e){var t=false,n,r;this.each(function(){if(n=this.rows.namedItem(e)){b(n).remove();this.p.records--;this.p.reccount--;this.updatepager(true,false);t=true;if(this.p.multiselect){r=b.inArray(e,this.p.selarrrow);r!=-1&&this.p.selarrrow.splice(r,1)}if(e==this.p.selrow)this.p.selrow=null}else return false;if(this.p.datatype=="local"){var i=this.p._index[e];if(typeof i!="undefined"){this.p.data.splice(i,1);this.refreshIndex()}}if(this.p.altRows===true&&t){var s=this.p.altclass;b(this.rows).each(function(e){e%2==1?b(this).addClass(s):b(this).removeClass(s)})}});return t},setRowData:function(e,t,n){var r,i=true,s;this.each(function(){if(!this.grid)return false;var o=this,u,a,l=typeof n,p={};a=o.rows.namedItem(e);if(!a)return false;if(t)try{b(this.p.colModel).each(function(n){r=this.name;if(t[r]!==undefined){p[r]=this.formatter&&typeof this.formatter==="string"&&this.formatter=="date"?b.unformat.date(t[r],this):t[r];u=o.formatter(e,t[r],n,t,"edit");s=this.title?{title:b.jgrid.stripHtml(u)}:{};o.p.treeGrid===true&&r==o.p.ExpandColumn?b("td:eq("+n+") > span:first",a).html(u).attr(s):b("td:eq("+n+")",a).html(u).attr(s)}});if(o.p.datatype=="local"){var d=o.p._index[e];if(o.p.treeGrid)for(var v in o.p.treeReader)p.hasOwnProperty(o.p.treeReader[v])&&delete p[o.p.treeReader[v]];if(typeof d!="undefined")o.p.data[d]=b.extend(true,o.p.data[d],p);p=null}}catch(m){i=false}if(i)if(l==="string")b(a).addClass(n);else l==="object"&&b(a).css(n)});return i},addRowData:function(e,t,n,r){n||(n="last");var i=false,s,o,u,a,f,l,c,h,p="",d,v,m,g,y;if(t){if(b.isArray(t)){d=true;n="last";v=e}else{t=[t];d=false}this.each(function(){var w=t.length;f=this.p.rownumbers===true?1:0;u=this.p.multiselect===true?1:0;a=this.p.subGrid===true?1:0;if(!d)if(typeof e!="undefined")e+="";else{e=b.jgrid.randId();if(this.p.keyIndex!==false){v=this.p.colModel[this.p.keyIndex+u+a+f].name;if(typeof t[0][v]!="undefined")e=t[0][v]}}m=this.p.altclass;for(var S=0,x="",T={},N=b.isFunction(this.p.afterInsertRow)?true:false;S<w;){g=t[S];o="";if(d){try{e=g[v]}catch(C){e=b.jgrid.randId()}x=this.p.altRows===true?(this.rows.length-1)%2===0?m:"":""}if(f){p=this.formatCol(0,1,"",null,e,true);o+='<td role="gridcell" aria-describedby="'+this.p.id+'_rn" class="ui-state-default jqgrid-rownum" '+p+">0</td>"}if(u){h='<input role="checkbox" type="checkbox" id="jqg_'+this.p.id+"_"+e+'" class="cbox"/>';p=this.formatCol(f,1,"",null,e,true);o+='<td role="gridcell" aria-describedby="'+this.p.id+'_cb" '+p+">"+h+"</td>"}if(a)o+=b(this).jqGrid("addSubGridCell",u+f,1);for(c=u+a+f;c<this.p.colModel.length;c++){y=this.p.colModel[c];s=y.name;T[s]=y.formatter&&typeof y.formatter==="string"&&y.formatter=="date"?b.unformat.date(g[s],y):g[s];h=this.formatter(e,b.jgrid.getAccessor(g,s),c,g,"edit");p=this.formatCol(c,1,h,e,g,true);o+='<td role="gridcell" aria-describedby="'+this.p.id+"_"+s+'" '+p+">"+h+"</td>"}o='<tr id="'+e+'" role="row" tabindex="-1" class="ui-widget-content jqgrow ui-row-'+this.p.direction+" "+x+'">'+o+"</tr>";if(this.p.subGrid===true){o=b(o)[0];b(this).jqGrid("addSubGrid",o,u+f)}if(this.rows.length===0)b("table:first",this.grid.bDiv).append(o);else switch(n){case"last":b(this.rows[this.rows.length-1]).after(o);break;case"first":b(this.rows[0]).after(o);break;case"after":if(l=this.rows.namedItem(r))b(this.rows[l.rowIndex+1]).hasClass("ui-subgrid")?b(this.rows[l.rowIndex+1]).after(o):b(l).after(o);break;case"before":if(l=this.rows.namedItem(r)){b(l).before(o);l=l.rowIndex}}this.p.records++;this.p.reccount++;N&&this.p.afterInsertRow.call(this,e,g,g);S++;if(this.p.datatype=="local"){T[this.p.localReader.id]=e;this.p._index[e]=this.p.data.length;this.p.data.push(T);T={}}}if(this.p.altRows===true&&!d)if(n=="last")(this.rows.length-1)%2==1&&b(this.rows[this.rows.length-1]).addClass(m);else b(this.rows).each(function(e){e%2==1?b(this).addClass(m):b(this).removeClass(m)});this.updatepager(true,true);i=true})}return i},footerData:function(e,t,n){function r(e){for(var t in e)if(e.hasOwnProperty(t))return false;return true}var i,s=false,o={},u;if(typeof e=="undefined")e="get";if(typeof n!="boolean")n=true;e=e.toLowerCase();this.each(function(){var p=this,d;if(!p.grid||!p.p.footerrow)return false;if(e=="set")if(r(t))return false;s=true;b(this.p.colModel).each(function(r){i=this.name;if(e=="set"){if(t[i]!==undefined){d=n?p.formatter("",t[i],r,t,"edit"):t[i];u=this.title?{title:b.jgrid.stripHtml(d)}:{};b("tr.footrow td:eq("+r+")",p.grid.sDiv).html(d).attr(u);s=true}}else if(e=="get")o[i]=b("tr.footrow td:eq("+r+")",p.grid.sDiv).html()})});return e=="get"?o:s},showHideCol:function(e,t){return this.each(function(){var n=this,r=false,i=b.browser.webkit||b.browser.safari?0:n.p.cellLayout,s;if(n.grid){if(typeof e==="string")e=[e];t=t!="none"?"":"none";var o=t===""?true:false;b(this.p.colModel).each(function(u){if(b.inArray(this.name,e)!==-1&&this.hidden===o){b("tr",n.grid.hDiv).each(function(){b(this).children("th:eq("+u+")").css("display",t)});b(n.rows).each(function(){b(this).children("td:eq("+u+")").css("display",t)});n.p.footerrow&&b(n.grid.sDiv).children("td:eq("+u+")").css("display",t);s=this.widthOrg?this.widthOrg:parseInt(this.width,10);if(t==="none")n.p.tblwidth-=s+i;else n.p.tblwidth+=s+i;this.hidden=!o;r=true}});if(r===true)if(n.grid.width!==n.p.tblwidth)b(n).jqGrid("setGridWidth",n.p.shrinkToFit===true?n.grid.width:n.p.tblwidth,true)}})},hideCol:function(e){return this.each(function(){b(this).jqGrid("showHideCol",e,"none")})},showCol:function(e){return this.each(function(){b(this).jqGrid("showHideCol",e,"")})},remapColumns:function(e,t,n){function r(t){var n;n=t.length?b.makeArray(t):b.extend({},t);b.each(e,function(e){t[e]=n[this]})}function i(t,n){b(">tr"+(n||""),t).each(function(){var t=this,n=b.makeArray(t.cells);b.each(e,function(){var e=n[this];e&&t.appendChild(e)})})}var s=this.get(0);r(s.p.colModel);r(s.p.colNames);r(s.grid.headers);i(b("thead:first",s.grid.hDiv),n&&":not(.ui-jqgrid-labels)");t&&i(b("#"+b.jgrid.jqID(s.p.id)+" tbody:first"),".jqgfirstrow, tr.jqgrow, tr.jqfoot");s.p.footerrow&&i(b("tbody:first",s.grid.sDiv));if(s.p.remapColumns)if(s.p.remapColumns.length)r(s.p.remapColumns);else s.p.remapColumns=b.makeArray(e);s.p.lastsort=b.inArray(s.p.lastsort,e);if(s.p.treeGrid)s.p.expColInd=b.inArray(s.p.expColInd,e)},setGridWidth:function(e,t){return this.each(function(){if(this.grid){var n=this,r,i=0,s=b.browser.webkit||b.browser.safari?0:n.p.cellLayout,o,u=0,a=false,l=n.p.scrollOffset,c,h=0,p=0,d;if(typeof t!="boolean")t=n.p.shrinkToFit;if(!isNaN(e)){e=parseInt(e,10);n.grid.width=n.p.width=e;b("#gbox_"+b.jgrid.jqID(n.p.id)).css("width",e+"px");b("#gview_"+b.jgrid.jqID(n.p.id)).css("width",e+"px");b(n.grid.bDiv).css("width",e+"px");b(n.grid.hDiv).css("width",e+"px");n.p.pager&&b(n.p.pager).css("width",e+"px");n.p.toppager&&b(n.p.toppager).css("width",e+"px");if(n.p.toolbar[0]===true){b(n.grid.uDiv).css("width",e+"px");n.p.toolbar[1]=="both"&&b(n.grid.ubDiv).css("width",e+"px")}n.p.footerrow&&b(n.grid.sDiv).css("width",e+"px");if(t===false&&n.p.forceFit===true)n.p.forceFit=false;if(t===true){b.each(n.p.colModel,function(){if(this.hidden===false){r=this.widthOrg?this.widthOrg:parseInt(this.width,10);i+=r+s;if(this.fixed)h+=r+s;else u++;p++}});if(u!==0){n.p.tblwidth=i;c=e-s*u-h;if(!isNaN(n.p.height))if(b(n.grid.bDiv)[0].clientHeight<b(n.grid.bDiv)[0].scrollHeight||n.rows.length===1){a=true;c-=l}i=0;var v=n.grid.cols.length>0;b.each(n.p.colModel,function(e){if(this.hidden===false&&!this.fixed){r=this.widthOrg?this.widthOrg:parseInt(this.width,10);r=Math.round(c*r/(n.p.tblwidth-s*u-h));if(!(r<0)){this.width=r;i+=r;n.grid.headers[e].width=r;n.grid.headers[e].el.style.width=r+"px";if(n.p.footerrow)n.grid.footers[e].style.width=r+"px";if(v)n.grid.cols[e].style.width=r+"px";o=e}}});d=0;if(a){if(e-h-(i+s*u)!==l)d=e-h-(i+s*u)-l}else if(Math.abs(e-h-(i+s*u))!==1)d=e-h-(i+s*u);n.p.colModel[o].width+=d;n.p.tblwidth=i+d+s*u+h;if(n.p.tblwidth>e){a=n.p.tblwidth-parseInt(e,10);n.p.tblwidth=e;r=n.p.colModel[o].width-=a}else r=n.p.colModel[o].width;n.grid.headers[o].width=r;n.grid.headers[o].el.style.width=r+"px";if(v)n.grid.cols[o].style.width=r+"px";b("table:first",n.grid.bDiv).css("width",n.p.tblwidth+"px");b("table:first",n.grid.hDiv).css("width",n.p.tblwidth+"px");n.grid.hDiv.scrollLeft=n.grid.bDiv.scrollLeft;if(n.p.footerrow){n.grid.footers[o].style.width=r+"px";b("table:first",n.grid.sDiv).css("width",n.p.tblwidth+"px")}}}}}})},setGridHeight:function(e){return this.each(function(){if(this.grid){b(this.grid.bDiv).css({height:e+(isNaN(e)?"":"px")});this.p.height=e;this.p.scroll&&this.grid.populateVisible()}})},setCaption:function(e){return this.each(function(){this.p.caption=e;b("span.ui-jqgrid-title",this.grid.cDiv).html(e);b(this.grid.cDiv).show()})},setLabel:function(e,t,n,r){return this.each(function(){var i=-1;if(this.grid){if(isNaN(e))b(this.p.colModel).each(function(t){if(this.name==e){i=t;return false}});else i=parseInt(e,10);if(i>=0){var s=b("tr.ui-jqgrid-labels th:eq("+i+")",this.grid.hDiv);if(t){var o=b(".s-ico",s);b("[id^=jqgh_]",s).empty().html(t).append(o);this.p.colNames[i]=t}if(n)typeof n==="string"?b(s).addClass(n):b(s).css(n);typeof r==="object"&&b(s).attr(r)}}})},setCell:function(e,t,n,r,i,s){return this.each(function(){var o=-1,u,a;if(this.grid){if(isNaN(t))b(this.p.colModel).each(function(e){if(this.name==t){o=e;return false}});else o=parseInt(t,10);if(o>=0)if(u=this.rows.namedItem(e)){var l=b("td:eq("+o+")",u);if(n!==""||s===true){u=this.formatter(e,n,o,u,"edit");a=this.p.colModel[o].title?{title:b.jgrid.stripHtml(u)}:{};this.p.treeGrid&&b(".tree-wrap",b(l)).length>0?b("span",b(l)).html(u).attr(a):b(l).html(u).attr(a);if(this.p.datatype=="local"){u=this.p.colModel[o];n=u.formatter&&typeof u.formatter==="string"&&u.formatter=="date"?b.unformat.date(n,u):n;a=this.p._index[e];if(typeof a!="undefined")this.p.data[a][u.name]=n}}if(typeof r==="string")b(l).addClass(r);else r&&b(l).css(r);typeof i==="object"&&b(l).attr(i)}}})},getCell:function(e,t){var n=false;this.each(function(){var r=-1;if(this.grid){if(isNaN(t))b(this.p.colModel).each(function(e){if(this.name===t){r=e;return false}});else r=parseInt(t,10);if(r>=0){var i=this.rows.namedItem(e);if(i)try{n=b.unformat(b("td:eq("+r+")",i),{rowId:i.id,colModel:this.p.colModel[r]},r)}catch(s){n=b.jgrid.htmlDecode(b("td:eq("+r+")",i).html())}}}});return n},getCol:function(e,t,n){var r=[],i,s=0,o=0,u=0,a;t=typeof t!="boolean"?false:t;if(typeof n=="undefined")n=false;this.each(function(){var p=-1;if(this.grid){if(isNaN(e))b(this.p.colModel).each(function(t){if(this.name===e){p=t;return false}});else p=parseInt(e,10);if(p>=0){var d=this.rows.length,v=0;if(d&&d>0){for(;v<d;){if(b(this.rows[v]).hasClass("jqgrow")){try{i=b.unformat(b(this.rows[v].cells[p]),{rowId:this.rows[v].id,colModel:this.p.colModel[p]},p)}catch(m){i=b.jgrid.htmlDecode(this.rows[v].cells[p].innerHTML)}if(n){a=parseFloat(i);s+=a;o=Math.min(o,a);u=Math.max(o,a)}else t?r.push({id:this.rows[v].id,value:i}):r.push(i)}v++}if(n)switch(n.toLowerCase()){case"sum":r=s;break;case"avg":r=s/d;break;case"count":r=d;break;case"min":r=o;break;case"max":r=u}}}}});return r},clearGridData:function(e){return this.each(function(){if(this.grid){if(typeof e!="boolean")e=false;if(this.p.deepempty)b("#"+b.jgrid.jqID(this.p.id)+" tbody:first tr:gt(0)").remove();else{var t=b("#"+b.jgrid.jqID(this.p.id)+" tbody:first tr:first")[0];b("#"+b.jgrid.jqID(this.p.id)+" tbody:first").empty().append(t)}this.p.footerrow&&e&&b(".ui-jqgrid-ftable td",this.grid.sDiv).html("&#160;");this.p.selrow=null;this.p.selarrrow=[];this.p.savedRow=[];this.p.records=0;this.p.page=1;this.p.lastpage=0;this.p.reccount=0;this.p.data=[];this.p_index={};this.updatepager(true,false)}})},getInd:function(e,t){var n=false,r;this.each(function(){if(r=this.rows.namedItem(e))n=t===true?r:r.rowIndex});return n},bindKeys:function(e){var t=b.extend({onEnter:null,onSpace:null,onLeftKey:null,onRightKey:null,scrollingRows:true},e||{});return this.each(function(){var e=this;b("body").is("[role]")||b("body").attr("role","application");e.p.scrollrows=t.scrollingRows;b(e).keydown(function(n){var r=b(e).find("tr[tabindex=0]")[0],i,s,o,u=e.p.treeReader.expanded_field;if(r){o=e.p._index[r.id];if(n.keyCode===37||n.keyCode===38||n.keyCode===39||n.keyCode===40){if(n.keyCode===38){s=r.previousSibling;i="";if(s)if(b(s).is(":hidden"))for(;s;){s=s.previousSibling;if(!b(s).is(":hidden")&&b(s).hasClass("jqgrow")){i=s.id;break}}else i=s.id;b(e).jqGrid("setSelection",i)}if(n.keyCode===40){s=r.nextSibling;i="";if(s)if(b(s).is(":hidden"))for(;s;){s=s.nextSibling;if(!b(s).is(":hidden")&&b(s).hasClass("jqgrow")){i=s.id;break}}else i=s.id;b(e).jqGrid("setSelection",i)}if(n.keyCode===37){e.p.treeGrid&&e.p.data[o][u]&&b(r).find("div.treeclick").trigger("click");b.isFunction(t.onLeftKey)&&t.onLeftKey.call(e,e.p.selrow)}if(n.keyCode===39){e.p.treeGrid&&!e.p.data[o][u]&&b(r).find("div.treeclick").trigger("click");b.isFunction(t.onRightKey)&&t.onRightKey.call(e,e.p.selrow)}return false}else if(n.keyCode===13){b.isFunction(t.onEnter)&&t.onEnter.call(e,e.p.selrow);return false}else if(n.keyCode===32){b.isFunction(t.onSpace)&&t.onSpace.call(e,e.p.selrow);return false}}})})},unbindKeys:function(){return this.each(function(){b(this).unbind("keydown")})},getLocalRow:function(e){var t=false,n;this.each(function(){if(typeof e!=="undefined"){n=this.p._index[e];if(n>=0)t=this.p.data[n]}});return t}})})(jQuery);(function(e){e.fmatter={};e.extend(e.fmatter,{isBoolean:function(e){return typeof e==="boolean"},isObject:function(t){return t&&(typeof t==="object"||e.isFunction(t))||false},isString:function(e){return typeof e==="string"},isNumber:function(e){return typeof e==="number"&&isFinite(e)},isNull:function(e){return e===null},isUndefined:function(e){return typeof e==="undefined"},isValue:function(e){return this.isObject(e)||this.isString(e)||this.isNumber(e)||this.isBoolean(e)},isEmpty:function(t){if(!this.isString(t)&&this.isValue(t))return false;else if(!this.isValue(t))return true;t=e.trim(t).replace(/\&nbsp\;/ig,"").replace(/\&#160\;/ig,"");return t===""}});e.fn.fmatter=function(t,n,r,i,s){var o=n;r=e.extend({},e.jgrid.formatter,r);if(e.fn.fmatter[t])o=e.fn.fmatter[t](n,r,i,s);return o};e.fmatter.util={NumberFormat:function(t,n){e.fmatter.isNumber(t)||(t*=1);if(e.fmatter.isNumber(t)){var r=t<0,i=t+"",s=n.decimalSeparator?n.decimalSeparator:".",o;if(e.fmatter.isNumber(n.decimalPlaces)){var u=n.decimalPlaces;i=Math.pow(10,u);i=Math.round(t*i)/i+"";o=i.lastIndexOf(".");if(u>0){if(o<0){i+=s;o=i.length-1}else if(s!==".")i=i.replace(".",s);for(;i.length-1-o<u;)i+="0"}}if(n.thousandsSeparator){u=n.thousandsSeparator;o=i.lastIndexOf(s);o=o>-1?o:i.length;s=i.substring(o);for(var a=-1,f=o;f>0;f--){a++;if(a%3===0&&f!==o&&(!r||f>1))s=u+s;s=i.charAt(f-1)+s}i=s}i=n.prefix?n.prefix+i:i;return i=n.suffix?i+n.suffix:i}else return t},DateFormat:function(t,n,r,i){var s=/^\/Date\((([-+])?[0-9]+)(([-+])([0-9]{2})([0-9]{2}))?\)\/$/,o=typeof n==="string"?n.match(s):null;s=function(e,t){e=String(e);for(t=parseInt(t,10)||2;e.length<t;)e="0"+e;return e};var u={m:1,d:1,y:1970,h:0,i:0,s:0,u:0},a=0,f,l=["i18n"];l.i18n={dayNames:i.dayNames,monthNames:i.monthNames};if(t in i.masks)t=i.masks[t];if(n.constructor===Number){if(String(t).toLowerCase()=="u")n*=1e3;a=new Date(n)}else if(n.constructor===Date)a=n;else if(o!==null){a=new Date(parseInt(o[1],10));if(o[3]){t=Number(o[5])*60+Number(o[6]);t*=o[4]=="-"?1:-1;t-=a.getTimezoneOffset();a.setTime(Number(Number(a)+t*6e4))}}else{n=String(n).split(/[\\\/:_;.,\t\T\s-]/);t=t.split(/[\\\/:_;.,\t\T\s-]/);o=0;for(f=t.length;o<f;o++){if(t[o]=="M"){a=e.inArray(n[o],l.i18n.monthNames);if(a!==-1&&a<12)n[o]=a+1}if(t[o]=="F"){a=e.inArray(n[o],l.i18n.monthNames);if(a!==-1&&a>11)n[o]=a+1-12}if(n[o])u[t[o].toLowerCase()]=parseInt(n[o],10)}if(u.f)u.m=u.f;if(u.m===0&&u.y===0&&u.d===0)return"&#160;";u.m=parseInt(u.m,10)-1;a=u.y;if(a>=70&&a<=99)u.y=1900+u.y;else if(a>=0&&a<=69)u.y=2e3+u.y;a=new Date(u.y,u.m,u.d,u.h,u.i,u.s,u.u)}if(r in i.masks)r=i.masks[r];else r||(r="Y-m-d");t=a.getHours();n=a.getMinutes();u=a.getDate();o=a.getMonth()+1;f=a.getTimezoneOffset();var c=a.getSeconds(),h=a.getMilliseconds(),p=a.getDay(),d=a.getFullYear(),v=(p+6)%7+1,m=(new Date(d,o-1,u)-new Date(d,0,1))/864e5,g={d:s(u),D:l.i18n.dayNames[p],j:u,l:l.i18n.dayNames[p+7],N:v,S:i.S(u),w:p,z:m,W:v<5?Math.floor((m+v-1)/7)+1:Math.floor((m+v-1)/7)||(((new Date(d-1,0,1)).getDay()+6)%7<4?53:52),F:l.i18n.monthNames[o-1+12],m:s(o),M:l.i18n.monthNames[o-1],n:o,t:"?",L:"?",o:"?",Y:d,y:String(d).substring(2),a:t<12?i.AmPm[0]:i.AmPm[1],A:t<12?i.AmPm[2]:i.AmPm[3],B:"?",g:t%12||12,G:t,h:s(t%12||12),H:s(t),i:s(n),s:s(c),u:h,e:"?",I:"?",O:(f>0?"-":"+")+s(Math.floor(Math.abs(f)/60)*100+Math.abs(f)%60,4),P:"?",T:(String(a).match(/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g)||[""]).pop().replace(/[^-+\dA-Z]/g,""),Z:"?",c:"?",r:"?",U:Math.floor(a/1e3)};return r.replace(/\\.|[dDjlNSwzWFmMntLoYyaABgGhHisueIOPTZcrU]/g,function(e){return e in g?g[e]:e.substring(1)})}};e.fn.fmatter.defaultFormat=function(t,n){return e.fmatter.isValue(t)&&t!==""?t:n.defaultValue?n.defaultValue:"&#160;"};e.fn.fmatter.email=function(t,n){return e.fmatter.isEmpty(t)?e.fn.fmatter.defaultFormat(t,n):'<a href="mailto:'+t+'">'+t+"</a>"};e.fn.fmatter.checkbox=function(t,n){var r=e.extend({},n.checkbox),i;e.fmatter.isUndefined(n.colModel.formatoptions)||(r=e.extend({},r,n.colModel.formatoptions));i=r.disabled===true?'disabled="disabled"':"";if(e.fmatter.isEmpty(t)||e.fmatter.isUndefined(t))t=e.fn.fmatter.defaultFormat(t,r);t+="";t=t.toLowerCase();return'<input type="checkbox" '+(t.search(/(false|0|no|off)/i)<0?" checked='checked' ":"")+' value="'+t+'" offval="no" '+i+"/>"};e.fn.fmatter.link=function(t,n){var r={target:n.target},i="";e.fmatter.isUndefined(n.colModel.formatoptions)||(r=e.extend({},r,n.colModel.formatoptions));if(r.target)i="target="+r.target;return e.fmatter.isEmpty(t)?e.fn.fmatter.defaultFormat(t,n):"<a "+i+' href="'+t+'">'+t+"</a>"};e.fn.fmatter.showlink=function(t,n){var r={baseLinkUrl:n.baseLinkUrl,showAction:n.showAction,addParam:n.addParam||"",target:n.target,idName:n.idName},i="";e.fmatter.isUndefined(n.colModel.formatoptions)||(r=e.extend({},r,n.colModel.formatoptions));if(r.target)i="target="+r.target;r=r.baseLinkUrl+r.showAction+"?"+r.idName+"="+n.rowId+r.addParam;return e.fmatter.isString(t)||e.fmatter.isNumber(t)?"<a "+i+' href="'+r+'">'+t+"</a>":e.fn.fmatter.defaultFormat(t,n)};e.fn.fmatter.integer=function(t,n){var r=e.extend({},n.integer);e.fmatter.isUndefined(n.colModel.formatoptions)||(r=e.extend({},r,n.colModel.formatoptions));if(e.fmatter.isEmpty(t))return r.defaultValue;return e.fmatter.util.NumberFormat(t,r)};e.fn.fmatter.number=function(t,n){var r=e.extend({},n.number);e.fmatter.isUndefined(n.colModel.formatoptions)||(r=e.extend({},r,n.colModel.formatoptions));if(e.fmatter.isEmpty(t))return r.defaultValue;return e.fmatter.util.NumberFormat(t,r)};e.fn.fmatter.currency=function(t,n){var r=e.extend({},n.currency);e.fmatter.isUndefined(n.colModel.formatoptions)||(r=e.extend({},r,n.colModel.formatoptions));if(e.fmatter.isEmpty(t))return r.defaultValue;return e.fmatter.util.NumberFormat(t,r)};e.fn.fmatter.date=function(t,n,r,i){r=e.extend({},n.date);e.fmatter.isUndefined(n.colModel.formatoptions)||(r=e.extend({},r,n.colModel.formatoptions));return!r.reformatAfterEdit&&i=="edit"?e.fn.fmatter.defaultFormat(t,n):e.fmatter.isEmpty(t)?e.fn.fmatter.defaultFormat(t,n):e.fmatter.util.DateFormat(r.srcformat,t,r.newformat,r)};e.fn.fmatter.select=function(t,n){t+="";var r=false,i=[];if(e.fmatter.isUndefined(n.colModel.formatoptions)){if(!e.fmatter.isUndefined(n.colModel.editoptions))r=n.colModel.editoptions.value}else r=n.colModel.formatoptions.value;if(r){var s=n.colModel.editoptions.multiple===true?true:false,o=[],u;if(s){o=t.split(",");o=e.map(o,function(t){return e.trim(t)})}if(e.fmatter.isString(r))for(var a=r.split(";"),f=0,l=0;l<a.length;l++){u=a[l].split(":");if(u.length>2)u[1]=jQuery.map(u,function(e,t){if(t>0)return e}).join(":");if(s){if(jQuery.inArray(u[0],o)>-1){i[f]=u[1];f++}}else if(e.trim(u[0])==e.trim(t)){i[0]=u[1];break}}else if(e.fmatter.isObject(r))if(s)i=jQuery.map(o,function(e){return r[e]});else i[0]=r[t]||""}t=i.join(", ");return t===""?e.fn.fmatter.defaultFormat(t,n):t};e.fn.fmatter.rowactions=function(t,n,r,i){var s={keys:false,editbutton:true,delbutton:true,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{oper:"edit"},url:null,delOptions:{}};i=e("#"+n)[0].p.colModel[i];e.fmatter.isUndefined(i.formatoptions)||(s=e.extend(s,i.formatoptions));i=function(r){s.afterSave&&s.afterSave(r);e("tr#"+t+" div.ui-inline-edit, tr#"+t+" div.ui-inline-del","#"+n).show();e("tr#"+t+" div.ui-inline-save, tr#"+t+" div.ui-inline-cancel","#"+n).hide()};var o=function(r){s.afterRestore&&s.afterRestore(r);e("tr#"+t+" div.ui-inline-edit, tr#"+t+" div.ui-inline-del","#"+n).show();e("tr#"+t+" div.ui-inline-save, tr#"+t+" div.ui-inline-cancel","#"+n).hide()};switch(r){case"edit":e("#"+n).jqGrid("editRow",t,s.keys,s.onEdit,s.onSuccess,s.url,s.extraparam,i,s.onError,o);e("tr#"+t+" div.ui-inline-edit, tr#"+t+" div.ui-inline-del","#"+n).hide();e("tr#"+t+" div.ui-inline-save, tr#"+t+" div.ui-inline-cancel","#"+n).show();break;case"save":if(e("#"+n).jqGrid("saveRow",t,s.onSuccess,s.url,s.extraparam,i,s.onError,o)){e("tr#"+t+" div.ui-inline-edit, tr#"+t+" div.ui-inline-del","#"+n).show();e("tr#"+t+" div.ui-inline-save, tr#"+t+" div.ui-inline-cancel","#"+n).hide()}break;case"cancel":e("#"+n).jqGrid("restoreRow",t,o);e("tr#"+t+" div.ui-inline-edit, tr#"+t+" div.ui-inline-del","#"+n).show();e("tr#"+t+" div.ui-inline-save, tr#"+t+" div.ui-inline-cancel","#"+n).hide();break;case"del":e("#"+n).jqGrid("delGridRow",t,s.delOptions)}};e.fn.fmatter.actions=function(t,n){var r={keys:false,editbutton:true,delbutton:true};e.fmatter.isUndefined(n.colModel.formatoptions)||(r=e.extend(r,n.colModel.formatoptions));var i=n.rowId,s="",o;if(typeof i=="undefined"||e.fmatter.isEmpty(i))return"";if(r.editbutton){o="onclick=$.fn.fmatter.rowactions('"+i+"','"+n.gid+"','edit',"+n.pos+");";s=s+"<div style='margin-left:8px;'><div title='"+e.jgrid.nav.edittitle+"' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' "+o+"><span class='ui-icon ui-icon-pencil'></span></div>"}if(r.delbutton){o="onclick=$.fn.fmatter.rowactions('"+i+"','"+n.gid+"','del',"+n.pos+");";s=s+"<div title='"+e.jgrid.nav.deltitle+"' style='float:left;margin-left:5px;' class='ui-pg-div ui-inline-del' "+o+"><span class='ui-icon ui-icon-trash'></span></div>"}o="onclick=$.fn.fmatter.rowactions('"+i+"','"+n.gid+"','save',"+n.pos+");";s=s+"<div title='"+e.jgrid.edit.bSubmit+"' style='float:left;display:none' class='ui-pg-div ui-inline-save'><span class='ui-icon ui-icon-disk' "+o+"></span></div>";o="onclick=$.fn.fmatter.rowactions('"+i+"','"+n.gid+"','cancel',"+n.pos+");";return s=s+"<div title='"+e.jgrid.edit.bCancel+"' style='float:left;display:none;margin-left:5px;' class='ui-pg-div ui-inline-cancel'><span class='ui-icon ui-icon-cancel' "+o+"></span></div></div>"};e.unformat=function(t,n,r,i){var s,o=n.colModel.formatter,u=n.colModel.formatoptions||{},a=/([\.\*\_\'\(\)\{\}\+\?\\])/g,f=n.colModel.unformat||e.fn.fmatter[o]&&e.fn.fmatter[o].unformat;if(typeof f!=="undefined"&&e.isFunction(f))s=f(e(t).text(),n,t);else if(!e.fmatter.isUndefined(o)&&e.fmatter.isString(o)){s=e.jgrid.formatter||{};switch(o){case"integer":u=e.extend({},s.integer,u);n=u.thousandsSeparator.replace(a,"\\$1");s=e(t).text().replace(RegExp(n,"g"),"");break;case"number":u=e.extend({},s.number,u);n=u.thousandsSeparator.replace(a,"\\$1");s=e(t).text().replace(RegExp(n,"g"),"").replace(u.decimalSeparator,".");break;case"currency":u=e.extend({},s.currency,u);n=u.thousandsSeparator.replace(a,"\\$1");s=e(t).text().replace(RegExp(n,"g"),"").replace(u.decimalSeparator,".").replace(u.prefix,"").replace(u.suffix,"");break;case"checkbox":u=n.colModel.editoptions?n.colModel.editoptions.value.split(":"):["Yes","No"];s=e("input",t).attr("checked")?u[0]:u[1];break;case"select":s=e.unformat.select(t,n,r,i);break;case"actions":return"";default:s=e(t).text()}}return s?s:i===true?e(t).text():e.jgrid.htmlDecode(e(t).html())};e.unformat.select=function(t,n,r,i){r=[];t=e(t).text();if(i===true)return t;n=e.extend({},n.colModel.editoptions);if(n.value){var s=n.value;n=n.multiple===true?true:false;i=[];var o;if(n){i=t.split(",");i=e.map(i,function(t){return e.trim(t)})}if(e.fmatter.isString(s))for(var u=s.split(";"),a=0,f=0;f<u.length;f++){o=u[f].split(":");if(o.length>2)o[1]=jQuery.map(o,function(e,t){if(t>0)return e}).join(":");if(n){if(jQuery.inArray(o[1],i)>-1){r[a]=o[0];a++}}else if(e.trim(o[1])==e.trim(t)){r[0]=o[0];break}}else if(e.fmatter.isObject(s)||e.isArray(s)){n||(i[0]=t);r=jQuery.map(i,function(t){var n;e.each(s,function(e,r){if(r==t){n=e;return false}});if(typeof n!="undefined")return n})}return r.join(", ")}else return t||""};e.unformat.date=function(t,n){var r=e.jgrid.formatter.date||{};e.fmatter.isUndefined(n.formatoptions)||(r=e.extend({},r,n.formatoptions));return e.fmatter.isEmpty(t)?e.fn.fmatter.defaultFormat(t,n):e.fmatter.util.DateFormat(r.newformat,t,r.srcformat,r)}})(jQuery);(function(e){e.jgrid.extend({getColProp:function(e){var t={},n=this[0];if(!n.grid)return false;n=n.p.colModel;for(var r=0;r<n.length;r++)if(n[r].name==e){t=n[r];break}return t},setColProp:function(t,n){return this.each(function(){if(this.grid)if(n)for(var r=this.p.colModel,i=0;i<r.length;i++)if(r[i].name==t){e.extend(this.p.colModel[i],n);break}})},sortGrid:function(e,t,n){return this.each(function(){var r=-1;if(this.grid){if(!e)e=this.p.sortname;for(var i=0;i<this.p.colModel.length;i++)if(this.p.colModel[i].index==e||this.p.colModel[i].name==e){r=i;break}if(r!=-1){i=this.p.colModel[r].sortable;if(typeof i!=="boolean")i=true;if(typeof t!=="boolean")t=false;i&&this.sortData("jqgh_"+e,r,t,n)}}})},GridDestroy:function(){return this.each(function(){if(this.grid){this.p.pager&&e(this.p.pager).remove();var t=this.id;try{e("#gbox_"+t).remove()}catch(n){}}})},GridUnload:function(){return this.each(function(){if(this.grid){var t={id:e(this).attr("id"),cl:e(this).attr("class")};this.p.pager&&e(this.p.pager).empty().removeClass("ui-state-default ui-jqgrid-pager corner-bottom");var n=document.createElement("table");e(n).attr({id:t.id});n.className=t.cl;t=this.id;e(n).removeClass("ui-jqgrid-btable");if(e(this.p.pager).parents("#gbox_"+t).length===1){e(n).insertBefore("#gbox_"+t).show();e(this.p.pager).insertBefore("#gbox_"+t)}else e(n).insertBefore("#gbox_"+t).show();e("#gbox_"+t).remove()}})},setGridState:function(t){return this.each(function(){if(this.grid)if(t=="hidden"){e(".ui-jqgrid-bdiv, .ui-jqgrid-hdiv","#gview_"+this.p.id).slideUp("fast");this.p.pager&&e(this.p.pager).slideUp("fast");this.p.toppager&&e(this.p.toppager).slideUp("fast");if(this.p.toolbar[0]===true){this.p.toolbar[1]=="both"&&e(this.grid.ubDiv).slideUp("fast");e(this.grid.uDiv).slideUp("fast")}this.p.footerrow&&e(".ui-jqgrid-sdiv","#gbox_"+this.p.id).slideUp("fast");e(".ui-jqgrid-titlebar-close span",this.grid.cDiv).removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s");this.p.gridstate="hidden"}else if(t=="visible"){e(".ui-jqgrid-hdiv, .ui-jqgrid-bdiv","#gview_"+this.p.id).slideDown("fast");this.p.pager&&e(this.p.pager).slideDown("fast");this.p.toppager&&e(this.p.toppager).slideDown("fast");if(this.p.toolbar[0]===true){this.p.toolbar[1]=="both"&&e(this.grid.ubDiv).slideDown("fast");e(this.grid.uDiv).slideDown("fast")}this.p.footerrow&&e(".ui-jqgrid-sdiv","#gbox_"+this.p.id).slideDown("fast");e(".ui-jqgrid-titlebar-close span",this.grid.cDiv).removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n");this.p.gridstate="visible"}})},filterToolbar:function(t){t=e.extend({autosearch:true,searchOnEnter:true,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,searchurl:"",stringResult:false,groupOp:"AND",defaultSearch:"bw"},t||{});return this.each(function(){function n(t,n){var r=e(t);r[0]&&jQuery.each(n,function(){this.data!==undefined?r.bind(this.type,this.data,this.fn):r.bind(this.type,this.fn)})}var r=this;if(!this.ftoolbar){var i=function(){var n={},i=0,s,o,u={},f;e.each(r.p.colModel,function(){o=this.index||this.name;switch(this.stype){case"select":f=this.searchoptions&&this.searchoptions.sopt?this.searchoptions.sopt[0]:"eq";if(s=e("#gs_"+e.jgrid.jqID(o),r.grid.hDiv).val()){n[o]=s;u[o]=f;i++}else try{delete r.p.postData[o]}catch(l){}break;case"text":f=this.searchoptions&&this.searchoptions.sopt?this.searchoptions.sopt[0]:t.defaultSearch;if(s=e("#gs_"+e.jgrid.jqID(o),r.grid.hDiv).val()){n[o]=s;u[o]=f;i++}else try{delete r.p.postData[o]}catch(h){}}});var l=i>0?true:false;if(t.stringResult===true||r.p.datatype=="local"){var h='{"groupOp":"'+t.groupOp+'","rules":[',p=0;e.each(n,function(e,t){if(p>0)h+=",";h+='{"field":"'+e+'",';h+='"op":"'+u[e]+'",';t+="";h+='"data":"'+t.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}';p++});h+="]}";e.extend(r.p.postData,{filters:h});e.each(["searchField","searchString","searchOper"],function(e,t){r.p.postData.hasOwnProperty(t)&&delete r.p.postData[t]})}else e.extend(r.p.postData,n);var d;if(r.p.searchurl){d=r.p.url;e(r).jqGrid("setGridParam",{url:r.p.searchurl})}var v=false;if(e.isFunction(t.beforeSearch))v=t.beforeSearch.call(r);v||e(r).jqGrid("setGridParam",{search:l}).trigger("reloadGrid",[{page:1}]);d&&e(r).jqGrid("setGridParam",{url:d});e.isFunction(t.afterSearch)&&t.afterSearch()},s=e("<tr class='ui-search-toolbar' role='rowheader'></tr>"),o;e.each(r.p.colModel,function(){var u=this,f,l,p,d;l=e("<th role='columnheader' class='ui-state-default ui-th-column ui-th-"+r.p.direction+"'></th>");f=e("<div style='width:100%;position:relative;height:100%;padding-right:0.3em;'></div>");this.hidden===true&&e(l).css("display","none");this.search=this.search===false?false:true;if(typeof this.stype=="undefined")this.stype="text";p=e.extend({},this.searchoptions||{});if(this.search)switch(this.stype){case"select":if(d=this.surl||p.dataUrl)e.ajax(e.extend({url:d,dataType:"html",complete:function(r){if(p.buildSelect!==undefined)(r=p.buildSelect(r))&&e(f).append(r);else e(f).append(r.responseText);p.defaultValue&&e("select",f).val(p.defaultValue);e("select",f).attr({name:u.index||u.name,id:"gs_"+u.name});p.attr&&e("select",f).attr(p.attr);e("select",f).css({width:"100%"});p.dataInit!==undefined&&p.dataInit(e("select",f)[0]);p.dataEvents!==undefined&&n(e("select",f)[0],p.dataEvents);t.autosearch===true&&e("select",f).change(function(){i();return false});r=null}},e.jgrid.ajaxOptions,r.p.ajaxSelectOptions||{}));else{var v;if(u.searchoptions&&u.searchoptions.value)v=u.searchoptions.value;else if(u.editoptions&&u.editoptions.value)v=u.editoptions.value;if(v){d=document.createElement("select");d.style.width="100%";e(d).attr({name:u.index||u.name,id:"gs_"+u.name});var m,g;if(typeof v==="string"){v=v.split(";");for(var y=0;y<v.length;y++){m=v[y].split(":");g=document.createElement("option");g.value=m[0];g.innerHTML=m[1];d.appendChild(g)}}else if(typeof v==="object")for(m in v)if(v.hasOwnProperty(m)){g=document.createElement("option");g.value=m;g.innerHTML=v[m];d.appendChild(g)}p.defaultValue&&e(d).val(p.defaultValue);p.attr&&e(d).attr(p.attr);p.dataInit!==undefined&&p.dataInit(d);p.dataEvents!==undefined&&n(d,p.dataEvents);e(f).append(d);t.autosearch===true&&e(d).change(function(){i();return false})}}break;case"text":d=p.defaultValue?p.defaultValue:"";e(f).append("<input type='text' style='width:95%;padding:0px;' name='"+(u.index||u.name)+"' id='gs_"+u.name+"' value='"+d+"'/>");p.attr&&e("input",f).attr(p.attr);p.dataInit!==undefined&&p.dataInit(e("input",f)[0]);p.dataEvents!==undefined&&n(e("input",f)[0],p.dataEvents);if(t.autosearch===true)t.searchOnEnter?e("input",f).keypress(function(e){if((e.charCode?e.charCode:e.keyCode?e.keyCode:0)==13){i();return false}return this}):e("input",f).keydown(function(e){switch(e.which){case 13:return false;case 9:case 16:case 37:case 38:case 39:case 40:case 27:break;default:o&&clearTimeout(o);o=setTimeout(function(){i()},500)}})}e(l).append(f);e(s).append(l)});e("table thead",r.grid.hDiv).append(s);this.ftoolbar=true;this.triggerToolbar=i;this.clearToolbar=function(n){var i={},s,o=0,u;n=typeof n!="boolean"?true:n;e.each(r.p.colModel,function(){s=this.searchoptions&&this.searchoptions.defaultValue?this.searchoptions.defaultValue:"";u=this.index||this.name;switch(this.stype){case"select":var t;e("#gs_"+e.jgrid.jqID(u)+" option",r.grid.hDiv).each(function(n){if(n===0)this.selected=true;if(e(this).text()==s){this.selected=true;t=e(this).val();return false}});if(t){i[u]=t;o++}else try{delete r.p.postData[u]}catch(n){}break;case"text":e("#gs_"+e.jgrid.jqID(u),r.grid.hDiv).val(s);if(s){i[u]=s;o++}else try{delete r.p.postData[u]}catch(f){}}});var f=o>0?true:false;if(t.stringResult===true||r.p.datatype=="local"){var l='{"groupOp":"'+t.groupOp+'","rules":[',h=0;e.each(i,function(e,t){if(h>0)l+=",";l+='{"field":"'+e+'",';l+='"op":"eq",';t+="";l+='"data":"'+t.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}';h++});l+="]}";e.extend(r.p.postData,{filters:l});e.each(["searchField","searchString","searchOper"],function(e,t){r.p.postData.hasOwnProperty(t)&&delete r.p.postData[t]})}else e.extend(r.p.postData,i);var p;if(r.p.searchurl){p=r.p.url;e(r).jqGrid("setGridParam",{url:r.p.searchurl})}var d=false;if(e.isFunction(t.beforeClear))d=t.beforeClear.call(r);d||n&&e(r).jqGrid("setGridParam",{search:f}).trigger("reloadGrid",[{page:1}]);p&&e(r).jqGrid("setGridParam",{url:p});e.isFunction(t.afterClear)&&t.afterClear()};this.toggleToolbar=function(){var t=e("tr.ui-search-toolbar",r.grid.hDiv);t.css("display")=="none"?t.show():t.hide()}}})}})})(jQuery);(function(e){e.extend(e.jgrid,{showModal:function(e){e.w.show()},closeModal:function(e){e.w.hide().attr("aria-hidden","true");e.o&&e.o.remove()},hideModal:function(t,n){n=e.extend({jqm:true,gb:""},n||{});if(n.onClose){var r=n.onClose(t);if(typeof r=="boolean"&&!r)return}if(e.fn.jqm&&n.jqm===true)e(t).attr("aria-hidden","true").jqmHide();else{if(n.gb!=="")try{e(".jqgrid-overlay:first",n.gb).hide()}catch(i){}e(t).hide().attr("aria-hidden","true")}},findPos:function(e){var t=0,n=0;if(e.offsetParent){do{t+=e.offsetLeft;n+=e.offsetTop}while(e=e.offsetParent)}return[t,n]},createModal:function(t,n,r,i,s,o,u){var f=document.createElement("div"),l,c=this;u=e.extend({},u||{});l=e(r.gbox).attr("dir")=="rtl"?true:false;f.className="ui-widget ui-widget-content ui-corner-all ui-jqdialog";f.id=t.themodal;var h=document.createElement("div");h.className="ui-jqdialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix";h.id=t.modalhead;e(h).append("<span class='ui-jqdialog-title'>"+r.caption+"</span>");var p=e("<a href='javascript:void(0)' class='ui-jqdialog-titlebar-close ui-corner-all'></a>").hover(function(){p.addClass("ui-state-hover")},function(){p.removeClass("ui-state-hover")}).append("<span class='ui-icon ui-icon-closethick'></span>");e(h).append(p);if(l){f.dir="rtl";e(".ui-jqdialog-title",h).css("float","right");e(".ui-jqdialog-titlebar-close",h).css("left","0.3em")}else{f.dir="ltr";e(".ui-jqdialog-title",h).css("float","left");e(".ui-jqdialog-titlebar-close",h).css("right","0.3em")}var d=document.createElement("div");e(d).addClass("ui-jqdialog-content ui-widget-content").attr("id",t.modalcontent);e(d).append(n);f.appendChild(d);e(f).prepend(h);if(o===true)e("body").append(f);else typeof o=="string"?e(o).append(f):e(f).insertBefore(i);e(f).css(u);if(typeof r.jqModal==="undefined")r.jqModal=true;n={};if(e.fn.jqm&&r.jqModal===true){if(r.left===0&&r.top===0&&r.overlay){u=[];u=this.findPos(s);r.left=u[0]+4;r.top=u[1]+4}n.top=r.top+"px";n.left=r.left}else if(r.left!==0||r.top!==0){n.left=r.left;n.top=r.top+"px"}e("a.ui-jqdialog-titlebar-close",h).click(function(){var n=e("#"+t.themodal).data("onClose")||r.onClose,i=e("#"+t.themodal).data("gbox")||r.gbox;c.hideModal("#"+t.themodal,{gb:i,jqm:r.jqModal,onClose:n});return false});if(r.width===0||!r.width)r.width=300;if(r.height===0||!r.height)r.height=200;if(!r.zIndex){i=e(i).parents("*[role=dialog]").filter(":first").css("z-index");r.zIndex=i?parseInt(i,10)+1:950}i=0;if(l&&n.left&&!o){i=e(r.gbox).width()-(!isNaN(r.width)?parseInt(r.width,10):0)-8;n.left=parseInt(n.left,10)+parseInt(i,10)}if(n.left)n.left+="px";e(f).css(e.extend({width:isNaN(r.width)?"auto":r.width+"px",height:isNaN(r.height)?"auto":r.height+"px",zIndex:r.zIndex,overflow:"hidden"},n)).attr({tabIndex:"-1",role:"dialog","aria-labelledby":t.modalhead,"aria-hidden":"true"});if(typeof r.drag=="undefined")r.drag=true;if(typeof r.resize=="undefined")r.resize=true;if(r.drag){e(h).css("cursor","move");if(e.fn.jqDrag)e(f).jqDrag(h);else try{e(f).draggable({handle:e("#"+h.id)})}catch(v){}}if(r.resize)if(e.fn.jqResize){e(f).append("<div class='jqResize ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se ui-icon-grip-diagonal-se'></div>");e("#"+t.themodal).jqResize(".jqResize",t.scrollelm?"#"+t.scrollelm:false)}else try{e(f).resizable({handles:"se, sw",alsoResize:t.scrollelm?"#"+t.scrollelm:false})}catch(m){}r.closeOnEscape===true&&e(f).keydown(function(n){if(n.which==27){n=e("#"+t.themodal).data("onClose")||r.onClose;c.hideModal(this,{gb:r.gbox,jqm:r.jqModal,onClose:n})}})},viewModal:function(t,n){n=e.extend({toTop:true,overlay:10,modal:false,onShow:this.showModal,onHide:this.closeModal,gbox:"",jqm:true,jqM:true},n||{});if(e.fn.jqm&&n.jqm===true)n.jqM?e(t).attr("aria-hidden","false").jqm(n).jqmShow():e(t).attr("aria-hidden","false").jqmShow();else{if(n.gbox!==""){e(".jqgrid-overlay:first",n.gbox).show();e(t).data("gbox",n.gbox)}e(t).show().attr("aria-hidden","false");try{e(":input:visible",t)[0].focus()}catch(r){}}},info_dialog:function(t,n,r,i){var s={width:290,height:"auto",dataheight:"auto",drag:true,resize:false,caption:"<b>"+t+"</b>",left:250,top:170,zIndex:1e3,jqModal:true,modal:false,closeOnEscape:true,align:"center",buttonalign:"center",buttons:[]};e.extend(s,i||{});var o=s.jqModal,u=this;if(e.fn.jqm&&!o)o=false;t="";if(s.buttons.length>0)for(i=0;i<s.buttons.length;i++){if(typeof s.buttons[i].id=="undefined")s.buttons[i].id="info_button_"+i;t+="<a href='javascript:void(0)' id='"+s.buttons[i].id+"' class='fm-button ui-state-default ui-corner-all'>"+s.buttons[i].text+"</a>"}i=isNaN(s.dataheight)?s.dataheight:s.dataheight+"px";var f="<div id='info_id'>";f+="<div id='infocnt' style='margin:0px;padding-bottom:1em;width:100%;overflow:auto;position:relative;height:"+i+";"+("text-align:"+s.align+";")+"'>"+n+"</div>";f+=r?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+s.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'><a href='javascript:void(0)' id='closedialog' class='fm-button ui-state-default ui-corner-all'>"+r+"</a>"+t+"</div>":t!==""?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+s.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'>"+t+"</div>":"";f+="</div>";try{e("#info_dialog").attr("aria-hidden")=="false"&&this.hideModal("#info_dialog",{jqm:o});e("#info_dialog").remove()}catch(l){}this.createModal({themodal:"info_dialog",modalhead:"info_head",modalcontent:"info_content",scrollelm:"infocnt"},f,s,"","",true);t&&e.each(s.buttons,function(t){e("#"+this.id,"#info_id").bind("click",function(){s.buttons[t].onClick.call(e("#info_dialog"));return false})});e("#closedialog","#info_id").click(function(){u.hideModal("#info_dialog",{jqm:o});return false});e(".fm-button","#info_dialog").hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")});e.isFunction(s.beforeOpen)&&s.beforeOpen();this.viewModal("#info_dialog",{onHide:function(e){e.w.hide().remove();e.o&&e.o.remove()},modal:s.modal,jqm:o});e.isFunction(s.afterOpen)&&s.afterOpen();try{e("#info_dialog").focus()}catch(c){}},createEl:function(t,n,r,i,s){function o(t,n){e.isFunction(n.dataInit)&&n.dataInit(t);n.dataEvents&&e.each(n.dataEvents,function(){this.data!==undefined?e(t).bind(this.type,this.data,this.fn):e(t).bind(this.type,this.fn)});return n}function u(t,n){var r=["dataInit","dataEvents","dataUrl","buildSelect","sopt","searchhidden","defaultValue","attr"];e.each(n,function(n,i){e.inArray(n,r)===-1&&e(t).attr(n,i)});n.hasOwnProperty("id")||e(t).attr("id",e.jgrid.randId())}var f="";switch(t){case"textarea":f=document.createElement("textarea");if(i)n.cols||e(f).css({width:"98%"});else if(!n.cols)n.cols=20;if(!n.rows)n.rows=2;if(r=="&nbsp;"||r=="&#160;"||r.length==1&&r.charCodeAt(0)==160)r="";f.value=r;u(f,n);n=o(f,n);e(f).attr({role:"textbox",multiline:"true"});break;case"checkbox":f=document.createElement("input");f.type="checkbox";if(n.value){t=n.value.split(":");if(r===t[0]){f.checked=true;f.defaultChecked=true}f.value=t[0];e(f).attr("offval",t[1])}else{t=r.toLowerCase();if(t.search(/(false|0|no|off|undefined)/i)<0&&t!==""){f.checked=true;f.defaultChecked=true;f.value=r}else f.value="on";e(f).attr("offval","off")}u(f,n);n=o(f,n);e(f).attr("role","checkbox");break;case"select":f=document.createElement("select");f.setAttribute("role","select");i=[];if(n.multiple===true){t=true;f.multiple="multiple";e(f).attr("aria-multiselectable","true")}else t=false;if(typeof n.dataUrl!="undefined")e.ajax(e.extend({url:n.dataUrl,type:"GET",dataType:"html",context:{elem:f,options:n,vl:r},success:function(t){var n=[],r=this.elem,i=this.vl,s=e.extend({},this.options),f=s.multiple===true;if(typeof s.buildSelect!="undefined")t=s.buildSelect(t);if(t=e(t).html()){e(r).append(t);u(r,s);s=o(r,s);if(typeof s.size==="undefined")s.size=f?3:1;if(f){n=i.split(",");n=e.map(n,function(t){return e.trim(t)})}else n[0]=e.trim(i);setTimeout(function(){e("option",r).each(function(){e(this).attr("role","option");if(e.inArray(e.trim(e(this).text()),n)>-1||e.inArray(e.trim(e(this).val()),n)>-1)this.selected="selected"})},0)}}},s||{}));else if(n.value){var l;if(t){i=r.split(",");i=e.map(i,function(t){return e.trim(t)});if(typeof n.size==="undefined")n.size=3}else n.size=1;if(typeof n.value==="function")n.value=n.value();var c,h;if(typeof n.value==="string"){c=n.value.split(";");for(l=0;l<c.length;l++){h=c[l].split(":");if(h.length>2)h[1]=e.map(h,function(e,t){if(t>0)return e}).join(":");s=document.createElement("option");s.setAttribute("role","option");s.value=h[0];s.innerHTML=h[1];if(!t&&(e.trim(h[0])==e.trim(r)||e.trim(h[1])==e.trim(r)))s.selected="selected";if(t&&(e.inArray(e.trim(h[1]),i)>-1||e.inArray(e.trim(h[0]),i)>-1))s.selected="selected";f.appendChild(s)}}else if(typeof n.value==="object"){c=n.value;for(l in c)if(c.hasOwnProperty(l)){s=document.createElement("option");s.setAttribute("role","option");s.value=l;s.innerHTML=c[l];if(!t&&(e.trim(l)==e.trim(r)||e.trim(c[l])==e.trim(r)))s.selected="selected";if(t&&(e.inArray(e.trim(c[l]),i)>-1||e.inArray(e.trim(l),i)>-1))s.selected="selected";f.appendChild(s)}}u(f,n);n=o(f,n)}break;case"text":case"password":case"button":l=t=="button"?"button":"textbox";f=document.createElement("input");f.type=t;f.value=r;u(f,n);n=o(f,n);if(t!="button")if(i)n.size||e(f).css({width:"98%"});else if(!n.size)n.size=20;e(f).attr("role",l);break;case"image":case"file":f=document.createElement("input");f.type=t;u(f,n);n=o(f,n);break;case"custom":f=document.createElement("span");try{if(e.isFunction(n.custom_element))if(c=n.custom_element.call(this,r,n)){c=e(c).addClass("customelement").attr({id:n.id,name:n.name});e(f).empty().append(c)}else throw"e2";else throw"e1"}catch(p){p=="e1"&&this.info_dialog(e.jgrid.errors.errcap,"function 'custom_element' "+e.jgrid.edit.msg.nodefined,e.jgrid.edit.bClose);p=="e2"?this.info_dialog(e.jgrid.errors.errcap,"function 'custom_element' "+e.jgrid.edit.msg.novalue,e.jgrid.edit.bClose):this.info_dialog(e.jgrid.errors.errcap,typeof p==="string"?p:p.message,e.jgrid.edit.bClose)}}return f},checkDate:function(e,t){var n={},r;e=e.toLowerCase();r=e.indexOf("/")!=-1?"/":e.indexOf("-")!=-1?"-":e.indexOf(".")!=-1?".":"/";e=e.split(r);t=t.split(r);if(t.length!=3)return false;r=-1;for(var i,s=-1,o=-1,u=0;u<e.length;u++){i=isNaN(t[u])?0:parseInt(t[u],10);n[e[u]]=i;i=e[u];if(i.indexOf("y")!=-1)r=u;if(i.indexOf("m")!=-1)o=u;if(i.indexOf("d")!=-1)s=u}i=e[r]=="y"||e[r]=="yyyy"?4:e[r]=="yy"?2:-1;u=function(e){for(var t=1;t<=e;t++){this[t]=31;if(t==4||t==6||t==9||t==11)this[t]=30;if(t==2)this[t]=29}return this}(12);var a;if(r===-1)return false;else{a=n[e[r]].toString();if(i==2&&a.length==1)i=1;if(a.length!=i||n[e[r]]===0&&t[r]!="00")return false}if(o===-1)return false;else{a=n[e[o]].toString();if(a.length<1||n[e[o]]<1||n[e[o]]>12)return false}if(s===-1)return false;else{a=n[e[s]].toString();if(a.length<1||n[e[s]]<1||n[e[s]]>31||n[e[o]]==2&&n[e[s]]>(n[e[r]]%4===0&&(n[e[r]]%100!==0||n[e[r]]%400===0)?29:28)||n[e[s]]>u[n[e[o]]])return false}return true},isEmpty:function(e){return e.match(/^\s+$/)||e===""?true:false},checkTime:function(e){var t=/^(\d{1,2}):(\d{2})([ap]m)?$/;if(!this.isEmpty(e))if(e=e.match(t)){if(e[3]){if(e[1]<1||e[1]>12)return false}else if(e[1]>23)return false;if(e[2]>59)return false}else return false;return true},checkValues:function(t,n,r,i,s){var o,u;if(typeof i==="undefined")if(typeof n=="string"){i=0;for(s=r.p.colModel.length;i<s;i++)if(r.p.colModel[i].name==n){o=r.p.colModel[i].editrules;n=i;try{u=r.p.colModel[i].formoptions.label}catch(f){}break}}else{if(n>=0)o=r.p.colModel[n].editrules}else{o=i;u=s===undefined?"_":s}if(o){u||(u=r.p.colNames[n]);if(o.required===true)if(this.isEmpty(t))return[false,u+": "+e.jgrid.edit.msg.required,""];i=o.required===false?false:true;if(o.number===true)if(!(i===false&&this.isEmpty(t)))if(isNaN(t))return[false,u+": "+e.jgrid.edit.msg.number,""];if(typeof o.minValue!="undefined"&&!isNaN(o.minValue))if(parseFloat(t)<parseFloat(o.minValue))return[false,u+": "+e.jgrid.edit.msg.minValue+" "+o.minValue,""];if(typeof o.maxValue!="undefined"&&!isNaN(o.maxValue))if(parseFloat(t)>parseFloat(o.maxValue))return[false,u+": "+e.jgrid.edit.msg.maxValue+" "+o.maxValue,""];if(o.email===true)if(!(i===false&&this.isEmpty(t))){s=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i;if(!s.test(t))return[false,u+": "+e.jgrid.edit.msg.email,""]}if(o.integer===true)if(!(i===false&&this.isEmpty(t))){if(isNaN(t))return[false,u+": "+e.jgrid.edit.msg.integer,""];if(t%1!==0||t.indexOf(".")!=-1)return[false,u+": "+e.jgrid.edit.msg.integer,""]}if(o.date===true)if(!(i===false&&this.isEmpty(t))){n=r.p.colModel[n].formatoptions&&r.p.colModel[n].formatoptions.newformat?r.p.colModel[n].formatoptions.newformat:r.p.colModel[n].datefmt||"Y-m-d";if(!this.checkDate(n,t))return[false,u+": "+e.jgrid.edit.msg.date+" - "+n,""]}if(o.time===true)if(!(i===false&&this.isEmpty(t)))if(!this.checkTime(t))return[false,u+": "+e.jgrid.edit.msg.date+" - hh:mm (am/pm)",""];if(o.url===true)if(!(i===false&&this.isEmpty(t))){s=/^(((https?)|(ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i;if(!s.test(t))return[false,u+": "+e.jgrid.edit.msg.url,""]}if(o.custom===true)if(!(i===false&&this.isEmpty(t)))if(e.isFunction(o.custom_func)){t=o.custom_func.call(r,t,u);return e.isArray(t)?t:[false,e.jgrid.edit.msg.customarray,""]}else return[false,e.jgrid.edit.msg.customfcheck,""]}return[true,"",""]}})})(jQuery);(function(e){var t=null;e.jgrid.extend({searchGrid:function(t){t=e.extend({recreateFilter:false,drag:true,sField:"searchField",sValue:"searchString",sOper:"searchOper",sFilter:"filters",loadDefaults:true,beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,closeAfterSearch:false,closeAfterReset:false,closeOnEscape:false,multipleSearch:false,multipleGroup:false,top:0,left:0,jqModal:true,modal:false,resize:false,width:450,height:"auto",dataheight:"auto",showQuery:false,errorcheck:true,sopt:null,stringResult:undefined,onClose:null,onSearch:null,onReset:null,toTop:true,overlay:10,columns:[],tmplNames:null,tmplFilters:null,tmplLabel:" Template: ",showOnLoad:false,layer:null},e.jgrid.search,t||{});return this.each(function(){function n(){if(e.isFunction(t.beforeShowSearch)){s=t.beforeShowSearch(e("#"+i));if(typeof s==="undefined")s=true}if(s){e.jgrid.viewModal("#"+o.themodal,{gbox:"#gbox_"+i,jqm:t.jqModal,modal:t.modal,overlay:t.overlay,toTop:t.toTop});e.isFunction(t.afterShowSearch)&&t.afterShowSearch(e("#"+i))}}var r=this;if(r.grid){var i="fbox_"+r.p.id,s=true,o={themodal:"searchmod"+i,modalhead:"searchhd"+i,modalcontent:"searchcnt"+i,scrollelm:i},u=r.p.postData[t.sFilter];if(typeof u==="string")u=e.jgrid.parse(u);t.recreateFilter===true&&e("#"+o.themodal).remove();if(e("#"+o.themodal).html()!==null)n();else{var f=e("<span><div id='"+i+"' class='searchFilter' style='overflow:auto'></div></span>").insertBefore("#gview_"+r.p.id);if(e.isFunction(t.onInitializeSearch))t.onInitializeSearch(e("#"+i));var l=e.extend([],r.p.colModel),c="<a href='javascript:void(0)' id='"+i+"_search' class='fm-button ui-state-default ui-corner-all fm-button-icon-right ui-reset'><span class='ui-icon ui-icon-search'></span>"+t.Find+"</a>",h="<a href='javascript:void(0)' id='"+i+"_reset' class='fm-button ui-state-default ui-corner-all fm-button-icon-left ui-search'><span class='ui-icon ui-icon-arrowreturnthick-1-w'></span>"+t.Reset+"</a>",p="",v="",m,g=false;if(t.showQuery)p="<a href='javascript:void(0)' id='"+i+"_query' class='fm-button ui-state-default ui-corner-all fm-button-icon-left'><span class='ui-icon ui-icon-comment'></span>Query</a>";if(t.columns.length)l=t.columns;else e.each(l,function(e,t){if(!t.label)t.label=r.p.colNames[e];if(!g){var n=typeof t.search==="undefined"?true:t.search,i=t.hidden===true;if(t.searchoptions&&t.searchoptions.searchhidden===true&&n||n&&!i){g=true;m=t.index||t.name}}});if(!u&&m||t.multipleSearch===false)u={groupOp:"AND",rules:[{field:m,op:"eq",data:""}]};g=false;if(t.tmplNames&&t.tmplNames.length){g=true;v=t.tmplLabel;v+="<select class='ui-template'>";v+="<option value='default'>Default</option>";e.each(t.tmplNames,function(e,t){v+="<option value='"+e+"'>"+t+"</option>"});v+="</select>"}c="<table class='EditTable' style='border:0px none;margin-top:5px' id='"+i+"_2'><tbody><tr><td colspan='2'><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr><td class='EditButton' style='text-align:left'>"+h+v+"</td><td class='EditButton'>"+p+c+"</td></tr></tbody></table>";e("#"+i).jqFilter({columns:l,filter:t.loadDefaults?u:null,showQuery:t.showQuery,errorcheck:t.errorcheck,sopt:t.sopt,groupButton:t.multipleGroup,_gridsopt:e.jgrid.search.odata,onChange:function(){this.p.showQuery&&e(".query",this).html(this.toUserFriendlyString())}});f.append(c);g&&t.tmplFilters&&t.tmplFilters.length&&e(".ui-template",f).bind("change",function(){var n=e(this).val();n=="default"?e("#"+i).jqFilter("addFilter",u):e("#"+i).jqFilter("addFilter",t.tmplFilters[parseInt(n,10)]);return false});if(t.multipleSearch===false){e(".add-rule","#"+i).hide();e(".delete-rule","#"+i).hide()}if(e.isFunction(t.onInitializeSearch))t.onInitializeSearch(e("#"+i));t.layer?e.jgrid.createModal(o,f,t,"#gview_"+r.p.id,e("#gbox_"+r.p.id)[0],"#"+t.layer,{position:"relative"}):e.jgrid.createModal(o,f,t,"#gview_"+r.p.id,e("#gbox_"+r.p.id)[0]);p&&e("#"+i+"_query").bind("click",function(){e(".queryresult",f).toggle();return false});if(t.stringResult===undefined)t.stringResult=t.multipleSearch;e("#"+i+"_search").bind("click",function(){var n=e("#"+i),s={},u,f=n.jqFilter("filterData");if(t.errorcheck){n[0].hideError();t.showQuery||n.jqFilter("toSQLString");if(n[0].p.error){n[0].showError();return false}}if(t.stringResult){try{u=xmlJsonClass.toJson(f,"","",false)}catch(l){try{u=JSON.stringify(f)}catch(c){}}if(typeof u==="string"){s[t.sFilter]=u;e.each([t.sField,t.sValue,t.sOper],function(){s[this]=""})}}else if(t.multipleSearch){s[t.sFilter]=f;e.each([t.sField,t.sValue,t.sOper],function(){s[this]=""})}else{s[t.sField]=f.rules[0].field;s[t.sValue]=f.rules[0].data;s[t.sOper]=f.rules[0].op;s[t.sFilter]=""}r.p.search=true;e.extend(r.p.postData,s);if(e.isFunction(t.onSearch))t.onSearch();e(r).trigger("reloadGrid",[{page:1}]);t.closeAfterSearch&&e.jgrid.hideModal("#"+o.themodal,{gb:"#gbox_"+r.p.id,jqm:t.jqModal,onClose:t.onClose});return false});e("#"+i+"_reset").bind("click",function(){var n={},s=e("#"+i);r.p.search=false;if(t.multipleSearch===false)n[t.sField]=n[t.sValue]=n[t.sOper]="";else n[t.sFilter]="";s[0].resetFilter();g&&e(".ui-template",f).val("default");e.extend(r.p.postData,n);if(e.isFunction(t.onReset))t.onReset();e(r).trigger("reloadGrid",[{page:1}]);return false});n();e(".fm-button:not(.ui-state-disabled)",f).hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")})}}})},editGridRow:function(n,r){t=r=e.extend({top:0,left:0,width:300,height:"auto",dataheight:"auto",modal:false,overlay:10,drag:true,resize:true,url:null,mtype:"POST",clearAfterAdd:true,closeAfterEdit:false,reloadAfterSubmit:true,onInitializeForm:null,beforeInitData:null,beforeShowForm:null,afterShowForm:null,beforeSubmit:null,afterSubmit:null,onclickSubmit:null,afterComplete:null,onclickPgButtons:null,afterclickPgButtons:null,editData:{},recreateForm:false,jqModal:true,closeOnEscape:false,addedrow:"first",topinfo:"",bottominfo:"",saveicon:[],closeicon:[],savekey:[false,13],navkeys:[false,38,40],checkOnSubmit:false,checkOnUpdate:false,_savedData:{},processing:false,onClose:null,ajaxEditOptions:{},serializeEditData:null,viewPagerButtons:true},e.jgrid.edit,r||{});return this.each(function(){function s(){e(".FormElement","#"+S).each(function(){var t=e(".customelement",this);if(t.length){var n=e(t[0]).attr("name");e.each(y.p.colModel,function(){if(this.name===n&&this.editoptions&&e.isFunction(this.editoptions.custom_value)){try{M[n]=this.editoptions.custom_value(e("#"+e.jgrid.jqID(n),"#"+S),"get");if(M[n]===undefined)throw"e1"}catch(t){t==="e1"?e.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose):e.jgrid.info_dialog(jQuery.jgrid.errors.errcap,t.message,jQuery.jgrid.edit.bClose)}return true}})}else{switch(e(this).get(0).type){case"checkbox":if(e(this).attr("checked"))M[this.name]=e(this).val();else{t=e(this).attr("offval");M[this.name]=t}break;case"select-one":M[this.name]=e("option:selected",this).val();_[this.name]=e("option:selected",this).text();break;case"select-multiple":M[this.name]=e(this).val();M[this.name]=M[this.name]?M[this.name].join(","):"";var r=[];e("option:selected",this).each(function(t,n){r[t]=e(n).text()});_[this.name]=r.join(",");break;case"password":case"text":case"textarea":case"button":M[this.name]=e(this).val()}if(y.p.autoencode)M[this.name]=e.jgrid.htmlEncode(M[this.name])}});return true}function o(n,r,i,s){var o,u,f,l=0,h,p,d,v=[],m=false,g="",b;for(b=1;b<=s;b++)g+="<td class='CaptionTD'>&#160;</td><td class='DataTD'>&#160;</td>";if(n!="_empty")m=e(r).jqGrid("getInd",n);e(r.p.colModel).each(function(b){o=this.name;p=(u=this.editrules&&this.editrules.edithidden===true?false:this.hidden===true?true:false)?"style='display:none'":"";if(o!=="cb"&&o!=="subgrid"&&this.editable===true&&o!=="rn"){if(m===false)h="";else if(o==r.p.ExpandColumn&&r.p.treeGrid===true)h=e("td:eq("+b+")",r.rows[m]).text();else try{h=e.unformat(e("td:eq("+b+")",r.rows[m]),{rowId:n,colModel:this},b)}catch(w){h=e("td:eq("+b+")",r.rows[m]).text()}var E=e.extend({},this.editoptions||{},{id:o,name:o}),S=e.extend({},{elmprefix:"",elmsuffix:"",rowabove:false,rowcontent:""},this.formoptions||{}),x=parseInt(S.rowpos,10)||l+1,T=parseInt((parseInt(S.colpos,10)||1)*2,10);if(n=="_empty"&&E.defaultValue)h=e.isFunction(E.defaultValue)?E.defaultValue():E.defaultValue;if(!this.edittype)this.edittype="text";if(y.p.autoencode)h=e.jgrid.htmlDecode(h);d=e.jgrid.createEl(this.edittype,E,h,false,e.extend({},e.jgrid.ajaxOptions,r.p.ajaxSelectOptions||{}));if(h===""&&this.edittype=="checkbox")h=e(d).attr("offval");if(h===""&&this.edittype=="select")h=e("option:eq(0)",d).text();if(t.checkOnSubmit||t.checkOnUpdate)t._savedData[o]=h;e(d).addClass("FormElement");if(this.edittype=="text"||this.edittype=="textarea")e(d).addClass("ui-widget-content ui-corner-all");f=e(i).find("tr[rowpos="+x+"]");if(S.rowabove){E=e("<tr><td class='contentinfo' colspan='"+s*2+"'>"+S.rowcontent+"</td></tr>");e(i).append(E);E[0].rp=x}if(f.length===0){f=e("<tr "+p+" rowpos='"+x+"'></tr>").addClass("FormData").attr("id","tr_"+o);e(f).append(g);e(i).append(f);f[0].rp=x}e("td:eq("+(T-2)+")",f[0]).html(typeof S.label==="undefined"?r.p.colNames[b]:S.label);e("td:eq("+(T-1)+")",f[0]).append(S.elmprefix).append(d).append(S.elmsuffix);v[l]=b;l++}});if(l>0){b=e("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(s*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='"+r.p.id+"_id' value='"+n+"'/></td></tr>");b[0].rp=l+999;e(i).append(b);if(t.checkOnSubmit||t.checkOnUpdate)t._savedData[r.p.id+"_id"]=n}return v}function u(n,r,i){var s,o=0,u,f,l,h,p;if(t.checkOnSubmit||t.checkOnUpdate){t._savedData={};t._savedData[r.p.id+"_id"]=n}var d=r.p.colModel;if(n=="_empty"){e(d).each(function(){s=this.name;l=e.extend({},this.editoptions||{});if((f=e("#"+e.jgrid.jqID(s),"#"+i))&&f[0]!==null){h="";if(l.defaultValue){h=e.isFunction(l.defaultValue)?l.defaultValue():l.defaultValue;if(f[0].type=="checkbox"){p=h.toLowerCase();if(p.search(/(false|0|no|off|undefined)/i)<0&&p!==""){f[0].checked=true;f[0].defaultChecked=true;f[0].value=h}else f.attr({checked:"",defaultChecked:""})}else f.val(h)}else if(f[0].type=="checkbox"){f[0].checked=false;f[0].defaultChecked=false;h=e(f).attr("offval")}else if(f[0].type&&f[0].type.substr(0,6)=="select")f[0].selectedIndex=0;else f.val(h);if(t.checkOnSubmit===true||t.checkOnUpdate)t._savedData[s]=h}});e("#id_g","#"+i).val(n)}else{var v=e(r).jqGrid("getInd",n,true);if(v){e("td",v).each(function(f){s=d[f].name;if(s!=="cb"&&s!=="subgrid"&&s!=="rn"&&d[f].editable===true){if(s==r.p.ExpandColumn&&r.p.treeGrid===true)u=e(this).text();else try{u=e.unformat(e(this),{rowId:n,colModel:d[f]},f)}catch(l){u=e(this).text()}if(y.p.autoencode)u=e.jgrid.htmlDecode(u);if(t.checkOnSubmit===true||t.checkOnUpdate)t._savedData[s]=u;s=e.jgrid.jqID(s);switch(d[f].edittype){case"password":case"text":case"button":case"image":e("#"+s,"#"+i).val(u);break;case"textarea":if(u=="&nbsp;"||u=="&#160;"||u.length==1&&u.charCodeAt(0)==160)u="";e("#"+s,"#"+i).val(u);break;case"select":var h=u.split(",");h=e.map(h,function(t){return e.trim(t)});e("#"+s+" option","#"+i).each(function(){this.selected=!d[f].editoptions.multiple&&(h[0]==e.trim(e(this).text())||h[0]==e.trim(e(this).val()))?true:d[f].editoptions.multiple?e.inArray(e.trim(e(this).text()),h)>-1||e.inArray(e.trim(e(this).val()),h)>-1?true:false:false});break;case"checkbox":u+="";if(d[f].editoptions&&d[f].editoptions.value)if(d[f].editoptions.value.split(":")[0]==u){e("#"+s,"#"+i).attr("checked",true);e("#"+s,"#"+i).attr("defaultChecked",true)}else{e("#"+s,"#"+i).attr("checked",false);e("#"+s,"#"+i).attr("defaultChecked","")}else{u=u.toLowerCase();if(u.search(/(false|0|no|off|undefined)/i)<0&&u!==""){e("#"+s,"#"+i).attr("checked",true);e("#"+s,"#"+i).attr("defaultChecked",true)}else{e("#"+s,"#"+i).attr("checked",false);e("#"+s,"#"+i).attr("defaultChecked","")}}break;case"custom":try{if(d[f].editoptions&&e.isFunction(d[f].editoptions.custom_value))d[f].editoptions.custom_value(e("#"+s,"#"+i),"set",u);else throw"e1"}catch(p){p=="e1"?e.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose):e.jgrid.info_dialog(jQuery.jgrid.errors.errcap,p.message,jQuery.jgrid.edit.bClose)}}o++}});o>0&&e("#id_g","#"+S).val(n)}}}function f(){var n,s=[true,"",""],o={},f=y.p.prmNames,l,h,p,d;if(e.isFunction(t.beforeCheckValues)){var v=t.beforeCheckValues(M,e("#"+E),M[y.p.id+"_id"]=="_empty"?f.addoper:f.editoper);if(v&&typeof v==="object")M=v}for(p in M)if(M.hasOwnProperty(p)){s=e.jgrid.checkValues(M[p],p,y);if(s[0]===false)break}if(s[0]){if(e.isFunction(t.onclickSubmit))o=t.onclickSubmit(t,M)||{};if(e.isFunction(t.beforeSubmit))s=t.beforeSubmit(M,e("#"+E))}if(s[0]&&!t.processing){t.processing=true;e("#sData","#"+S+"_2").addClass("ui-state-active");h=f.oper;l=f.id;M[h]=e.trim(M[y.p.id+"_id"])=="_empty"?f.addoper:f.editoper;if(M[h]!=f.addoper)M[l]=M[y.p.id+"_id"];else if(M[l]===undefined)M[l]=M[y.p.id+"_id"];delete M[y.p.id+"_id"];M=e.extend(M,t.editData,o);if(y.p.treeGrid===true){if(M[h]==f.addoper){d=e(y).jqGrid("getGridParam","selrow");M[y.p.treeGridModel=="adjacency"?y.p.treeReader.parent_id_field:"parent_id"]=d}for(i in y.p.treeReader){o=y.p.treeReader[i];if(M.hasOwnProperty(o))M[h]==f.addoper&&i==="parent_id_field"||delete M[o]}}o=e.extend({url:t.url?t.url:e(y).jqGrid("getGridParam","editurl"),type:t.mtype,data:e.isFunction(t.serializeEditData)?t.serializeEditData(M):M,complete:function(i,o){if(o!="success"){s[0]=false;s[1]=e.isFunction(t.errorTextFormat)?t.errorTextFormat(i):o+" Status: '"+i.statusText+"'. Error code: "+i.status}else if(e.isFunction(t.afterSubmit))s=t.afterSubmit(i,M);if(s[0]===false){e("#FormError>td","#"+S).html(s[1]);e("#FormError","#"+S).show()}else{e.each(y.p.colModel,function(){if(_[this.name]&&this.formatter&&this.formatter=="select")try{delete _[this.name]}catch(e){}});M=e.extend(M,_);y.p.autoencode&&e.each(M,function(t,n){M[t]=e.jgrid.htmlDecode(n)});t.reloadAfterSubmit=t.reloadAfterSubmit&&y.p.datatype!="local";if(M[h]==f.addoper){s[2]||(s[2]=e.jgrid.randId());M[l]=s[2];if(t.closeAfterAdd){if(t.reloadAfterSubmit)e(y).trigger("reloadGrid");else if(y.p.treeGrid===true)e(y).jqGrid("addChildNode",s[2],d,M);else{e(y).jqGrid("addRowData",s[2],M,r.addedrow);e(y).jqGrid("setSelection",s[2])}e.jgrid.hideModal("#"+x.themodal,{gb:"#gbox_"+w,jqm:r.jqModal,onClose:t.onClose})}else if(t.clearAfterAdd){if(t.reloadAfterSubmit)e(y).trigger("reloadGrid");else y.p.treeGrid===true?e(y).jqGrid("addChildNode",s[2],d,M):e(y).jqGrid("addRowData",s[2],M,r.addedrow);u("_empty",y,E)}else if(t.reloadAfterSubmit)e(y).trigger("reloadGrid");else y.p.treeGrid===true?e(y).jqGrid("addChildNode",s[2],d,M):e(y).jqGrid("addRowData",s[2],M,r.addedrow)}else{if(t.reloadAfterSubmit){e(y).trigger("reloadGrid");t.closeAfterEdit||setTimeout(function(){e(y).jqGrid("setSelection",M[l])},1e3)}else y.p.treeGrid===true?e(y).jqGrid("setTreeRow",M[l],M):e(y).jqGrid("setRowData",M[l],M);t.closeAfterEdit&&e.jgrid.hideModal("#"+x.themodal,{gb:"#gbox_"+w,jqm:r.jqModal,onClose:t.onClose})}if(e.isFunction(t.afterComplete)){n=i;setTimeout(function(){t.afterComplete(n,M,e("#"+E));n=null},500)}if(t.checkOnSubmit||t.checkOnUpdate){e("#"+E).data("disabled",false);if(t._savedData[y.p.id+"_id"]!="_empty")for(var p in t._savedData)if(M[p])t._savedData[p]=M[p]}}t.processing=false;e("#sData","#"+S+"_2").removeClass("ui-state-active");try{e(":input:visible","#"+E)[0].focus()}catch(v){}}},e.jgrid.ajaxOptions,t.ajaxEditOptions);if(!o.url&&!t.useDataProxy)if(e.isFunction(y.p.dataProxy))t.useDataProxy=true;else{s[0]=false;s[1]+=" "+e.jgrid.errors.nourl}if(s[0])t.useDataProxy?y.p.dataProxy.call(y,o,"set_"+y.p.id):e.ajax(o)}if(s[0]===false){e("#FormError>td","#"+S).html(s[1]);e("#FormError","#"+S).show()}}function l(e,t){var n=false,r;for(r in e)if(e[r]!=t[r]){n=true;break}return n}function h(){e.each(y.p.colModel,function(e,t){if(t.editoptions&&t.editoptions.NullIfEmpty===true)if(M.hasOwnProperty(t.name)&&M[t.name]=="")M[t.name]="null"})}function p(){var n=true;e("#FormError","#"+S).hide();if(t.checkOnUpdate){M={};_={};s();D=e.extend({},M,_);if(P=l(D,t._savedData)){e("#"+E).data("disabled",true);e(".confirm","#"+x.themodal).show();n=false}else h()}return n}function v(){if(n!=="_empty"&&typeof y.p.savedRow!=="undefined"&&y.p.savedRow.length>0&&e.isFunction(e.fn.jqGrid.restoreRow))for(var t=0;t<y.p.savedRow.length;t++)if(y.p.savedRow[t].id==n){e(y).jqGrid("restoreRow",n);break}}function m(t,n){t===0?e("#pData","#"+S+"_2").addClass("ui-state-disabled"):e("#pData","#"+S+"_2").removeClass("ui-state-disabled");t==n?e("#nData","#"+S+"_2").addClass("ui-state-disabled"):e("#nData","#"+S+"_2").removeClass("ui-state-disabled")}function g(){var t=e(y).jqGrid("getDataIDs"),n=e("#id_g","#"+S).val();return[e.inArray(n,t),t]}var y=this;if(y.grid&&n){var w=y.p.id,E="FrmGrid_"+w,S="TblGrid_"+w,x={themodal:"editmod"+w,modalhead:"edithd"+w,modalcontent:"editcnt"+w,scrollelm:E},T=e.isFunction(t.beforeShowForm)?t.beforeShowForm:false,N=e.isFunction(t.afterShowForm)?t.afterShowForm:false,C=e.isFunction(t.beforeInitData)?t.beforeInitData:false,k=e.isFunction(t.onInitializeForm)?t.onInitializeForm:false,L=true,A=1,O=0,M,_,D,P;if(n==="new"){n="_empty";r.caption=t.addCaption}else r.caption=t.editCaption;r.recreateForm===true&&e("#"+x.themodal).html()!==null&&e("#"+x.themodal).remove();var H=true;if(r.checkOnUpdate&&r.jqModal&&!r.modal)H=false;if(e("#"+x.themodal).html()!==null){if(C){L=C(e("#"+E));if(typeof L=="undefined")L=true}if(L===false)return;v();e(".ui-jqdialog-title","#"+x.modalhead).html(r.caption);e("#FormError","#"+S).hide();if(t.topinfo){e(".topinfo","#"+S+"_2").html(t.topinfo);e(".tinfo","#"+S+"_2").show()}else e(".tinfo","#"+S+"_2").hide();if(t.bottominfo){e(".bottominfo","#"+S+"_2").html(t.bottominfo);e(".binfo","#"+S+"_2").show()}else e(".binfo","#"+S+"_2").hide();u(n,y,E);n=="_empty"||!t.viewPagerButtons?e("#pData, #nData","#"+S+"_2").hide():e("#pData, #nData","#"+S+"_2").show();if(t.processing===true){t.processing=false;e("#sData","#"+S+"_2").removeClass("ui-state-active")}if(e("#"+E).data("disabled")===true){e(".confirm","#"+x.themodal).hide();e("#"+E).data("disabled",false)}T&&T(e("#"+E));e("#"+x.themodal).data("onClose",t.onClose);e.jgrid.viewModal("#"+x.themodal,{gbox:"#gbox_"+w,jqm:r.jqModal,jqM:false,overlay:r.overlay,modal:r.modal});H||e(".jqmOverlay").click(function(){if(!p())return false;e.jgrid.hideModal("#"+x.themodal,{gb:"#gbox_"+w,jqm:r.jqModal,onClose:t.onClose});return false});N&&N(e("#"+E))}else{var B=isNaN(r.dataheight)?r.dataheight:r.dataheight+"px";B=e("<form name='FormPost' id='"+E+"' class='FormGrid' onSubmit='return false;' style='width:100%;overflow:auto;position:relative;height:"+B+";'></form>").data("disabled",false);var j=e("<table id='"+S+"' class='EditTable' cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>");if(C){L=C(e("#"+E));if(typeof L=="undefined")L=true}if(L===false)return;v();e(y.p.colModel).each(function(){var e=this.formoptions;A=Math.max(A,e?e.colpos||0:0);O=Math.max(O,e?e.rowpos||0:0)});e(B).append(j);C=e("<tr id='FormError' style='display:none'><td class='ui-state-error' colspan='"+A*2+"'></td></tr>");C[0].rp=0;e(j).append(C);C=e("<tr style='display:none' class='tinfo'><td class='topinfo' colspan='"+A*2+"'>"+t.topinfo+"</td></tr>");C[0].rp=0;e(j).append(C);L=(C=y.p.direction=="rtl"?true:false)?"nData":"pData";var F=C?"pData":"nData";o(n,y,j,A);L="<a href='javascript:void(0)' id='"+L+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></div>";F="<a href='javascript:void(0)' id='"+F+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></div>";var I="<a href='javascript:void(0)' id='sData' class='fm-button ui-state-default ui-corner-all'>"+r.bSubmit+"</a>",q="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+r.bCancel+"</a>";L="<table border='0' cellspacing='0' cellpadding='0' class='EditTable' id='"+S+"_2'><tbody><tr><td colspan='2'><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr id='Act_Buttons'><td class='navButton'>"+(C?F+L:L+F)+"</td><td class='EditButton'>"+I+q+"</td></tr>";L+="<tr style='display:none' class='binfo'><td class='bottominfo' colspan='2'>"+t.bottominfo+"</td></tr>";L+="</tbody></table>";if(O>0){var R=[];e.each(e(j)[0].rows,function(e,t){R[e]=t});R.sort(function(e,t){if(e.rp>t.rp)return 1;if(e.rp<t.rp)return-1;return 0});e.each(R,function(t,n){e("tbody",j).append(n)})}r.gbox="#gbox_"+w;var U=false;if(r.closeOnEscape===true){r.closeOnEscape=false;U=true}B=e("<span></span>").append(B).append(L);e.jgrid.createModal(x,B,r,"#gview_"+y.p.id,e("#gbox_"+y.p.id)[0]);if(C){e("#pData, #nData","#"+S+"_2").css("float","right");e(".EditButton","#"+S+"_2").css("text-align","left")}t.topinfo&&e(".tinfo","#"+S+"_2").show();t.bottominfo&&e(".binfo","#"+S+"_2").show();L=B=null;e("#"+x.themodal).keydown(function(n){var i=n.target;if(e("#"+E).data("disabled")===true)return false;if(t.savekey[0]===true&&n.which==t.savekey[1])if(i.tagName!="TEXTAREA"){e("#sData","#"+S+"_2").trigger("click");return false}if(n.which===27){if(!p())return false;U&&e.jgrid.hideModal(this,{gb:r.gbox,jqm:r.jqModal,onClose:t.onClose});return false}if(t.navkeys[0]===true){if(e("#id_g","#"+S).val()=="_empty")return true;if(n.which==t.navkeys[1]){e("#pData","#"+S+"_2").trigger("click");return false}if(n.which==t.navkeys[2]){e("#nData","#"+S+"_2").trigger("click");return false}}});if(r.checkOnUpdate){e("a.ui-jqdialog-titlebar-close span","#"+x.themodal).removeClass("jqmClose");e("a.ui-jqdialog-titlebar-close","#"+x.themodal).unbind("click").click(function(){if(!p())return false;e.jgrid.hideModal("#"+x.themodal,{gb:"#gbox_"+w,jqm:r.jqModal,onClose:t.onClose});return false})}r.saveicon=e.extend([true,"left","ui-icon-disk"],r.saveicon);r.closeicon=e.extend([true,"left","ui-icon-close"],r.closeicon);if(r.saveicon[0]===true)e("#sData","#"+S+"_2").addClass(r.saveicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+r.saveicon[2]+"'></span>");if(r.closeicon[0]===true)e("#cData","#"+S+"_2").addClass(r.closeicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+r.closeicon[2]+"'></span>");if(t.checkOnSubmit||t.checkOnUpdate){I="<a href='javascript:void(0)' id='sNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+r.bYes+"</a>";F="<a href='javascript:void(0)' id='nNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+r.bNo+"</a>";q="<a href='javascript:void(0)' id='cNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+r.bExit+"</a>";B=r.zIndex||999;B++;e("<div class='ui-widget-overlay jqgrid-overlay confirm' style='z-index:"+B+";display:none;'>&#160;"+(e.browser.msie&&e.browser.version==6?'<iframe style="display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=\'0\');" src="javascript:false;"></iframe>':"")+"</div><div class='confirm ui-widget-content ui-jqconfirm' style='z-index:"+(B+1)+"'>"+r.saveData+"<br/><br/>"+I+F+q+"</div>").insertAfter("#"+E);e("#sNew","#"+x.themodal).click(function(){f();e("#"+E).data("disabled",false);e(".confirm","#"+x.themodal).hide();return false});e("#nNew","#"+x.themodal).click(function(){e(".confirm","#"+x.themodal).hide();e("#"+E).data("disabled",false);setTimeout(function(){e(":input","#"+E)[0].focus()},0);return false});e("#cNew","#"+x.themodal).click(function(){e(".confirm","#"+x.themodal).hide();e("#"+E).data("disabled",false);e.jgrid.hideModal("#"+x.themodal,{gb:"#gbox_"+w,jqm:r.jqModal,onClose:t.onClose});return false})}k&&k(e("#"+E));n=="_empty"||!t.viewPagerButtons?e("#pData,#nData","#"+S+"_2").hide():e("#pData,#nData","#"+S+"_2").show();T&&T(e("#"+E));e("#"+x.themodal).data("onClose",t.onClose);e.jgrid.viewModal("#"+x.themodal,{gbox:"#gbox_"+w,jqm:r.jqModal,overlay:r.overlay,modal:r.modal});H||e(".jqmOverlay").click(function(){if(!p())return false;e.jgrid.hideModal("#"+x.themodal,{gb:"#gbox_"+w,jqm:r.jqModal,onClose:t.onClose});return false});N&&N(e("#"+E));e(".fm-button","#"+x.themodal).hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")});e("#sData","#"+S+"_2").click(function(){M={};_={};e("#FormError","#"+S).hide();s();h();if(M[y.p.id+"_id"]=="_empty")f();else if(r.checkOnSubmit===true){D=e.extend({},M,_);if(P=l(D,t._savedData)){e("#"+E).data("disabled",true);e(".confirm","#"+x.themodal).show()}else f()}else f();return false});e("#cData","#"+S+"_2").click(function(){if(!p())return false;e.jgrid.hideModal("#"+x.themodal,{gb:"#gbox_"+w,jqm:r.jqModal,onClose:t.onClose});return false});e("#nData","#"+S+"_2").click(function(){if(!p())return false;e("#FormError","#"+S).hide();var t=g();t[0]=parseInt(t[0],10);if(t[0]!=-1&&t[1][t[0]+1]){if(e.isFunction(r.onclickPgButtons))r.onclickPgButtons("next",e("#"+E),t[1][t[0]]);u(t[1][t[0]+1],y,E);e(y).jqGrid("setSelection",t[1][t[0]+1]);e.isFunction(r.afterclickPgButtons)&&r.afterclickPgButtons("next",e("#"+E),t[1][t[0]+1]);m(t[0]+1,t[1].length-1)}return false});e("#pData","#"+S+"_2").click(function(){if(!p())return false;e("#FormError","#"+S).hide();var t=g();if(t[0]!=-1&&t[1][t[0]-1]){if(e.isFunction(r.onclickPgButtons))r.onclickPgButtons("prev",e("#"+E),t[1][t[0]]);u(t[1][t[0]-1],y,E);e(y).jqGrid("setSelection",t[1][t[0]-1]);e.isFunction(r.afterclickPgButtons)&&r.afterclickPgButtons("prev",e("#"+E),t[1][t[0]-1]);m(t[0]-1,t[1].length-1)}return false})}T=g();m(T[0],T[1].length-1)}})},viewGridRow:function(t,n){n=e.extend({top:0,left:0,width:0,height:"auto",dataheight:"auto",modal:false,overlay:10,drag:true,resize:true,jqModal:true,closeOnEscape:false,labelswidth:"30%",closeicon:[],navkeys:[false,38,40],onClose:null,beforeShowForm:null,beforeInitData:null,viewPagerButtons:true},e.jgrid.view,n||{});return this.each(function(){function r(){if(n.closeOnEscape===true||n.navkeys[0]===true)setTimeout(function(){e(".ui-jqdialog-titlebar-close","#"+p.modalhead).focus()},0)}function i(t,r,i,s){for(var o,u,f,l=0,c,h,p=[],d=false,v="<td class='CaptionTD form-view-label ui-widget-content' width='"+n.labelswidth+"'>&#160;</td><td class='DataTD form-view-data ui-helper-reset ui-widget-content'>&#160;</td>",m="",g=["integer","number","currency"],y=0,w=0,E,S,x,T=1;T<=s;T++)m+=T==1?v:"<td class='CaptionTD form-view-label ui-widget-content'>&#160;</td><td class='DataTD form-view-data ui-widget-content'>&#160;</td>";e(r.p.colModel).each(function(){u=this.editrules&&this.editrules.edithidden===true?false:this.hidden===true?true:false;if(!u&&this.align==="right")if(this.formatter&&e.inArray(this.formatter,g)!==-1)y=Math.max(y,parseInt(this.width,10));else w=Math.max(w,parseInt(this.width,10))});E=y!==0?y:w!==0?w:0;d=e(r).jqGrid("getInd",t);e(r.p.colModel).each(function(t){o=this.name;S=false;h=(u=this.editrules&&this.editrules.edithidden===true?false:this.hidden===true?true:false)?"style='display:none'":"";x=typeof this.viewable!="boolean"?true:this.viewable;if(o!=="cb"&&o!=="subgrid"&&o!=="rn"&&x){c=d===false?"":o==r.p.ExpandColumn&&r.p.treeGrid===true?e("td:eq("+t+")",r.rows[d]).text():e("td:eq("+t+")",r.rows[d]).html();S=this.align==="right"&&E!==0?true:false;e.extend({},this.editoptions||{},{id:o,name:o});var n=e.extend({},{rowabove:false,rowcontent:""},this.formoptions||{}),v=parseInt(n.rowpos,10)||l+1,g=parseInt((parseInt(n.colpos,10)||1)*2,10);if(n.rowabove){var y=e("<tr><td class='contentinfo' colspan='"+s*2+"'>"+n.rowcontent+"</td></tr>");e(i).append(y);y[0].rp=v}f=e(i).find("tr[rowpos="+v+"]");if(f.length===0){f=e("<tr "+h+" rowpos='"+v+"'></tr>").addClass("FormData").attr("id","trv_"+o);e(f).append(m);e(i).append(f);f[0].rp=v}e("td:eq("+(g-2)+")",f[0]).html("<b>"+(typeof n.label==="undefined"?r.p.colNames[t]:n.label)+"</b>");e("td:eq("+(g-1)+")",f[0]).append("<span>"+c+"</span>").attr("id","v_"+o);S&&e("td:eq("+(g-1)+") span",f[0]).css({"text-align":"right",width:E+"px"});p[l]=t;l++}});if(l>0){t=e("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(s*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='id' value='"+t+"'/></td></tr>");t[0].rp=l+99;e(i).append(t)}return p}function s(t,n){var r,i,s=0,o,u;if(u=e(n).jqGrid("getInd",t,true)){e("td",u).each(function(t){r=n.p.colModel[t].name;i=n.p.colModel[t].editrules&&n.p.colModel[t].editrules.edithidden===true?false:n.p.colModel[t].hidden===true?true:false;if(r!=="cb"&&r!=="subgrid"&&r!=="rn"){o=r==n.p.ExpandColumn&&n.p.treeGrid===true?e(this).text():e(this).html();e.extend({},n.p.colModel[t].editoptions||{});r=e.jgrid.jqID("v_"+r);e("#"+r+" span","#"+h).html(o);i&&e("#"+r,"#"+h).parents("tr:first").hide();s++}});s>0&&e("#id_g","#"+h).val(t)}}function o(t,n){t===0?e("#pData","#"+h+"_2").addClass("ui-state-disabled"):e("#pData","#"+h+"_2").removeClass("ui-state-disabled");t==n?e("#nData","#"+h+"_2").addClass("ui-state-disabled"):e("#nData","#"+h+"_2").removeClass("ui-state-disabled")}function u(){var t=e(f).jqGrid("getDataIDs"),n=e("#id_g","#"+h).val();return[e.inArray(n,t),t]}var f=this;if(f.grid&&t){if(!n.imgpath)n.imgpath=f.p.imgpath;var l=f.p.id,c="ViewGrid_"+l,h="ViewTbl_"+l,p={themodal:"viewmod"+l,modalhead:"viewhd"+l,modalcontent:"viewcnt"+l,scrollelm:c},v=e.isFunction(n.beforeInitData)?n.beforeInitData:false,m=true,g=1,y=0;if(e("#"+p.themodal).html()!==null){if(v){m=v(e("#"+c));if(typeof m=="undefined")m=true}if(m===false)return;e(".ui-jqdialog-title","#"+p.modalhead).html(n.caption);e("#FormError","#"+h).hide();s(t,f);e.isFunction(n.beforeShowForm)&&n.beforeShowForm(e("#"+c));e.jgrid.viewModal("#"+p.themodal,{gbox:"#gbox_"+l,jqm:n.jqModal,jqM:false,overlay:n.overlay,modal:n.modal});r()}else{var w=isNaN(n.dataheight)?n.dataheight:n.dataheight+"px";w=e("<form name='FormPost' id='"+c+"' class='FormGrid' style='width:100%;overflow:auto;position:relative;height:"+w+";'></form>");var E=e("<table id='"+h+"' class='EditTable' cellspacing='1' cellpadding='2' border='0' style='table-layout:fixed'><tbody></tbody></table>");if(v){m=v(e("#"+c));if(typeof m=="undefined")m=true}if(m===false)return;e(f.p.colModel).each(function(){var e=this.formoptions;g=Math.max(g,e?e.colpos||0:0);y=Math.max(y,e?e.rowpos||0:0)});e(w).append(E);i(t,f,E,g);v=f.p.direction=="rtl"?true:false;m="<a href='javascript:void(0)' id='"+(v?"nData":"pData")+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></a>";var S="<a href='javascript:void(0)' id='"+(v?"pData":"nData")+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></a>",x="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+n.bClose+"</a>";if(y>0){var T=[];e.each(e(E)[0].rows,function(e,t){T[e]=t});T.sort(function(e,t){if(e.rp>t.rp)return 1;if(e.rp<t.rp)return-1;return 0});e.each(T,function(t,n){e("tbody",E).append(n)})}n.gbox="#gbox_"+l;var N=false;if(n.closeOnEscape===true){n.closeOnEscape=false;N=true}w=e("<span></span>").append(w).append("<table border='0' class='EditTable' id='"+h+"_2'><tbody><tr id='Act_Buttons'><td class='navButton' width='"+n.labelswidth+"'>"+(v?S+m:m+S)+"</td><td class='EditButton'>"+x+"</td></tr></tbody></table>");e.jgrid.createModal(p,w,n,"#gview_"+f.p.id,e("#gview_"+f.p.id)[0]);if(v){e("#pData, #nData","#"+h+"_2").css("float","right");e(".EditButton","#"+h+"_2").css("text-align","left")}n.viewPagerButtons||e("#pData, #nData","#"+h+"_2").hide();w=null;e("#"+p.themodal).keydown(function(t){if(t.which===27){N&&e.jgrid.hideModal(this,{gb:n.gbox,jqm:n.jqModal,onClose:n.onClose});return false}if(n.navkeys[0]===true){if(t.which===n.navkeys[1]){e("#pData","#"+h+"_2").trigger("click");return false}if(t.which===n.navkeys[2]){e("#nData","#"+h+"_2").trigger("click");return false}}});n.closeicon=e.extend([true,"left","ui-icon-close"],n.closeicon);if(n.closeicon[0]===true)e("#cData","#"+h+"_2").addClass(n.closeicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+n.closeicon[2]+"'></span>");e.isFunction(n.beforeShowForm)&&n.beforeShowForm(e("#"+c));e.jgrid.viewModal("#"+p.themodal,{gbox:"#gbox_"+l,jqm:n.jqModal,modal:n.modal});e(".fm-button:not(.ui-state-disabled)","#"+h+"_2").hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")});r();e("#cData","#"+h+"_2").click(function(){e.jgrid.hideModal("#"+p.themodal,{gb:"#gbox_"+l,jqm:n.jqModal,onClose:n.onClose});return false});e("#nData","#"+h+"_2").click(function(){e("#FormError","#"+h).hide();var t=u();t[0]=parseInt(t[0],10);if(t[0]!=-1&&t[1][t[0]+1]){if(e.isFunction(n.onclickPgButtons))n.onclickPgButtons("next",e("#"+c),t[1][t[0]]);s(t[1][t[0]+1],f);e(f).jqGrid("setSelection",t[1][t[0]+1]);e.isFunction(n.afterclickPgButtons)&&n.afterclickPgButtons("next",e("#"+c),t[1][t[0]+1]);o(t[0]+1,t[1].length-1)}r();return false});e("#pData","#"+h+"_2").click(function(){e("#FormError","#"+h).hide();var t=u();if(t[0]!=-1&&t[1][t[0]-1]){if(e.isFunction(n.onclickPgButtons))n.onclickPgButtons("prev",e("#"+c),t[1][t[0]]);s(t[1][t[0]-1],f);e(f).jqGrid("setSelection",t[1][t[0]-1]);e.isFunction(n.afterclickPgButtons)&&n.afterclickPgButtons("prev",e("#"+c),t[1][t[0]-1]);o(t[0]-1,t[1].length-1)}r();return false})}w=u();o(w[0],w[1].length-1)}})},delGridRow:function(n,r){t=r=e.extend({top:0,left:0,width:240,height:"auto",dataheight:"auto",modal:false,overlay:10,drag:true,resize:true,url:"",mtype:"POST",reloadAfterSubmit:true,beforeShowForm:null,beforeInitData:null,afterShowForm:null,beforeSubmit:null,onclickSubmit:null,afterSubmit:null,jqModal:true,closeOnEscape:false,delData:{},delicon:[],cancelicon:[],onClose:null,ajaxDelOptions:{},processing:false,serializeDelData:null,useDataProxy:false},e.jgrid.del,r||{});return this.each(function(){var i=this;if(i.grid)if(n){var s=typeof r.beforeShowForm==="function"?true:false,o=typeof r.afterShowForm==="function"?true:false,u=e.isFunction(r.beforeInitData)?r.beforeInitData:false,f=i.p.id,l={},h=true,p="DelTbl_"+f,v,m,g,y,w={themodal:"delmod"+f,modalhead:"delhd"+f,modalcontent:"delcnt"+f,scrollelm:p};if(jQuery.isArray(n))n=n.join();if(e("#"+w.themodal).html()!==null){if(u){h=u(e("#"+p));if(typeof h=="undefined")h=true}if(h===false)return;e("#DelData>td","#"+p).text(n);e("#DelError","#"+p).hide();if(t.processing===true){t.processing=false;e("#dData","#"+p).removeClass("ui-state-active")}s&&r.beforeShowForm(e("#"+p));e.jgrid.viewModal("#"+w.themodal,{gbox:"#gbox_"+f,jqm:r.jqModal,jqM:false,overlay:r.overlay,modal:r.modal})}else{var E=isNaN(r.dataheight)?r.dataheight:r.dataheight+"px";E="<div id='"+p+"' class='formdata' style='width:100%;overflow:auto;position:relative;height:"+E+";'>";E+="<table class='DelTable'><tbody>";E+="<tr id='DelError' style='display:none'><td class='ui-state-error'></td></tr>";E+="<tr id='DelData' style='display:none'><td >"+n+"</td></tr>";E+='<tr><td class="delmsg" style="white-space:pre;">'+r.msg+"</td></tr><tr><td >&#160;</td></tr>";E+="</tbody></table></div>";E+="<table cellspacing='0' cellpadding='0' border='0' class='EditTable' id='"+p+"_2'><tbody><tr><td><hr class='ui-widget-content' style='margin:1px'/></td></tr></tr><tr><td class='DelButton EditButton'>"+("<a href='javascript:void(0)' id='dData' class='fm-button ui-state-default ui-corner-all'>"+r.bSubmit+"</a>")+"&#160;"+("<a href='javascript:void(0)' id='eData' class='fm-button ui-state-default ui-corner-all'>"+r.bCancel+"</a>")+"</td></tr></tbody></table>";r.gbox="#gbox_"+f;e.jgrid.createModal(w,E,r,"#gview_"+i.p.id,e("#gview_"+i.p.id)[0]);if(u){h=u(e("#"+p));if(typeof h=="undefined")h=true}if(h===false)return;e(".fm-button","#"+p+"_2").hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")});r.delicon=e.extend([true,"left","ui-icon-scissors"],r.delicon);r.cancelicon=e.extend([true,"left","ui-icon-cancel"],r.cancelicon);if(r.delicon[0]===true)e("#dData","#"+p+"_2").addClass(r.delicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+r.delicon[2]+"'></span>");if(r.cancelicon[0]===true)e("#eData","#"+p+"_2").addClass(r.cancelicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+r.cancelicon[2]+"'></span>");e("#dData","#"+p+"_2").click(function(){var n=[true,""];l={};var s=e("#DelData>td","#"+p).text();if(typeof r.onclickSubmit==="function")l=r.onclickSubmit(t,s)||{};if(typeof r.beforeSubmit==="function")n=r.beforeSubmit(s);if(n[0]&&!t.processing){t.processing=true;e(this).addClass("ui-state-active");g=i.p.prmNames;v=e.extend({},t.delData,l);y=g.oper;v[y]=g.deloper;m=g.id;v[m]=s;var o=e.extend({url:t.url?t.url:e(i).jqGrid("getGridParam","editurl"),type:r.mtype,data:e.isFunction(r.serializeDelData)?r.serializeDelData(v):v,complete:function(o,u){if(u!="success"){n[0]=false;n[1]=e.isFunction(t.errorTextFormat)?t.errorTextFormat(o):u+" Status: '"+o.statusText+"'. Error code: "+o.status}else if(typeof t.afterSubmit==="function")n=t.afterSubmit(o,v);if(n[0]===false){e("#DelError>td","#"+p).html(n[1]);e("#DelError","#"+p).show()}else{if(t.reloadAfterSubmit&&i.p.datatype!="local")e(i).trigger("reloadGrid");else{var l=[];l=s.split(",");if(i.p.treeGrid===true)try{e(i).jqGrid("delTreeNode",l[0])}catch(h){}else for(var d=0;d<l.length;d++)e(i).jqGrid("delRowData",l[d]);i.p.selrow=null;i.p.selarrrow=[]}e.isFunction(t.afterComplete)&&setTimeout(function(){t.afterComplete(o,s)},500)}t.processing=false;e("#dData","#"+p+"_2").removeClass("ui-state-active");n[0]&&e.jgrid.hideModal("#"+w.themodal,{gb:"#gbox_"+f,jqm:r.jqModal,onClose:t.onClose})}},e.jgrid.ajaxOptions,r.ajaxDelOptions);if(!o.url&&!t.useDataProxy)if(e.isFunction(i.p.dataProxy))t.useDataProxy=true;else{n[0]=false;n[1]+=" "+e.jgrid.errors.nourl}if(n[0])t.useDataProxy?i.p.dataProxy.call(i,o,"del_"+i.p.id):e.ajax(o)}if(n[0]===false){e("#DelError>td","#"+p).html(n[1]);e("#DelError","#"+p).show()}return false});e("#eData","#"+p+"_2").click(function(){e.jgrid.hideModal("#"+w.themodal,{gb:"#gbox_"+f,jqm:r.jqModal,onClose:t.onClose});return false});s&&r.beforeShowForm(e("#"+p));e.jgrid.viewModal("#"+w.themodal,{gbox:"#gbox_"+f,jqm:r.jqModal,overlay:r.overlay,modal:r.modal})}o&&r.afterShowForm(e("#"+p));r.closeOnEscape===true&&setTimeout(function(){e(".ui-jqdialog-titlebar-close","#"+w.modalhead).focus()},0)}})},navGrid:function(t,n,r,i,s,o,u){n=e.extend({edit:true,editicon:"ui-icon-pencil",add:true,addicon:"ui-icon-plus",del:true,delicon:"ui-icon-trash",search:true,searchicon:"ui-icon-search",refresh:true,refreshicon:"ui-icon-refresh",refreshstate:"firstpage",view:false,viewicon:"ui-icon-document",position:"left",closeOnEscape:true,beforeRefresh:null,afterRefresh:null,cloneToTop:false},e.jgrid.nav,n||{});return this.each(function(){if(!this.nav){var f={themodal:"alertmod",modalhead:"alerthd",modalcontent:"alertcnt"},c=this,h,p,v;if(!(!c.grid||typeof t!="string")){if(e("#"+f.themodal).html()===null){if(typeof window.innerWidth!="undefined"){h=window.innerWidth;p=window.innerHeight}else if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!==0){h=document.documentElement.clientWidth;p=document.documentElement.clientHeight}else{h=1024;p=768}e.jgrid.createModal(f,"<div>"+n.alerttext+"</div><span tabindex='0'><span tabindex='-1' id='jqg_alrt'></span></span>",{gbox:"#gbox_"+c.p.id,jqModal:true,drag:true,resize:true,caption:n.alertcap,top:p/2-25,left:h/2-100,width:200,height:"auto",closeOnEscape:n.closeOnEscape},"","",true)}h=1;if(n.cloneToTop&&c.p.toppager)h=2;for(p=0;p<h;p++){var m=e("<table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table navtable' style='float:left;table-layout:auto;'><tbody><tr></tr></tbody></table>"),g,y;if(p===0){g=t;y=c.p.id;if(g==c.p.toppager){y+="_top";h=1}}else{g=c.p.toppager;y=c.p.id+"_top"}c.p.direction=="rtl"&&e(m).attr("dir","rtl").css("float","right");if(n.add){i=i||{};v=e("<td class='ui-pg-button ui-corner-all'></td>");e(v).append("<div class='ui-pg-div'><span class='ui-icon "+n.addicon+"'></span>"+n.addtext+"</div>");e("tr",m).append(v);e(v,m).attr({title:n.addtitle||"",id:i.id||"add_"+y}).click(function(){e(this).hasClass("ui-state-disabled")||(typeof n.addfunc=="function"?n.addfunc():e(c).jqGrid("editGridRow","new",i));return false}).hover(function(){e(this).hasClass("ui-state-disabled")||e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")});v=null}if(n.edit){v=e("<td class='ui-pg-button ui-corner-all'></td>");r=r||{};e(v).append("<div class='ui-pg-div'><span class='ui-icon "+n.editicon+"'></span>"+n.edittext+"</div>");e("tr",m).append(v);e(v,m).attr({title:n.edittitle||"",id:r.id||"edit_"+y}).click(function(){if(!e(this).hasClass("ui-state-disabled")){var t=c.p.selrow;if(t)typeof n.editfunc=="function"?n.editfunc(t):e(c).jqGrid("editGridRow",t,r);else{e.jgrid.viewModal("#"+f.themodal,{gbox:"#gbox_"+c.p.id,jqm:true});e("#jqg_alrt").focus()}}return false}).hover(function(){e(this).hasClass("ui-state-disabled")||e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")});v=null}if(n.view){v=e("<td class='ui-pg-button ui-corner-all'></td>");u=u||{};e(v).append("<div class='ui-pg-div'><span class='ui-icon "+n.viewicon+"'></span>"+n.viewtext+"</div>");e("tr",m).append(v);e(v,m).attr({title:n.viewtitle||"",id:u.id||"view_"+y}).click(function(){if(!e(this).hasClass("ui-state-disabled")){var t=c.p.selrow;if(t)e(c).jqGrid("viewGridRow",t,u);else{e.jgrid.viewModal("#"+f.themodal,{gbox:"#gbox_"+c.p.id,jqm:true});e("#jqg_alrt").focus()}}return false}).hover(function(){e(this).hasClass("ui-state-disabled")||e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")});v=null}if(n.del){v=e("<td class='ui-pg-button ui-corner-all'></td>");s=s||{};e(v).append("<div class='ui-pg-div'><span class='ui-icon "+n.delicon+"'></span>"+n.deltext+"</div>");e("tr",m).append(v);e(v,m).attr({title:n.deltitle||"",id:s.id||"del_"+y}).click(function(){if(!e(this).hasClass("ui-state-disabled")){var t;if(c.p.multiselect){t=c.p.selarrrow;if(t.length===0)t=null}else t=c.p.selrow;if(t)"function"==typeof n.delfunc?n.delfunc(t):e(c).jqGrid("delGridRow",t,s);else{e.jgrid.viewModal("#"+f.themodal,{gbox:"#gbox_"+c.p.id,jqm:true});e("#jqg_alrt").focus()}}return false}).hover(function(){e(this).hasClass("ui-state-disabled")||e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")});v=null}if(n.add||n.edit||n.del||n.view)e("tr",m).append("<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>");if(n.search){v=e("<td class='ui-pg-button ui-corner-all'></td>");o=o||{};e(v).append("<div class='ui-pg-div'><span class='ui-icon "+n.searchicon+"'></span>"+n.searchtext+"</div>");e("tr",m).append(v);e(v,m).attr({title:n.searchtitle||"",id:o.id||"search_"+y}).click(function(){e(this).hasClass("ui-state-disabled")||e(c).jqGrid("searchGrid",o);return false}).hover(function(){e(this).hasClass("ui-state-disabled")||e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")});o.showOnLoad&&o.showOnLoad===true&&e(v,m).click();v=null}if(n.refresh){v=e("<td class='ui-pg-button ui-corner-all'></td>");e(v).append("<div class='ui-pg-div'><span class='ui-icon "+n.refreshicon+"'></span>"+n.refreshtext+"</div>");e("tr",m).append(v);e(v,m).attr({title:n.refreshtitle||"",id:"refresh_"+y}).click(function(){if(!e(this).hasClass("ui-state-disabled")){e.isFunction(n.beforeRefresh)&&n.beforeRefresh();c.p.search=false;try{var t=c.p.id;c.p.postData.filters="";e("#fbox_"+t).jqFilter("resetFilter");e.isFunction(c.clearToolbar)&&c.clearToolbar(false)}catch(r){}switch(n.refreshstate){case"firstpage":e(c).trigger("reloadGrid",[{page:1}]);break;case"current":e(c).trigger("reloadGrid",[{current:true}])}e.isFunction(n.afterRefresh)&&n.afterRefresh()}return false}).hover(function(){e(this).hasClass("ui-state-disabled")||e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")});v=null}v=e(".ui-jqgrid").css("font-size")||"11px";e("body").append("<div id='testpg2' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:"+v+";visibility:hidden;' ></div>");v=e(m).clone().appendTo("#testpg2").width();e("#testpg2").remove();e(g+"_"+n.position,g).append(m);if(c.p._nvtd){if(v>c.p._nvtd[0]){e(g+"_"+n.position,g).width(v);c.p._nvtd[0]=v}c.p._nvtd[1]=v}m=v=v=null;this.nav=true}}}})},navButtonAdd:function(t,n){n=e.extend({caption:"newButton",title:"",buttonicon:"ui-icon-newwin",onClickButton:null,position:"last",cursor:"pointer"},n||{});return this.each(function(){if(this.grid){if(t.indexOf("#")!==0)t="#"+t;var r=e(".navtable",t)[0],i=this;if(r)if(!(n.id&&e("#"+n.id,r).html()!==null)){var s=e("<td></td>");n.buttonicon.toString().toUpperCase()=="NONE"?e(s).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'>"+n.caption+"</div>"):e(s).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'><span class='ui-icon "+n.buttonicon+"'></span>"+n.caption+"</div>");n.id&&e(s).attr("id",n.id);if(n.position=="first")r.rows[0].cells.length===0?e("tr",r).append(s):e("tr td:eq(0)",r).before(s);else e("tr",r).append(s);e(s,r).attr("title",n.title||"").click(function(t){e(this).hasClass("ui-state-disabled")||e.isFunction(n.onClickButton)&&n.onClickButton.call(i,t);return false}).hover(function(){e(this).hasClass("ui-state-disabled")||e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")})}}})},navSeparatorAdd:function(t,n){n=e.extend({sepclass:"ui-separator",sepcontent:""},n||{});return this.each(function(){if(this.grid){if(t.indexOf("#")!==0)t="#"+t;var r=e(".navtable",t)[0];if(r){var i="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='"+n.sepclass+"'></span>"+n.sepcontent+"</td>";e("tr",r).append(i)}}})},GridToForm:function(t,n){return this.each(function(){if(this.grid){var r=e(this).jqGrid("getRowData",t);if(r)for(var i in r)e("[name="+e.jgrid.jqID(i)+"]",n).is("input:radio")||e("[name="+e.jgrid.jqID(i)+"]",n).is("input:checkbox")?e("[name="+e.jgrid.jqID(i)+"]",n).each(function(){e(this).val()==r[i]?e(this).attr("checked","checked"):e(this).attr("checked","")}):e("[name="+e.jgrid.jqID(i)+"]",n).val(r[i])}})},FormToGrid:function(t,n,r,i){return this.each(function(){if(this.grid){r||(r="set");i||(i="first");var s=e(n).serializeArray(),o={};e.each(s,function(e,t){o[t.name]=t.value});if(r=="add")e(this).jqGrid("addRowData",t,o,i);else r=="set"&&e(this).jqGrid("setRowData",t,o)}})}})})(jQuery);(function(e){e.fn.jqFilter=function(t){if(typeof t==="string"){var n=e.fn.jqFilter[t];if(!n)throw"jqFilter - No such method: "+t;var r=e.makeArray(arguments).slice(1);return n.apply(this,r)}var i=e.extend(true,{filter:null,columns:[],onChange:null,checkValues:null,error:false,errmsg:"",errorcheck:true,showQuery:true,sopt:null,ops:[{name:"eq",description:"equal",operator:"="},{name:"ne",description:"not equal",operator:"<>"},{name:"lt",description:"less",operator:"<"},{name:"le",description:"less or equal",operator:"<="},{name:"gt",description:"greater",operator:">"},{name:"ge",description:"greater or equal",operator:">="},{name:"bw",description:"begins with",operator:"LIKE"},{name:"bn",description:"does not begin with",operator:"NOT LIKE"},{name:"in",description:"in",operator:"IN"},{name:"ni",description:"not in",operator:"NOT IN"},{name:"ew",description:"ends with",operator:"LIKE"},{name:"en",description:"does not end with",operator:"NOT LIKE"},{name:"cn",description:"contains",operator:"LIKE"},{name:"nc",description:"does not contain",operator:"NOT LIKE"},{name:"nu",description:"is null",operator:"IS NULL"},{name:"nn",description:"is not null",operator:"IS NOT NULL"}],numopts:["eq","ne","lt","le","gt","ge","nu","nn","in","ni"],stropts:["eq","ne","bw","bn","ew","en","cn","nc","nu","nn","in","ni"],_gridsopt:[],groupOps:["AND","OR"],groupButton:true},t||{});return this.each(function(){if(!this.filter){this.p=i;if(this.p.filter===null||this.p.filter===undefined)this.p.filter={groupOp:this.p.groupOps[0],rules:[],groups:[]};var t,n=this.p.columns.length,r,s=/msie/i.test(navigator.userAgent)&&!window.opera;if(this.p._gridsopt.length)for(t=0;t<this.p._gridsopt.length;t++)this.p.ops[t].description=this.p._gridsopt[t];this.p.initFilter=e.extend(true,{},this.p.filter);if(n){for(t=0;t<n;t++){r=this.p.columns[t];if(r.stype)r.inputtype=r.stype;else if(!r.inputtype)r.inputtype="text";if(r.sorttype)r.searchtype=r.sorttype;else if(!r.searchtype)r.searchtype="string";if(r.hidden===undefined)r.hidden=false;if(!r.label)r.label=r.name;if(r.index)r.name=r.index;if(!r.hasOwnProperty("searchoptions"))r.searchoptions={};if(!r.hasOwnProperty("searchrules"))r.searchrules={}}this.p.showQuery&&e(this).append("<table class='queryresult ui-widget ui-widget-content' style='display:block;max-width:440px;border:0px none;'><tbody><tr><td class='query'></td></tr></tbody></table>");var u=function(t,n){var r=[true,""];if(e.isFunction(n.searchrules))r=n.searchrules(t,n);else if(e.jgrid&&e.jgrid.checkValues)try{r=e.jgrid.checkValues(t,-1,null,n.searchrules,n.label)}catch(s){}if(r&&r.length&&r[0]===false){i.error=!r[0];i.errmsg=r[1]}};this.onchange=function(){this.p.error=false;this.p.errmsg="";return e.isFunction(this.p.onChange)?this.p.onChange.call(this,this.p):false};this.reDraw=function(){e("table.group:first",this).remove();var t=this.createTableForGroup(i.filter,null);e(this).append(t)};this.createTableForGroup=function(t,n){var r=this,s,u=e("<table class='group ui-widget ui-widget-content' style='border:0px none;'><tbody></tbody></table>");n===null&&e(u).append("<tr class='error' style='display:none;'><th colspan='5' class='ui-state-error' align='left'></th></tr>");var a=e("<tr></tr>");e(u).append(a);var f=e("<th colspan='5' align='left'></th>");a.append(f);var l=e("<select class='opsel'></select>");f.append(l);a="";var c;for(s=0;s<i.groupOps.length;s++){c=t.groupOp===r.p.groupOps[s]?" selected='selected'":"";a+="<option value='"+r.p.groupOps[s]+"'"+c+">"+r.p.groupOps[s]+"</option>"}l.append(a).bind("change",function(){t.groupOp=e(l).val();r.onchange()});a="<span></span>";if(this.p.groupButton){a=e("<input type='button' value='+ {}' title='Add subgroup' class='add-group'/>");a.bind("click",function(){if(t.groups===undefined)t.groups=[];t.groups.push({groupOp:i.groupOps[0],rules:[],groups:[]});r.reDraw();r.onchange();return false})}f.append(a);a=e("<input type='button' value='+' title='Add rule' class='add-rule ui-add'/>");var h;a.bind("click",function(){if(t.rules===undefined)t.rules=[];for(s=0;s<r.p.columns.length;s++){var e=typeof r.p.columns[s].search==="undefined"?true:r.p.columns[s].search,n=r.p.columns[s].hidden===true;if(r.p.columns[s].searchoptions.searchhidden===true&&e||e&&!n){h=r.p.columns[s];break}}t.rules.push({field:h.name,op:(h.searchoptions.sopt?h.searchoptions.sopt:r.p.sopt?r.p.sopt:h.searchtype==="string"?r.p.stropts:r.p.numopts)[0],data:""});r.reDraw();return false});f.append(a);if(n!==null){a=e("<input type='button' value='-' title='Delete group' class='delete-group'/>");f.append(a);a.bind("click",function(){for(s=0;s<n.groups.length;s++)if(n.groups[s]===t){n.groups.splice(s,1);break}r.reDraw();r.onchange();return false})}if(t.groups!==undefined)for(s=0;s<t.groups.length;s++){f=e("<tr></tr>");u.append(f);a=e("<td class='first'></td>");f.append(a);a=e("<td colspan='4'></td>");a.append(this.createTableForGroup(t.groups[s],t));f.append(a)}if(t.groupOp===undefined)t.groupOp=r.p.groupOps[0];if(t.rules!==undefined)for(s=0;s<t.rules.length;s++)u.append(this.createTableRowForRule(t.rules[s],t));return u};this.createTableRowForRule=function(t,n){var r=this,u=e("<tr></tr>"),a,f,l,c,h="",p;u.append("<td class='first'></td>");var m=e("<td class='columns'></td>");u.append(m);var g=e("<select></select>");m.append(g);g.bind("change",function(){t.field=e(g).val();l=e(this).parents("tr:first");for(a=0;a<r.p.columns.length;a++)if(r.p.columns[a].name===t.field){c=r.p.columns[a];break}if(c){c.searchoptions.id=e.jgrid.randId();if(s&&c.inputtype==="text")if(!c.searchoptions.size)c.searchoptions.size=10;var n=e.jgrid.createEl(c.inputtype,c.searchoptions,"",true,r.p.ajaxSelectOptions,true);e(n).addClass("input-elm");f=c.searchoptions.sopt?c.searchoptions.sopt:r.p.sopt?r.p.sopt:c.searchtype==="string"?r.p.stropts:r.p.numopts;var i="",o="";for(a=0;a<r.p.ops.length;a++)if(e.inArray(r.p.ops[a].name,f)!==-1){o=t.op===r.p.ops[a].name?" selected=selected":"";i+="<option value='"+r.p.ops[a].name+"'"+o+">"+r.p.ops[a].description+"</option>"}e(".selectopts",l).empty().append(i);e(".data",l).empty().append(n);e(".input-elm",l).bind("change",function(){t.data=e(this).val();if(e.isArray(t.data))t.data=t.data.join(",");r.onchange()});setTimeout(function(){t.data=e(n).val();r.onchange()},0)}});for(a=m=0;a<r.p.columns.length;a++){p=typeof r.p.columns[a].search==="undefined"?true:r.p.columns[a].search;var y=r.p.columns[a].hidden===true;if(r.p.columns[a].searchoptions.searchhidden===true&&p||p&&!y){p="";if(t.field===r.p.columns[a].name){p=" selected='selected'";m=a}h+="<option value='"+r.p.columns[a].name+"'"+p+">"+r.p.columns[a].label+"</option>"}}g.append(h);h=e("<td class='operators'></td>");u.append(h);c=i.columns[m];c.searchoptions.id=e.jgrid.randId();if(s&&c.inputtype==="text")if(!c.searchoptions.size)c.searchoptions.size=10;m=e.jgrid.createEl(c.inputtype,c.searchoptions,t.data,true,r.p.ajaxSelectOptions,true);var b=e("<select class='selectopts'></select>");h.append(b);b.bind("change",function(){t.op=e(b).val();l=e(this).parents("tr:first");var n=e(".input-elm",l)[0];if(t.op==="nu"||t.op==="nn"){t.data="";n.value="";n.setAttribute("readonly","true");n.setAttribute("disabled","true")}else{n.removeAttribute("readonly");n.removeAttribute("disabled")}r.onchange()});f=c.searchoptions.sopt?c.searchoptions.sopt:r.p.sopt?r.p.sopt:c.searchtype==="string"?i.stropts:r.p.numopts;h="";for(a=0;a<r.p.ops.length;a++)if(e.inArray(r.p.ops[a].name,f)!==-1){p=t.op===r.p.ops[a].name?" selected='selected'":"";h+="<option value='"+r.p.ops[a].name+"'"+p+">"+r.p.ops[a].description+"</option>"}b.append(h);h=e("<td class='data'></td>");u.append(h);h.append(m);e(m).addClass("input-elm").bind("change",function(){t.data=e(this).val();if(e.isArray(t.data))t.data=t.data.join(",");r.onchange()});h=e("<td></td>");u.append(h);m=e("<input type='button' value='-' title='Delete rule' class='delete-rule ui-del'/>");h.append(m);m.bind("click",function(){for(a=0;a<n.rules.length;a++)if(n.rules[a]===t){n.rules.splice(a,1);break}r.reDraw();r.onchange();return false});return u};this.getStringForGroup=function(e){var t="(",n;if(e.groups!==undefined)for(n=0;n<e.groups.length;n++){if(t.length>1)t+=" "+e.groupOp+" ";try{t+=this.getStringForGroup(e.groups[n])}catch(r){alert(r)}}if(e.rules!==undefined)try{for(n=0;n<e.rules.length;n++){if(t.length>1)t+=" "+e.groupOp+" ";t+=this.getStringForRule(e.rules[n])}}catch(i){alert(i)}t+=")";return t==="()"?"":t};this.getStringForRule=function(t){var n="",r="",s,a;for(s=0;s<this.p.ops.length;s++)if(this.p.ops[s].name===t.op){n=this.p.ops[s].operator;r=this.p.ops[s].name;break}for(s=0;s<this.p.columns.length;s++)if(this.p.columns[s].name===t.field){a=this.p.columns[s];break}s=t.data;if(r==="bw"||r==="bn")s+="%";if(r==="ew"||r==="en")s="%"+s;if(r==="cn"||r==="nc")s="%"+s+"%";if(r==="in"||r==="ni")s=" ("+s+")";i.errorcheck&&u(t.data,a);return e.inArray(a.searchtype,["int","integer","float","number","currency"])!==-1||r==="nn"||r==="nu"?t.field+" "+n+" "+s:t.field+" "+n+' "'+s+'"'};this.resetFilter=function(){this.p.filter=e.extend(true,{},this.p.initFilter);this.reDraw();this.onchange()};this.hideError=function(){e("th.ui-state-error",this).html("");e("tr.error",this).hide()};this.showError=function(){e("th.ui-state-error",this).html(this.p.errmsg);e("tr.error",this).show()};this.toUserFriendlyString=function(){return this.getStringForGroup(i.filter)};this.toString=function(){function e(n){var r="(",i;if(n.groups!==undefined)for(i=0;i<n.groups.length;i++){if(r.length>1)r+=n.groupOp==="OR"?" || ":" && ";r+=e(n.groups[i])}if(n.rules!==undefined)for(i=0;i<n.rules.length;i++){if(r.length>1)r+=n.groupOp==="OR"?" || ":" && ";var s=n.rules[i];if(t.p.errorcheck){var o=void 0,a=void 0;for(o=0;o<t.p.columns.length;o++)if(t.p.columns[o].name===s.field){a=t.p.columns[o];break}a&&u(s.data,a)}r+=s.op+"(item."+s.field+",'"+s.data+"')"}r+=")";return r==="()"?"":r}var t=this;return e(this.p.filter)};this.reDraw();if(this.p.showQuery)this.onchange();this.filter=true}}})};e.extend(e.fn.jqFilter,{toSQLString:function(){var e="";this.each(function(){e=this.toUserFriendlyString()});return e},filterData:function(){var e;this.each(function(){e=this.p.filter});return e},getParameter:function(e){if(e!==undefined)if(this.p.hasOwnProperty(e))return this.p[e];return this.p},resetFilter:function(){return this.each(function(){this.resetFilter()})},addFilter:function(e){if(typeof e==="string")e=jQuery.jgrid.parse(e);this.each(function(){this.p.filter=e;this.reDraw();this.onchange()})}})})(jQuery);(function(e){e.jgrid.extend({editRow:function(t,n,r,i,s,o,u,f,l){var c={keys:n||false,oneditfunc:r||null,successfunc:i||null,url:s||null,extraparam:o||{},aftersavefunc:u||null,errorfunc:f||null,afterrestorefunc:l||null,restoreAfterErorr:true},h=e.makeArray(arguments).slice(1),p;p=h[0]&&typeof h[0]=="object"&&!e.isFunction(h[0])?e.extend(c,h[0]):c;return this.each(function(){var n=this,r,i,s=0,o=null,u={},f,c;if(n.grid){f=e(n).jqGrid("getInd",t,true);if(f!==false)if((e(f).attr("editable")||"0")=="0"&&!e(f).hasClass("not-editable-row")){c=n.p.colModel;e("td",f).each(function(f){r=c[f].name;var l=n.p.treeGrid===true&&r==n.p.ExpandColumn;if(l)i=e("span:first",this).html();else try{i=e.unformat(this,{rowId:t,colModel:c[f]},f)}catch(h){i=e(this).html()}if(r!="cb"&&r!="subgrid"&&r!="rn"){if(n.p.autoencode)i=e.jgrid.htmlDecode(i);u[r]=i;if(c[f].editable===true){if(o===null)o=f;l?e("span:first",this).html(""):e(this).html("");var p=e.extend({},c[f].editoptions||{},{id:t+"_"+r,name:r});if(!c[f].edittype)c[f].edittype="text";p=e.jgrid.createEl(c[f].edittype,p,i,true,e.extend({},e.jgrid.ajaxOptions,n.p.ajaxSelectOptions||{}));e(p).addClass("editable");l?e("span:first",this).append(p):e(this).append(p);c[f].edittype=="select"&&c[f].editoptions.multiple===true&&e.browser.msie&&e(p).width(e(p).width());s++}}});if(s>0){u.id=t;n.p.savedRow.push(u);e(f).attr("editable","1");e("td:eq("+o+") input",f).focus();p.keys===true&&e(f).bind("keydown",function(r){r.keyCode===27&&e(n).jqGrid("restoreRow",t,l);if(r.keyCode===13){if(r.target.tagName=="TEXTAREA")return true;e(n).jqGrid("saveRow",t,p);return false}r.stopPropagation()});e.isFunction(p.oneditfunc)&&p.oneditfunc.call(n,t)}}}})},saveRow:function(t,n,r,i,s,o,u){var f={successfunc:n||null,url:r||null,extraparam:i||{},aftersavefunc:s||null,errorfunc:o||null,afterrestorefunc:u||null,restoreAfterErorr:true},l=e.makeArray(arguments).slice(1),c;c=l[0]&&typeof l[0]=="object"&&!e.isFunction(l[0])?e.extend(f,l[0]):f;var h=false,p=this[0],d,v={},m={},g={},y,b,w;if(!p.grid)return h;w=e(p).jqGrid("getInd",t,true);if(w===false)return h;f=e(w).attr("editable");c.url=c.url?c.url:p.p.editurl;if(f==="1"){var E;e("td",w).each(function(t){E=p.p.colModel[t];d=E.name;if(d!="cb"&&d!="subgrid"&&E.editable===true&&d!="rn"&&!e(this).hasClass("not-editable-cell")){switch(E.edittype){case"checkbox":var n=["Yes","No"];if(E.editoptions)n=E.editoptions.value.split(":");v[d]=e("input",this).attr("checked")?n[0]:n[1];break;case"text":case"password":case"textarea":case"button":v[d]=e("input, textarea",this).val();break;case"select":if(E.editoptions.multiple){n=e("select",this);var r=[];v[d]=e(n).val();v[d]=v[d]?v[d].join(","):"";e("select > option:selected",this).each(function(t,n){r[t]=e(n).text()});m[d]=r.join(",")}else{v[d]=e("select>option:selected",this).val();m[d]=e("select>option:selected",this).text()}if(E.formatter&&E.formatter=="select")m={};break;case"custom":try{if(E.editoptions&&e.isFunction(E.editoptions.custom_value)){v[d]=E.editoptions.custom_value.call(p,e(".customelement",this),"get");if(v[d]===undefined)throw"e2"}else throw"e1"}catch(i){i=="e1"&&e.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose);i=="e2"?e.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose):e.jgrid.info_dialog(jQuery.jgrid.errors.errcap,i.message,jQuery.jgrid.edit.bClose)}}b=e.jgrid.checkValues(v[d],t,p);if(b[0]===false){b[1]=v[d]+" "+b[1];return false}if(p.p.autoencode)v[d]=e.jgrid.htmlEncode(v[d]);if(c.url!=="clientArray"&&E.editoptions&&E.editoptions.NullIfEmpty===true)if(v[d]=="")g[d]="null"}});if(b[0]===false){try{var S=e.jgrid.findPos(e("#"+e.jgrid.jqID(t),p.grid.bDiv)[0]);e.jgrid.info_dialog(e.jgrid.errors.errcap,b[1],e.jgrid.edit.bClose,{left:S[0],top:S[1]})}catch(x){alert(b[1])}return h}if(v){f=p.p.prmNames;l=f.oper;S=f.id;v[l]=f.editoper;v[S]=t;if(typeof p.p.inlineData=="undefined")p.p.inlineData={};v=e.extend({},v,p.p.inlineData,c.extraparam)}if(c.url=="clientArray"){v=e.extend({},v,m);p.p.autoencode&&e.each(v,function(t,n){v[t]=e.jgrid.htmlDecode(n)});S=e(p).jqGrid("setRowData",t,v);e(w).attr("editable","0");for(f=0;f<p.p.savedRow.length;f++)if(p.p.savedRow[f].id==t){y=f;break}y>=0&&p.p.savedRow.splice(y,1);e.isFunction(c.aftersavefunc)&&c.aftersavefunc.call(p,t,S);h=true}else{e("#lui_"+p.p.id).show();g=e.extend({},v,g);e.ajax(e.extend({url:c.url,data:e.isFunction(p.p.serializeRowData)?p.p.serializeRowData.call(p,g):g,type:"POST",async:false,complete:function(n,r){e("#lui_"+p.p.id).hide();if(r==="success")if((e.isFunction(c.succesfunc)?c.succesfunc.call(p,n):true)===true){p.p.autoencode&&e.each(v,function(t,n){v[t]=e.jgrid.htmlDecode(n)});v=e.extend({},v,m);e(p).jqGrid("setRowData",t,v);e(w).attr("editable","0");for(var i=0;i<p.p.savedRow.length;i++)if(p.p.savedRow[i].id==t){y=i;break}y>=0&&p.p.savedRow.splice(y,1);e.isFunction(c.aftersavefunc)&&c.aftersavefunc.call(p,t,n);h=true}else{e.isFunction(c.errorfunc)&&c.errorfunc.call(p,t,n,r);c.restoreAfterError===true&&e(p).jqGrid("restoreRow",t,c.afterrestorefunc)}},error:function(n,r){e("#lui_"+p.p.id).hide();if(e.isFunction(c.errorfunc))c.errorfunc.call(p,t,n,r);else try{jQuery.jgrid.info_dialog(jQuery.jgrid.errors.errcap,'<div class="ui-state-error">'+n.responseText+"</div>",jQuery.jgrid.edit.bClose,{buttonalign:"right"})}catch(i){alert(n.responseText)}c.restoreAfterError===true&&e(p).jqGrid("restoreRow",t,c.afterrestorefunc)}},e.jgrid.ajaxOptions,p.p.ajaxRowOptions||{}))}e(w).unbind("keydown")}return h},restoreRow:function(t,n){return this.each(function(){var r=this,i,s,o={};if(r.grid){s=e(r).jqGrid("getInd",t,true);if(s!==false){for(var u=0;u<r.p.savedRow.length;u++)if(r.p.savedRow[u].id==t){i=u;break}if(i>=0){if(e.isFunction(e.fn.datepicker))try{e("input.hasDatepicker","#"+e.jgrid.jqID(s.id)).datepicker("hide")}catch(f){}e.each(r.p.colModel,function(){if(this.editable===true&&this.name in r.p.savedRow[i]&&!e(this).hasClass("not-editable-cell"))o[this.name]=r.p.savedRow[i][this.name]});e(r).jqGrid("setRowData",t,o);e(s).attr("editable","0").unbind("keydown");r.p.savedRow.splice(i,1)}e.isFunction(n)&&n.call(r,t)}}})}})})(jQuery);(function(e){e.jgrid.extend({editCell:function(t,n,r){return this.each(function(){var i=this,s,o,u;if(!(!i.grid||i.p.cellEdit!==true)){n=parseInt(n,10);i.p.selrow=i.rows[t].id;i.p.knv||e(i).jqGrid("GridNav");if(i.p.savedRow.length>0){if(r===true)if(t==i.p.iRow&&n==i.p.iCol)return;e(i).jqGrid("saveCell",i.p.savedRow[0].id,i.p.savedRow[0].ic)}else window.setTimeout(function(){e("#"+i.p.knv).attr("tabindex","-1").focus()},0);s=i.p.colModel[n].name;if(!(s=="subgrid"||s=="cb"||s=="rn")){u=e("td:eq("+n+")",i.rows[t]);if(i.p.colModel[n].editable===true&&r===true&&!u.hasClass("not-editable-cell")){if(parseInt(i.p.iCol,10)>=0&&parseInt(i.p.iRow,10)>=0){e("td:eq("+i.p.iCol+")",i.rows[i.p.iRow]).removeClass("edit-cell ui-state-highlight");e(i.rows[i.p.iRow]).removeClass("selected-row ui-state-hover")}e(u).addClass("edit-cell ui-state-highlight");e(i.rows[t]).addClass("selected-row ui-state-hover");try{o=e.unformat(u,{rowId:i.rows[t].id,colModel:i.p.colModel[n]},n)}catch(f){o=e(u).html()}if(i.p.autoencode)o=e.jgrid.htmlDecode(o);if(!i.p.colModel[n].edittype)i.p.colModel[n].edittype="text";i.p.savedRow.push({id:t,ic:n,name:s,v:o});if(e.isFunction(i.p.formatCell)){var l=i.p.formatCell.call(i,i.rows[t].id,s,o,t,n);if(l!==undefined)o=l}l=e.extend({},i.p.colModel[n].editoptions||{},{id:t+"_"+s,name:s});var c=e.jgrid.createEl(i.p.colModel[n].edittype,l,o,true,e.extend({},e.jgrid.ajaxOptions,i.p.ajaxSelectOptions||{}));e.isFunction(i.p.beforeEditCell)&&i.p.beforeEditCell.call(i,i.rows[t].id,s,o,t,n);e(u).html("").append(c).attr("tabindex","0");window.setTimeout(function(){e(c).focus()},0);e("input, select, textarea",u).bind("keydown",function(r){if(r.keyCode===27)if(e("input.hasDatepicker",u).length>0)e(".ui-datepicker").is(":hidden")?e(i).jqGrid("restoreCell",t,n):e("input.hasDatepicker",u).datepicker("hide");else e(i).jqGrid("restoreCell",t,n);r.keyCode===13&&e(i).jqGrid("saveCell",t,n);if(r.keyCode==9)if(i.grid.hDiv.loading)return false;else r.shiftKey?e(i).jqGrid("prevCell",t,n):e(i).jqGrid("nextCell",t,n);r.stopPropagation()});e.isFunction(i.p.afterEditCell)&&i.p.afterEditCell.call(i,i.rows[t].id,s,o,t,n)}else{if(parseInt(i.p.iCol,10)>=0&&parseInt(i.p.iRow,10)>=0){e("td:eq("+i.p.iCol+")",i.rows[i.p.iRow]).removeClass("edit-cell ui-state-highlight");e(i.rows[i.p.iRow]).removeClass("selected-row ui-state-hover")}u.addClass("edit-cell ui-state-highlight");e(i.rows[t]).addClass("selected-row ui-state-hover");if(e.isFunction(i.p.onSelectCell)){o=u.html().replace(/\&#160\;/ig,"");i.p.onSelectCell.call(i,i.rows[t].id,s,o,t,n)}}i.p.iCol=n;i.p.iRow=t}}})},saveCell:function(t,n){return this.each(function(){var r=this,i;if(!(!r.grid||r.p.cellEdit!==true)){i=r.p.savedRow.length>=1?0:null;if(i!==null){var s=e("td:eq("+n+")",r.rows[t]),o,u,a=r.p.colModel[n],f=a.name,l=e.jgrid.jqID(f);switch(a.edittype){case"select":if(a.editoptions.multiple){l=e("#"+t+"_"+l,r.rows[t]);var c=[];if(o=e(l).val())o.join(",");else o="";e("option:selected",l).each(function(t,n){c[t]=e(n).text()});u=c.join(",")}else{o=e("#"+t+"_"+l+">option:selected",r.rows[t]).val();u=e("#"+t+"_"+l+">option:selected",r.rows[t]).text()}if(a.formatter)u=o;break;case"checkbox":var h=["Yes","No"];if(a.editoptions)h=a.editoptions.value.split(":");u=o=e("#"+t+"_"+l,r.rows[t]).attr("checked")?h[0]:h[1];break;case"password":case"text":case"textarea":case"button":u=o=e("#"+t+"_"+l,r.rows[t]).val();break;case"custom":try{if(a.editoptions&&e.isFunction(a.editoptions.custom_value)){o=a.editoptions.custom_value.call(r,e(".customelement",s),"get");if(o===undefined)throw"e2";else u=o}else throw"e1"}catch(p){p=="e1"&&e.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose);p=="e2"?e.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose):e.jgrid.info_dialog(jQuery.jgrid.errors.errcap,p.message,jQuery.jgrid.edit.bClose)}}if(u!=r.p.savedRow[i].v){if(e.isFunction(r.p.beforeSaveCell))if(i=r.p.beforeSaveCell.call(r,r.rows[t].id,f,o,t,n))u=o=i;var v=e.jgrid.checkValues(o,n,r);if(v[0]===true){i={};if(e.isFunction(r.p.beforeSubmitCell))(i=r.p.beforeSubmitCell.call(r,r.rows[t].id,f,o,t,n))||(i={});e("input.hasDatepicker",s).length>0&&e("input.hasDatepicker",s).datepicker("hide");if(r.p.cellsubmit=="remote")if(r.p.cellurl){var m={};if(r.p.autoencode)o=e.jgrid.htmlEncode(o);m[f]=o;h=r.p.prmNames;a=h.id;l=h.oper;m[a]=r.rows[t].id;m[l]=h.editoper;m=e.extend(i,m);e("#lui_"+r.p.id).show();r.grid.hDiv.loading=true;e.ajax(e.extend({url:r.p.cellurl,data:e.isFunction(r.p.serializeCellData)?r.p.serializeCellData.call(r,m):m,type:"POST",complete:function(i,a){e("#lui_"+r.p.id).hide();r.grid.hDiv.loading=false;if(a=="success")if(e.isFunction(r.p.afterSubmitCell)){var l=r.p.afterSubmitCell.call(r,i,m.id,f,o,t,n);if(l[0]===true){e(s).empty();e(r).jqGrid("setCell",r.rows[t].id,n,u,false,false,true);e(s).addClass("dirty-cell");e(r.rows[t]).addClass("edited");e.isFunction(r.p.afterSaveCell)&&r.p.afterSaveCell.call(r,r.rows[t].id,f,o,t,n);r.p.savedRow.splice(0,1)}else{e.jgrid.info_dialog(e.jgrid.errors.errcap,l[1],e.jgrid.edit.bClose);e(r).jqGrid("restoreCell",t,n)}}else{e(s).empty();e(r).jqGrid("setCell",r.rows[t].id,n,u,false,false,true);e(s).addClass("dirty-cell");e(r.rows[t]).addClass("edited");e.isFunction(r.p.afterSaveCell)&&r.p.afterSaveCell.call(r,r.rows[t].id,f,o,t,n);r.p.savedRow.splice(0,1)}},error:function(i,s){e("#lui_"+r.p.id).hide();r.grid.hDiv.loading=false;e.isFunction(r.p.errorCell)?r.p.errorCell.call(r,i,s):e.jgrid.info_dialog(e.jgrid.errors.errcap,i.status+" : "+i.statusText+"<br/>"+s,e.jgrid.edit.bClose);e(r).jqGrid("restoreCell",t,n)}},e.jgrid.ajaxOptions,r.p.ajaxCellOptions||{}))}else try{e.jgrid.info_dialog(e.jgrid.errors.errcap,e.jgrid.errors.nourl,e.jgrid.edit.bClose);e(r).jqGrid("restoreCell",t,n)}catch(g){}if(r.p.cellsubmit=="clientArray"){e(s).empty();e(r).jqGrid("setCell",r.rows[t].id,n,u,false,false,true);e(s).addClass("dirty-cell");e(r.rows[t]).addClass("edited");e.isFunction(r.p.afterSaveCell)&&r.p.afterSaveCell.call(r,r.rows[t].id,f,o,t,n);r.p.savedRow.splice(0,1)}}else try{window.setTimeout(function(){e.jgrid.info_dialog(e.jgrid.errors.errcap,o+" "+v[1],e.jgrid.edit.bClose)},100);e(r).jqGrid("restoreCell",t,n)}catch(y){}}else e(r).jqGrid("restoreCell",t,n)}e.browser.opera?e("#"+r.p.knv).attr("tabindex","-1").focus():window.setTimeout(function(){e("#"+r.p.knv).attr("tabindex","-1").focus()},0)}})},restoreCell:function(t,n){return this.each(function(){var r=this,i;if(!(!r.grid||r.p.cellEdit!==true)){i=r.p.savedRow.length>=1?0:null;if(i!==null){var s=e("td:eq("+n+")",r.rows[t]);if(e.isFunction(e.fn.datepicker))try{e("input.hasDatepicker",s).datepicker("hide")}catch(o){}e(s).empty().attr("tabindex","-1");e(r).jqGrid("setCell",r.rows[t].id,n,r.p.savedRow[i].v,false,false,true);e.isFunction(r.p.afterRestoreCell)&&r.p.afterRestoreCell.call(r,r.rows[t].id,r.p.savedRow[i].v,t,n);r.p.savedRow.splice(0,1)}window.setTimeout(function(){e("#"+r.p.knv).attr("tabindex","-1").focus()},0)}})},nextCell:function(t,n){return this.each(function(){var r=false;if(!(!this.grid||this.p.cellEdit!==true)){for(var i=n+1;i<this.p.colModel.length;i++)if(this.p.colModel[i].editable===true){r=i;break}if(r!==false)e(this).jqGrid("editCell",t,r,true);else this.p.savedRow.length>0&&e(this).jqGrid("saveCell",t,n)}})},prevCell:function(t,n){return this.each(function(){var r=false;if(!(!this.grid||this.p.cellEdit!==true)){for(var i=n-1;i>=0;i--)if(this.p.colModel[i].editable===true){r=i;break}if(r!==false)e(this).jqGrid("editCell",t,r,true);else this.p.savedRow.length>0&&e(this).jqGrid("saveCell",t,n)}})},GridNav:function(){return this.each(function(){function t(t,n,i){if(i.substr(0,1)=="v"){var s=e(r.grid.bDiv)[0].clientHeight,o=e(r.grid.bDiv)[0].scrollTop,u=r.rows[t].offsetTop+r.rows[t].clientHeight,f=r.rows[t].offsetTop;if(i=="vd")if(u>=s)e(r.grid.bDiv)[0].scrollTop=e(r.grid.bDiv)[0].scrollTop+r.rows[t].clientHeight;if(i=="vu")if(f<o)e(r.grid.bDiv)[0].scrollTop=e(r.grid.bDiv)[0].scrollTop-r.rows[t].clientHeight}if(i=="h"){i=e(r.grid.bDiv)[0].clientWidth;s=e(r.grid.bDiv)[0].scrollLeft;o=r.rows[t].cells[n].offsetLeft;if(r.rows[t].cells[n].offsetLeft+r.rows[t].cells[n].clientWidth>=i+parseInt(s,10))e(r.grid.bDiv)[0].scrollLeft=e(r.grid.bDiv)[0].scrollLeft+r.rows[t].cells[n].clientWidth;else if(o<s)e(r.grid.bDiv)[0].scrollLeft=e(r.grid.bDiv)[0].scrollLeft-r.rows[t].cells[n].clientWidth}}function n(e,t){var n,i;if(t=="lft"){n=e+1;for(i=e;i>=0;i--)if(r.p.colModel[i].hidden!==true){n=i;break}}if(t=="rgt"){n=e-1;for(i=e;i<r.p.colModel.length;i++)if(r.p.colModel[i].hidden!==true){n=i;break}}return n}var r=this;if(!(!r.grid||r.p.cellEdit!==true)){r.p.knv=r.p.id+"_kn";var i=e("<span style='width:0px;height:0px;background-color:black;' tabindex='0'><span tabindex='-1' style='width:0px;height:0px;background-color:grey' id='"+r.p.knv+"'></span></span>"),s,o;e(i).insertBefore(r.grid.cDiv);e("#"+r.p.knv).focus().keydown(function(i){o=i.keyCode;if(r.p.direction=="rtl")if(o==37)o=39;else if(o==39)o=37;switch(o){case 38:if(r.p.iRow-1>0){t(r.p.iRow-1,r.p.iCol,"vu");e(r).jqGrid("editCell",r.p.iRow-1,r.p.iCol,false)}break;case 40:if(r.p.iRow+1<=r.rows.length-1){t(r.p.iRow+1,r.p.iCol,"vd");e(r).jqGrid("editCell",r.p.iRow+1,r.p.iCol,false)}break;case 37:if(r.p.iCol-1>=0){s=n(r.p.iCol-1,"lft");t(r.p.iRow,s,"h");e(r).jqGrid("editCell",r.p.iRow,s,false)}break;case 39:if(r.p.iCol+1<=r.p.colModel.length-1){s=n(r.p.iCol+1,"rgt");t(r.p.iRow,s,"h");e(r).jqGrid("editCell",r.p.iRow,s,false)}break;case 13:parseInt(r.p.iCol,10)>=0&&parseInt(r.p.iRow,10)>=0&&e(r).jqGrid("editCell",r.p.iRow,r.p.iCol,true)}return false})}})},getChangedCells:function(t){var n=[];t||(t="all");this.each(function(){var r=this,i;!r.grid||r.p.cellEdit!==true||e(r.rows).each(function(s){var o={};if(e(this).hasClass("edited")){e("td",this).each(function(n){i=r.p.colModel[n].name;if(i!=="cb"&&i!=="subgrid")if(t=="dirty"){if(e(this).hasClass("dirty-cell"))try{o[i]=e.unformat(this,{rowId:r.rows[s].id,colModel:r.p.colModel[n]},n)}catch(u){o[i]=e.jgrid.htmlDecode(e(this).html())}}else try{o[i]=e.unformat(this,{rowId:r.rows[s].id,colModel:r.p.colModel[n]},n)}catch(l){o[i]=e.jgrid.htmlDecode(e(this).html())}});o.id=this.id;n.push(o)}})});return n}})})(jQuery);(function(e){e.fn.jqm=function(r){var i={overlay:50,closeoverlay:true,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:s,ajaxText:"",target:s,modal:s,toTop:s,onShow:s,onHide:s,onLoad:s};return this.each(function(){if(this._jqm)return n[this._jqm].c=e.extend({},n[this._jqm].c,r);t++;this._jqm=t;n[t]={c:e.extend(i,e.jqm.params,r),a:s,w:e(this).addClass("jqmID"+t),s:t};i.trigger&&e(this).jqmAddTrigger(i.trigger)})};e.fn.jqmAddClose=function(e){return l(this,e,"jqmHide")};e.fn.jqmAddTrigger=function(e){return l(this,e,"jqmShow")};e.fn.jqmShow=function(t){return this.each(function(){e.jqm.open(this._jqm,t)})};e.fn.jqmHide=function(t){return this.each(function(){e.jqm.close(this._jqm,t)})};e.jqm={hash:{},open:function(t,u){var f=n[t],l=f.c,c="."+l.closeClass,h=parseInt(f.w.css("z-index"));h=h>0?h:3e3;var d=e("<div></div>").css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":h-1,opacity:l.overlay/100});if(f.a)return s;f.t=u;f.a=true;f.w.css("z-index",h);if(l.modal){r[0]||setTimeout(function(){a("bind")},1);r.push(t)}else if(l.overlay>0)l.closeoverlay&&f.w.jqmAddClose(d);else d=s;f.o=d?d.addClass(l.overlayClass).prependTo("body"):s;if(i){e("html,body").css({height:"100%",width:"100%"});if(d){d=d.css({position:"absolute"})[0];for(var v in{Top:1,Left:1})d.style.setExpression(v.toLowerCase(),"(_=(document.documentElement.scroll"+v+" || document.body.scroll"+v+"))+'px'")}}if(l.ajax){h=l.target||f.w;d=l.ajax;h=typeof h=="string"?e(h,f.w):e(h);d=d.substr(0,1)=="@"?e(u).attr(d.substring(1)):d;h.html(l.ajaxText).load(d,function(){l.onLoad&&l.onLoad.call(this,f);c&&f.w.jqmAddClose(e(c,f.w));o(f)})}else c&&f.w.jqmAddClose(e(c,f.w));l.toTop&&f.o&&f.w.before('<span id="jqmP'+f.w[0]._jqm+'"></span>').insertAfter(f.o);l.onShow?l.onShow(f):f.w.show();o(f);return s},close:function(t){t=n[t];if(!t.a)return s;t.a=s;if(r[0]){r.pop();r[0]||a("unbind")}t.c.toTop&&t.o&&e("#jqmP"+t.w[0]._jqm).after(t.w).remove();if(t.c.onHide)t.c.onHide(t);else{t.w.hide();t.o&&t.o.remove()}return s},params:{}};var t=0,n=e.jqm.hash,r=[],i=e.browser.msie&&e.browser.version=="6.0",s=false,o=function(t){var n=e('<iframe src="javascript:false;document.write(\'\');" class="jqm"></iframe>').css({opacity:0});if(i)if(t.o)t.o.html('<p style="width:100%;height:100%"/>').prepend(n);else e("iframe.jqm",t.w)[0]||t.w.prepend(n);u(t)},u=function(t){try{e(":input:visible",t.w)[0].focus()}catch(n){}},a=function(t){e(document)[t]("keypress",f)[t]("keydown",f)[t]("mousedown",f)},f=function(t){var i=n[r[r.length-1]];(t=!e(t.target).parents(".jqmID"+i.s)[0])&&u(i);return!t},l=function(t,r,i){return t.each(function(){var t=this._jqm;e(r).each(function(){if(!this[i]){this[i]=[];e(this).click(function(){for(var e in{jqmShow:1,jqmHide:1})for(var t in this[e])if(n[this[e][t]])n[this[e][t]].w[e](this);return s})}this[i].push(t)})})}})(jQuery);(function(e){e.fn.jqDrag=function(e){return s(this,e,"d")};e.fn.jqResize=function(e,t){return s(this,e,"r",t)};e.jqDnR={dnr:{},e:0,drag:function(e){if(n.k=="d")r.css({left:n.X+e.pageX-n.pX,top:n.Y+e.pageY-n.pY});else{r.css({width:Math.max(e.pageX-n.pX+n.W,0),height:Math.max(e.pageY-n.pY+n.H,0)});M1&&i.css({width:Math.max(e.pageX-M1.pX+M1.W,0),height:Math.max(e.pageY-M1.pY+M1.H,0)})}return false},stop:function(){e(document).unbind("mousemove",t.drag).unbind("mouseup",t.stop)}};var t=e.jqDnR,n=t.dnr,r=t.e,i,s=function(t,s,u,a){return t.each(function(){s=s?e(s,t):t;s.bind("mousedown",{e:t,k:u},function(t){var s=t.data,u={};r=s.e;i=a?e(a):false;if(r.css("position")!="relative")try{r.position(u)}catch(l){}n={X:u.left||o("left")||0,Y:u.top||o("top")||0,W:o("width")||r[0].scrollWidth||0,H:o("height")||r[0].scrollHeight||0,pX:t.pageX,pY:t.pageY,k:s.k};M1=i&&s.k!="d"?{X:u.left||f1("left")||0,Y:u.top||f1("top")||0,W:i[0].offsetWidth||f1("width")||0,H:i[0].offsetHeight||f1("height")||0,pX:t.pageX,pY:t.pageY,k:s.k}:false;if(e("input.hasDatepicker",r[0])[0])try{e("input.hasDatepicker",r[0]).datepicker("hide")}catch(h){}e(document).mousemove(e.jqDnR.drag).mouseup(e.jqDnR.stop);return false})})},o=function(e){return parseInt(r.css(e))||false};f1=function(e){return parseInt(i.css(e))||false}})(jQuery);(function(e){e.jgrid.extend({setSubGrid:function(){return this.each(function(){var t;this.p.subGridOptions=e.extend({plusicon:"ui-icon-plus",minusicon:"ui-icon-minus",openicon:"ui-icon-carat-1-sw",expandOnLoad:false,delayOnLoad:50,selectOnExpand:false,reloadOnExpand:true},this.p.subGridOptions||{});this.p.colNames.unshift("");this.p.colModel.unshift({name:"subgrid",width:e.browser.safari?this.p.subGridWidth+this.p.cellLayout:this.p.subGridWidth,sortable:false,resizable:false,hidedlg:true,search:false,fixed:true});t=this.p.subGridModel;if(t[0]){t[0].align=e.extend([],t[0].align||[]);for(var n=0;n<t[0].name.length;n++)t[0].align[n]=t[0].align[n]||"left"}})},addSubGridCell:function(e,t){var n="",r,i;this.each(function(){n=this.formatCol(e,t);i=this.p.id;r=this.p.subGridOptions.plusicon});return'<td role="grid" aria-describedby="'+i+'_subgrid" class="ui-sgcollapsed sgcollapsed" '+n+"><a href='javascript:void(0);'><span class='ui-icon "+r+"'></span></a></td>"},addSubGrid:function(t){return this.each(function(){var n=this;if(n.grid){var r=function(t,r,i){r=e("<td align='"+n.p.subGridModel[0].align[i]+"'></td>").html(r);e(t).append(r)},i=function(t,i){var s,o,u,a=e("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),f=e("<tr></tr>");for(o=0;o<n.p.subGridModel[0].name.length;o++){s=e("<th class='ui-state-default ui-th-subgrid ui-th-column ui-th-"+n.p.direction+"'></th>");e(s).html(n.p.subGridModel[0].name[o]);e(s).width(n.p.subGridModel[0].width[o]);e(f).append(s)}e(a).append(f);if(t){u=n.p.xmlReader.subgrid;e(u.root+" "+u.row,t).each(function(){f=e("<tr class='ui-widget-content ui-subtblcell'></tr>");if(u.repeatitems===true)e(u.cell,this).each(function(t){r(f,e(this).text()||"&#160;",t)});else{var t=n.p.subGridModel[0].mapping||n.p.subGridModel[0].name;if(t)for(o=0;o<t.length;o++)r(f,e(t[o],this).text()||"&#160;",o)}e(a).append(f)})}s=e("table:first",n.grid.bDiv).attr("id")+"_";e("#"+s+i).append(a);n.grid.hDiv.loading=false;e("#load_"+n.p.id).hide();return false},s=function(t,i){var s,o,u,a,f,l=e("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),c=e("<tr></tr>");for(o=0;o<n.p.subGridModel[0].name.length;o++){s=e("<th class='ui-state-default ui-th-subgrid ui-th-column ui-th-"+n.p.direction+"'></th>");e(s).html(n.p.subGridModel[0].name[o]);e(s).width(n.p.subGridModel[0].width[o]);e(c).append(s)}e(l).append(c);if(t){a=n.p.jsonReader.subgrid;s=t[a.root];if(typeof s!=="undefined")for(o=0;o<s.length;o++){u=s[o];c=e("<tr class='ui-widget-content ui-subtblcell'></tr>");if(a.repeatitems===true){if(a.cell)u=u[a.cell];for(f=0;f<u.length;f++)r(c,u[f]||"&#160;",f)}else{var h=n.p.subGridModel[0].mapping||n.p.subGridModel[0].name;if(h.length)for(f=0;f<h.length;f++)r(c,u[h[f]]||"&#160;",f)}e(l).append(c)}}o=e("table:first",n.grid.bDiv).attr("id")+"_";e("#"+o+i).append(l);n.grid.hDiv.loading=false;e("#load_"+n.p.id).hide();return false},o=function(t){var r,o,u,a;r=e(t).attr("id");o={nd_:(new Date).getTime()};o[n.p.prmNames.subgridid]=r;if(!n.p.subGridModel[0])return false;if(n.p.subGridModel[0].params)for(a=0;a<n.p.subGridModel[0].params.length;a++)for(u=0;u<n.p.colModel.length;u++)if(n.p.colModel[u].name==n.p.subGridModel[0].params[a])o[n.p.colModel[u].name]=e("td:eq("+u+")",t).text().replace(/\&#160\;/ig,"");if(!n.grid.hDiv.loading){n.grid.hDiv.loading=true;e("#load_"+n.p.id).show();if(!n.p.subgridtype)n.p.subgridtype=n.p.datatype;if(e.isFunction(n.p.subgridtype))n.p.subgridtype.call(n,o);else n.p.subgridtype=n.p.subgridtype.toLowerCase();switch(n.p.subgridtype){case"xml":case"json":e.ajax(e.extend({type:n.p.mtype,url:n.p.subGridUrl,dataType:n.p.subgridtype,data:e.isFunction(n.p.serializeSubGridData)?n.p.serializeSubGridData.call(n,o):o,complete:function(t){n.p.subgridtype=="xml"?i(t.responseXML,r):s(e.jgrid.parse(t.responseText),r)}},e.jgrid.ajaxOptions,n.p.ajaxSubgridOptions||{}))}}return false},u,a,l,c=0,h,p;e.each(n.p.colModel,function(){if(this.hidden===true||this.name=="rn"||this.name=="cb")c++});e(n.rows).each(function(r){var i=this;if(e(i).hasClass("jqgrow")){e(this.cells[t]).bind("click",function(){p=i.nextSibling;if(e(this).hasClass("sgcollapsed")){a=n.p.id;u=i.id;if(n.p.subGridOptions.reloadOnExpand===true||n.p.subGridOptions.reloadOnExpand===false&&!e(p).hasClass("ui-subgrid")){l=t>=1?"<td colspan='"+t+"'>&#160;</td>":"";h=true;if(e.isFunction(n.p.subGridBeforeExpand))h=n.p.subGridBeforeExpand.call(n,a+"_"+u,u);if(h===false)return false;e(i).after("<tr role='row' class='ui-subgrid'>"+l+"<td class='ui-widget-content subgrid-cell'><span class='ui-icon "+n.p.subGridOptions.openicon+"'></span></td><td colspan='"+parseInt(n.p.colNames.length-1-c,10)+"' class='ui-widget-content subgrid-data'><div id="+a+"_"+u+" class='tablediv'></div></td></tr>");e.isFunction(n.p.subGridRowExpanded)?n.p.subGridRowExpanded.call(n,a+"_"+u,u):o(i)}else e(p).show();e(this).html("<a href='javascript:void(0);'><span class='ui-icon "+n.p.subGridOptions.minusicon+"'></span></a>").removeClass("sgcollapsed").addClass("sgexpanded");n.p.subGridOptions.selectOnExpand&&e(n).jqGrid("setSelection",u)}else if(e(this).hasClass("sgexpanded")){h=true;if(e.isFunction(n.p.subGridRowColapsed)){u=i.id;h=n.p.subGridRowColapsed.call(n,a+"_"+u,u)}if(h===false)return false;if(n.p.subGridOptions.reloadOnExpand===true)e(p).remove(".ui-subgrid");else e(p).hasClass("ui-subgrid")&&e(p).hide();e(this).html("<a href='javascript:void(0);'><span class='ui-icon "+n.p.subGridOptions.plusicon+"'></span></a>").removeClass("sgexpanded").addClass("sgcollapsed")}return false});n.p.subGridOptions.expandOnLoad===true&&setTimeout(function(){e(i.cells[t]).trigger("click")},r*n.p.subGridOptions.delayOnLoad)}});n.subGridXml=function(e,t){i(e,t)};n.subGridJson=function(e,t){s(e,t)}}})},expandSubGridRow:function(t){return this.each(function(){if(this.grid||t)if(this.p.subGrid===true){var n=e(this).jqGrid("getInd",t,true);if(n)(n=e("td.sgcollapsed",n)[0])&&e(n).trigger("click")}})},collapseSubGridRow:function(t){return this.each(function(){if(this.grid||t)if(this.p.subGrid===true){var n=e(this).jqGrid("getInd",t,true);if(n)(n=e("td.sgexpanded",n)[0])&&e(n).trigger("click")}})},toggleSubGridRow:function(t){return this.each(function(){if(this.grid||t)if(this.p.subGrid===true){var n=e(this).jqGrid("getInd",t,true);if(n){var r=e("td.sgcollapsed",n)[0];if(r)e(r).trigger("click");else(r=e("td.sgexpanded",n)[0])&&e(r).trigger("click")}}})}})})(jQuery);(function(e){e.jgrid.extend({groupingSetup:function(){return this.each(function(){var t=this.p.groupingView;if(t!==null&&(typeof t==="object"||e.isFunction(t)))if(t.groupField.length){if(typeof t.visibiltyOnNextGrouping=="undefined")t.visibiltyOnNextGrouping=[];for(var n=0;n<t.groupField.length;n++){t.groupOrder[n]||(t.groupOrder[n]="asc");t.groupText[n]||(t.groupText[n]="{0}");if(typeof t.groupColumnShow[n]!="boolean")t.groupColumnShow[n]=true;if(typeof t.groupSummary[n]!="boolean")t.groupSummary[n]=false;if(t.groupColumnShow[n]===true){t.visibiltyOnNextGrouping[n]=true;e(this).jqGrid("showCol",t.groupField[n])}else{t.visibiltyOnNextGrouping[n]=e("#"+this.p.id+"_"+t.groupField[n]).is(":visible");e(this).jqGrid("hideCol",t.groupField[n])}t.sortitems[n]=[];t.sortnames[n]=[];t.summaryval[n]=[];if(t.groupSummary[n]){t.summary[n]=[];for(var r=this.p.colModel,i=0,s=r.length;i<s;i++)r[i].summaryType&&t.summary[n].push({nm:r[i].name,st:r[i].summaryType,v:""})}}this.p.scroll=false;this.p.rownumbers=false;this.p.subGrid=false;this.p.treeGrid=false;this.p.gridview=true}else this.p.grouping=false;else this.p.grouping=false})},groupingPrepare:function(t,n,r,i){this.each(function(){n[0]+="";var s=n[0].toString().split(" ").join(""),o=this.p.groupingView,u=this;if(r.hasOwnProperty(s))r[s].push(t);else{r[s]=[];r[s].push(t);o.sortitems[0].push(s);o.sortnames[0].push(e.trim(n[0].toString()));o.summaryval[0][s]=e.extend(true,[],o.summary[0])}o.groupSummary[0]&&e.each(o.summaryval[0][s],function(){this.v=e.isFunction(this.st)?this.st.call(u,this.v,this.nm,i):e(u).jqGrid("groupingCalculations."+this.st,this.v,this.nm,i)})});return r},groupingToggle:function(t){this.each(function(){var n=this.p.groupingView,r=t.lastIndexOf("_"),i=t.substring(0,r+1);r=parseInt(t.substring(r+1),10)+1;var s=n.minusicon,o=n.plusicon,u=e("#"+t)[0].nextSibling,f=e("#"+t+" span.tree-wrap-"+this.p.direction),l=false;if(f.hasClass(s)){if(n.showSummaryOnHide&&n.groupSummary[0]){if(u)for(;u;){if(e(u).hasClass("jqfoot"))break;e(u).hide();u=u.nextSibling}}else if(u)for(;u;){if(e(u).attr("id")==i+String(r))break;e(u).hide();u=u.nextSibling}f.removeClass(s).addClass(o);l=true}else{if(u)for(;u;){if(e(u).attr("id")==i+String(r))break;e(u).show();u=u.nextSibling}f.removeClass(o).addClass(s);l=false}e.isFunction(this.p.onClickGroup)&&this.p.onClickGroup.call(this,t,l)});return false},groupingRender:function(t,n){return this.each(function(){var r=this,i=r.p.groupingView,s="",o="",u,f="",l,c,h;if(!i.groupDataSorted){i.sortitems[0].sort();i.sortnames[0].sort();if(i.groupOrder[0].toLowerCase()=="desc"){i.sortitems[0].reverse();i.sortnames[0].reverse()}}f=i.groupCollapse?i.plusicon:i.minusicon;f+=" tree-wrap-"+r.p.direction;for(h=0;h<n;){if(r.p.colModel[h].name==i.groupField[0]){c=h;break}h++}e.each(i.sortitems[0],function(h,p){u=r.p.id+"ghead_"+h;o="<span style='cursor:pointer;' class='ui-icon "+f+"' onclick=\"jQuery('#"+r.p.id+"').jqGrid('groupingToggle','"+u+"');return false;\"></span>";try{l=r.formatter(u,i.sortnames[0][h],c,i.sortitems[0])}catch(v){l=i.sortnames[0][h]}s+='<tr id="'+u+'" role="row" class= "ui-widget-content jqgroup ui-row-'+r.p.direction+'"><td colspan="'+n+'">'+o+e.jgrid.format(i.groupText[0],l,t[p].length)+"</td></tr>";for(var m=0;m<t[p].length;m++)s+=t[p][m].join("");if(i.groupSummary[0]){m="";if(i.groupCollapse&&!i.showSummaryOnHide)m=' style="display:none;"';s+="<tr"+m+' role="row" class="ui-widget-content jqfoot ui-row-'+r.p.direction+'">';m=i.summaryval[0][p];for(var y=r.p.colModel,w,E=t[p].length,S=0;S<n;S++){var x="<td "+r.formatCol(S,1,"")+">&#160;</td>",T="{0}";e.each(m,function(){if(this.nm==y[S].name){if(y[S].summaryTpl)T=y[S].summaryTpl;if(this.st=="avg")if(this.v&&E>0)this.v/=E;try{w=r.formatter("",this.v,S,this)}catch(t){w=this.v}x="<td "+r.formatCol(S,1,"")+">"+e.jgrid.format(T,w)+"</td>";return false}});s+=x}s+="</tr>"}});e("#"+r.p.id+" tbody:first").append(s);s=null})},groupingGroupBy:function(t,n){return this.each(function(){if(typeof t=="string")t=[t];var r=this.p.groupingView;this.p.grouping=true;for(var i=0;i<r.groupField.length;i++)!r.groupColumnShow[i]&&r.visibiltyOnNextGrouping[i]&&e(this).jqGrid("showCol",r.groupField[i]);for(i=0;i<t.length;i++)r.visibiltyOnNextGrouping[i]=e("#"+this.p.id+"_"+t[i]).is(":visible");this.p.groupingView=e.extend(this.p.groupingView,n||{});r.groupField=t;e(this).trigger("reloadGrid")})},groupingRemove:function(t){return this.each(function(){if(typeof t=="undefined")t=true;this.p.grouping=false;if(t===true){for(var n=this.p.groupingView,r=0;r<n.groupField.length;r++)!n.groupColumnShow[r]&&n.visibiltyOnNextGrouping[r]&&e(this).jqGrid("showCol",n.groupField);e("tr.jqgroup, tr.jqfoot","#"+this.p.id+" tbody:first").remove();e("tr.jqgrow:hidden","#"+this.p.id+" tbody:first").show()}else e(this).trigger("reloadGrid")})},groupingCalculations:{sum:function(e,t,n){return parseFloat(e||0)+parseFloat(n[t]||0)},min:function(e,t,n){if(e==="")return parseFloat(n[t]||0);return Math.min(parseFloat(e),parseFloat(n[t]||0))},max:function(e,t,n){if(e==="")return parseFloat(n[t]||0);return Math.max(parseFloat(e),parseFloat(n[t]||0))},count:function(e,t,n){if(e==="")e=0;return n.hasOwnProperty(t)?e+1:0},avg:function(e,t,n){return parseFloat(e||0)+parseFloat(n[t]||0)}}})})(jQuery);(function(e){e.jgrid.extend({setTreeNode:function(t,n){return this.each(function(){var r=this;if(r.grid&&r.p.treeGrid)for(var i=r.p.expColInd,s=r.p.treeReader.expanded_field,o=r.p.treeReader.leaf_field,u=r.p.treeReader.level_field,a=r.p.treeReader.icon_field,f=r.p.treeReader.loaded,l,h,p,v;t<n;){v=r.p.data[r.p._index[r.rows[t].id]];if(r.p.treeGridModel=="nested")if(!v[o]){l=parseInt(v[r.p.treeReader.left_field],10);h=parseInt(v[r.p.treeReader.right_field],10);v[o]=h===l+1?"true":"false";r.rows[t].cells[r.p._treeleafpos].innerHTML=v[o]}l=parseInt(v[u],10);if(r.p.tree_root_level===0){p=l+1;h=l}else{p=l;h=l-1}p="<div class='tree-wrap tree-wrap-"+r.p.direction+"' style='width:"+p*18+"px;'>";p+="<div style='"+(r.p.direction=="rtl"?"right:":"left:")+h*18+"px;' class='ui-icon ";if(v[f]!==undefined)v[f]=v[f]=="true"||v[f]===true?true:false;if(v[o]=="true"||v[o]===true){p+=(v[a]!==undefined&&v[a]!==""?v[a]:r.p.treeIcons.leaf)+" tree-leaf treeclick'";v[o]=true;h="leaf"}else{v[o]=false;h=""}v[s]=(v[s]=="true"||v[s]===true?true:false)&&v[f];p+=v[s]===true?r.p.treeIcons.minus+" tree-minus treeclick'":r.p.treeIcons.plus+" tree-plus treeclick'";p+="</div></div>";e(r.rows[t].cells[i]).wrapInner("<span class='cell-wrapper"+h+"'></span>").prepend(p);if(l!==parseInt(r.p.tree_root_level,10))(v=(v=e(r).jqGrid("getNodeParent",v))&&v.hasOwnProperty(s)?v[s]:true)||e(r.rows[t]).css("display","none");e(r.rows[t].cells[i]).find("div.treeclick").bind("click",function(t){t=e(t.target||t.srcElement,r.rows).closest("tr.jqgrow")[0].id;t=r.p._index[t];if(!r.p.data[t][o])if(r.p.data[t][s]){e(r).jqGrid("collapseRow",r.p.data[t]);e(r).jqGrid("collapseNode",r.p.data[t])}else{e(r).jqGrid("expandRow",r.p.data[t]);e(r).jqGrid("expandNode",r.p.data[t])}return false});r.p.ExpandColClick===true&&e(r.rows[t].cells[i]).find("span.cell-wrapper").css("cursor","pointer").bind("click",function(t){t=e(t.target||t.srcElement,r.rows).closest("tr.jqgrow")[0].id;var n=r.p._index[t];if(!r.p.data[n][o])if(r.p.data[n][s]){e(r).jqGrid("collapseRow",r.p.data[n]);e(r).jqGrid("collapseNode",r.p.data[n])}else{e(r).jqGrid("expandRow",r.p.data[n]);e(r).jqGrid("expandNode",r.p.data[n])}e(r).jqGrid("setSelection",t);return false});t++}})},setTreeGrid:function(){return this.each(function(){var t=this,n=0,r=false,i,s,o=[];if(t.p.treeGrid){t.p.treedatatype||e.extend(t.p,{treedatatype:t.p.datatype});t.p.subGrid=false;t.p.altRows=false;t.p.pgbuttons=false;t.p.pginput=false;t.p.gridview=true;t.p.multiselect=false;t.p.rowList=[];t.p.expColInd=0;t.p.treeIcons=e.extend({plus:"ui-icon-triangle-1-"+(t.p.direction=="rtl"?"w":"e"),minus:"ui-icon-triangle-1-s",leaf:"ui-icon-radio-off"},t.p.treeIcons||{});if(t.p.treeGridModel=="nested")t.p.treeReader=e.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},t.p.treeReader);else if(t.p.treeGridModel=="adjacency")t.p.treeReader=e.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},t.p.treeReader);for(s in t.p.colModel)if(t.p.colModel.hasOwnProperty(s)){i=t.p.colModel[s].name;if(i==t.p.ExpandColumn&&!r){r=true;t.p.expColInd=n}n++;for(var u in t.p.treeReader)t.p.treeReader[u]==i&&o.push(i)}e.each(t.p.treeReader,function(r,i){if(i&&e.inArray(i,o)===-1){if(r==="leaf_field")t.p._treeleafpos=n;n++;t.p.colNames.push(i);t.p.colModel.push({name:i,width:1,hidden:true,sortable:false,resizable:false,hidedlg:true,editable:true,search:false})}})}})},expandRow:function(t){this.each(function(){var n=this;if(n.grid&&n.p.treeGrid){var r=e(n).jqGrid("getNodeChildren",t),i=n.p.treeReader.expanded_field;e(r).each(function(){var t=e.jgrid.getAccessor(this,n.p.localReader.id);e("#"+t,n.grid.bDiv).css("display","");this[i]&&e(n).jqGrid("expandRow",this)})}})},collapseRow:function(t){this.each(function(){var n=this;if(n.grid&&n.p.treeGrid){var r=e(n).jqGrid("getNodeChildren",t),i=n.p.treeReader.expanded_field;e(r).each(function(){var t=e.jgrid.getAccessor(this,n.p.localReader.id);e("#"+t,n.grid.bDiv).css("display","none");this[i]&&e(n).jqGrid("collapseRow",this)})}})},getRootNodes:function(){var t=[];this.each(function(){var n=this;if(n.grid&&n.p.treeGrid)switch(n.p.treeGridModel){case"nested":var r=n.p.treeReader.level_field;e(n.p.data).each(function(){parseInt(this[r],10)===parseInt(n.p.tree_root_level,10)&&t.push(this)});break;case"adjacency":var i=n.p.treeReader.parent_id_field;e(n.p.data).each(function(){if(this[i]===null||String(this[i]).toLowerCase()=="null")t.push(this)})}});return t},getNodeDepth:function(t){var n=null;this.each(function(){if(this.grid&&this.p.treeGrid)switch(this.p.treeGridModel){case"nested":n=parseInt(t[this.p.treeReader.level_field],10)-parseInt(this.p.tree_root_level,10);break;case"adjacency":n=e(this).jqGrid("getNodeAncestors",t).length}});return n},getNodeParent:function(t){var n=null;this.each(function(){if(this.grid&&this.p.treeGrid)switch(this.p.treeGridModel){case"nested":var r=this.p.treeReader.left_field,i=this.p.treeReader.right_field,s=this.p.treeReader.level_field,o=parseInt(t[r],10),u=parseInt(t[i],10),a=parseInt(t[s],10);e(this.p.data).each(function(){if(parseInt(this[s],10)===a-1&&parseInt(this[r],10)<o&&parseInt(this[i],10)>u){n=this;return false}});break;case"adjacency":var f=this.p.treeReader.parent_id_field,l=this.p.localReader.id;e(this.p.data).each(function(){if(this[l]==t[f]){n=this;return false}})}});return n},getNodeChildren:function(t){var n=[];this.each(function(){if(this.grid&&this.p.treeGrid)switch(this.p.treeGridModel){case"nested":var r=this.p.treeReader.left_field,i=this.p.treeReader.right_field,s=this.p.treeReader.level_field,o=parseInt(t[r],10),u=parseInt(t[i],10),a=parseInt(t[s],10);e(this.p.data).each(function(){parseInt(this[s],10)===a+1&&parseInt(this[r],10)>o&&parseInt(this[i],10)<u&&n.push(this)});break;case"adjacency":var f=this.p.treeReader.parent_id_field,l=this.p.localReader.id;e(this.p.data).each(function(){this[f]==t[l]&&n.push(this)})}});return n},getFullTreeNode:function(t){var n=[];this.each(function(){var r;if(this.grid&&this.p.treeGrid)switch(this.p.treeGridModel){case"nested":var i=this.p.treeReader.left_field,s=this.p.treeReader.right_field,o=this.p.treeReader.level_field,u=parseInt(t[i],10),a=parseInt(t[s],10),f=parseInt(t[o],10);e(this.p.data).each(function(){parseInt(this[o],10)>=f&&parseInt(this[i],10)>=u&&parseInt(this[i],10)<=a&&n.push(this)});break;case"adjacency":if(t){n.push(t);var l=this.p.treeReader.parent_id_field,h=this.p.localReader.id;e(this.p.data).each(function(e){r=n.length;for(e=0;e<r;e++)if(n[e][h]==this[l]){n.push(this);break}})}}});return n},getNodeAncestors:function(t){var n=[];this.each(function(){if(this.grid&&this.p.treeGrid)for(var r=e(this).jqGrid("getNodeParent",t);r;){n.push(r);r=e(this).jqGrid("getNodeParent",r)}});return n},isVisibleNode:function(t){var n=true;this.each(function(){if(this.grid&&this.p.treeGrid){var r=e(this).jqGrid("getNodeAncestors",t),i=this.p.treeReader.expanded_field;e(r).each(function(){n=n&&this[i];if(!n)return false})}});return n},isNodeLoaded:function(t){var n;this.each(function(){if(this.grid&&this.p.treeGrid){var r=this.p.treeReader.leaf_field;n=t!==undefined?t.loaded!==undefined?t.loaded:t[r]||e(this).jqGrid("getNodeChildren",t).length>0?true:false:false}});return n},expandNode:function(t){return this.each(function(){if(this.grid&&this.p.treeGrid){var n=this.p.treeReader.expanded_field,r=this.p.treeReader.parent_id_field,i=this.p.treeReader.loaded,s=this.p.treeReader.level_field,o=this.p.treeReader.left_field,u=this.p.treeReader.right_field;if(!t[n]){var a=e.jgrid.getAccessor(t,this.p.localReader.id),f=e("#"+a,this.grid.bDiv)[0],l=this.p._index[a];if(e(this).jqGrid("isNodeLoaded",this.p.data[l])){t[n]=true;e("div.treeclick",f).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus")}else{t[n]=true;e("div.treeclick",f).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus");this.p.treeANode=f.rowIndex;this.p.datatype=this.p.treedatatype;this.p.treeGridModel=="nested"?e(this).jqGrid("setGridParam",{postData:{nodeid:a,n_left:t[o],n_right:t[u],n_level:t[s]}}):e(this).jqGrid("setGridParam",{postData:{nodeid:a,parentid:t[r],n_level:t[s]}});e(this).trigger("reloadGrid");t[i]=true;this.p.treeGridModel=="nested"?e(this).jqGrid("setGridParam",{postData:{nodeid:"",n_left:"",n_right:"",n_level:""}}):e(this).jqGrid("setGridParam",{postData:{nodeid:"",parentid:"",n_level:""}})}}}})},collapseNode:function(t){return this.each(function(){if(this.grid&&this.p.treeGrid)if(t.expanded){t.expanded=false;var n=e.jgrid.getAccessor(t,this.p.localReader.id);n=e("#"+n,this.grid.bDiv)[0];e("div.treeclick",n).removeClass(this.p.treeIcons.minus+" tree-minus").addClass(this.p.treeIcons.plus+" tree-plus")}})},SortTree:function(t,n,r,i){return this.each(function(){if(this.grid&&this.p.treeGrid){var s,o,u,f=[],l=this,h;s=e(this).jqGrid("getRootNodes");s=e.jgrid.from(s);s.orderBy(t,n,r,i);h=s.select();s=0;for(o=h.length;s<o;s++){u=h[s];f.push(u);e(this).jqGrid("collectChildrenSortTree",f,u,t,n,r,i)}e.each(f,function(t){var n=e.jgrid.getAccessor(this,l.p.localReader.id);e("#"+l.p.id+" tbody tr:eq("+t+")").after(e("tr#"+n,l.grid.bDiv))});f=h=s=null}})},collectChildrenSortTree:function(t,n,r,i,s,o){return this.each(function(){if(this.grid&&this.p.treeGrid){var u,f,l,p;u=e(this).jqGrid("getNodeChildren",n);u=e.jgrid.from(u);u.orderBy(r,i,s,o);p=u.select();u=0;for(f=p.length;u<f;u++){l=p[u];t.push(l);e(this).jqGrid("collectChildrenSortTree",t,l,r,i,s,o)}}})},setTreeRow:function(t,n){var r=false;this.each(function(){if(this.grid&&this.p.treeGrid)r=e(this).jqGrid("setRowData",t,n)});return r},delTreeNode:function(t){return this.each(function(){var n=this.p.localReader.id,r=this.p.treeReader.left_field,i=this.p.treeReader.right_field,s,o,u;if(this.grid&&this.p.treeGrid){var a=this.p._index[t];if(a!==undefined){s=parseInt(this.p.data[a][i],10);o=s-parseInt(this.p.data[a][r],10)+1;a=e(this).jqGrid("getFullTreeNode",this.p.data[a]);if(a.length>0)for(var f=0;f<a.length;f++)e(this).jqGrid("delRowData",a[f][n]);if(this.p.treeGridModel==="nested"){n=e.jgrid.from(this.p.data).greater(r,s,{stype:"integer"}).select();if(n.length)for(u in n)n[u][r]=parseInt(n[u][r],10)-o;n=e.jgrid.from(this.p.data).greater(i,s,{stype:"integer"}).select();if(n.length)for(u in n)n[u][i]=parseInt(n[u][i],10)-o}}}})},addChildNode:function(t,n,r){var i=this[0];if(r){var s=i.p.treeReader.expanded_field,o=i.p.treeReader.leaf_field,u=i.p.treeReader.level_field,a=i.p.treeReader.parent_id_field,f=i.p.treeReader.left_field,l=i.p.treeReader.right_field,c=i.p.treeReader.loaded,h,p,v,m,g;h=0;var y=n,b;if(!t){g=i.p.data.length-1;if(g>=0)for(;g>=0;){h=Math.max(h,parseInt(i.p.data[g][i.p.localReader.id],10));g--}t=h+1}var w=e(i).jqGrid("getInd",n);b=false;if(n===undefined||n===null||n===""){y=n=null;h="last";m=i.p.tree_root_level;g=i.p.data.length+1}else{h="after";p=i.p._index[n];v=i.p.data[p];n=v[i.p.localReader.id];m=parseInt(v[u],10)+1;g=e(i).jqGrid("getFullTreeNode",v);if(g.length){y=g=g[g.length-1][i.p.localReader.id];g=e(i).jqGrid("getInd",y)+1}else g=e(i).jqGrid("getInd",n)+1;if(v[o]){b=true;v[s]=true;e(i.rows[w]).find("span.cell-wrapperleaf").removeClass("cell-wrapperleaf").addClass("cell-wrapper").end().find("div.tree-leaf").removeClass(i.p.treeIcons.leaf+" tree-leaf").addClass(i.p.treeIcons.minus+" tree-minus");i.p.data[p][o]=false;v[c]=true}}p=g+1;r[s]=false;r[c]=true;r[u]=m;r[o]=true;if(i.p.treeGridModel==="adjacency")r[a]=n;if(i.p.treeGridModel==="nested"){var E;if(n!==null){o=parseInt(v[l],10);u=e.jgrid.from(i.p.data);u=u.greaterOrEquals(l,o,{stype:"integer"});u=u.select();if(u.length)for(E in u){u[E][f]=u[E][f]>o?parseInt(u[E][f],10)+2:u[E][f];u[E][l]=u[E][l]>=o?parseInt(u[E][l],10)+2:u[E][l]}r[f]=o;r[l]=o+1}else{o=parseInt(e(i).jqGrid("getCol",l,false,"max"),10);u=e.jgrid.from(i.p.data).greater(f,o,{stype:"integer"}).select();if(u.length)for(E in u)u[E][f]=parseInt(u[E][f],10)+2;u=e.jgrid.from(i.p.data).greater(l,o,{stype:"integer"}).select();if(u.length)for(E in u)u[E][l]=parseInt(u[E][l],10)+2;r[f]=o+1;r[l]=o+2}}if(n===null||e(i).jqGrid("isNodeLoaded",v)||b){e(i).jqGrid("addRowData",t,r,h,y);e(i).jqGrid("setTreeNode",g,p)}v&&!v[s]&&e(i.rows[w]).find("div.treeclick").click()}}})})(jQuery);(function(e){e.jgrid.extend({jqGridImport:function(t){t=e.extend({imptype:"xml",impstring:"",impurl:"",mtype:"GET",impData:{},xmlGrid:{config:"roots>grid",data:"roots>rows"},jsonGrid:{config:"grid",data:"data"},ajaxOptions:{}},t||{});return this.each(function(){var n=this,r=function(t,r){var i=e(r.xmlGrid.config,t)[0],s=e(r.xmlGrid.data,t)[0],o;if(xmlJsonClass.xml2json&&e.jgrid.parse){i=xmlJsonClass.xml2json(i," ");i=e.jgrid.parse(i);for(var u in i)if(i.hasOwnProperty(u))o=i[u];if(s){s=i.grid.datatype;i.grid.datatype="xmlstring";i.grid.datastr=t;e(n).jqGrid(o).jqGrid("setGridParam",{datatype:s})}else e(n).jqGrid(o)}else alert("xml2json or parse are not present")},i=function(t,r){if(t&&typeof t=="string"){var i=e.jgrid.parse(t),s=i[r.jsonGrid.config];if(i=i[r.jsonGrid.data]){var o=s.datatype;s.datatype="jsonstring";s.datastr=i;e(n).jqGrid(s).jqGrid("setGridParam",{datatype:o})}else e(n).jqGrid(s)}};switch(t.imptype){case"xml":e.ajax(e.extend({url:t.impurl,type:t.mtype,data:t.impData,dataType:"xml",complete:function(n,i){if(i=="success"){r(n.responseXML,t);e.isFunction(t.importComplete)&&t.importComplete(n)}}},t.ajaxOptions));break;case"xmlstring":if(t.impstring&&typeof t.impstring=="string"){var s=e.jgrid.stringToDoc(t.impstring);if(s){r(s,t);e.isFunction(t.importComplete)&&t.importComplete(s);t.impstring=null}s=null}break;case"json":e.ajax(e.extend({url:t.impurl,type:t.mtype,data:t.impData,dataType:"json",complete:function(n,r){if(r=="success"){i(n.responseText,t);e.isFunction(t.importComplete)&&t.importComplete(n)}}},t.ajaxOptions));break;case"jsonstring":if(t.impstring&&typeof t.impstring=="string"){i(t.impstring,t);e.isFunction(t.importComplete)&&t.importComplete(t.impstring);t.impstring=null}}})},jqGridExport:function(t){t=e.extend({exptype:"xmlstring",root:"grid",ident:"	"},t||{});var n=null;this.each(function(){if(this.grid){var r=e.extend({},e(this).jqGrid("getGridParam"));if(r.rownumbers){r.colNames.splice(0,1);r.colModel.splice(0,1)}if(r.multiselect){r.colNames.splice(0,1);r.colModel.splice(0,1)}if(r.subGrid){r.colNames.splice(0,1);r.colModel.splice(0,1)}r.knv=null;if(r.treeGrid)for(var i in r.treeReader)if(r.treeReader.hasOwnProperty(i)){r.colNames.splice(r.colNames.length-1);r.colModel.splice(r.colModel.length-1)}switch(t.exptype){case"xmlstring":n="<"+t.root+">"+xmlJsonClass.json2xml(r,t.ident)+"</"+t.root+">";break;case"jsonstring":n="{"+xmlJsonClass.toJson(r,t.root,t.ident)+"}";if(r.postData.filters!==undefined){n=n.replace(/filters":"/,'filters":');n=n.replace(/}]}"/,"}]}")}}}});return n},excelExport:function(t){t=e.extend({exptype:"remote",url:null,oper:"oper",tag:"excel",exportOptions:{}},t||{});return this.each(function(){if(this.grid){var n;if(t.exptype=="remote"){n=e.extend({},this.p.postData);n[t.oper]=t.tag;n=jQuery.param(n);n=t.url.indexOf("?")!=-1?t.url+"&"+n:t.url+"?"+n;window.location=n}}})}})})(jQuery);var xmlJsonClass={xml2json:function(e,t){if(e.nodeType===9)e=e.documentElement;var n=this.toJson(this.toObj(this.removeWhite(e)),e.nodeName,"	");return"{\n"+t+(t?n.replace(/\t/g,t):n.replace(/\t|\n/g,""))+"\n}"},json2xml:function(e,t){var n=function(e,t,r){var i="",s,o;if(e instanceof Array)if(e.length===0)i+=r+"<"+t+">__EMPTY_ARRAY_</"+t+">\n";else{s=0;for(o=e.length;s<o;s+=1){var u=r+n(e[s],t,r+"	")+"\n";i+=u}}else if(typeof e==="object"){s=false;i+=r+"<"+t;for(o in e)if(e.hasOwnProperty(o))if(o.charAt(0)==="@")i+=" "+o.substr(1)+'="'+e[o].toString()+'"';else s=true;i+=s?">":"/>";if(s){for(o in e)if(e.hasOwnProperty(o))if(o==="#text")i+=e[o];else if(o==="#cdata")i+="<![CDATA["+e[o]+"]]>";else if(o.charAt(0)!=="@")i+=n(e[o],o,r+"	");i+=(i.charAt(i.length-1)==="\n"?r:"")+"</"+t+">"}}else i+=typeof e==="function"?r+"<"+t+"><![CDATA["+e+"]]></"+t+">":e.toString()==='""'||e.toString().length===0?r+"<"+t+">__EMPTY_STRING_</"+t+">":r+"<"+t+">"+e.toString()+"</"+t+">";return i},r="",i;for(i in e)if(e.hasOwnProperty(i))r+=n(e[i],i,"");return t?r.replace(/\t/g,t):r.replace(/\t|\n/g,"")},toObj:function(e){var t={},n=/function/i;if(e.nodeType===1){if(e.attributes.length){var r;for(r=0;r<e.attributes.length;r+=1)t["@"+e.attributes[r].nodeName]=(e.attributes[r].nodeValue||"").toString()}if(e.firstChild){var i=r=0,s=false,o;for(o=e.firstChild;o;o=o.nextSibling)if(o.nodeType===1)s=true;else if(o.nodeType===3&&o.nodeValue.match(/[^ \f\n\r\t\v]/))r+=1;else if(o.nodeType===4)i+=1;if(s)if(r<2&&i<2){this.removeWhite(e);for(o=e.firstChild;o;o=o.nextSibling)if(o.nodeType===3)t["#text"]=this.escape(o.nodeValue);else if(o.nodeType===4)if(n.test(o.nodeValue))t[o.nodeName]=[t[o.nodeName],o.nodeValue];else t["#cdata"]=this.escape(o.nodeValue);else if(t[o.nodeName])if(t[o.nodeName]instanceof Array)t[o.nodeName][t[o.nodeName].length]=this.toObj(o);else t[o.nodeName]=[t[o.nodeName],this.toObj(o)];else t[o.nodeName]=this.toObj(o)}else if(e.attributes.length)t["#text"]=this.escape(this.innerXml(e));else t=this.escape(this.innerXml(e));else if(r)if(e.attributes.length)t["#text"]=this.escape(this.innerXml(e));else{t=this.escape(this.innerXml(e));if(t==="__EMPTY_ARRAY_")t="[]";else if(t==="__EMPTY_STRING_")t=""}else if(i)if(i>1)t=this.escape(this.innerXml(e));else for(o=e.firstChild;o;o=o.nextSibling)if(n.test(e.firstChild.nodeValue)){t=e.firstChild.nodeValue;break}else t["#cdata"]=this.escape(o.nodeValue)}if(!e.attributes.length&&!e.firstChild)t=null}else if(e.nodeType===9)t=this.toObj(e.documentElement);else alert("unhandled node type: "+e.nodeType);return t},toJson:function(e,t,n,r){if(r===undefined)r=true;var i=t?'"'+t+'"':"",s="	",o="\n";if(!r)o=s="";if(e==="[]")i+=t?":[]":"[]";else if(e instanceof Array){var u,a,f=[];a=0;for(u=e.length;a<u;a+=1)f[a]=this.toJson(e[a],"",n+s,r);i+=(t?":[":"[")+(f.length>1?o+n+s+f.join(","+o+n+s)+o+n:f.join(""))+"]"}else if(e===null)i+=(t&&":")+"null";else if(typeof e==="object"){u=[];for(a in e)if(e.hasOwnProperty(a))u[u.length]=this.toJson(e[a],a,n+s,r);i+=(t?":{":"{")+(u.length>1?o+n+s+u.join(","+o+n+s)+o+n:u.join(""))+"}"}else i+=typeof e==="string"?(t&&":")+'"'+e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"':(t&&":")+'"'+e.toString()+'"';return i},innerXml:function(e){var t="";if("innerHTML"in e)t=e.innerHTML;else{var n=function(e){var t="",r;if(e.nodeType===1){t+="<"+e.nodeName;for(r=0;r<e.attributes.length;r+=1)t+=" "+e.attributes[r].nodeName+'="'+(e.attributes[r].nodeValue||"").toString()+'"';if(e.firstChild){t+=">";for(r=e.firstChild;r;r=r.nextSibling)t+=n(r);t+="</"+e.nodeName+">"}else t+="/>"}else if(e.nodeType===3)t+=e.nodeValue;else if(e.nodeType===4)t+="<![CDATA["+e.nodeValue+"]]>";return t};for(e=e.firstChild;e;e=e.nextSibling)t+=n(e)}return t},escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();var t;for(t=e.firstChild;t;)if(t.nodeType===3)if(t.nodeValue.match(/[^ \f\n\r\t\v]/))t=t.nextSibling;else{var n=t.nextSibling;e.removeChild(t);t=n}else{t.nodeType===1&&this.removeWhite(t);t=t.nextSibling}return e}};(function(a){if(a.browser.msie&&a.browser.version==8)a.expr[":"].hidden=function(e){return e.offsetWidth===0||e.offsetHeight===0||e.style.display=="none"};a.jgrid._multiselect=false;if(a.ui)if(a.ui.multiselect){if(a.ui.multiselect.prototype._setSelected){var q=a.ui.multiselect.prototype._setSelected;a.ui.multiselect.prototype._setSelected=function(e,t){var n=q.call(this,e,t);if(t&&this.selectedList){var r=this.element;this.selectedList.find("li").each(function(){a(this).data("optionLink")&&a(this).data("optionLink").remove().appendTo(r)})}return n}}if(a.ui.multiselect.prototype.destroy)a.ui.multiselect.prototype.destroy=function(){this.element.show();this.container.remove();a.Widget===undefined?a.widget.prototype.destroy.apply(this,arguments):a.Widget.prototype.destroy.apply(this,arguments)};a.jgrid._multiselect=true}a.jgrid.extend({sortableColumns:function(e){return this.each(function(){function t(){n.p.disableClick=true}var n=this,r={tolerance:"pointer",axis:"x",scrollSensitivity:"1",items:">th:not(:has(#jqgh_cb,#jqgh_rn,#jqgh_subgrid),:hidden)",placeholder:{element:function(e){return a(document.createElement(e[0].nodeName)).addClass(e[0].className+" ui-sortable-placeholder ui-state-highlight").removeClass("ui-sortable-helper")[0]},update:function(e,t){t.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10));t.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10))}},update:function(e,t){var r=a(t.item).parent();r=a(">th",r);var i={};a.each(n.p.colModel,function(e){i[this.name]=e});var s=[];r.each(function(){var e=a(">div",this).get(0).id.replace(/^jqgh_/,"");e in i&&s.push(i[e])});a(n).jqGrid("remapColumns",s,true,true);a.isFunction(n.p.sortable.update)&&n.p.sortable.update(s);setTimeout(function(){n.p.disableClick=false},50)}};if(n.p.sortable.options)a.extend(r,n.p.sortable.options);else if(a.isFunction(n.p.sortable))n.p.sortable={update:n.p.sortable};if(r.start){var i=r.start;r.start=function(e,n){t();i.call(this,e,n)}}else r.start=t;if(n.p.sortable.exclude)r.items+=":not("+n.p.sortable.exclude+")";e.sortable(r).data("sortable").floating=true})},columnChooser:function(e){function t(e,t){if(e)if(typeof e=="string")a.fn[e]&&a.fn[e].apply(t,a.makeArray(arguments).slice(2));else a.isFunction(e)&&e.apply(t,a.makeArray(arguments).slice(2))}var n=this;if(!a("#colchooser_"+n[0].p.id).length){var r=a('<div id="colchooser_'+n[0].p.id+'" style="position:relative;overflow:hidden"><div><select multiple="multiple"></select></div></div>'),i=a("select",r);e=a.extend({width:420,height:240,classname:null,done:function(e){e&&n.jqGrid("remapColumns",e,true)},msel:"multiselect",dlog:"dialog",dlog_opts:function(e){var t={};t[e.bSubmit]=function(){e.apply_perm();e.cleanup(false)};t[e.bCancel]=function(){e.cleanup(true)};return{buttons:t,close:function(){e.cleanup(true)},modal:e.modal?e.modal:false,resizable:e.resizable?e.resizable:true,width:e.width+20}},apply_perm:function(){a("option",i).each(function(){this.selected?n.jqGrid("showCol",s[this.value].name):n.jqGrid("hideCol",s[this.value].name)});var t=[];a("option[selected]",i).each(function(){t.push(parseInt(this.value,10))});a.each(t,function(){delete u[s[parseInt(this,10)].name]});a.each(u,function(){var e=parseInt(this,10);var n=t,r=e;if(r>=0){var i=n.slice(),s=i.splice(r,Math.max(n.length-r,r));if(r>n.length)r=n.length;i[r]=e;t=i.concat(s)}else t=void 0});e.done&&e.done.call(n,t)},cleanup:function(s){t(e.dlog,r,"destroy");t(e.msel,i,"destroy");r.remove();s&&e.done&&e.done.call(n)},msel_opts:{}},a.jgrid.col,e||{});if(a.ui)if(a.ui.multiselect)if(e.msel=="multiselect"){if(!a.jgrid._multiselect){alert("Multiselect plugin loaded after jqGrid. Please load the plugin before the jqGrid!");return}e.msel_opts=a.extend(a.ui.multiselect.defaults,e.msel_opts)}e.caption&&r.attr("title",e.caption);if(e.classname){r.addClass(e.classname);i.addClass(e.classname)}if(e.width){a(">div",r).css({width:e.width,margin:"0 auto"});i.css("width",e.width)}if(e.height){a(">div",r).css("height",e.height);i.css("height",e.height-10)}var s=n.jqGrid("getGridParam","colModel"),o=n.jqGrid("getGridParam","colNames"),u={},f=[];i.empty();a.each(s,function(e){u[this.name]=e;if(this.hidedlg)this.hidden||f.push(e);else i.append("<option value='"+e+"' "+(this.hidden?"":"selected='selected'")+">"+o[e]+"</option>")});var l=a.isFunction(e.dlog_opts)?e.dlog_opts.call(n,e):e.dlog_opts;t(e.dlog,r,l);l=a.isFunction(e.msel_opts)?e.msel_opts.call(n,e):e.msel_opts;t(e.msel,i,l)}},sortableRows:function(e){return this.each(function(){var t=this;if(t.grid)if(!t.p.treeGrid)if(a.fn.sortable){e=a.extend({cursor:"move",axis:"y",items:".jqgrow"},e||{});if(e.start&&a.isFunction(e.start)){e._start_=e.start;delete e.start}else e._start_=false;if(e.update&&a.isFunction(e.update)){e._update_=e.update;delete e.update}else e._update_=false;e.start=function(n,r){a(r.item).css("border-width","0px");a("td",r.item).each(function(e){this.style.width=t.grid.cols[e].style.width});if(t.p.subGrid){var i=a(r.item).attr("id");try{a(t).jqGrid("collapseSubGridRow",i)}catch(s){}}e._start_&&e._start_.apply(this,[n,r])};e.update=function(n,r){a(r.item).css("border-width","");t.p.rownumbers===true&&a("td.jqgrid-rownum",t.rows).each(function(e){a(this).html(e+1)});e._update_&&e._update_.apply(this,[n,r])};a("tbody:first",t).sortable(e);a("tbody:first",t).disableSelection()}})},gridDnD:function(e){return this.each(function(){function t(){var e=a.data(n,"dnd");a("tr.jqgrow:not(.ui-draggable)",n).draggable(a.isFunction(e.drag)?e.drag.call(a(n),e):e.drag)}var n=this;if(n.grid)if(!n.p.treeGrid)if(a.fn.draggable&&a.fn.droppable){a("#jqgrid_dnd").html()===null&&a("body").append("<table id='jqgrid_dnd' class='ui-jqgrid-dnd'></table>");if(typeof e=="string"&&e=="updateDnD"&&n.p.jqgdnd===true)t();else{e=a.extend({drag:function(e){return a.extend({start:function(t,r){if(n.p.subGrid){var i=a(r.helper).attr("id");try{a(n).jqGrid("collapseSubGridRow",i)}catch(s){}}for(i=0;i<a.data(n,"dnd").connectWith.length;i++)a(a.data(n,"dnd").connectWith[i]).jqGrid("getGridParam","reccount")=="0"&&a(a.data(n,"dnd").connectWith[i]).jqGrid("addRowData","jqg_empty_row",{});r.helper.addClass("ui-state-highlight");a("td",r.helper).each(function(e){this.style.width=n.grid.headers[e].width+"px"});e.onstart&&a.isFunction(e.onstart)&&e.onstart.call(a(n),t,r)},stop:function(t,r){if(r.helper.dropped){var i=a(r.helper).attr("id");a(n).jqGrid("delRowData",i)}for(i=0;i<a.data(n,"dnd").connectWith.length;i++)a(a.data(n,"dnd").connectWith[i]).jqGrid("delRowData","jqg_empty_row");e.onstop&&a.isFunction(e.onstop)&&e.onstop.call(a(n),t,r)}},e.drag_opts||{})},drop:function(e){return a.extend({accept:function(e){if(!a(e).hasClass("jqgrow"))return e;var t=a(e).closest("table.ui-jqgrid-btable");if(t.length>0&&a.data(t[0],"dnd")!==undefined){e=a.data(t[0],"dnd").connectWith;return a.inArray("#"+this.id,e)!=-1?true:false}return e},drop:function(t,r){if(a(r.draggable).hasClass("jqgrow")){var i=a(r.draggable).attr("id");i=r.draggable.parent().parent().jqGrid("getRowData",i);if(!e.dropbyname){var s=0,o={},u,f=a("#"+this.id).jqGrid("getGridParam","colModel");try{for(var l in i){if(i.hasOwnProperty(l)&&f[s]){u=f[s].name;o[u]=i[l]}s++}i=o}catch(h){}}r.helper.dropped=true;if(e.beforedrop&&a.isFunction(e.beforedrop)){u=e.beforedrop.call(this,t,r,i,a("#"+n.id),a(this));if(typeof u!="undefined"&&u!==null&&typeof u=="object")i=u}if(r.helper.dropped){var p;if(e.autoid)if(a.isFunction(e.autoid))p=e.autoid.call(this,i);else{p=Math.ceil(Math.random()*1e3);p=e.autoidprefix+p}a("#"+this.id).jqGrid("addRowData",p,i,e.droppos)}e.ondrop&&a.isFunction(e.ondrop)&&e.ondrop.call(this,t,r,i)}}},e.drop_opts||{})},onstart:null,onstop:null,beforedrop:null,ondrop:null,drop_opts:{activeClass:"ui-state-active",hoverClass:"ui-state-hover"},drag_opts:{revert:"invalid",helper:"clone",cursor:"move",appendTo:"#jqgrid_dnd",zIndex:5e3},dropbyname:false,droppos:"first",autoid:true,autoidprefix:"dnd_"},e||{});if(e.connectWith){e.connectWith=e.connectWith.split(",");e.connectWith=a.map(e.connectWith,function(e){return a.trim(e)});a.data(n,"dnd",e);n.p.reccount!="0"&&!n.p.jqgdnd&&t();n.p.jqgdnd=true;for(var r=0;r<e.connectWith.length;r++)a(e.connectWith[r]).droppable(a.isFunction(e.drop)?e.drop.call(a(n),e):e.drop)}}}})},gridResize:function(b){return this.each(function(){var g=this;if(g.grid&&a.fn.resizable){b=a.extend({},b||{});if(b.alsoResize){b._alsoResize_=b.alsoResize;delete b.alsoResize}else b._alsoResize_=false;if(b.stop&&a.isFunction(b.stop)){b._stop_=b.stop;delete b.stop}else b._stop_=false;b.stop=function(e,t){a(g).jqGrid("setGridParam",{height:a("#gview_"+g.p.id+" .ui-jqgrid-bdiv").height()});a(g).jqGrid("setGridWidth",t.size.width,b.shrinkToFit);b._stop_&&b._stop_.call(g,e,t)};b.alsoResize=b._alsoResize_?eval("("+("{'#gview_"+g.p.id+" .ui-jqgrid-bdiv':true,'"+b._alsoResize_+"':true}")+")"):a(".ui-jqgrid-bdiv","#gview_"+g.p.id);delete b._alsoResize_;a("#gbox_"+g.p.id).resizable(b)}})}})})(jQuery)});define("jquery-layout",["jquery"],function(jQuery){(function($){var min=Math.min,max=Math.max,round=Math.floor,isStr=function(e){return $.type(e)==="string"},runPluginCallbacks=function(Instance,a_fn){function g(e){return e}if($.isArray(a_fn))for(var i=0,c=a_fn.length;i<c;i++){var fn=a_fn[i];try{if(isStr(fn))fn=eval(fn);if($.isFunction(fn))g(fn)(Instance)}catch(ex){}}};$.layout={version:"1.3.rc30.7",revision:.033007,browser:{mozilla:!!$.browser.mozilla,webkit:!!$.browser.webkit||!!$.browser.safari,msie:!!$.browser.msie,isIE6:$.browser.msie&&$.browser.version==6,boxModel:$.support.boxModel!==false||!$.browser.msie,version:$.browser.version},effects:{slide:{all:{duration:"fast"},north:{direction:"up"},south:{direction:"down"},east:{direction:"right"},west:{direction:"left"}},drop:{all:{duration:"slow"},north:{direction:"up"},south:{direction:"down"},east:{direction:"right"},west:{direction:"left"}},scale:{all:{duration:"fast"}},blind:{},clip:{},explode:{},fade:{},fold:{},puff:{},size:{all:{easing:"swing"}}},config:{optionRootKeys:"effects,panes,north,south,west,east,center".split(","),allPanes:"north,south,west,east,center".split(","),borderPanes:"north,south,west,east".split(","),oppositeEdge:{north:"south",south:"north",east:"west",west:"east"},offscreenCSS:{left:"-99999px",right:"auto"},offscreenReset:"offscreenReset",hidden:{visibility:"hidden"},visible:{visibility:"visible"},resizers:{cssReq:{position:"absolute",padding:0,margin:0,fontSize:"1px",textAlign:"left",overflow:"hidden"},cssDemo:{background:"#DDD",border:"none"}},togglers:{cssReq:{position:"absolute",display:"block",padding:0,margin:0,overflow:"hidden",textAlign:"center",fontSize:"1px",cursor:"pointer",zIndex:1},cssDemo:{background:"#AAA"}},content:{cssReq:{position:"relative"},cssDemo:{overflow:"auto",padding:"10px"},cssDemoPane:{overflow:"hidden",padding:0}},panes:{cssReq:{position:"absolute",margin:0},cssDemo:{padding:"10px",background:"#FFF",border:"1px solid #BBB",overflow:"auto"}},north:{side:"top",sizeType:"Height",dir:"horz",cssReq:{top:0,bottom:"auto",left:0,right:0,width:"auto"}},south:{side:"bottom",sizeType:"Height",dir:"horz",cssReq:{top:"auto",bottom:0,left:0,right:0,width:"auto"}},east:{side:"right",sizeType:"Width",dir:"vert",cssReq:{left:"auto",right:0,top:"auto",bottom:"auto",height:"auto"}},west:{side:"left",sizeType:"Width",dir:"vert",cssReq:{left:0,right:"auto",top:"auto",bottom:"auto",height:"auto"}},center:{dir:"center",cssReq:{left:"auto",right:"auto",top:"auto",bottom:"auto",height:"auto",width:"auto"}}},callbacks:{},getParentPaneElem:function(e){var t=$(e),n=t.data("layout")||t.data("parentLayout");if(n){var r=n.container;if(r.data("layoutPane"))return r;var i=r.closest("."+$.layout.defaults.panes.paneClass);if(i.data("layoutPane"))return i}return null},getParentPaneInstance:function(e){var t=$.layout.getParentPaneElem(e);return t?t.data("layoutPane"):null},getParentLayoutInstance:function(e){var t=$.layout.getParentPaneElem(e);return t?t.data("parentLayout"):null},getEventObject:function(e){return typeof e==="object"&&e.stopPropagation?e:null},parsePaneName:function(e){var t=$.layout.getEventObject(e);if(t){t.stopPropagation();return $(this).data("layoutEdge")}else return e},plugins:{draggable:!!$.fn.draggable,effects:{core:!!$.effects,slide:$.effects&&($.effects.slide||$.effects.effect.slide)}},onCreate:[],onLoad:[],onReady:[],onDestroy:[],onUnload:[],afterOpen:[],afterClose:[],scrollbarWidth:function(){return window.scrollbarWidth||$.layout.getScrollbarSize("width")},scrollbarHeight:function(){return window.scrollbarHeight||$.layout.getScrollbarSize("height")},getScrollbarSize:function(e){var t=$('<div style="position: absolute; top: -10000px; left: -10000px; width: 100px; height: 100px; overflow: scroll;"></div>').appendTo("body");var n={width:t.css("width")-t[0].clientWidth,height:t.height()-t[0].clientHeight};t.remove();window.scrollbarWidth=n.width;window.scrollbarHeight=n.height;return e.match(/^(width|height)$/)?n[e]:n},showInvisibly:function(e,t){if(e&&e.length&&(t||e.css("display")==="none")){var n=e[0].style,r={display:n.display||"",visibility:n.visibility||""};e.css({display:"block",visibility:"hidden"});return r}return{}},getElementDimensions:function(e,t){var n={css:{},inset:{}},r=n.css,i={bottom:0},s=$.layout.cssNum,o=e.offset(),u,a,f;n.offsetLeft=o.left;n.offsetTop=o.top;if(!t)t={};$.each("Left,Right,Top,Bottom".split(","),function(s,o){u=r["border"+o]=$.layout.borderWidth(e,o);a=r["padding"+o]=$.layout.cssNum(e,"padding"+o);f=o.toLowerCase();n.inset[f]=t[f]>=0?t[f]:a;i[f]=n.inset[f]+u});r.width=e.css("width");r.height=e.height();r.top=s(e,"top",true);r.bottom=s(e,"bottom",true);r.left=s(e,"left",true);r.right=s(e,"right",true);n.outerWidth=e.outerWidth();n.outerHeight=e.outerHeight();n.innerWidth=max(0,n.outerWidth-i.left-i.right);n.innerHeight=max(0,n.outerHeight-i.top-i.bottom);n.layoutWidth=e.innerWidth();n.layoutHeight=e.innerHeight();return n},getElementStyles:function(e,t){var n={},r=e[0].style,i=t.split(","),s="Top,Bottom,Left,Right".split(","),o="Color,Style,Width".split(","),u,a,f,l,c,h;for(l=0;l<i.length;l++){u=i[l];if(u.match(/(border|padding|margin)$/))for(c=0;c<4;c++){a=s[c];if(u==="border")for(h=0;h<3;h++){f=o[h];n[u+a+f]=r[u+a+f]}else n[u+a]=r[u+a]}else n[u]=r[u]}return n},cssWidth:function(e,t){if(t<=0)return 0;if(!$.layout.browser.boxModel)return t;var n=$.layout.borderWidth,r=$.layout.cssNum,i=t-n(e,"Left")-n(e,"Right")-r(e,"paddingLeft")-r(e,"paddingRight");return max(0,i)},cssHeight:function(e,t){if(t<=0)return 0;if(!$.layout.browser.boxModel)return t;var n=$.layout.borderWidth,r=$.layout.cssNum,i=t-n(e,"Top")-n(e,"Bottom")-r(e,"paddingTop")-r(e,"paddingBottom");return max(0,i)},cssNum:function(e,t,n){if(!e.jquery)e=$(e);var r=$.layout.showInvisibly(e),i=$.css(e[0],t,true),s=n&&i=="auto"?i:Math.round(parseFloat(i)||0);e.css(r);return s},borderWidth:function(e,t){if(e.jquery)e=e[0];var n="border"+t.substr(0,1).toUpperCase()+t.substr(1);return $.css(e,n+"Style",true)==="none"?0:Math.round(parseFloat($.css(e,n+"Width",true))||0)},isMouseOverElem:function(e,t){var n=$(t||this),r=n.offset(),i=r.top,s=r.left,o=s+n.outerWidth(),u=i+n.outerHeight(),a=e.pageX,f=e.pageY;return $.layout.browser.msie&&a<0&&f<0||a>=s&&a<=o&&f>=i&&f<=u},msg:function(e,t,n,r){function a(){var e=$.support.fixedPosition?"fixed":"absolute",t=$('<div id="layoutLogger" style="position: '+e+'; top: 5px; z-index: 999999; max-width: 25%; overflow: hidden; border: 1px solid #000; border-radius: 5px; background: #FBFBFB; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">'+'<div style="font-size: 13px; font-weight: bold; padding: 5px 10px; background: #F6F6F6; border-radius: 5px 5px 0 0; cursor: move;">'+'<span style="float: right; padding-left: 7px; cursor: pointer;" title="Remove Console" onclick="$(this).closest(\'#layoutLogger\').remove()">X</span>Layout console.log</div>'+'<ul style="font-size: 13px; font-weight: none; list-style: none; margin: 0; padding: 0 0 2px;"></ul>'+"</div>").appendTo("body");t.css("left",$(window).width()-t.outerWidth()-5);if($.ui.draggable)t.draggable({handle:":first-child"});return t}if($.isPlainObject(e)&&window.debugData){if(typeof t==="string"){r=n;n=t}else if(typeof n==="object"){r=n;n=null}var i=n||"log( <object> )",s=$.extend({sort:false,returnHTML:false,display:false},r);if(t===true||s.display)debugData(e,i,s);else if(window.console)console.log(debugData(e,i,s))}else if(t)alert(e);else if(window.console)console.log(e);else{var o="#layoutLogger",u=$(o);if(!u.length)u=a();u.children("ul").append('<li style="padding: 4px 10px; margin: 0; border-top: 1px solid #CCC;">'+e.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")+"</li>")}}};$.layout.defaults={name:"",containerClass:"ui-layout-container",inset:null,scrollToBookmarkOnLoad:true,resizeWithWindow:true,resizeWithWindowDelay:200,resizeWithWindowMaxDelay:0,maskPanesEarly:false,onresizeall_start:null,onresizeall_end:null,onload_start:null,onload_end:null,onunload_start:null,onunload_end:null,initPanes:true,showErrorMessages:true,showDebugMessages:false,zIndex:null,zIndexes:{pane_normal:0,content_mask:1,resizer_normal:2,pane_sliding:100,pane_animate:1e3,resizer_drag:1e4},errors:{pane:"pane",selector:"selector",addButtonError:"Error Adding Button \n\nInvalid ",containerMissing:"UI Layout Initialization Error\n\nThe specified layout-container does not exist.",centerPaneMissing:"UI Layout Initialization Error\n\nThe center-pane element does not exist.\n\nThe center-pane is a required element.",noContainerHeight:"UI Layout Initialization Warning\n\nThe layout-container \"CONTAINER\" has no height.\n\nTherefore the layout is 0-height and hence 'invisible'!",callbackError:"UI Layout Callback Error\n\nThe EVENT callback is not a valid function."},panes:{applyDemoStyles:false,closable:true,resizable:true,slidable:true,initClosed:false,initHidden:false,contentSelector:".ui-layout-content",contentIgnoreSelector:".ui-layout-ignore",findNestedContent:false,paneClass:"ui-layout-pane",resizerClass:"ui-layout-resizer",togglerClass:"ui-layout-toggler",buttonClass:"ui-layout-button",minSize:0,maxSize:0,spacing_open:6,spacing_closed:6,togglerLength_open:50,togglerLength_closed:50,togglerAlign_open:"center",togglerAlign_closed:"center",togglerContent_open:"",togglerContent_closed:"",resizerDblClickToggle:true,autoResize:true,autoReopen:true,resizerDragOpacity:1,maskContents:false,maskObjects:false,maskZindex:null,resizingGrid:false,livePaneResizing:false,liveContentResizing:false,liveResizingTolerance:1,sliderCursor:"pointer",slideTrigger_open:"click",slideTrigger_close:"mouseleave",slideDelay_open:300,slideDelay_close:300,hideTogglerOnSlide:false,preventQuickSlideClose:$.layout.browser.webkit,preventPrematureSlideClose:false,tips:{Open:"Open",Close:"Close",Resize:"Resize",Slide:"Slide Open",Pin:"Pin",Unpin:"Un-Pin",noRoomToOpen:"Not enough room to show this panel.",minSizeWarning:"Panel has reached its minimum size",maxSizeWarning:"Panel has reached its maximum size"},showOverflowOnHover:false,enableCursorHotkey:true,customHotkeyModifier:"SHIFT",fxName:"slide",fxSpeed:null,fxSettings:{},fxOpacityFix:true,animatePaneSizing:false,children:null,containerSelector:"",initChildren:true,destroyChildren:true,resizeChildren:true,triggerEventsOnLoad:false,triggerEventsDuringLiveResize:true,onshow_start:null,onshow_end:null,onhide_start:null,onhide_end:null,onopen_start:null,onopen_end:null,onclose_start:null,onclose_end:null,onresize_start:null,onresize_end:null,onsizecontent_start:null,onsizecontent_end:null,onswap_start:null,onswap_end:null,ondrag_start:null,ondrag_end:null},north:{paneSelector:".ui-layout-north",size:"auto",resizerCursor:"n-resize",customHotkey:""},south:{paneSelector:".ui-layout-south",size:"auto",resizerCursor:"s-resize",customHotkey:""},east:{paneSelector:".ui-layout-east",size:200,resizerCursor:"e-resize",customHotkey:""},west:{paneSelector:".ui-layout-west",size:200,resizerCursor:"w-resize",customHotkey:""},center:{paneSelector:".ui-layout-center",minWidth:0,minHeight:0}};$.layout.optionsMap={layout:("name,instanceKey,stateManagement,effects,inset,zIndexes,errors,"+"zIndex,scrollToBookmarkOnLoad,showErrorMessages,maskPanesEarly,"+"outset,resizeWithWindow,resizeWithWindowDelay,resizeWithWindowMaxDelay,"+"onresizeall,onresizeall_start,onresizeall_end,onload,onunload").split(","),center:("paneClass,contentSelector,contentIgnoreSelector,findNestedContent,applyDemoStyles,triggerEventsOnLoad,"+"showOverflowOnHover,maskContents,maskObjects,liveContentResizing,"+"containerSelector,children,initChildren,resizeChildren,destroyChildren,"+"onresize,onresize_start,onresize_end,onsizecontent,onsizecontent_start,onsizecontent_end").split(","),noDefault:"paneSelector,resizerCursor,customHotkey".split(",")};$.layout.transformData=function(e,t){var n=t?{panes:{},center:{}}:{},r,i,s,o,u,a,f;if(typeof e!=="object")return n;for(i in e){r=n;u=e[i];s=i.split("__");f=s.length-1;for(a=0;a<=f;a++){o=s[a];if(a===f){if($.isPlainObject(u))r[o]=$.layout.transformData(u);else r[o]=u}else{if(!r[o])r[o]={};r=r[o]}}}return n};$.layout.backwardCompatibility={map:{applyDefaultStyles:"applyDemoStyles",childOptions:"children",initChildLayout:"initChildren",destroyChildLayout:"destroyChildren",resizeChildLayout:"resizeChildren",resizeNestedLayout:"resizeChildren",resizeWhileDragging:"livePaneResizing",resizeContentWhileDragging:"liveContentResizing",triggerEventsWhileDragging:"triggerEventsDuringLiveResize",maskIframesOnResize:"maskContents",useStateCookie:"stateManagement.enabled","cookie.autoLoad":"stateManagement.autoLoad","cookie.autoSave":"stateManagement.autoSave","cookie.keys":"stateManagement.stateKeys","cookie.name":"stateManagement.cookie.name","cookie.domain":"stateManagement.cookie.domain","cookie.path":"stateManagement.cookie.path","cookie.expires":"stateManagement.cookie.expires","cookie.secure":"stateManagement.cookie.secure",noRoomToOpenTip:"tips.noRoomToOpen",togglerTip_open:"tips.Close",togglerTip_closed:"tips.Open",resizerTip:"tips.Resize",sliderTip:"tips.Slide"},renameOptions:function(e){function o(t,n){var r=t.split("."),i=r.length-1,s={branch:e,key:r[i]},o=0,u,a;for(;o<i;o++){u=r[o];if(s.branch[u]==undefined){if(n){s.branch=s.branch[u]={}}else s.branch={}}else s.branch=s.branch[u]}return s}var t=$.layout.backwardCompatibility.map,n,r,i;for(var s in t){n=o(s);i=n.branch[n.key];if(i!==undefined){r=o(t[s],true);r.branch[r.key]=i;delete n.branch[n.key]}}},renameAllOptions:function(e){var t=$.layout.backwardCompatibility.renameOptions;t(e);if(e.defaults){if(typeof e.panes!=="object")e.panes={};$.extend(true,e.panes,e.defaults);delete e.defaults}if(e.panes)t(e.panes);$.each($.layout.config.allPanes,function(n,r){if(e[r])t(e[r])});return e}};$.fn.layout=function(opts){function keyDown(e){if(!e)return true;var t=e.keyCode;if(t<33)return true;var n={38:"north",40:"south",37:"west",39:"east"},r=e.altKey,i=e.shiftKey,s=e.ctrlKey,o=s&&t>=37&&t<=40,u,a,f,l;if(o&&options[n[t]].enableCursorHotkey)l=n[t];else if(s||i)$.each(_c.borderPanes,function(e,n){u=options[n];a=u.customHotkey;f=u.customHotkeyModifier;if(i&&f=="SHIFT"||s&&f=="CTRL"||s&&i){if(a&&t===(isNaN(a)||a<=9?a.toUpperCase().charCodeAt(0):a)){l=n;return false}}});if(!l||!$Ps[l]||!options[l].closable||state[l].isHidden)return true;toggle(l);e.stopPropagation();e.returnValue=false;return false}function allowOverflow(e){if(!isInitialized())return;if(this&&this.tagName)e=this;var t;if(isStr(e))t=$Ps[e];else if($(e).data("layoutRole"))t=$(e);else $(e).parents().each(function(){if($(this).data("layoutRole")){t=$(this);return false}});if(!t||!t.length)return;var n=t.data("layoutEdge"),r=state[n];if(r.cssSaved)resetOverflow(n);if(r.isSliding||r.isResizing||r.isClosed){r.cssSaved=false;return}var i={zIndex:options.zIndexes.resizer_normal+1},s={},o=t.css("overflow"),u=t.css("overflowX"),a=t.css("overflowY");if(o!="visible"){s.overflow=o;i.overflow="visible"}if(u&&!u.match(/(visible|auto)/)){s.overflowX=u;i.overflowX="visible"}if(a&&!a.match(/(visible|auto)/)){s.overflowY=u;i.overflowY="visible"}r.cssSaved=s;t.css(i);$.each(_c.allPanes,function(e,t){if(t!=n)resetOverflow(t)})}function resetOverflow(e){if(!isInitialized())return;if(this&&this.tagName)e=this;var t;if(isStr(e))t=$Ps[e];else if($(e).data("layoutRole"))t=$(e);else $(e).parents().each(function(){if($(this).data("layoutRole")){t=$(this);return false}});if(!t||!t.length)return;var n=t.data("layoutEdge"),r=state[n],i=r.cssSaved||{};if(!r.isSliding&&!r.isResizing)t.css("zIndex",options.zIndexes.pane_normal);t.css(i);r.cssSaved=false}var browser=$.layout.browser,_c=$.layout.config,cssW=$.layout.cssWidth,cssH=$.layout.cssHeight,elDims=$.layout.getElementDimensions,styles=$.layout.getElementStyles,evtObj=$.layout.getEventObject,evtPane=$.layout.parsePaneName,options=$.extend(true,{},$.layout.defaults),effects=options.effects=$.extend(true,{},$.layout.effects),state={id:"layout"+$.now(),initialized:false,paneResizing:false,panesSliding:{},container:{innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0,layoutWidth:0,layoutHeight:0},north:{childIdx:0},south:{childIdx:0},east:{childIdx:0},west:{childIdx:0},center:{childIdx:0}},children={north:null,south:null,east:null,west:null,center:null},timer={data:{},set:function(e,t,n){timer.clear(e);timer.data[e]=setTimeout(t,n)},clear:function(e){var t=timer.data;if(t[e]){clearTimeout(t[e]);delete t[e]}}},_log=function(e,t,n){var r=options;if(r.showErrorMessages&&!n||n&&r.showDebugMessages)$.layout.msg(r.name+" / "+e,t!==false);return false},_runCallbacks=function(evtName,pane,skipBoundEvents){function g(e){return e}var hasPane=pane&&isStr(pane),s=hasPane?state[pane]:state,o=hasPane?options[pane]:options,lName=options.name,lng=evtName+(evtName.match(/_/)?"":"_end"),shrt=lng.match(/_end$/)?lng.substr(0,lng.length-4):"",fn=o[lng]||o[shrt],retVal="NC",args=[],$P;if(!hasPane&&$.type(pane)==="boolean"){skipBoundEvents=pane;pane=""}if(fn){try{if(isStr(fn)){if(fn.match(/,/)){args=fn.split(","),fn=eval(args[0])}else fn=eval(fn)}if($.isFunction(fn)){if(args.length)retVal=g(fn)(args[1]);else if(hasPane)retVal=g(fn)(pane,$Ps[pane],s,o,lName);else retVal=g(fn)(Instance,s,o,lName)}}catch(ex){_log(options.errors.callbackError.replace(/EVENT/,$.trim((pane||"")+" "+lng)),false)}}if(!skipBoundEvents&&retVal!==false){if(hasPane){$P=$Ps[pane];o=options[pane];s=state[pane];$P.triggerHandler("layoutpane"+lng,[pane,$P,s,o,lName]);if(shrt)$P.triggerHandler("layoutpane"+shrt,[pane,$P,s,o,lName])}else{$N.triggerHandler("layout"+lng,[Instance,s,o,lName]);if(shrt)$N.triggerHandler("layout"+shrt,[Instance,s,o,lName])}}if(hasPane&&evtName==="onresize_end"||evtName==="onsizecontent_end")resizeChildren(pane+"",true);return retVal;},_fixIframe=function(e){if(browser.mozilla)return;var t=$Ps[e];if(state[e].tagName==="IFRAME")t.css(_c.hidden).css(_c.visible);else t.find("IFRAME").css(_c.hidden).css(_c.visible)},cssSize=function(e,t){var n=_c[e].dir=="horz"?cssH:cssW;return n($Ps[e],t)},cssMinDims=function(e){var t=$Ps[e],n=_c[e].dir,r={minWidth:1001-cssW(t,1e3),minHeight:1001-cssH(t,1e3)};if(n==="horz")r.minSize=r.minHeight;if(n==="vert")r.minSize=r.minWidth;return r},setOuterWidth=function(e,t,n){var r=e,i;if(isStr(e))r=$Ps[e];else if(!e.jquery)r=$(e);i=cssW(r,t);r.css({width:i});if(i>0){if(n&&r.data("autoHidden")&&r.innerHeight()>0){r.show().data("autoHidden",false);if(!browser.mozilla)r.css(_c.hidden).css(_c.visible)}}else if(n&&!r.data("autoHidden"))r.hide().data("autoHidden",true)},setOuterHeight=function(e,t,n){var r=e,i;if(isStr(e))r=$Ps[e];else if(!e.jquery)r=$(e);i=cssH(r,t);r.css({height:i,visibility:"visible"});if(i>0&&r.innerWidth()>0){if(n&&r.data("autoHidden")){r.show().data("autoHidden",false);if(!browser.mozilla)r.css(_c.hidden).css(_c.visible)}}else if(n&&!r.data("autoHidden"))r.hide().data("autoHidden",true)},_parseSize=function(e,t,n){if(!n)n=_c[e].dir;if(isStr(t)&&t.match(/%/))t=t==="100%"?-1:parseInt(t,10)/100;if(t===0)return 0;else if(t>=1)return parseInt(t,10);var r=options,i=0;if(n=="horz")i=sC.innerHeight-($Ps.north?r.north.spacing_open:0)-($Ps.south?r.south.spacing_open:0);else if(n=="vert")i=sC.innerWidth-($Ps.west?r.west.spacing_open:0)-($Ps.east?r.east.spacing_open:0);if(t===-1)return i;else if(t>0)return round(i*t);else if(e=="center")return 0;else{var s=n==="horz"?"height":"width",o=$Ps[e],u=s==="height"?$Cs[e]:false,a=$.layout.showInvisibly(o),f=o.css(s),l=u?u.css(s):0;o.css(s,"auto");if(u)u.css(s,"auto");t=s==="height"?o.outerHeight():o.outerWidth();o.css(s,f).css(a);if(u)u.css(s,l);return t}},getPaneSize=function(e,t){var n=$Ps[e],r=options[e],i=state[e],s=t?r.spacing_open:0,o=t?r.spacing_closed:0;if(!n||i.isHidden)return 0;else if(i.isClosed||i.isSliding&&t)return o;else if(_c[e].dir==="horz")return n.outerHeight()+s;else return n.outerWidth()+s},setSizeLimits=function(e,t){if(!isInitialized())return;var n=options[e],r=state[e],i=_c[e],s=i.dir,o=i.sizeType.toLowerCase(),u=t!=undefined?t:r.isSliding,a=$Ps[e],f=n.spacing_open,l=_c.oppositeEdge[e],c=state[l],h=$Ps[l],p=!h||c.isVisible===false||c.isSliding?0:s=="horz"?h.outerHeight():h.outerWidth(),d=(!h||c.isHidden?0:options[l][c.isClosed!==false?"spacing_closed":"spacing_open"])||0,v=s=="horz"?sC.innerHeight:sC.innerWidth,m=cssMinDims("center"),g=s=="horz"?max(options.center.minHeight,m.minHeight):max(options.center.minWidth,m.minWidth),y=v-f-(u?0:_parseSize("center",g,s)+p+d),b=r.minSize=max(_parseSize(e,n.minSize),cssMinDims(e).minSize),w=r.maxSize=min(n.maxSize?_parseSize(e,n.maxSize):1e5,y),E=r.resizerPosition={},S=sC.inset.top,x=sC.inset.left,T=sC.innerWidth,N=sC.innerHeight,C=n.spacing_open;switch(e){case"north":E.min=S+b;E.max=S+w;break;case"west":E.min=x+b;E.max=x+w;break;case"south":E.min=S+N-w-C;E.max=S+N-b-C;break;case"east":E.min=x+T-w-C;E.max=x+T-b-C;break}},calcNewCenterPaneDims=function(){var e={top:getPaneSize("north",true),bottom:getPaneSize("south",true),left:getPaneSize("west",true),right:getPaneSize("east",true),width:0,height:0};e.width=sC.innerWidth-e.left-e.right;e.height=sC.innerHeight-e.bottom-e.top;e.top+=sC.inset.top;e.bottom+=sC.inset.bottom;e.left+=sC.inset.left;e.right+=sC.inset.right;return e},getHoverClasses=function(e,t){var n=$(e),r=n.data("layoutRole"),i=n.data("layoutEdge"),s=options[i],o=s[r+"Class"],u="-"+i,a="-open",f="-closed",l="-sliding",c="-hover ",h=n.hasClass(o+f)?f:a,p=h===f?a:f,d=o+c+(o+u+c)+(o+h+c)+(o+u+h+c);if(t)d+=o+p+c+(o+u+p+c);if(r=="resizer"&&n.hasClass(o+l))d+=o+l+c+(o+u+l+c);return $.trim(d)},addHover=function(e,t){var n=$(t||this);if(e&&n.data("layoutRole")==="toggler")e.stopPropagation();n.addClass(getHoverClasses(n))},removeHover=function(e,t){var n=$(t||this);n.removeClass(getHoverClasses(n,true))},onResizerEnter=function(e){var t=$(this).data("layoutEdge"),n=state[t];if(n.isClosed||n.isResizing||state.paneResizing)return;if($.fn.disableSelection)$("body").disableSelection();if(options.maskPanesEarly)showMasks(t)},onResizerLeave=function(e,t){var n=t||this,r=$(n).data("layoutEdge"),i=r+"ResizerLeave";timer.clear(r+"_openSlider");timer.clear(i);if(!t)timer.set(i,function(){onResizerLeave(e,n)},200);else if(!state.paneResizing){if($.fn.enableSelection)$("body").enableSelection();if(options.maskPanesEarly)hideMasks()}},_create=function(){initOptions();var e=options,t=state;t.creatingLayout=true;runPluginCallbacks(Instance,$.layout.onCreate);if(false===_runCallbacks("onload_start"))return"cancel";_initContainer();initHotkeys();$(window).bind("unload."+sID,unload);runPluginCallbacks(Instance,$.layout.onLoad);if(e.initPanes)_initLayoutElements();delete t.creatingLayout;return state.initialized},isInitialized=function(){if(state.initialized||state.creatingLayout)return true;else return _initLayoutElements()},_initLayoutElements=function(e){var t=options;if(!$N.is(":visible")){if(!e&&browser.webkit&&$N[0].tagName==="BODY")setTimeout(function(){_initLayoutElements(true)},50);return false}if(!getPane("center").length){return _log(t.errors.centerPaneMissing)}state.creatingLayout=true;$.extend(sC,elDims($N,t.inset));initPanes();if(t.scrollToBookmarkOnLoad){var n=self.location;if(n.hash)n.replace(n.hash)}if(Instance.hasParentLayout)t.resizeWithWindow=false;else if(t.resizeWithWindow)$(window).bind("resize."+sID,windowResize);delete state.creatingLayout;state.initialized=true;runPluginCallbacks(Instance,$.layout.onReady);_runCallbacks("onload_end");return true},createChildren=function(e,t){var n=evtPane.call(this,e),r=$Ps[n];if(!r)return;var i=$Cs[n],s=state[n],o=options[n],u=options.stateManagement||{},a=t?o.children=t:o.children;if($.isPlainObject(a))a=[a];else if(!a||!$.isArray(a))return;$.each(a,function(e,t){if(!$.isPlainObject(t))return;var o=t.containerSelector?r.find(t.containerSelector):i||r;o.each(function(){var e=$(this),r=e.data("layout");if(!r){setInstanceKey({container:e,options:t},s);if(u.includeChildren&&state.stateData[n]){var i=state.stateData[n].children||{},o=i[t.instanceKey],a=t.stateManagement||(t.stateManagement={autoLoad:true});if(a.autoLoad===true&&o){a.autoSave=false;a.includeChildren=true;a.autoLoad=$.extend(true,{},o)}}r=e.layout(t);if(r){refreshChildren(n,r)}}})})},setInstanceKey=function(e,t){var n=e.container,r=e.options,i=r.stateManagement,s=r.instanceKey||n.data("layoutInstanceKey");if(!s)s=(i&&i.cookie?i.cookie.name:"")||r.name;if(!s)s="layout"+ ++t.childIdx;else s=s.replace(/[^\w-]/gi,"_").replace(/_{2,}/g,"_");r.instanceKey=s;n.data("layoutInstanceKey",s);return s},refreshChildren=function(e,t){var n=$Ps[e],r=children[e],i=state[e],s;if($.isPlainObject(r)){$.each(r,function(e,t){if(t.destroyed)delete r[e]});if($.isEmptyObject(r))r=children[e]=null}if(!t&&!r){t=n.data("layout")}if(t){t.hasParentLayout=true;s=t.options;setInstanceKey(t,i);if(!r)r=children[e]={};r[s.instanceKey]=t.container.data("layout")}Instance[e].children=children[e];if(!t){createChildren(e)}},windowResize=function(){var e=options,t=Number(e.resizeWithWindowDelay);if(t<10)t=100;timer.clear("winResize");timer.set("winResize",function(){timer.clear("winResize");timer.clear("winResizeRepeater");var t=elDims($N,e.inset);if(t.innerWidth!==sC.innerWidth||t.innerHeight!==sC.innerHeight)resizeAll()},t);if(!timer.data["winResizeRepeater"])setWindowResizeRepeater()},setWindowResizeRepeater=function(){var e=Number(options.resizeWithWindowMaxDelay);if(e>0)timer.set("winResizeRepeater",function(){setWindowResizeRepeater();resizeAll()},e)},unload=function(){var e=options;_runCallbacks("onunload_start");runPluginCallbacks(Instance,$.layout.onUnload);_runCallbacks("onunload_end")},_initContainer=function(){var e=$N[0],t=$("html"),n=sC.tagName=e.tagName,r=sC.id=e.id,i=sC.className=e.className,s=options,o=s.name,u="position,margin,padding,border",a="layoutCSS",f={},l="hidden",c=$N.data("parentLayout"),h=$N.data("layoutEdge"),p=c&&h,d=$.layout.cssNum,v,m;sC.selector=$N.selector.split(".slice")[0];sC.ref=(s.name?s.name+" layout / ":"")+n+(r?"#"+r:i?".["+i+"]":"");sC.isBody=n==="BODY";if(!p&&!sC.isBody){v=$N.closest("."+$.layout.defaults.panes.paneClass);c=v.data("parentLayout");h=v.data("layoutEdge");p=c&&h}$N.data({layout:Instance,layoutContainer:sID}).addClass(s.containerClass);var g={destroy:"",initPanes:"",resizeAll:"resizeAll",resize:"resizeAll"};for(o in g){$N.bind("layout"+o.toLowerCase()+"."+sID,Instance[g[o]||o])}if(p){Instance.hasParentLayout=true;c.refreshChildren(h,Instance)}if(!$N.data(a)){if(sC.isBody){$N.data(a,$.extend(styles($N,u),{height:$N.css("height"),overflow:$N.css("overflow"),overflowX:$N.css("overflowX"),overflowY:$N.css("overflowY")}));t.data(a,$.extend(styles(t,"padding"),{height:"auto",overflow:t.css("overflow"),overflowX:t.css("overflowX"),overflowY:t.css("overflowY")}))}else $N.data(a,styles($N,u+",top,bottom,left,right,width,height,overflow,overflowX,overflowY"))}try{f={overflow:l,overflowX:l,overflowY:l};$N.css(f);if(s.inset&&!$.isPlainObject(s.inset)){m=parseInt(s.inset,10)||0;s.inset={top:m,bottom:m,left:m,right:m}}if(sC.isBody){if(!s.outset){s.outset={top:d(t,"paddingTop"),bottom:d(t,"paddingBottom"),left:d(t,"paddingLeft"),right:d(t,"paddingRight")}}else if(!$.isPlainObject(s.outset)){m=parseInt(s.outset,10)||0;s.outset={top:m,bottom:m,left:m,right:m}}t.css(f).css({height:"100%",border:"none",padding:0,margin:0});if(browser.isIE6){$N.css({width:"100%",height:"100%",border:"none",padding:0,margin:0,position:"relative"});if(!s.inset)s.inset=elDims($N).inset}else{$N.css({width:"auto",height:"auto",margin:0,position:"absolute"});$N.css(s.outset)}$.extend(sC,elDims($N,s.inset))}else{var y=$N.css("position");if(!y||!y.match(/(fixed|absolute|relative)/))$N.css("position","relative");if($N.is(":visible")){$.extend(sC,elDims($N,s.inset));if(sC.innerHeight<1)_log(s.errors.noContainerHeight.replace(/CONTAINER/,sC.ref))}}if(d($N,"minWidth"))$N.parent().css("overflowX","auto");if(d($N,"minHeight"))$N.parent().css("overflowY","auto")}catch(b){}},initHotkeys=function(e){e=e?e.split(","):_c.borderPanes;$.each(e,function(e,t){var n=options[t];if(n.enableCursorHotkey||n.customHotkey){$(document).bind("keydown."+sID,keyDown);return false}})},initOptions=function(){function c(e){var t=options[e],n=options.panes;if(!t.fxSettings)t.fxSettings={};if(!n.fxSettings)n.fxSettings={};$.each(["_open","_close","_size"],function(r,i){var s="fxName"+i,o="fxSpeed"+i,u="fxSettings"+i,a=t[s]=t[s]||n[s]||t.fxName||n.fxName||"none";if(a==="none"||!options.effects[a]||!$.effects||!$.effects[a]&&!$.effects.effect[a])a=t[s]="none";var f=options.effects[a]||{},l=f.all||null,c=f[e]||null;t[o]=t[o]||n[o]||t.fxSpeed||n.fxSpeed||null;t[u]=$.extend(true,{},l,c,n.fxSettings,t.fxSettings,n[u],t[u])});delete t.fxName;delete t.fxSpeed;delete t.fxSettings}var e,t,n,r,i,s,o,u;opts=$.layout.transformData(opts,true);opts=$.layout.backwardCompatibility.renameAllOptions(opts);if(!$.isEmptyObject(opts.panes)){e=$.layout.optionsMap.noDefault;for(s=0,o=e.length;s<o;s++){r=e[s];delete opts.panes[r]}e=$.layout.optionsMap.layout;for(s=0,o=e.length;s<o;s++){r=e[s];delete opts.panes[r]}}e=$.layout.optionsMap.layout;var a=$.layout.config.optionRootKeys;for(r in opts){i=opts[r];if($.inArray(r,a)<0&&$.inArray(r,e)<0){if(!opts.panes[r])opts.panes[r]=$.isPlainObject(i)?$.extend(true,{},i):i;delete opts[r]}}$.extend(true,options,opts);$.each(_c.allPanes,function(n,i){_c[i]=$.extend(true,{},_c.panes,_c[i]);t=options.panes;u=options[i];if(i==="center"){e=$.layout.optionsMap.center;for(n=0,o=e.length;n<o;n++){r=e[n];if(!opts.center[r]&&(opts.panes[r]||!u[r]))u[r]=t[r]}}else{u=options[i]=$.extend(true,{},t,u);c(i);if(!u.resizerClass)u.resizerClass="ui-layout-resizer";if(!u.togglerClass)u.togglerClass="ui-layout-toggler"}if(!u.paneClass)u.paneClass="ui-layout-pane"});var f=opts.zIndex,l=options.zIndexes;if(f>0){l.pane_normal=f;l.content_mask=max(f+1,l.content_mask);l.resizer_normal=max(f+2,l.resizer_normal)}delete options.panes},getPane=function(e){var t=options[e].paneSelector;if(t.substr(0,1)==="#")return $N.find(t).eq(0);else{var n=$N.children(t).eq(0);return n.length?n:$N.children("form:first").children(t).eq(0)}},initPanes=function(e){evtPane(e);$.each(_c.allPanes,function(e,t){addPane(t,true)});initHandles();$.each(_c.borderPanes,function(e,t){if($Ps[t]&&state[t].isVisible){setSizeLimits(t);makePaneFit(t)}});sizeMidPanes("center");$.each(_c.allPanes,function(e,t){afterInitPane(t)})},addPane=function(e,t){if(!t&&!isInitialized())return;var n=options[e],r=state[e],i=_c[e],s=i.dir,o=r.fx,u=n.spacing_open||0,a=e==="center",f={},l=$Ps[e],c,h,p,d;if(l)removePane(e,false,true,false);else $Cs[e]=false;l=$Ps[e]=getPane(e);if(!l.length){$Ps[e]=false;return}if(!l.data("layoutCSS")){var v="position,top,left,bottom,right,width,height,overflow,zIndex,display,backgroundColor,padding,margin,border";l.data("layoutCSS",styles(l,v))}Instance[e]={name:e,pane:$Ps[e],content:$Cs[e],options:options[e],state:state[e],children:children[e]};l.data({parentLayout:Instance,layoutPane:Instance[e],layoutEdge:e,layoutRole:"pane"}).css(i.cssReq).css("zIndex",options.zIndexes.pane_normal).css(n.applyDemoStyles?i.cssDemo:{}).addClass(n.paneClass+" "+n.paneClass+"-"+e).bind("mouseenter."+sID,addHover).bind("mouseleave."+sID,removeHover);var m={hide:"",show:"",toggle:"",close:"",open:"",slideOpen:"",slideClose:"",slideToggle:"",size:"sizePane",sizePane:"sizePane",sizeContent:"",sizeHandles:"",enableClosable:"",disableClosable:"",enableSlideable:"",disableSlideable:"",enableResizable:"",disableResizable:"",swapPanes:"swapPanes",swap:"swapPanes",move:"swapPanes",removePane:"removePane",remove:"removePane",createChildren:"",resizeChildren:"",resizeAll:"resizeAll",resizeLayout:"resizeAll"},g;for(g in m){l.bind("layoutpane"+g.toLowerCase()+"."+sID,Instance[m[g]||g])}initContent(e,false);if(!a){c=r.size=_parseSize(e,n.size);h=_parseSize(e,n.minSize)||1;p=_parseSize(e,n.maxSize)||1e5;if(c>0)c=max(min(c,p),h);r.autoResize=n.autoResize;r.isClosed=false;r.isSliding=false;r.isResizing=false;r.isHidden=false;if(!r.pins)r.pins=[]}r.tagName=l[0].tagName;r.edge=e;r.noRoom=false;r.isVisible=true;setPanePosition(e);if(s==="horz")f.height=cssH(l,c);else if(s==="vert")f.width=cssW(l,c);l.css(f);if(s!="horz")sizeMidPanes(e,true);if(n.initClosed&&n.closable&&!n.initHidden)close(e,true,true);else if(n.initHidden||n.initClosed)hide(e);else if(!r.noRoom)l.css("display","block");l.css("visibility","visible");if(n.showOverflowOnHover)l.hover(allowOverflow,resetOverflow);if(state.initialized){initHandles(e);initHotkeys(e);afterInitPane(e)}},afterInitPane=function(e){var t=$Ps[e],n=state[e],r=options[e];if(!t)return;if(t.data("layout"))refreshChildren(e,t.data("layout"));if(n.isVisible){if(state.initialized)resizeAll();else sizeContent(e);if(r.triggerEventsOnLoad)_runCallbacks("onresize_end",e);else resizeChildren(e,true)}if(r.initChildren&&r.children)createChildren(e)},setPanePosition=function(e){e=e?e.split(","):_c.borderPanes;$.each(e,function(e,t){var n=$Ps[t],r=$Rs[t],i=options[t],s=state[t],o=_c[t].side,u={};if(!n)return;switch(t){case"north":u.top=sC.inset.top;u.left=sC.inset.left;u.right=sC.inset.right;break;case"south":u.bottom=sC.inset.bottom;u.left=sC.inset.left;u.right=sC.inset.right;break;case"west":u.left=sC.inset.left;break;case"east":u.right=sC.inset.right;break;case"center":}n.css(u);if(r&&s.isClosed)r.css(o,sC.inset[o]);else if(r&&!s.isHidden)r.css(o,sC.inset[o]+getPaneSize(t))})},initHandles=function(e){e=e?e.split(","):_c.borderPanes;$.each(e,function(e,t){var n=$Ps[t];$Rs[t]=false;$Ts[t]=false;if(!n)return;var r=options[t],i=state[t],s=_c[t],o=r.paneSelector.substr(0,1)==="#"?r.paneSelector.substr(1):"",u=r.resizerClass,a=r.togglerClass,f=i.isVisible?r.spacing_open:r.spacing_closed,l="-"+t,c=i.isVisible?"-open":"-closed",h=Instance[t],p=h.resizer=$Rs[t]=$("<div></div>"),d=h.toggler=r.closable?$Ts[t]=$("<div></div>"):false;if(!i.isVisible&&r.slidable)p.attr("title",r.tips.Slide).css("cursor",r.sliderCursor);p.attr("id",o?o+"-resizer":"").data({parentLayout:Instance,layoutPane:Instance[t],layoutEdge:t,layoutRole:"resizer"}).css(_c.resizers.cssReq).css("zIndex",options.zIndexes.resizer_normal).css(r.applyDemoStyles?_c.resizers.cssDemo:{}).addClass(u+" "+u+l).hover(addHover,removeHover).hover(onResizerEnter,onResizerLeave).appendTo($N);if(r.resizerDblClickToggle)p.bind("dblclick."+sID,toggle);if(d){d.attr("id",o?o+"-toggler":"").data({parentLayout:Instance,layoutPane:Instance[t],layoutEdge:t,layoutRole:"toggler"}).css(_c.togglers.cssReq).css(r.applyDemoStyles?_c.togglers.cssDemo:{}).addClass(a+" "+a+l).hover(addHover,removeHover).bind("mouseenter",onResizerEnter).appendTo(p);if(r.togglerContent_open)$("<span>"+r.togglerContent_open+"</span>").data({layoutEdge:t,layoutRole:"togglerContent"}).data("layoutRole","togglerContent").data("layoutEdge",t).addClass("content content-open").css("display","none").appendTo(d);if(r.togglerContent_closed)$("<span>"+r.togglerContent_closed+"</span>").data({layoutEdge:t,layoutRole:"togglerContent"}).addClass("content content-closed").css("display","none").appendTo(d);enableClosable(t)}initResizable(t);if(i.isVisible)setAsOpen(t);else{setAsClosed(t);bindStartSlidingEvents(t,true)}});sizeHandles()},initContent=function(e,t){if(!isInitialized())return;var n=options[e],r=n.contentSelector,i=Instance[e],s=$Ps[e],o;if(r)o=i.content=$Cs[e]=n.findNestedContent?s.find(r).eq(0):s.children(r).eq(0);if(o&&o.length){o.data("layoutRole","content");if(!o.data("layoutCSS"))o.data("layoutCSS",styles(o,"height"));o.css(_c.content.cssReq);if(n.applyDemoStyles){o.css(_c.content.cssDemo);s.css(_c.content.cssDemoPane)}if(s.css("overflowX").match(/(scroll|auto)/)){s.css("overflow","hidden")}state[e].content={};if(t!==false)sizeContent(e)}else i.content=$Cs[e]=false},initResizable=function(e){var t=$.layout.plugins.draggable,n;e=e?e.split(","):_c.borderPanes;$.each(e,function(e,n){var i=options[n];if(!t||!$Ps[n]||!i.resizable){i.resizable=false;return true}var s=state[n],o=options.zIndexes,u=_c[n],a=u.dir=="horz"?"top":"left",f=$Ps[n],l=$Rs[n],c=i.resizerClass,h=0,p,d,v=c+"-drag",m=c+"-"+n+"-drag",g=c+"-dragging",y=c+"-"+n+"-dragging",b=c+"-dragging-limit",w=c+"-"+n+"-dragging-limit",E=false;if(!s.isClosed)l.attr("title",i.tips.Resize).css("cursor",i.resizerCursor);l.draggable({containment:$N[0],axis:u.dir=="horz"?"y":"x",delay:0,distance:1,grid:i.resizingGrid,helper:"clone",opacity:i.resizerDragOpacity,addClasses:false,zIndex:o.resizer_drag,start:function(e,t){i=options[n];s=state[n];d=i.livePaneResizing;if(false===_runCallbacks("ondrag_start",n))return false;s.isResizing=true;state.paneResizing=n;timer.clear(n+"_closeSlider");setSizeLimits(n);p=s.resizerPosition;h=t.position[a];l.addClass(v+" "+m);E=false;$("body").disableSelection();showMasks(n)},drag:function(e,t){if(!E){t.helper.addClass(g+" "+y).css({right:"auto",bottom:"auto"}).children().css("visibility","hidden");E=true;if(s.isSliding)$Ps[n].css("zIndex",o.pane_sliding)}var u=0;if(t.position[a]<p.min){t.position[a]=p.min;u=-1}else if(t.position[a]>p.max){t.position[a]=p.max;u=1}if(u){t.helper.addClass(b+" "+w);window.defaultStatus=u>0&&n.match(/(north|west)/)||u<0&&n.match(/(south|east)/)?i.tips.maxSizeWarning:i.tips.minSizeWarning}else{t.helper.removeClass(b+" "+w);window.defaultStatus=""}if(d&&Math.abs(t.position[a]-h)>=i.liveResizingTolerance){h=t.position[a];r(e,t,n)}},stop:function(e,t){$("body").enableSelection();window.defaultStatus="";l.removeClass(v+" "+m);s.isResizing=false;state.paneResizing=false;r(e,t,n,true)}})});var r=function(e,t,n,r){var i=t.position,s=_c[n],o=options[n],u=state[n],a;switch(n){case"north":a=i.top;break;case"west":a=i.left;break;case"south":a=sC.layoutHeight-i.top-o.spacing_open;break;case"east":a=sC.layoutWidth-i.left-o.spacing_open;break}var f=a-sC.inset[s.side];if(!r){if(Math.abs(f-u.size)<o.liveResizingTolerance)return;manualSizePane(n,f,false,true);sizeMasks()}else{if(false!==_runCallbacks("ondrag_end",n))manualSizePane(n,f,false,true);hideMasks(true);if(u.isSliding)showMasks(n)}}},sizeMask=function(){var e=$(this),t=e.data("layoutMask"),n=state[t];if(n.tagName=="IFRAME"&&n.isVisible)e.css({top:n.offsetTop,left:n.offsetLeft,width:n.outerWidth,height:n.outerHeight})},sizeMasks=function(){$Ms.each(sizeMask)},showMasks=function(e,t){var n=_c[e],r=["center"],i=options.zIndexes,s=$.extend({objectsOnly:false,forSliding:state[e].isSliding},t),o,u;if(s.forSliding)r.push(_c.oppositeEdge[e]);if(n.dir==="horz"){r.push("west");r.push("east")}$.each(r,function(e,t){u=state[t];o=options[t];if(u.isVisible&&(o.maskObjects||!s.objectsOnly&&o.maskContents)){getMasks(t).each(function(){sizeMask.call(this);this.style.zIndex=u.isSliding?i.pane_sliding+1:i.pane_normal+1;this.style.display="block"})}})},hideMasks=function(e){if(e||!state.paneResizing){$Ms.hide()}else if(!e&&!$.isEmptyObject(state.panesSliding)){var t=$Ms.length-1,n,r;for(;t>=0;t--){r=$Ms.eq(t);n=r.data("layoutMask");if(!options[n].maskObjects){r.hide()}}}},getMasks=function(e){var t=$([]),n,r=0,i=$Ms.length;for(;r<i;r++){n=$Ms.eq(r);if(n.data("layoutMask")===e)t=t.add(n)}if(t.length)return t;else return createMasks(e)},createMasks=function(e){var t=$Ps[e],n=state[e],r=options[e],i=options.zIndexes,s=$([]),o,u,a,f,l;if(!r.maskContents&&!r.maskObjects)return s;for(l=0;l<(r.maskObjects?2:1);l++){o=r.maskObjects&&l==0;u=document.createElement(o?"iframe":"div");a=$(u).data("layoutMask",e);u.className="ui-layout-mask ui-layout-mask-"+e;f=u.style;f.display="block";f.position="absolute";f.background="#FFF";if(o){u.frameborder=0;u.src="about:blank";f.opacity=0;f.filter="Alpha(Opacity='0')";f.border=0}if(n.tagName=="IFRAME"){f.zIndex=i.pane_normal+1;$N.append(u)}else{a.addClass("ui-layout-mask-inside-pane");f.zIndex=r.maskZindex||i.content_mask;f.top=0;f.left=0;f.width="100%";f.height="100%";t.append(u)}s=s.add(u);$Ms=$Ms.add(u)}return s},destroy=function(e,t){$(window).unbind("."+sID);$(document).unbind("."+sID);if(typeof e==="object")evtPane(e);else t=e;$N.clearQueue().removeData("layout").removeData("layoutContainer").removeClass(options.containerClass).unbind("."+sID);$Ms.remove();$.each(_c.allPanes,function(e,n){removePane(n,false,true,t)});var n="layoutCSS";if($N.data(n)&&!$N.data("layoutRole"))$N.css($N.data(n)).removeData(n);if(sC.tagName==="BODY"&&($N=$("html")).data(n))$N.css($N.data(n)).removeData(n);runPluginCallbacks(Instance,$.layout.onDestroy);unload();for(var r in Instance)if(!r.match(/^(container|options)$/))delete Instance[r];Instance.destroyed=true;return Instance},removePane=function(e,t,n,r){if(!isInitialized())return;var i=evtPane.call(this,e),s=$Ps[i],o=$Cs[i],u=$Rs[i],a=$Ts[i];if(s&&$.isEmptyObject(s.data()))s=false;if(o&&$.isEmptyObject(o.data()))o=false;if(u&&$.isEmptyObject(u.data()))u=false;if(a&&$.isEmptyObject(a.data()))a=false;if(s)s.stop(true,true);var f=options[i],l=state[i],c="layout",h="layoutCSS",p=children[i],d=$.isPlainObject(p)&&!$.isEmptyObject(p),v=r!==undefined?r:f.destroyChildren;if(d&&v){$.each(p,function(e,t){if(!t.destroyed)t.destroy(true);if(t.destroyed)delete p[e]});if($.isEmptyObject(p)){p=children[i]=null;d=false}}if(s&&t&&!d)s.remove();else if(s&&s[0]){var m=f.paneClass,g=m+"-"+i,y="-open",b="-sliding",w="-closed",E=[m,m+y,m+w,m+b,g,g+y,g+w,g+b];$.merge(E,getHoverClasses(s,true));s.removeClass(E.join(" ")).removeData("parentLayout").removeData("layoutPane").removeData("layoutRole").removeData("layoutEdge").removeData("autoHidden").unbind("."+sID);if(d&&o){o.width(o.width());$.each(p,function(e,t){t.resizeAll()})}else if(o)o.css(o.data(h)).removeData(h).removeData("layoutRole");if(!s.data(c))s.css(s.data(h)).removeData(h)}if(a)a.remove();if(u)u.remove();Instance[i]=$Ps[i]=$Cs[i]=$Rs[i]=$Ts[i]=false;l={removed:true};if(!n)resizeAll()},_hidePane=function(e){var t=$Ps[e],n=options[e],r=t[0].style;if(n.useOffscreenClose){if(!t.data(_c.offscreenReset))t.data(_c.offscreenReset,{left:r.left,right:r.right});t.css(_c.offscreenCSS)}else t.hide().removeData(_c.offscreenReset)},_showPane=function(e){var t=$Ps[e],n=options[e],r=_c.offscreenCSS,i=t.data(_c.offscreenReset),s=t[0].style;t.show().removeData(_c.offscreenReset);if(n.useOffscreenClose&&i){if(s.left==r.left)s.left=i.left;if(s.right==r.right)s.right=i.right}},hide=function(e,t){if(!isInitialized())return;var n=evtPane.call(this,e),r=options[n],i=state[n],s=$Ps[n],o=$Rs[n];if(!s||i.isHidden)return;if(state.initialized&&false===_runCallbacks("onhide_start",n))return;i.isSliding=false;delete state.panesSliding[n];if(o)o.hide();if(!state.initialized||i.isClosed){i.isClosed=true;i.isHidden=true;i.isVisible=false;if(!state.initialized)_hidePane(n);sizeMidPanes(_c[n].dir==="horz"?"":"center");if(state.initialized||r.triggerEventsOnLoad)_runCallbacks("onhide_end",n)}else{i.isHiding=true;close(n,false,t)}},show=function(e,t,n,r){if(!isInitialized())return;var i=evtPane.call(this,e),s=options[i],o=state[i],u=$Ps[i],a=$Rs[i];if(!u||!o.isHidden)return;if(false===_runCallbacks("onshow_start",i))return;o.isShowing=true;o.isSliding=false;delete state.panesSliding[i];if(t===false)close(i,true);else open(i,false,n,r)},toggle=function(e,t){if(!isInitialized())return;var n=evtObj(e),r=evtPane.call(this,e),i=state[r];if(n)n.stopImmediatePropagation();if(i.isHidden)show(r);else if(i.isClosed)open(r,!!t);else close(r)},_closePane=function(e,t){var n=$Ps[e],r=state[e];_hidePane(e);r.isClosed=true;r.isVisible=false},close=function(e,t,n,r){function v(){f.isMoving=false;bindStartSlidingEvents(i,true);var e=_c.oppositeEdge[i];if(state[e].noRoom){setSizeLimits(e);makePaneFit(e)}if(!r&&(state.initialized||a.triggerEventsOnLoad)){if(!h)_runCallbacks("onclose_end",i);if(h)_runCallbacks("onshow_end",i);if(p)_runCallbacks("onhide_end",i)}}var i=evtPane.call(this,e);if(!state.initialized&&$Ps[i]){_closePane(i);return}if(!isInitialized())return;var s=$Ps[i],o=$Rs[i],u=$Ts[i],a=options[i],f=state[i],l=_c[i],c,h,p,d;$N.queue(function(e){if(!s||!a.closable&&!f.isShowing&&!f.isHiding||!t&&f.isClosed&&!f.isShowing)return e();var r=!f.isShowing&&false===_runCallbacks("onclose_start",i);h=f.isShowing;p=f.isHiding;d=f.isSliding;delete f.isShowing;delete f.isHiding;if(r)return e();c=!n&&!f.isClosed&&a.fxName_close!="none";f.isMoving=true;f.isClosed=true;f.isVisible=false;if(p)f.isHidden=true;else if(h)f.isHidden=false;if(f.isSliding)bindStopSlidingEvents(i,false);else sizeMidPanes(_c[i].dir==="horz"?"":"center",false);setAsClosed(i);if(c){lockPaneForFX(i,true);s.hide(a.fxName_close,a.fxSettings_close,a.fxSpeed_close,function(){lockPaneForFX(i,false);if(f.isClosed)v();e()})}else{_hidePane(i);v();e()}})},setAsClosed=function(e){var t=$Ps[e],n=$Rs[e],r=$Ts[e],i=options[e],s=state[e],o=_c[e].side,u=i.resizerClass,a=i.togglerClass,f="-"+e,l="-open",c="-sliding",h="-closed";n.css(o,sC.inset[o]).removeClass(u+l+" "+u+f+l).removeClass(u+c+" "+u+f+c).addClass(u+h+" "+u+f+h);if(i.resizable&&$.layout.plugins.draggable)n.draggable("disable").removeClass("ui-state-disabled").css("cursor","default").attr("title","");if(r){r.removeClass(a+l+" "+a+f+l).addClass(a+h+" "+a+f+h).attr("title",i.tips.Open);r.children(".content-open").hide();r.children(".content-closed").css("display","block")}syncPinBtns(e,false);if(state.initialized){sizeHandles()}},open=function(e,t,n,r){function p(){f.isMoving=false;_fixIframe(i);if(!f.isSliding){sizeMidPanes(_c[i].dir=="vert"?"center":"",false)}setAsOpen(i)}if(!isInitialized())return;var i=evtPane.call(this,e),s=$Ps[i],o=$Rs[i],u=$Ts[i],a=options[i],f=state[i],l=_c[i],c,h;$N.queue(function(e){if(!s||!a.resizable&&!a.closable&&!f.isShowing||f.isVisible&&!f.isSliding)return e();if(f.isHidden&&!f.isShowing){e();show(i,true);return}if(f.autoResize&&f.size!=a.size)sizePane(i,a.size,true,true,true);else setSizeLimits(i,t);var o=_runCallbacks("onopen_start",i);if(o==="abort")return e();if(o!=="NC")setSizeLimits(i,t);if(f.minSize>f.maxSize){syncPinBtns(i,false);if(!r&&a.tips.noRoomToOpen)alert(a.tips.noRoomToOpen);return e()}if(t)bindStopSlidingEvents(i,true);else if(f.isSliding)bindStopSlidingEvents(i,false);else if(a.slidable)bindStartSlidingEvents(i,false);f.noRoom=false;makePaneFit(i);h=f.isShowing;delete f.isShowing;c=!n&&f.isClosed&&a.fxName_open!="none";f.isMoving=true;f.isVisible=true;f.isClosed=false;if(h)f.isHidden=false;if(c){lockPaneForFX(i,true);s.show(a.fxName_open,a.fxSettings_open,a.fxSpeed_open,function(){lockPaneForFX(i,false);if(f.isVisible)p();e()})}else{_showPane(i);p();e()}});},setAsOpen=function(e,t){var n=$Ps[e],r=$Rs[e],i=$Ts[e],s=options[e],o=state[e],u=_c[e].side,a=s.resizerClass,f=s.togglerClass,l="-"+e,c="-open",h="-closed",p="-sliding";r.css(u,sC.inset[u]+getPaneSize(e)).removeClass(a+h+" "+a+l+h).addClass(a+c+" "+a+l+c);if(o.isSliding)r.addClass(a+p+" "+a+l+p);else r.removeClass(a+p+" "+a+l+p);removeHover(0,r);if(s.resizable&&$.layout.plugins.draggable)r.draggable("enable").css("cursor",s.resizerCursor).attr("title",s.tips.Resize);else if(!o.isSliding)r.css("cursor","default");if(i){i.removeClass(f+h+" "+f+l+h).addClass(f+c+" "+f+l+c).attr("title",s.tips.Close);removeHover(0,i);i.children(".content-closed").hide();i.children(".content-open").css("display","block")}syncPinBtns(e,!o.isSliding);$.extend(o,elDims(n));if(state.initialized){sizeHandles();sizeContent(e,true)}if(!t&&(state.initialized||s.triggerEventsOnLoad)&&n.is(":visible")){_runCallbacks("onopen_end",e);if(o.isShowing)_runCallbacks("onshow_end",e);if(state.initialized)_runCallbacks("onresize_end",e)}},slideOpen=function(e){function s(){if(!r.isClosed)bindStopSlidingEvents(n,true);else if(!r.isMoving)open(n,true)}if(!isInitialized())return;var t=evtObj(e),n=evtPane.call(this,e),r=state[n],i=options[n].slideDelay_open;if(t)t.stopImmediatePropagation();if(r.isClosed&&t&&t.type==="mouseenter"&&i>0)timer.set(n+"_openSlider",s,i);else s();},slideClose=function(e){function o(){if(i.isClosed)bindStopSlidingEvents(n,false);else if(!i.isMoving)close(n)}if(!isInitialized())return;var t=evtObj(e),n=evtPane.call(this,e),r=options[n],i=state[n],s=i.isMoving?1e3:300;if(i.isClosed||i.isResizing)return;else if(r.slideTrigger_close==="click")o();else if(r.preventQuickSlideClose&&i.isMoving)return;else if(r.preventPrematureSlideClose&&t&&$.layout.isMouseOverElem(t,$Ps[n]))return;else if(t)timer.set(n+"_closeSlider",o,max(r.slideDelay_close,s));else o();},slideToggle=function(e){var t=evtPane.call(this,e);toggle(t,true)},lockPaneForFX=function(e,t){var n=$Ps[e],r=state[e],i=options[e],s=options.zIndexes;if(t){showMasks(e,{objectsOnly:true});n.css({zIndex:s.pane_animate});if(e=="south")n.css({top:sC.inset.top+sC.innerHeight-n.outerHeight()});else if(e=="east")n.css({left:sC.inset.left+sC.innerWidth-n.outerWidth()})}else{hideMasks();n.css({zIndex:r.isSliding?s.pane_sliding:s.pane_normal});if(e=="south")n.css({top:"auto"});else if(e=="east"&&!n.css("left").match(/\-99999/))n.css({left:"auto"});if(browser.msie&&i.fxOpacityFix&&i.fxName_open!="slide"&&n.css("filter")&&n.css("opacity")==1)n[0].style.removeAttribute("filter")}},bindStartSlidingEvents=function(e,t){var n=options[e],r=$Ps[e],i=$Rs[e],s=n.slideTrigger_open.toLowerCase();if(!i||t&&!n.slidable)return;if(s.match(/mouseover/))s=n.slideTrigger_open="mouseenter";else if(!s.match(/(click|dblclick|mouseenter)/))s=n.slideTrigger_open="click";if(n.resizerDblClickToggle&&s.match(/click/)){i[t?"unbind":"bind"]("dblclick."+sID,toggle)}i[t?"bind":"unbind"](s+"."+sID,slideOpen).css("cursor",t?n.sliderCursor:"default").attr("title",t?n.tips.Slide:"")},bindStopSlidingEvents=function(e,t){function l(t){timer.clear(e+"_closeSlider");t.stopPropagation()}var n=options[e],r=state[e],i=_c[e],s=options.zIndexes,o=n.slideTrigger_close.toLowerCase(),u=t?"bind":"unbind",a=$Ps[e],f=$Rs[e];timer.clear(e+"_closeSlider");if(t){r.isSliding=true;state.panesSliding[e]=true;bindStartSlidingEvents(e,false)}else{r.isSliding=false;delete state.panesSliding[e]}a.css("zIndex",t?s.pane_sliding:s.pane_normal);f.css("zIndex",t?s.pane_sliding+2:s.resizer_normal);if(!o.match(/(click|mouseleave)/))o=n.slideTrigger_close="mouseleave";f[u](o,slideClose);if(o==="mouseleave"){a[u]("mouseleave."+sID,slideClose);f[u]("mouseenter."+sID,l);a[u]("mouseenter."+sID,l)}if(!t)timer.clear(e+"_closeSlider");else if(o==="click"&&!n.resizable){f.css("cursor",t?n.sliderCursor:"default");f.attr("title",t?n.tips.Close:"")}},makePaneFit=function(e,t,n,r){var i=options[e],s=state[e],o=_c[e],u=$Ps[e],a=$Rs[e],f=o.dir==="vert",l=false;if(e==="center"||f&&s.noVerticalRoom){l=s.maxHeight>=0;if(l&&s.noRoom){_showPane(e);if(a)a.show();s.isVisible=true;s.noRoom=false;if(f)s.noVerticalRoom=false;_fixIframe(e)}else if(!l&&!s.noRoom){_hidePane(e);if(a)a.hide();s.isVisible=false;s.noRoom=true}}if(e==="center"){}else if(s.minSize<=s.maxSize){l=true;if(s.size>s.maxSize)sizePane(e,s.maxSize,n,true,r);else if(s.size<s.minSize)sizePane(e,s.minSize,n,true,r);else if(a&&s.isVisible&&u.is(":visible")){var c=s.size+sC.inset[o.side];if($.layout.cssNum(a,o.side)!=c)a.css(o.side,c)}if(s.noRoom){if(s.wasOpen&&i.closable){if(i.autoReopen)open(e,false,true,true);else s.noRoom=false}else show(e,s.wasOpen,true,true)}}else{if(!s.noRoom){s.noRoom=true;s.wasOpen=!s.isClosed&&!s.isSliding;if(s.isClosed){}else if(i.closable)close(e,true,true);else hide(e,true)}}},manualSizePane=function(e,t,n,r,i){if(!isInitialized())return;var s=evtPane.call(this,e),o=options[s],u=state[s],a=i||o.livePaneResizing&&!u.isResizing;u.autoResize=false;sizePane(s,t,n,r,a)},sizePane=function(e,t,n,r,i){function m(){var e=c==="width"?a.outerWidth():a.outerHeight(),r=[{pane:s,count:1,target:t,actual:e,correct:t===e,attempt:t,cssSize:v}],o=r[0],p={},m="Inaccurate size after resizing the "+s+"-pane.";while(!o.correct){p={pane:s,count:o.count+1,target:t};if(o.actual>t)p.attempt=max(0,o.attempt-(o.actual-t));else p.attempt=max(0,o.attempt+(t-o.actual));p.cssSize=cssSize(s,p.attempt);a.css(c,p.cssSize);p.actual=c=="width"?a.outerWidth():a.outerHeight();p.correct=t===p.actual;if(r.length===1){_log(m,false,true);_log(o,false,true)}_log(p,false,true);if(r.length>3)break;r.push(p);o=r[r.length-1]}u.size=t;$.extend(u,elDims(a));if(u.isVisible&&a.is(":visible")){if(f)f.css(l,t+sC.inset[l]);sizeContent(s)}if(!n&&!h&&state.initialized&&u.isVisible)_runCallbacks("onresize_end",s);if(!n){if(!u.isSliding)sizeMidPanes(_c[s].dir=="horz"?"":"center",h,i);sizeHandles()}var g=_c.oppositeEdge[s];if(t<d&&state[g].noRoom){setSizeLimits(g);makePaneFit(g,false,n)}if(r.length>1)_log(m+"\nSee the Error Console for details.",true,true)}if(!isInitialized())return;var s=evtPane.call(this,e),o=options[s],u=state[s],a=$Ps[s],f=$Rs[s],l=_c[s].side,c=_c[s].sizeType.toLowerCase(),h=u.isResizing&&!o.triggerEventsDuringLiveResize,p=r!==true&&o.animatePaneSizing,d,v;$N.queue(function(e){setSizeLimits(s);d=u.size;t=_parseSize(s,t);t=max(t,_parseSize(s,o.minSize));t=min(t,u.maxSize);if(t<u.minSize){e();makePaneFit(s,false,n);return}if(!i&&t===d)return e();if(!n&&state.initialized&&u.isVisible)_runCallbacks("onresize_start",s);v=cssSize(s,t);if(p&&a.is(":visible")){var r=$.layout.effects.size[s]||$.layout.effects.size.all,f=o.fxSettings_size.easing||r.easing,l=options.zIndexes,h={};h[c]=v+"px";u.isMoving=true;a.css({zIndex:l.pane_animate}).show().animate(h,o.fxSpeed_size,f,function(){a.css({zIndex:u.isSliding?l.pane_sliding:l.pane_normal});u.isMoving=false;m();e()})}else{a.css(c,v);if(a.is(":visible"))m();else{u.size=t;$.extend(u,elDims(a))}e()}})},sizeMidPanes=function(e,t,n){e=(e?e:"east,west,center").split(",");$.each(e,function(e,r){if(!$Ps[r])return;var i=options[r],s=state[r],o=$Ps[r],u=$Rs[r],a=r=="center",f=true,l={},c=$.layout.showInvisibly(o),h=calcNewCenterPaneDims();$.extend(s,elDims(o));if(r==="center"){if(!n&&s.isVisible&&h.width===s.outerWidth&&h.height===s.outerHeight){o.css(c);return true}$.extend(s,cssMinDims(r),{maxWidth:h.width,maxHeight:h.height});l=h;l.width=cssW(o,l.width);l.height=cssH(o,l.height);f=l.width>=0&&l.height>=0;if(!state.initialized&&i.minWidth>h.width){var p=i.minWidth-s.outerWidth,d=options.east.minSize||0,v=options.west.minSize||0,m=state.east.size,g=state.west.size,y=m,b=g;if(p>0&&state.east.isVisible&&m>d){y=max(m-d,m-p);p-=m-y}if(p>0&&state.west.isVisible&&g>v){b=max(g-v,g-p);p-=g-b}if(p===0){if(m&&m!=d)sizePane("east",y,true,true,n);if(g&&g!=v)sizePane("west",b,true,true,n);sizeMidPanes("center",t,n);o.css(c);return}}}else{if(s.isVisible&&!s.noVerticalRoom)$.extend(s,elDims(o),cssMinDims(r));if(!n&&!s.noVerticalRoom&&h.height===s.outerHeight){o.css(c);return true}l.top=h.top;l.bottom=h.bottom;l.height=cssH(o,h.height);s.maxHeight=l.height;f=s.maxHeight>=0;if(!f)s.noVerticalRoom=true}if(f){if(!t&&state.initialized)_runCallbacks("onresize_start",r);o.css(l);if(r!=="center")sizeHandles(r);if(s.noRoom&&!s.isClosed&&!s.isHidden)makePaneFit(r);if(s.isVisible){$.extend(s,elDims(o));if(state.initialized)sizeContent(r)}}else if(!s.noRoom&&s.isVisible)makePaneFit(r);o.css(c);if(!s.isVisible)return true;if(r==="center"){var w=browser.isIE6||!browser.boxModel;if($Ps.north&&(w||state.north.tagName=="IFRAME"))$Ps.north.css("width",cssW($Ps.north,sC.innerWidth));if($Ps.south&&(w||state.south.tagName=="IFRAME"))$Ps.south.css("width",cssW($Ps.south,sC.innerWidth))}if(!t&&state.initialized)_runCallbacks("onresize_end",r)})},resizeAll=function(e){var t=sC.innerWidth,n=sC.innerHeight;evtPane(e);if(!$N.is(":visible"))return;if(!state.initialized){_initLayoutElements();return}$.extend(sC,elDims($N,options.inset));if(!sC.outerHeight)return;if(e===true)setPanePosition();if(false===_runCallbacks("onresizeall_start"))return false;var r=sC.innerHeight<n,i=sC.innerWidth<t,s,o,u;$.each(["south","north","east","west"],function(e,t){if(!$Ps[t])return;o=options[t];u=state[t];if(u.autoResize&&u.size!=o.size)sizePane(t,o.size,true,true,true);else{setSizeLimits(t);makePaneFit(t,false,true,true)}});sizeMidPanes("",true,true);sizeHandles();$.each(_c.allPanes,function(e,t){s=$Ps[t];if(!s)return;if(state[t].isVisible)_runCallbacks("onresize_end",t)});_runCallbacks("onresizeall_end")},resizeChildren=function(e,t){var n=evtPane.call(this,e);if(!options[n].resizeChildren)return;if(!t)refreshChildren(n);var r=children[n];if($.isPlainObject(r)){$.each(r,function(e,t){t.resizeAll()})}},sizeContent=function(e,t){if(!isInitialized())return;var n=evtPane.call(this,e);n=n?n.split(","):_c.allPanes;$.each(n,function(e,n){function f(e){return max(o.css.paddingBottom,parseInt(e.css("marginBottom"),10)||0)}function l(){var e=options[n].contentIgnoreSelector,t=i.nextAll().not(".ui-layout-mask").not(e||":lt(0)"),r=t.filter(":visible"),s=r.filter(":last");u={top:i[0].offsetTop,height:i.outerHeight(),numFooters:t.length,hiddenFooters:t.length-r.length,spaceBelow:0};u.spaceAbove=u.top;u.bottom=u.top+u.height;if(s.length)u.spaceBelow=s[0].offsetTop+s.outerHeight()-u.bottom+f(s);else u.spaceBelow=f(i)}var r=$Ps[n],i=$Cs[n],s=options[n],o=state[n],u=o.content;if(!r||!i||!r.is(":visible"))return true;if(!i.length){initContent(n,false);if(!i)return}if(false===_runCallbacks("onsizecontent_start",n))return;if(!o.isMoving&&!o.isResizing||s.liveContentResizing||t||u.top==undefined){l();if(u.hiddenFooters>0&&r.css("overflow")==="hidden"){r.css("overflow","visible");l();r.css("overflow","hidden")}}var a=o.innerHeight-(u.spaceAbove-o.css.paddingTop)-(u.spaceBelow-o.css.paddingBottom);if(!i.is(":visible")||u.height!=a){setOuterHeight(i,a,true);u.height=a}if(state.initialized)_runCallbacks("onsizecontent_end",n);})},sizeHandles=function(e){var t=evtPane.call(this,e);t=t?t.split(","):_c.borderPanes;$.each(t,function(e,t){var n=options[t],r=state[t],i=$Ps[t],s=$Rs[t],o=$Ts[t],u;if(!i||!s)return;var a=_c[t].dir,f=r.isClosed?"_closed":"_open",l=n["spacing"+f],c=n["togglerAlign"+f],h=n["togglerLength"+f],p,d,v,m={};if(l===0){s.hide();return}else if(!r.noRoom&&!r.isHidden)s.show();if(a==="horz"){p=sC.innerWidth;r.resizerLength=p;d=$.layout.cssNum(i,"left");s.css({width:cssW(s,p),height:cssH(s,l),left:d>-9999?d:sC.inset.left})}else{p=i.outerHeight();r.resizerLength=p;s.css({height:cssH(s,p),width:cssW(s,l),top:sC.inset.top+getPaneSize("north",true)})}removeHover(n,s);if(o){if(h===0||r.isSliding&&n.hideTogglerOnSlide){o.hide();return}else o.show();if(!(h>0)||h==="100%"||h>p){h=p;v=0}else{if(isStr(c)){switch(c){case"top":case"left":v=0;break;case"bottom":case"right":v=p-h;break;case"middle":case"center":default:v=round((p-h)/2)}}else{var g=parseInt(c,10);if(c>=0)v=g;else v=p-h+g}}if(a==="horz"){var y=cssW(o,h);o.css({width:y,height:cssH(o,l),left:v,top:0});o.children(".content").each(function(){u=$(this);u.css("marginLeft",round((y-u.outerWidth())/2))})}else{var b=cssH(o,h);o.css({height:b,width:cssW(o,l),top:v,left:0});o.children(".content").each(function(){u=$(this);u.css("marginTop",round((b-u.outerHeight())/2))})}removeHover(0,o)}if(!state.initialized&&(n.initHidden||r.noRoom)){s.hide();if(o)o.hide()}})},enableClosable=function(e){if(!isInitialized())return;var t=evtPane.call(this,e),n=$Ts[t],r=options[t];if(!n)return;r.closable=true;n.bind("click."+sID,function(e){e.stopPropagation();toggle(t)}).css("visibility","visible").css("cursor","pointer").attr("title",state[t].isClosed?r.tips.Open:r.tips.Close).show()},disableClosable=function(e,t){if(!isInitialized())return;var n=evtPane.call(this,e),r=$Ts[n];if(!r)return;options[n].closable=false;if(state[n].isClosed)open(n,false,true);r.unbind("."+sID).css("visibility",t?"hidden":"visible").css("cursor","default").attr("title","")},enableSlidable=function(e){if(!isInitialized())return;var t=evtPane.call(this,e),n=$Rs[t];if(!n||!n.data("draggable"))return;options[t].slidable=true;if(state[t].isClosed)bindStartSlidingEvents(t,true)},disableSlidable=function(e){if(!isInitialized())return;var t=evtPane.call(this,e),n=$Rs[t];if(!n)return;options[t].slidable=false;if(state[t].isSliding)close(t,false,true);else{bindStartSlidingEvents(t,false);n.css("cursor","default").attr("title","");removeHover(null,n[0])}},enableResizable=function(e){if(!isInitialized())return;var t=evtPane.call(this,e),n=$Rs[t],r=options[t];if(!n||!n.data("draggable"))return;r.resizable=true;n.draggable("enable");if(!state[t].isClosed)n.css("cursor",r.resizerCursor).attr("title",r.tips.Resize)},disableResizable=function(e){if(!isInitialized())return;var t=evtPane.call(this,e),n=$Rs[t];if(!n||!n.data("draggable"))return;options[t].resizable=false;n.draggable("disable").css("cursor","default").attr("title","");removeHover(null,n[0])},swapPanes=function(e,t){function o(e){var t=$Ps[e],n=$Cs[e];return!t?false:{pane:e,P:t?t[0]:false,C:n?n[0]:false,state:$.extend(true,{},state[e]),options:$.extend(true,{},options[e])}}function u(e,t){if(!e)return;var n=e.P,r=e.C,i=e.pane,o=_c[t],u=$.extend(true,{},state[t]),a=options[t],f={resizerCursor:a.resizerCursor},l,c,h;$.each("fxName,fxSpeed,fxSettings".split(","),function(e,t){f[t+"_open"]=a[t+"_open"];f[t+"_close"]=a[t+"_close"];f[t+"_size"]=a[t+"_size"]});$Ps[t]=$(n).data({layoutPane:Instance[t],layoutEdge:t}).css(_c.hidden).css(o.cssReq);$Cs[t]=r?$(r):false;options[t]=$.extend(true,{},e.options,f);state[t]=$.extend(true,{},e.state);l=new RegExp(a.paneClass+"-"+i,"g");n.className=n.className.replace(l,a.paneClass+"-"+t);initHandles(t);if(o.dir!=_c[i].dir){c=s[t]||0;setSizeLimits(t);c=max(c,state[t].minSize);manualSizePane(t,c,true,true)}else $Rs[t].css(o.side,sC.inset[o.side]+(state[t].isVisible?getPaneSize(t):0));if(e.state.isVisible&&!u.isVisible)setAsOpen(t,true);else{setAsClosed(t);bindStartSlidingEvents(t,true)}e=null}if(!isInitialized())return;var n=evtPane.call(this,e);state[n].edge=t;state[t].edge=n;if(false===_runCallbacks("onswap_start",n)||false===_runCallbacks("onswap_start",t)){state[n].edge=n;state[t].edge=t;return}var r=o(n),i=o(t),s={};s[n]=r?r.state.size:0;s[t]=i?i.state.size:0;$Ps[n]=false;$Ps[t]=false;state[n]={};state[t]={};if($Ts[n])$Ts[n].remove();if($Ts[t])$Ts[t].remove();if($Rs[n])$Rs[n].remove();if($Rs[t])$Rs[t].remove();$Rs[n]=$Rs[t]=$Ts[n]=$Ts[t]=false;u(r,t);u(i,n);r=i=s=null;if($Ps[n])$Ps[n].css(_c.visible);if($Ps[t])$Ps[t].css(_c.visible);resizeAll();_runCallbacks("onswap_end",n);_runCallbacks("onswap_end",t);return;},syncPinBtns=function(e,t){if($.layout.plugins.buttons)$.each(state[e].pins,function(n,r){$.layout.buttons.setPinState(Instance,$(r),e,t)})};var $N=$(this).eq(0);if(!$N.length){return _log(options.errors.containerMissing)}if($N.data("layoutContainer")&&$N.data("layout"))return $N.data("layout");var $Ps={},$Cs={},$Rs={},$Ts={},$Ms=$([]),sC=state.container,sID=state.id;var Instance={options:options,state:state,container:$N,panes:$Ps,contents:$Cs,resizers:$Rs,togglers:$Ts,hide:hide,show:show,toggle:toggle,open:open,close:close,slideOpen:slideOpen,slideClose:slideClose,slideToggle:slideToggle,setSizeLimits:setSizeLimits,_sizePane:sizePane,sizePane:manualSizePane,sizeContent:sizeContent,swapPanes:swapPanes,showMasks:showMasks,hideMasks:hideMasks,initContent:initContent,addPane:addPane,removePane:removePane,createChildren:createChildren,refreshChildren:refreshChildren,enableClosable:enableClosable,disableClosable:disableClosable,enableSlidable:enableSlidable,disableSlidable:disableSlidable,enableResizable:enableResizable,disableResizable:disableResizable,allowOverflow:allowOverflow,resetOverflow:resetOverflow,destroy:destroy,initPanes:isInitialized,resizeAll:resizeAll,runCallbacks:_runCallbacks,hasParentLayout:false,children:children,north:false,south:false,west:false,east:false,center:false};if(_create()==="cancel")return null;else return Instance};$(function(){var e=$.layout.browser;if(e.msie)e.boxModel=$.support.boxModel})})(jQuery);(function(e){if(!e.ui)e.ui={};e.ui.cookie={acceptsCookies:!!navigator.cookieEnabled,read:function(t){var n=document.cookie,r=n?n.split(";"):[],i;for(var s=0,o=r.length;s<o;s++){i=e.trim(r[s]).split("=");if(i[0]==t)return decodeURIComponent(i[1])}return null},write:function(e,t,n){var r="",i="",s=false,o=n||{},u=o.expires;if(u&&u.toUTCString)i=u;else if(u===null||typeof u==="number"){i=new Date;if(u>0)i.setDate(i.getDate()+u);else{i.setFullYear(1970);s=true}}if(i)r+=";expires="+i.toUTCString();if(o.path)r+=";path="+o.path;if(o.domain)r+=";domain="+o.domain;if(o.secure)r+=";secure";document.cookie=e+"="+(s?"":encodeURIComponent(t))+r},clear:function(t){e.ui.cookie.write(t,"",{expires:-1})}};if(!e.cookie)e.cookie=function(t,n,r){var i=e.ui.cookie;if(n===null)i.clear(t);else if(n===undefined)return i.read(t);else i.write(t,n,r)};e.layout.plugins.stateManagement=true;e.layout.config.optionRootKeys.push("stateManagement");e.layout.defaults.stateManagement={enabled:false,autoSave:true,autoLoad:true,includeChildren:true,stateKeys:"north.size,south.size,east.size,west.size,"+"north.isClosed,south.isClosed,east.isClosed,west.isClosed,"+"north.isHidden,south.isHidden,east.isHidden,west.isHidden",cookie:{name:"",domain:"",path:"",expires:"",secure:false}};e.layout.optionsMap.layout.push("stateManagement");e.layout.state={saveCookie:function(t,n,r){var i=t.options,s=i.stateManagement,o=e.extend(true,{},s.cookie,r||null),u=t.state.stateData=t.readState(n||s.stateKeys);e.ui.cookie.write(o.name||i.name||"Layout",e.layout.state.encodeJSON(u),o);return e.extend(true,{},u)},deleteCookie:function(t){var n=t.options;e.ui.cookie.clear(n.stateManagement.cookie.name||n.name||"Layout")},readCookie:function(t){var n=t.options;var r=e.ui.cookie.read(n.stateManagement.cookie.name||n.name||"Layout");return r?e.layout.state.decodeJSON(r):{}},loadCookie:function(t){var n=e.layout.state.readCookie(t);if(n){t.state.stateData=e.extend(true,{},n);t.loadState(n)}return n},loadState:function(t,n,r){n=e.layout.transformData(n);if(!e.isPlainObject(n)||e.isEmptyObject(n))return;t.state.stateData=n;var i=e.extend(true,{},n);e.each(e.layout.config.allPanes,function(e,t){if(i[t])delete i[t].children});e.extend(true,t.options,i);if(1===1)return;console.data(n,"loadState - stateData");r=e.extend({animate:true,children:false},r);var s,o,u,a,f,l,c,h,p,d,v=!r.animate,m="stateManagement";if(t.state.initialized){e.each(e.layout.config.borderPanes,function(e,r){h=t.state[r];c=n[r];if(typeof c!="object")return;i=c.size;l=c.initClosed;f=c.initHidden;s=h.isVisible;h.autoResize=c.autoResize;if(!s)t._sizePane(r,i,false,false,false);if(f===true)t.hide(r,v);else if(l===false)t.open(r,false,v);else if(l===true)t.close(r,false,v);else if(f===false)t.show(r,false,v);if(s)t._sizePane(r,i,false,false,v)})}},readState:function(t,n){if(e.type(n)==="string")n={keys:n};if(!n)n={};var r=t.options.stateManagement,i=n.includeChildren,s=i!==undefined?i:r.includeChildren,o=n.stateKeys||r.stateKeys,u={isClosed:"initClosed",isHidden:"initHidden"},a=t.state,f=e.layout.config.allPanes,l={},c,h,p,d,v,m,g,y,b,w;if(e.isArray(o))o=o.join(",");o=o.replace(/__/g,".").split(",");for(var E=0,S=o.length;E<S;E++){c=o[E].split(".");h=c[0];p=c[1];if(e.inArray(h,f)<0)continue;d=a[h][p];if(d==undefined)continue;if(p=="isClosed"&&a[h]["isSliding"])d=true;(l[h]||(l[h]={}))[u[p]?u[p]:p]=d}if(s){e.each(f,function(n,r){m=t.children[r];v=a.stateData[r];if(e.isPlainObject(m)&&!e.isEmptyObject(m)){w=l[r]||(l[r]={});if(!w.children)w.children={};e.each(m,function(t,n){if(n.state.initialized)w.children[t]=e.layout.state.readState(n);else if(v&&v.children&&v.children[t]){w.children[t]=e.extend(true,{},v.children[t])}})}})}return l},encodeJSON:function(t){function n(t){var r=[],i=0,s,o,u,a=e.isArray(t);for(s in t){o=t[s];u=typeof o;if(u=="string")o='"'+o+'"';else if(u=="object")o=n(o);r[i++]=(!a?'"'+s+'":':"")+o}return(a?"[":"{")+r.join(",")+(a?"]":"}")}return n(t);},decodeJSON:function(t){try{return e.parseJSON?e.parseJSON(t):window["eval"]("("+t+")")||{}}catch(n){return{}}},_create:function(t){var n=e.layout.state,r=t.options,i=r.stateManagement;e.extend(t,{readCookie:function(){return n.readCookie(t)},deleteCookie:function(){n.deleteCookie(t)},saveCookie:function(e,r){return n.saveCookie(t,e,r)},loadCookie:function(){return n.loadCookie(t)},loadState:function(e,r){n.loadState(t,e,r)},readState:function(e){return n.readState(t,e)},encodeJSON:n.encodeJSON,decodeJSON:n.decodeJSON});t.state.stateData={};if(!i.autoLoad)return;if(e.isPlainObject(i.autoLoad)){if(!e.isEmptyObject(i.autoLoad)){t.loadState(i.autoLoad)}}else if(i.enabled){if(e.isFunction(i.autoLoad)){var s={};try{s=i.autoLoad(t,t.state,t.options,t.options.name||"")}catch(o){}if(s&&e.isPlainObject(s)&&!e.isEmptyObject(s))t.loadState(s)}else t.loadCookie()}},_unload:function(t){var n=t.options.stateManagement;if(n.enabled&&n.autoSave){if(e.isFunction(n.autoSave)){try{n.autoSave(t,t.state,t.options,t.options.name||"")}catch(r){}}else t.saveCookie()}}};e.layout.onCreate.push(e.layout.state._create);e.layout.onUnload.push(e.layout.state._unload);e.layout.plugins.buttons=true;e.layout.defaults.autoBindCustomButtons=false;e.layout.optionsMap.layout.push("autoBindCustomButtons");e.layout.buttons={init:function(t){var n="ui-layout-button-",r=t.options.name||"",i;e.each("toggle,open,close,pin,toggle-slide,open-slide".split(","),function(s,o){e.each(e.layout.config.borderPanes,function(s,u){e("."+n+o+"-"+u).each(function(){i=e(this).data("layoutName")||e(this).attr("layoutName");if(i==undefined||i===r)t.bindButton(this,o,u)})})})},get:function(t,n,r,i){var s=e(n),o=t.options,u=o.errors.addButtonError;if(!s.length){e.layout.msg(u+" "+o.errors.selector+": "+n,true)}else if(e.inArray(r,e.layout.config.borderPanes)<0){e.layout.msg(u+" "+o.errors.pane+": "+r,true);s=e("")}else{var a=o[r].buttonClass+"-"+i;s.addClass(a+" "+a+"-"+r).data("layoutName",o.name)}return s},bind:function(t,n,r,i){var s=e.layout.buttons;switch(r.toLowerCase()){case"toggle":s.addToggle(t,n,i);break;case"open":s.addOpen(t,n,i);break;case"close":s.addClose(t,n,i);break;case"pin":s.addPin(t,n,i);break;case"toggle-slide":s.addToggle(t,n,i,true);break;case"open-slide":s.addOpen(t,n,i,true);break}return t},addToggle:function(t,n,r,i){e.layout.buttons.get(t,n,r,"toggle").click(function(e){t.toggle(r,!!i);e.stopPropagation()});return t},addOpen:function(t,n,r,i){e.layout.buttons.get(t,n,r,"open").attr("title",t.options[r].tips.Open).click(function(e){t.open(r,!!i);e.stopPropagation()});return t},addClose:function(t,n,r){e.layout.buttons.get(t,n,r,"close").attr("title",t.options[r].tips.Close).click(function(e){t.close(r);e.stopPropagation()});return t},addPin:function(t,n,r){var i=e.layout.buttons,s=i.get(t,n,r,"pin");if(s.length){var o=t.state[r];s.click(function(n){i.setPinState(t,e(this),r,o.isSliding||o.isClosed);if(o.isSliding||o.isClosed)t.open(r);else t.close(r);n.stopPropagation()});i.setPinState(t,s,r,!o.isClosed&&!o.isSliding);o.pins.push(n)}return t},setPinState:function(e,t,n,r){var i=t.attr("pin");if(i&&r===(i=="down"))return;var s=e.options[n],o=s.buttonClass+"-pin",u=o+"-"+n,a=o+"-up "+u+"-up",f=o+"-down "+u+"-down";t.attr("pin",r?"down":"up").attr("title",r?s.tips.Unpin:s.tips.Pin).removeClass(r?a:f).addClass(r?f:a)},syncPinBtns:function(t,n,r){e.each(t.state[n].pins,function(i,s){e.layout.buttons.setPinState(t,e(s),n,r)})},_load:function(t){var n=e.layout.buttons;e.extend(t,{bindButton:function(e,r,i){return n.bind(t,e,r,i)},addToggleBtn:function(e,r,i){return n.addToggle(t,e,r,i)},addOpenBtn:function(e,r,i){return n.addOpen(t,e,r,i)},addCloseBtn:function(e,r){return n.addClose(t,e,r)},addPinBtn:function(e,r){return n.addPin(t,e,r)}});for(var r=0;r<4;r++){var i=e.layout.config.borderPanes[r];t.state[i].pins=[]}if(t.options.autoBindCustomButtons)n.init(t)},_unload:function(e){}};e.layout.onLoad.push(e.layout.buttons._load);e.layout.plugins.browserZoom=true;e.layout.defaults.browserZoomCheckInterval=1e3;e.layout.optionsMap.layout.push("browserZoomCheckInterval");e.layout.browserZoom={_init:function(t){if(e.layout.browserZoom.ratio()!==false)e.layout.browserZoom._setTimer(t)},_setTimer:function(t){if(t.destroyed)return;var n=t.options,r=t.state,i=t.hasParentLayout?5e3:Math.max(n.browserZoomCheckInterval,100);setTimeout(function(){if(t.destroyed||!n.resizeWithWindow)return;var i=e.layout.browserZoom.ratio();if(i!==r.browserZoom){r.browserZoom=i;t.resizeAll()}e.layout.browserZoom._setTimer(t)},i)},ratio:function(){function l(e,t){return(parseInt(e,10)/parseInt(t,10)*100).toFixed()}var t=window,n=screen,r=document,i=r.documentElement||r.body,s=e.layout.browser,o=s.version,u,a,f;if(s.msie&&o>8||!s.msie)return false;if(n.deviceXDPI&&n.systemXDPI)return l(n.deviceXDPI,n.systemXDPI);if(s.webkit&&(u=r.body.getBoundingClientRect))return l(u.left-u.right,r.body.offsetWidth);if(s.webkit&&(a=t.outerWidth))return l(a,t.innerWidth);if((a=n.width)&&(f=i.clientWidth))return l(a,f);return false}};e.layout.onReady.push(e.layout.browserZoom._init)})(jQuery)});define("RepositoryBrowser",["jquery","Class","PubSub","repository-browser-i18n-"+(window&&window.__DEPS__&&window.__DEPS__.lang||"en"),"jstree","jqgrid","jquery-layout"],function(e,t,n,r){function f(e){e.each(function(){i(this).attr("unselectable","on").css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none"}).each(function(){this.onselectstart=function(){return false}})})}function l(e){switch(e){case"folder":return"folder";case"document":return"document";default:return""}}function c(){return++u}function h(e,t){e._cachedRepositoryObjects[t.uid]=t}function p(e,t){return e._cachedRepositoryObjects[t]}function d(e){return e.find("a:first").attr("data-repo-obj")}function v(t,n){var r=c();var i=false===t.hasMoreItems||"folder"!==t.baseType?null:"closed";var s=null;if(t.children){i="open";s=[];var o;var u;for(o=0;o<t.children.length;o++){u=v(t.children[o],n);s.push(u);h(n,u.resource)}}var a=e.extend(t,{uid:r,loaded:false});return{state:i,resource:a,children:s,attr:{rel:t.type,"data-repo-obj":r},data:{title:t.name,icon:l(t.baseType),attr:{"data-repo-obj":r}}}}var i=e;var s=[];var o=0;var u=(new Date).getTime();var a={repositoryManager:null,repositoryFilter:[],objectTypeFilter:[],renditionFilter:["cmis:none"],filter:["url"],element:null,isFloating:false,verticalPadding:100,horizontalPadding:50,maxHeight:1e3,minHeight:400,minWidth:400,maxWidth:1200,treeWidth:300,listWidth:"auto",pageSize:8,adaptPageSize:false,rowHeight:32,rootPath:"",rootFolderId:"aloha",columns:{icon:{title:"",width:30,sortable:false,resizable:false},name:{title:"Name",width:200,sorttype:"text"},url:{title:"URL",width:220,sorttype:"text"},preview:{title:"Preview",width:150,sorttype:"text"}},i18n:{Browsing:"Browsing",Close:"Close","in":"in","Input search text...":"Input search text...",numerous:"numerous",of:"of","Repository Browser":"Repository Browser",Search:"Search","Searching for":"Searching for",Viewing:"Viewing"}};var m=t.extend({_cachedRepositoryObjects:{},_searchQuery:null,_orderBy:null,_prefilledValue:null,$_grid:null,$_tree:null,$_list:null,_isOpened:true,_constructor:function(){this.init.apply(this,arguments)},init:function(e){e=i.extend({},a,e,{i18n:r});if(!e.element||0===e.element.length){e.isFloating=true;e.element=this._createOverlay()}if(e.maxWidth<e.minWidth){e.maxWidth=e.minWidth}i.extend(this,e);this._prefilledValue=this._i18n("Input search text...");this._cachedRepositoryObjects={};this._searchQuery=null;this._orderBy=null;this._pagingCount=null;this._pagingOffset=0;this._pagingBtns={first:null,end:null,next:null,prev:null};this._initializeUI();s.push(this);n.pub("repository-browser.initialized",{data:this})},_i18n:function(e){return this.i18n[e]||e},_initializeUI:function(){this.element.attr("data-repository-browser",++u);this.element.width(this.maxWidth);this.$_grid=this._createGrid(this.element).resize();this._setInitialHeight();this.$_tree=this._createTree(this.$_grid.find(".ui-layout-west"));this.$_list=this._createList(this.$_grid.find(".ui-layout-center"));var e=this;var t=this.treeWidth/5;this.$_grid.layout({enableCursorHotkey:false,west__size:this.treeWidth-1,west__minSize:this.treeWidth-t,west__maxSize:this.treeWidth+t,center__size:"auto",paneClass:"ui-layout-pane",resizerClass:"ui-layout-resizer",togglerClass:"ui-layout-toggler",onresize:function(t,n){if("center"===t){e.$_list.setGridWidth(n.width())}}}).sizePane("west",this.treeWidth);f(this.$_grid);this._preloadImages();i(function(){i(window).resize(function(){e._onWindowResized()})});this.element.mousedown(function(){i.each(s,function(e){this.element.css("z-index",99999+e)});i(this).css("z-index",99999+s.length+1)});i(".repository-browser-grid").css("width",this.maxWidth);this.close();this._adaptPageSize()},_setInitialHeight:function(){var e=this.maxHeight-i(window).height()+this.verticalPadding;var t=e>0?Math.max(this.minHeight,this.maxHeight-e):this.maxHeight;this.$_grid.height(t)},_onWindowResized:function(){var e=this.maxWidth-i(window).width()+this.horizontalPadding,t,n;var r=e>0?Math.max(this.minWidth,this.maxWidth-e):this.maxWidth;this.element.width(r);this.$_grid.width(r);this._setInitialHeight();t=this.$_grid.find(".repository-browser-tree-header");this.$_tree.height(this.$_grid.height()-t.outerHeight(true));n=this.$_grid.find(".ui-layout-center");n.find(".ui-jqgrid-bdiv").height(this.$_grid.height()-(n.find(".ui-jqgrid-titlebar").height()+n.find(".ui-jqgrid-hdiv").height()+n.find(".ui-jqgrid-pager").height()));if(this._adaptPageSize()){if(this._currentFolder){this._fetchItems(this._currentFolder)}}},_preloadImages:function(){var e=this.rootPath+"img/";var t=["arrow-000-medium.png","arrow-180.png","arrow-315-medium.png","arrow-stop-180.png","arrow-stop.png","arrow.png","control-stop-square-small.png","folder-horizontal-open.png","folder-open.png","magnifier-left.png","page.png","picture.png","sort-alphabet-descending.png","sort-alphabet.png"];var n=t.length;while(n){var r=document.createElement("img");r.src=e+t[--n]}},_processRepoResponse:function(e,t,n){if(typeof t==="function"){n=t;t=undefined}var r=this;var i=[];var s=r._currentFolder&&r._currentFolder.id;var o=null;var u;var a;for(a=0;a<e.length;a++){u=v(e[a],r);i.push(u);h(r,u.resource);if(s===u.resource.id){o=u.resource}}n(i,t);if(o){window.setTimeout(function(){r.$_tree.jstree("select_node",'li[data-repo-obj="'+o.uid+'"]')},0)}},_fetchRepoRoot:function(e){if(!this._currentFolder){this._currentFolder=this.getSelectedFolder()}if(this.repositoryManager){this.getRepoChildren({inFolderId:this.rootFolderId,repositoryFilter:this.repositoryFilter},e)}},_getObjectFromCache:function(e){if(e&&e.length){var t=e.find("a:first").attr("data-repo-obj");return this._cachedRepositoryObjects[t]}return null},_onTreeNodeSelected:function(e,t){if(t.args[0].context){return}var n=this;var r=p(n,d(t.rslt.obj));if(r){n._pagingOffset=0;n._currentFolder=r;n._clearSearch();n._fetchItems(r);n.folderSelected(r)}},_createTree:function(t){var n=i('<div class="repository-browser-tree">');var r=i('<div class="repository-browser-tree-header'+' repository-browser-grab-handle">'+this._i18n("Repository Browser")+"</div>");t.append(r,n);n.height(this.$_grid.height()-r.outerHeight(true));n.bind("loaded.jstree",function(t,r){e(this).find(">ul>li:first").css("padding-top",5);e(this).find('li[rel="repository"]:first').each(function(e,t){n.jstree("open_node",t)})});var s=this;n.bind("select_node.jstree",function(e,t){s._onTreeNodeSelected(e,t)});n.bind("open_node.jstree",function(e,t){s.folderOpened(t.rslt.obj)});n.bind("close_node.jstree",function(e,t){s.folderClosed(t.rslt.obj)});n.jstree({types:this.types,rootFolderId:this.rootFolderId,plugins:["themes","json_data","ui","types"],core:{animation:250},themes:{url:this.rootPath+"css/jstree.css",dots:true,icons:true,theme:"browser"},json_data:{data:function(e,t){if(s.repositoryManager){s.jstree_callback=t;s._fetchSubnodes(e,t)}else{t()}},correct_state:true},ui:{select_limit:1}});return n},_createGrid:function(e){var t=i('<div class="repository-browser-grid				             repository-browser-shadow							 repository-browser-rounded-top">					<div class="ui-layout-west"></div>					<div class="ui-layout-center"></div>				</div>');e.append(t);return t},_createList:function(e){var t=i('<table id="repository-browser-list-'+ ++u+'" class="repository-browser-list"></table>');var n=[{name:"id",sorttype:"int",firstsortorder:"asc",hidden:true}];var r=[""];i.each(this.columns,function(e,t){r.push(t.title||"&nbsp;");n.push({name:e,width:t.width,sortable:t.sortable,sorttype:t.sorttype,resizable:t.resizable,fixed:t.fixed})});var s="repository-browser-list-page-"+ ++u;e.append(t,i('<div id="'+s+'">'));t.jqGrid({datatype:"local",width:e.width(),shrinkToFit:true,colNames:r,colModel:n,caption:"&nbsp;",altRows:true,altclass:"repository-browser-list-altrow",resizeclass:"repository-browser-list-resizable",pager:"#"+s,viewrecords:true,onPaging:function(e){},loadError:function(e,t,n){},ondblClickRow:function(e,t,n,r){},gridComplete:function(){},loadComplete:function(e){}});e.find(".ui-jqgrid-bdiv").height(this.$_grid.height()-(e.find(".ui-jqgrid-titlebar").height()+e.find(".ui-jqgrid-hdiv").height()+e.find(".ui-jqgrid-pager").height()));var o=this;t.click(function(){o.rowClicked.apply(o,arguments)});e.find(".ui-pg-button").unbind().find(">span.ui-icon").each(function(){var e=this.className.match(/ui\-icon\-seek\-([a-z]+)/)[1];o._pagingBtns[e]=i(this).parent().addClass("ui-state-disabled").click(function(){if(!i(this).hasClass("ui-state-disabled")){o._doPaging(e)}})});e.find(".ui-pg-input").parent().hide();e.find(".ui-separator").parent().css("opacity",0).first().hide();this._createTitlebar(e);var a=t[0].p;e.find(".ui-jqgrid-view tr:first th div").each(function(e){if(false!==a.colModel[e].sortable){i(this).css("cursor","pointer");i(this).unbind().click(function(t){t.stopPropagation();o._sortList(a.colModel[e],this)})}});return t},_clearSearch:function(){var e=this.$_grid.find(".repository-browser-search-field");e.val(this._prefilledValue).addClass("repository-browser-search-field-empty");this._searchQuery=null},_createTitlebar:function(e){var t=e.find(".ui-jqgrid-titlebar");var n=i('<div class="repository-browser-btns">					<input type="text" class="repository-browser-search-field" />					<span class="repository-browser-btn repository-browser-search-btn">						<span class="repository-browser-search-icon"></span>					</span>					<span class="repository-browser-btn repository-browser-close-btn">'+this._i18n("Close")+'</span>					<div class="repository-browser-clear"></div>				</div>');var r=this;t.addClass("repository-browser-grab-handle").append(n);t.find(".repository-browser-search-btn").html(this._i18n("Search")).click(function(){r._triggerSearch()});var s=t.find(".repository-browser-search-field");this._clearSearch();s.keypress(function(e){if(13===e.keyCode){r._triggerSearch()}});s.focus(function(){if(i(this).val()===r._prefilledValue){i(this).val("").removeClass("repository-browser-search-field-empty")}});s.blur(function(){if(i(this).val()===""){r._clearSearch()}});t.find(".repository-browser-close-btn").click(function(){r.close()});t.find(".repository-browser-btn").mousedown(function(){i(this).addClass("repository-browser-pressed")}).mouseup(function(){i(this).removeClass("repository-browser-pressed")})},_triggerSearch:function(){var e=this.$_grid.find("input.repository-browser-search-field");var t=e.val();if(i(e).hasClass("aloha-browser-search-field-empty")||""===t){t=null}this._pagingOffset=0;this._searchQuery=t;this._fetchItems(this._currentFolder)},_sortList:function(e,t){this.$_grid.find("span.ui-grid-ico-sort").addClass("ui-state-disabled");e.sortorder="asc"===e.sortorder?"desc":"asc";i(t).find("span.s-ico").show().find(".ui-icon-"+e.sortorder).removeClass("ui-state-disabled");this._setSortOrder(e.name,e.sortorder);this._fetchItems(this._currentFolder)},_doPaging:function(e){switch(e){case"first":this._pagingOffset=0;break;case"end":if(this._pagingCount%this.pageSize===0){this._pagingOffset=this._pagingCount-this.pageSize}else{this._pagingOffset=this._pagingCount-this._pagingCount%this.pageSize}break;case"next":this._pagingOffset+=this.pageSize;break;case"prev":this._pagingOffset-=this.pageSize;if(this._pagingOffset<0){this._pagingOffset=0}break}this._fetchItems(this._currentFolder)},_setSortOrder:function(e,t){var n={};var r=false;var i=this._orderBy||[];var s;var o;var u;n[e]=t||"asc";for(u=0;u<i.length;++u){s=i[u];for(o in s){if(s.hasOwnProperty(o)){if(o===e){i.splice(u,1);i.unshift(n);r=true;break}}}if(r){break}}if(r){i.unshift(n)}this._orderBy=i},_listItems:function(e){var t=this.$_list.clearGridData();var n;var r;for(n=0;n<e.length;n++){r=e[n].resource;t.addRowData(r.uid,i.extend({id:r.id},this.renderRowCols(r)))}},handleTimeout:function(){},_processItems:function(e,t){this._pagingCount=t&&i.isNumeric(t.numItems)?t.numItems:null;this.$_grid.find(".loading").hide();this.$_list.show();this._listItems(e);var n="ui-state-disabled";var r=this._pagingBtns;if(this._pagingOffset<=0){r.first.add(r.prev).addClass(n)}else{r.first.add(r.prev).removeClass(n)}if(!i.isNumeric(this._pagingCount)){r.end.addClass(n);if(e.length<=this.pageSize){r.next.addClass(n)}else{r.next.removeClass(n)}}else if(this._pagingOffset+this.pageSize>=this._pagingCount){r.end.add(r.next).addClass(n)}else{r.end.add(r.next).removeClass(n)}var s;var o;if(0===e.length&&0===this._pagingOffset){s=0;o=0}else{s=this._pagingOffset+1;o=s+e.length-1}this.$_grid.find(".ui-paging-info").html(this._i18n("Viewing")+" "+s+" - "+o+" "+this._i18n("of")+" "+(i.isNumeric(this._pagingCount)?this._pagingCount:this._i18n("numerous")));if(t&&t.timeout){this.handleTimeout()}},_createOverlay:function(){if(0===i(".repository-browser-modal-overlay").length){i("body").append('<div class="repository-browser-modal-overlay" '+'style="top: -99999px; z-index: 99999;"></div>')}var e=this;i(".repository-browser-modal-overlay").click(function(){e.close()});var t=i('<div class="repository-browser-modal-window"'+' style="top: -99999px; z-index: 99999;">');i("body").append(t);return t},_fetchSubnodes:function(e,t){if(-1===e){this._fetchRepoRoot(t)}else{var n;for(n=0;n<e.length;n++){var r=this._getObjectFromCache(e.eq(n));if(r){this.fetchChildren(r,t)}}}},getRepoChildren:function(e,t){if(this.repositoryManager){var n=this;this.repositoryManager.getChildren(e,function(e){n._processRepoResponse(e,t)})}},queryRepository:function(e,t){if(this.repositoryManager){var n=this;this.repositoryManager.query(e,function(e){n._processRepoResponse(e.results>0?e.items:[],{numItems:e.numItems,hasMoreItems:e.hasMoreItems,timeout:e.timeout},t)})}},renderRowCols:function(e){var t={};i.each(this.columns,function(n,r){switch(n){case"icon":t.icon='<div class="repository-browser-icon '+"repository-browser-icon-"+e.type+'"></div>';break;default:t[n]=e[n]||"--"}});return t},onSelect:function(e){},fetchChildren:function(e,t){if(true===e.hasMoreItems||"folder"===e.baseType){if(false===e.loaded){var n=this;this.getRepoChildren({inFolderId:e.id,repositoryId:e.repositoryId},function(r){n._cachedRepositoryObjects[e.uid].loaded=true;if(typeof t==="function"){t(r)}})}}},rowClicked:function(e){var t=i(e.target).parent("tr");if(t.length){var n=t.attr("id");var r=this._cachedRepositoryObjects[n];this.onSelect(r);return r}return null},getFieldOfHeader:function(e){return e.find("div.ui-jqgrid-sortable").attr("id").replace("jqgh_","")},_fetchItems:function(e){if(!e){return}var t=typeof this._searchQuery==="string";this.$_list.setCaption(typeof this._searchQuery==="string"?this._i18n("Searching for")+' "'+this._searchQuery+'" '+this._i18n("in")+" "+e.name:this._i18n("Browsing")+": "+e.name);this.$_list.hide();this.$_grid.find(".loading").show();var n=this;this.queryRepository({repositoryId:e.repositoryId,inFolderId:e.id,queryString:this._searchQuery,orderBy:this._orderBy,skipCount:this._pagingOffset,maxItems:this.pageSize,objectTypeFilter:this.objectTypeFilter,renditionFilter:this.renditionFilter,filter:this.filter,recursive:t},function(e,t){n._processItems(e,t)})},setObjectTypeFilter:function(e){this.objectTypeFilter=typeof e==="string"?[e]:e},getObjectTypeFilter:function(){return this.objectTypeFilter},show:function(){this.open()},open:function(){if(this._isOpened){return}this._isOpened=true;var e=this.element;if(this.isFloating){i(".repository-browser-modal-overlay").stop().css({top:0,left:0}).show();e.stop().show();this._onWindowResized();this.$_grid.resize();var t=i(window);e.css({left:this.horizontalPadding/2,top:this.verticalPadding/2}).draggable({handle:e.find(".repository-browser-grab-handle")});this.$_grid.css({marginTop:0,opacity:0}).animate({marginTop:0,opacity:1},1500,"easeOutExpo",function(){if(i.browser.msie){i(this).add(e).css("filter","progid:DXImageTransform.Microsoft.gradient(enabled=false)")}})}else{e.stop().show().css({opacity:1,filter:"progid:DXImageTransform.Microsoft.gradient(enabled=false)"});this._onWindowResized();this.$_grid.resize()}++o},close:function(){if(!this._isOpened){return}this._isOpened=false;this.element.fadeOut(250,function(){i(this).css("top",0).hide();if(0===o||0===--o){i(".repository-browser-modal-overlay").hide()}})},refresh:function(){if(this._currentFolder){this._fetchItems(this._currentFolder)}},folderOpened:function(e){var t=this;var n=p(t,d(e));if(n){t.repositoryManager.folderOpened(n)}},folderClosed:function(e){var t=this._getObjectFromCache(e);if(t){if(this.repositoryManager){this.repositoryManager.folderClosed(t)}}},folderSelected:function(e){if(this.repositoryManager){this.repositoryManager.folderSelected(e)}},getSelectedFolder:function(){if(this.repositoryManager){if(typeof this.repositoryManager.getSelectedFolder==="function"){return this.repositoryManager.getSelectedFolder()}}},_adaptPageSize:function(){var e,t,n;if(!this.adaptPageSize||!this.$_list||!this.rowHeight){return false}n=this.$_grid.find(".ui-jqgrid-bdiv");e=n.innerHeight()-20;if(e){t=Math.floor(e/this.rowHeight);if(t<=0){t=1}if(t!==this.pageSize){this.pageSize=t;return true}else{return false}}else{return false}}});return m});define("repository-browser-i18n-de",[],function(){return{Browsing:"Durchsuchen",Close:"Schlieen","in":"in","Input search text...":"Suchtext einfgen...",numerous:"zahlreiche",of:"von","Repository Browser":"Repository Browser",Search:"Suchen","Searching for":"Suche nach",Viewing:"Anzeige","button.switch-metaview.tooltip":"Zwischen Metaansicht und normaler Ansicht umschalten"}});define("repository-browser-i18n-en",[],function(){return{Browsing:"Browsing",Close:"Close","in":"in","Input search text...":"Input search text...",numerous:"numerous",of:"of","Repository Browser":"Repository Browser",Search:"Search","Searching for":"Searching for",Viewing:"Viewing","button.switch-metaview.tooltip":"Switch between meta and normal view"}});define("linkbrowser/nls/i18n",{root:{"button.addlink.tooltip":"Insert Link","button.removelink.tooltip":"Remove Link","newlink.defaulttext":"New Link","floatingmenu.tab.link":"Link"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("linkbrowser/linkbrowser-plugin",["aloha","jquery","aloha/plugin","aloha/pluginmanager","ui/ui","ui/button","link/link-plugin","RepositoryBrowser","i18n!linkbrowser/nls/i18n","i18n!aloha/nls/i18n"],function(e,t,n,r,i,s,o,u,a,f){var l=u.extend({init:function(t){this._super(t);var n=this;this._linkBrowserButton=i.adopt("linkBrowser",s,{tooltip:a.t("button.addlink.tooltip"),icon:"aloha-icon-tree",scope:"Aloha.continuoustext",click:function(){n.show()}});this._linkBrowserButton.hide();this.url=e.getAlohaUrl()+"/../plugins/extra/linkbrowser/";e.bind("aloha-link-selected",function(e,t){n._linkBrowserButton.show()});e.bind("aloha-link-unselected",function(e,t){n._linkBrowserButton.hide()})},onSelect:function(t){o.hrefField.setItem(t);var n=e.Selection.getRangeObject();var r=n.startContainer=n.endContainer;var i=n.startOffset=n.endOffset;n.select();n.startContainer=n.endContainer=r;n.startOffset=n.endOffset=i;n.select();e.trigger("aloha-link-selected-in-linkbrowser",t);this.close()},renderRowCols:function(e){var n={},r=this.url,i="__page__",s=e.id.match(/(\d+)\./);t.each(this.columns,function(t,s){switch(t){case"icon":n.icon='<div class="aloha-browser-icon						aloha-browser-icon-'+i+'"></div>';break;case"translations":if(!e.renditions){break}var o=e.renditions,u=o.length,a=[],f;for(;u>0;--u){f=o[u];if(f.kind=="translation"){a.push('<img src="'+r+"img/flags/"+f.language+'.png"									  alt="'+f.language+'"									  title="'+f.filename+'" />')}}n.translations=a.join("");break;case"language":n.language=e.language;break;default:n[t]=e[t]||"--"}});return n}});var c=n.create("linkbrowser",{dependencies:["link"],browser:null,init:function(){var t={repositoryManager:e.RepositoryManager,repositoryFilter:[],objectTypeFilter:["website","file","image","language"],renditionFilter:["*"],filter:["language"],columns:{icon:{title:"",width:30,sortable:false,resizable:false},name:{title:"Name",width:320,sorttype:"text"},language:{title:"",width:30,sorttype:"text"},translations:{title:"",width:350,sorttype:"text"}},rootPath:e.settings.baseUrl+"/vendor/repository-browser/"};this.browser=new l(t)}});return c});define("imagebrowser/nls/i18n",{root:{"button.addimage.tooltip":"Insert Image","button.removeimage.tooltip":"Remove Image","newimage.defaulttext":"New Image","floatingmenu.tab.img":"Image"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("imagebrowser/imagebrowser-plugin",["aloha","jquery","aloha/plugin","aloha/pluginmanager","ui/ui","ui/button","image/image-plugin","RepositoryBrowser","i18n!imagebrowser/nls/i18n","i18n!aloha/nls/i18n"],function(e,t,n,r,i,s,o,u,a,f){var l=u.extend({init:function(t){this._super(t);var n=this;this._imageBrowserButton=i.adopt("imageBrowser",s,{tooltip:a.t("button.addimage.tooltip"),icon:"aloha-icon-tree",scope:"Aloha.continuoustext","class":"aloha-imagebrowser-button",click:function(){n.open()}});this._imageBrowserButton.show(false);this.url=e.getAlohaUrl()+"/../plugins/extra/imagebrowser/";e.bind("aloha-image-selected",function(e,t){n._imageBrowserButton.show(true)});e.bind("aloha-image-unselected",function(e,t){n._imageBrowserButton.show(false)})},onSelect:function(e){if(e.type.match("image")!==null){o.ui.imgSrcField.setItem(e);o.resetSize();this.close()}},listItems:function(e){var n=this;var r=this.list.clearGridData();t.each(e,function(){var e=this.resource;if(e.type.match("image")!==null){r.addRowData(e.uid,t.extend({id:e.id},n.renderRowCols(e)))}})},renderRowCols:function(e){var n={},r=this.url,i="__page__",s=e.id.match(/(\d+)\./);t.each(this.columns,function(t,r){switch(t){case"icon":if(!e.renditions){break}if(e.renditions.length===1){if(e.renditions[0].kind==="thumbnail"){n.icon='<img width="'+e.renditions[0].width+'" height="'+e.renditions[0].height+' " src="'+e.renditions[0].url+'"/>'}}break;default:n[t]=e[t]||"--"}});return n}});var c=n.create("imagebrowser",{dependencies:["image"],browser:null,init:function(){var t={repositoryManager:e.RepositoryManager,repositoryFilter:[],objectTypeFilter:["image"],renditionFilter:["*"],filter:["language"],columns:{icon:{title:"",width:75,sortable:false,resizable:false},name:{title:"Name",width:320,sorttype:"text"}},rootPath:e.settings.baseUrl+"/vendor/repository-browser/"};this.browser=new l(t)}});return c});define("ui/menuButton",["jquery","ui/component","ui/utils","jqueryui"],function(e,t,n){function i(t,r){var o=[];e.each(r,function(r,u){var a=e("<li>");a.append(e("<a>",{href:"javascript:void 0",html:n.makeButtonLabelWithIcon(u)}));if(u.click){a.data("aloha-ui-menubutton-select",function(){t();u.click()})}if(u.menu){var f=e("<ul>").appendTo(a);f.append(i(s(f,t),u.menu))}o.push(a[0])});return o}function s(t,n){n=n||e.noop;return function(){t.blur().hide();t.parent().removeClass("aloha-ui-menubutton-pressed");n()}}function o(e,t){var n=t.item.data("aloha-ui-menubutton-select");n&&n(e,t);e.preventDefault()}var r=t.extend({init:function(){this.element=r.makeMenuButton(this)}});r.makeMenuButton=function(t){function c(e){e.hide().parent().removeClass("aloha-ui-menubutton-pressed")}var r=e("<div>",{"class":"aloha-ui-menubutton-container"});var u=n.makeButtonElement({"class":"aloha-ui-menubutton-expand"});var a=e("<ul>",{"class":"aloha-ui-menubutton-menu"});var f=null;var l=null;if(e.browser.msie){r.addClass("aloha-ui-menubutton-iehack")}if(t.click){f=n.makeButton(n.makeButtonElement({"class":"aloha-ui-menubutton-action"}),t).click(t.click);n.makeButton(u,{},true);l=e("<div>").buttonset().append(f).append(u)}else{n.makeButton(u,t,true).addClass("aloha-ui-menubutton-single")}if(!t.menu){return r.append(f)}u.click(function(){r.addClass("aloha-ui-menubutton-pressed");if(t.siblingContainer){t.siblingContainer.find(".aloha-ui-menubutton-menu").each(function(){if(this!==a[0]){c(e(this))}})}if(a.is(":visible")){c(a);return}a.show().position({my:"left top",at:"left bottom",of:f||u});e(document).bind("click",function(t){e(this).unbind(t);a.hide();r.removeClass("aloha-ui-menubutton-pressed")});return false});r.append(l||u).append(a);a.append(i(s(a),t.menu));a.hide().menu({select:o});return r};return r});define("ribbon/ribbon-plugin",["jquery","aloha/plugin","ui/menuButton","ui/utils","jqueryui"],function(e,t,n,r){var i=t.create("ribbon",{init:function(){if(!this.settings.enable&&typeof this.settings.enable!=="undefined"){return}var t=this;this._visible=false;this._toolbar=e("<div>",{"class":"aloha-ribbon-toolbar ui-menubar ui-widget-header ui-helper-clearfix"});var n=r.makeButtonElement({"class":"aloha-ribbon-in"}).button().hide().click(function(){t._toolbar.animate({left:0});e("body").animate({paddingTop:30});n.hide()}).appendTo(this._toolbar);var i=r.makeButtonElement({"class":"aloha-ribbon-out"}).button().click(function(){t._toolbar.animate({left:-t._toolbar.outerWidth()+n.outerWidth()+10});e("body").animate({paddingTop:0});n.show()}).appendTo(this._toolbar);var s=e("<div>",{"class":"aloha aloha-ribbon"}).appendTo("body");this._icon=e("<div>").prependTo(this._toolbar);this.setIcon("");this._toolbar.appendTo(s);e("body").css({position:"relative",paddingTop:30})},setIcon:function(e){if(!this._icon){return}this._icon.attr("class","aloha-ribbon-icon "+e)},addButton:function(t){if(!this._toolbar){return}t=e.extend({},t,{siblingContainer:this._toolbar});this._toolbar.append(n.makeMenuButton(t))},hide:function(){if(!this._toolbar){return}this._toolbar.hide();this._visible=false},show:function(){if(!this._toolbar){return}this._toolbar.show();this._visible=true},isVisible:function(){return this._visible}});return i});define("wai-lang/nls/i18n",{root:{"floatingmenu.tab.wai-lang":"Language annotation","button.add-wai-lang-remove.tooltip":"Remove language annotation","button.add-wai-lang.tooltip":"Add language annotation"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("wai-lang/languages",["aloha","jquery","flag-icons/flag-icons-plugin","aloha/console","wai-lang/wai-lang-plugin"],function(e,t,n,r){var i=t.Deferred();return new(e.AbstractRepository.extend({languageCodes:[],locale:"de",iso:"iso639-1",flags:false,_constructor:function(){this._super("wai-languages")},init:function(){var t=this;var n=e.require("wai-lang/wai-lang-plugin");var r=e.settings.locale;var s=n.iso639;if(r!=="de"){this.locale="en"}if(s!=="iso639-1"){this.iso="iso639-2"}this.flags=n.flags;this.repositoryName="WaiLanguages";e.require(["wai-lang/"+this.iso+"-"+this.locale],function(e){t.storeLanguageCodes(e);i.resolve()})},markObject:function(e,t){},errorHandler:function(e,t){r.log("error",this,"Error while loading languages. "+e)},storeLanguageCodes:function(r){var i=this;var s=e.getPluginUrl("wai-lang");t.each(r,function(t,r){var o=r;o.id=t;o.repositoryId=i.repositoryId;o.type="language";if(i.flags){if(o.flag){o.url=n.path+"/img/flags/"+o.flag+".png"}else{o.url=s+"/img/button.png"}}i.languageCodes.push(new e.RepositoryDocument(o))})},_searchInLanguageCodes:function(e,n){var r=new RegExp("^"+e.queryString,"i"),i,s=[],o,u,a;for(i=0;i<this.languageCodes.length;++i){a=this.languageCodes[i];o=!e.queryString||a.name.match(r);u=!e.objectTypeFilter||!e.objectTypeFilter.length||t.inArray(a.type,e.objectTypeFilter)>-1;if(o&&u){s.push(a)}}n.call(this,s)},query:function(e,t){var n=this;i.done(function(){n._searchInLanguageCodes(e,t)})},getObjectById:function(e,t){var n,r;for(n=0;n<this.languageCodes.length;++n){r=this.languageCodes[n];if(r.id===e){t.call(this,[r]);break}}}}))});define("wai-lang/wai-lang-plugin",["aloha","jquery","PubSub","aloha/plugin","aloha/selection","util/dom","ui/ui","ui/scopes","ui/button","ui/toggleButton","ui/port-helper-attribute-field","i18n!wai-lang/nls/i18n","wai-lang/languages"],function(t,n,r,i,s,o,u,a,f,l,c,h){function v(e){if(e){e.foreground();e.focus()}a.setScope("wai-lang")}function m(e){return true===e||1===e||"true"===e||"1"===e}function g(){var e=n(this);return e.hasClass(p)||e.is("[lang]")}function y(e){return t.activeEditable?e.findMarkup(g,t.activeEditable.obj):null}function b(e){if(e.isCollapsed()){o.extendToWord(e)}o.addMarkup(e,n('<span class="'+p+'"></span>'),false);e.select()}function w(e){var t=y(e);if(t){o.removeFromDOM(t,e,true);e.select()}}function E(){var e=s.getRangeObject();if(!y(e)){b(e)}v(d)}function S(){if(t.activeEditable){var e=s.getRangeObject();if(y(e)){w(e)}else{b(e);v(d)}}}function x(e){var t=n(e);t.addClass(p).attr("data-gentics-aloha-repository","wai-languages").attr("data-gentics-aloha-object-id",t.attr("lang"))}function T(e){d=c({name:"wailangfield",width:320,valueField:"id",minChars:1,scope:"wai-lang"});e._wailangButton=u.adopt("wailang",l,{tooltip:h.t("button.add-wai-lang.tooltip"),icon:"aloha-icon aloha-icon-wai-lang",scope:"Aloha.continuoustext",click:S});u.adopt("removewailang",f,{tooltip:h.t("button.add-wai-lang-remove.tooltip"),icon:"aloha-icon aloha-icon-wai-lang-remove",scope:"wai-lang",click:function(){w(s.getRangeObject())}});a.createScope("wai-lang","Aloha.continuoustext");d.setTemplate(e.flags?'<div class="aloha-wai-lang-img-item">'+'<img class="aloha-wai-lang-img" src="{url}" />'+'<div class="aloha-wai-lang-label-item">{name} ({id})</div>'+"</div>":'<div class="aloha-wai-lang-img-item">'+'<div class="aloha-wai-lang-label-item">{name} ({id})</div>'+"</div>");d.setObjectTypeFilter(e.objectTypeFilter)}function C(e){return e._instanceId}function L(e,t){var n=e.getId()+":"+C(t);if(!k[n]){k[n]=t.getEditableConfig(e.obj)}return k[n]}function A(e){r.sub("aloha.editable.activated",function(r){var i=L(r.data.editable,e);if(n.inArray("span",i)>-1){e._wailangButton.show()}else{e._wailangButton.hide()}});t.bind("aloha-selection-changed",function(n,r){var i=y(r);if(i){e._wailangButton.setState(true);d.setTargetObject(i,"lang");a.setScope("wai-lang")}else{e._wailangButton.setState(false);d.setTargetObject(null)}});d.addListener("blur",function(){if(!this.getValue()){w(s.getRangeObject())}});t.bind("aloha-editable-created",function(n,r){r.obj.bind("keydown",e.hotKey.insertAnnotation,function(){E();return false});r.obj.find("span[lang]").each(function(){x(this)})})}var p="aloha-wai-lang";var d=null;var N=function(e){var t=0;return function(){return e+"-"+ ++t}}();var k={};return i.create("wai-lang",{config:["span"],iso639:"iso639-1",flags:false,objectTypeFilter:["language"],hotKey:{insertAnnotation:h.t("insertAnnotation","ctrl+shift+l")},init:function(){this._instanceId=N("wai-lang");if(this.settings.objectTypeFilter){this.objectTypeFilter=this.settings.objectTypeFilter}if(this.settings.hotKey){n.extend(true,this.hotKey,this.settings.hotKey)}if(this.settings.iso639){this.iso639=this.settings.iso639}this.flags=m(this.settings.flags);T(this);A(this)},formatLanguageSpan:S,makeClean:function(t){t.find("span[lang]").each(function(){var t=n(this);t.removeClass(p).removeAttr("data-gentics-aloha-repository").removeAttr("data-gentics-aloha-object-id").attr("xml:lang",t.attr("lang"))})}})});define("headerids/nls/i18n",{root:{"headerids.label.target":"Target","headerids.button.reset":"Reset","headerids.button.set":"Set",internal_hyperlink:"Internal Hyperlink"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("headerids/headerids-plugin",["aloha","jquery","PubSub","aloha/plugin","util/html","i18n!headerids/nls/i18n"],function(e,t,n,r,i,s){function a(){var e=[],n=u;o.each(arguments,function(){e.push("."+(this==""?n:n+"-"+this))});return t.trim(e.join(" "))}function f(){var e=[],n=u;o.each(arguments,function(){e.push(this==""?n:n+"-"+this)});return t.trim(e.join(" "))}function l(e){return e.find("h1,h2,h3,h4,h5,h6").not(".aloha-customized,.aloha-editable,.aloha-block")}function c(e){var t=e,n=1;while(o("#"+e).length>0){e=t+"_"+(++n).toString()}return e}var o=t;var u="aloha-headerids";return r.create("headerids",{_constructor:function(){this._super("headerids")},config:["true"],init:function(){var t=this,r=function(e){var n=e.data.obj||e.data.editable.obj;t.check(n)};n.sub("aloha.editable.created",r);n.sub("aloha.editable.activated",r);n.sub("aloha.editable.deactivated",r);e.bind("aloha-plugins-loaded",function(n){t.initSidebar(e.Sidebar.right)})},check:function(e){var t=this;if(o.inArray("true",t.getEditableConfig(e))>-1){l(e).each(function(e,n){t.processH(n)})}},processH:function(e){if(!e.id){var t=o(e),n=this.sanitize(t.text());n=c(n);t.attr("id",n)}},sanitize:function(e){return i.trimWhitespaceCharacters(e).replace(/[^a-z0-9]+/gi,"_")},initSidebar:function(e){var n=this;n.sidebar=e;e.addPanel({id:f("sidebar-panel"),title:s.t("internal_hyperlink"),content:"",expanded:true,activeOn:"h1, h2, h3, h4, h5, h6",onInit:function(){var e=this,r=this.setContent('<label class="'+f("label")+'" for="'+f("input")+'">'+s.t("headerids.label.target")+'</label><input id="'+f("input")+'" class="'+f("input")+'" type="text" name="value"/> <button class="'+f("reset-button")+'">'+s.t("headerids.button.reset")+'</button><button class="'+f("set-button")+'">'+s.t("headerids.button.set")+"</button>").content;r.find(a("set-button")).click(function(){var n=e.content;t(e.effective).attr("id",t(a("input")).val());t(e.effective).addClass("aloha-customized")});r.find(a("reset-button")).click(function(){var r=e.content;n.processH(e.effective);t(e.effective).removeClass("aloha-customized");e.content.find(a("input")).val(e.effective.attr("id"))})},onActivate:function(e){var t=this;t.effective=e;t.content.find(a("input")).val(e.attr("id"))}});e.show()},makeClean:function(e){this.check(e)}})});define("metaview/nls/i18n",{root:{"button.switch-metaview.tooltip":"Switch between meta and normal view"},ca:true,de:true,mk:true,"pt-br":true,ru:true,uk:true,"zh-hans":true});define("metaview/metaview-plugin",["jquery","aloha/core","aloha/plugin","ui/ui","ui/toggleButton","i18n!metaview/nls/i18n","i18n!aloha/nls/i18n"],function(e,t,n,r,i,s){function u(e){return o[e[0].id]}function a(e,t){e.addClass("aloha-metaview");t.setState(true);o[e[0].id]=true}function f(e,t){e.removeClass("aloha-metaview");t.setState(false);o[e[0].id]=false}function l(e,t){if(u(e)){f(e,t)}else{a(e,t)}}function h(e,t){return e.getEditableConfig(t)}function p(t){return e.type(t)==="array"&&e.inArray("enabled",t)!==-1}function d(t){return e.type(t)==="array"&&e.inArray("metaview",t)!==-1}var o={};var c=r.adopt("toggleMetaView",i,{tooltip:s.t("button.switch-metaview.tooltip"),icon:"aloha-icon aloha-icon-metaview",scope:"Aloha.continuoustext",click:function(){l(t.activeEditable.obj,this)}});return n.create("metaview",{config:["metaview"],init:function(){var e=this;t.bind("aloha-editable-activated",function(){var n=h(e,t.activeEditable.obj);if(p(n)){c.show(true);a(t.activeEditable.obj,c)}else if(d(n)){c.show(true);if(u(t.activeEditable.obj)){a(t.activeEditable.obj,c)}else{f(t.activeEditable.obj,c)}}else{c.show(false)}});t.bind("aloha-editable-deactivated",function(){t.activeEditable.obj.removeClass("aloha-metaview")})}})});define("listenforcer/listenforcer-plugin",["aloha","jquery","aloha/plugin","aloha/console"],function(e,t,n,r){function s(e,n){if(t.inArray(e[0],i)===-1){return}e.find(".aloha-end-br").remove();var r=false;e.find("li").each(function(){if(t.trim(t(this).text())!==""){r=true;return false}});if(!r){e.html(n)}var s=e.find(">ul,>ol"),o=s.length,u;if(o>1){var a=t(s[0]);for(u=1;u<o;++u){a.append(t(s[u]).find(">li"));t(s[u]).remove()}}e.find(">*:not(ul,ol)").remove()}var i=[];return n.create("listenforcer",{_constructor:function(){this._super("listenforcer")},init:function(){var n=this,i=this.settings.editables||[],o,u,a=i.length;for(u=0;u<a;u++){o=i[u];if(typeof o==="string"||o.nodeName||o instanceof t){t(o).each(function(){n.addEditableToEnforcementList(this)})}else{r.warn("Aloha List Enforcer Plugin",'Object "'+o.toString()+'" can not '+"be used as a jQuery selector with which to register"+" an editable to be list enforced.")}}e.bind("aloha-editable-activated",function(e,t){s(t.editable.obj,"<ul><li><br /></li></ul>")});e.bind("aloha-editable-deactivated",function(e,t){s(t.editable.obj,"")});e.bind("aloha-smart-content-changed",function(t,n){if(e.activeEditable&&e.activeEditable.isActive===true){s(n.editable.obj,"<ul><li><br /></li></ul>")}})},addEditableToEnforcementList:function(e){if(e){i.push(e)}}})});if(Aloha._load){Aloha._load()}})();